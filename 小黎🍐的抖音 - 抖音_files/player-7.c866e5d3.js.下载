/*! For license information please see player-7.c866e5d3.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).xss={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function i(e,t,i){if(i||2==arguments.length)for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}var n=/[^a-zA-Z0-9\\_:.-]/gim,r=/</g,o=/>/g,a=/&#([a-zA-Z0-9]*);?/gim,s=/&quot;/g,l=/&colon;?/gim,d=/&newline;?/gim,c=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,u=/u\s*r\s*l\s*\(.*/gi,f=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,h=/"/g,g=function(e){return e.replace(r,"&lt;").replace(o,"&gt;")},p={indexOf:function(e,t){var i,n;for(i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return -1},forEach:function(e,t,i){var n,r;for(n=0,r=e.length;n<r;n++)t.call(i,e[n],n,e)},some:function(e,t,i){var n,r;for(n=0,r=e.length;n<r;n++)if(t.call(i,e[n],n,e))return!0;return!1},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},includes:function(e,t){if("string"==typeof e)return -1!==e.indexOf(t);for(var i=0;i<e.length;i++)if(e[i]===t)return!0;return!1},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1},uniq:function(e){for(var t={},i=[],n=0;n<e.length;n++)t[e[n]]||(i.push(e[n]),t[e[n]]=!0);return i},from:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i]);return t},keys:function(e){var t=[];for(var i in e)t.push(i);return t}};function v(e){return null==e}function m(e){var t;return'"'===(t=e)[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]?e.substr(1,e.length-2):e}function y(e){var t,i,n,r,o,a,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d="",c=0;for(e=function(e){e=e.replace(/rn/g,"n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?t+=String.fromCharCode(n>>6|192)+String.fromCharCode(63&n|128):t+=String.fromCharCode(n>>12|224)+String.fromCharCode(n>>6&63|128)+String.fromCharCode(63&n|128)}return t}(e);c<e.length;)r=(t=e.charCodeAt(c++))>>2,o=(3&t)<<4|(i=e.charCodeAt(c++))>>4,a=(15&i)<<2|(n=e.charCodeAt(c++))>>6,s=63&n,isNaN(i)?a=s=64:isNaN(n)&&(s=64),d=d+l.charAt(r)+l.charAt(o)+l.charAt(a)+l.charAt(s);return d}function I(e){var t,i,n,r,o,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",d=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");d<e.length;)t=s.indexOf(e.charAt(d++))<<2|(r=s.indexOf(e.charAt(d++)))>>4,i=(15&r)<<4|(o=s.indexOf(e.charAt(d++)))>>2,n=(3&o)<<6|(a=s.indexOf(e.charAt(d++))),l+=String.fromCharCode(t),64!==o&&(l+=String.fromCharCode(i)),64!==a&&(l+=String.fromCharCode(n));return function(e){for(var t="",i=0,n=0,r=0,o=0;i<e.length;)(n=e.charCodeAt(i))<128?(t+=String.fromCharCode(n),i++):n>191&&n<224?(t+=String.fromCharCode((31&n)<<6|63&(o=e.charCodeAt(i+1))),i+=2):(o=e.charCodeAt(i+1),t+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&(r=e.charCodeAt(i+2))),i+=3);return t}(l)}function _(e,t,i){var n="",r=0,o=!1,a=!1,s=0,l=e.length,d="",c="";e:for(s=0;s<l;s++){var u=e.charAt(s);if(!1===o){if("<"===u){o=s;continue}}else if(!1===a){if("<"===u){n+=i(e.slice(r,s)),o=s,r=s;continue}if(">"===u||s===l-1){n+=i(e.slice(r,o)),d=function(e){var t,i=p.spaceIndex(e);return t=-1===i?e.slice(1,-1):e.slice(1,i+1),"/"===(t=p.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}(c=e.slice(o,s+1)),n+=t(o,n.length,d,c,"</"===c.slice(0,2)),r=s+1,o=!1;continue}if('"'===u||"'"===u)for(var f=1,h=e.charAt(s-f);""===h.trim()||"="===h;){if("="===h){a=u;continue e}h=e.charAt(s-++f)}}else if(u===a){a=!1;continue}}return r<l&&(n+=i(e.substr(r))),n}function C(e,t){var i=0,r=0,o=[],a=!1,s=e.length;function l(e,i){if(!((e=(e=p.trim(e)).replace(n,"").toLowerCase()).length<1)){var r=t(e,i||"");r&&o.push(r)}}for(var d=0;d<s;d++){var c=e.charAt(d),u=void 0;if(!1!==a||"="!==c){if(!1===a||d!==r){if(/\s|\n|\t/.test(c)){if(e=e.replace(/\s|\n|\t/g," "),!1===a){if(-1===(u=function(e,t){for(;t<e.length;t++){var i=e[t];if(" "!==i)return"="===i?t:-1}return -1}(e,d))){l(p.trim(e.slice(i,d))),a=!1,i=d+1;continue}d=u-1;continue}if(-1===(u=function(e,t){for(;t>0;t--){var i=e[t];if(" "!==i)return"="===i?t:-1}return -1}(e,d-1))){l(a,m(p.trim(e.slice(i,d)))),a=!1,i=d+1;continue}}}else{if(-1===(u=e.indexOf(c,d+1)))break;l(a,p.trim(e.slice(r+1,u))),a=!1,i=(d=u)+1}}else a=e.slice(i,d),i=d+1,r='"'===e.charAt(i)||"'"===e.charAt(i)?i:function(e,t){for(;t<e.length;t++){var i=e[t];if(" "!==i)return"'"===i||'"'===i?t:-1}return -1}(e,d+1)}return i<e.length&&(!1===a?l(e.slice(i)):l(a,m(p.trim(e.slice(i))))),p.trim(o.join(" "))}function A(e,t,i){if(i=function(e){return e=function(e){for(var t="",i=0,n=e.length;i<n;i++)t+=32>e.charCodeAt(i)?" ":e.charAt(i);return p.trim(t)}(e=(e=(e=e.replace(s,'"')).replace(a,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})).replace(l,":").replace(d," "))}(i),"href"===t||"src"===t){if("#"===(i=p.trim(i)))return"#";if("http://"!==i.substr(0,7)&&"https://"!==i.substr(0,8)&&"mailto:"!==i.substr(0,7)&&"tel:"!==i.substr(0,4)&&"data:image/"!==i.substr(0,11)&&"ftp://"!==i.substr(0,6)&&"./"!==i.substr(0,2)&&"../"!==i.substr(0,3)&&"#"!==i[0]&&"/"!==i[0])return""}else if("background"===t){if(c.lastIndex=0,c.test(i))return""}else if("style"===t&&(f.lastIndex=0,f.test(i)||(u.lastIndex=0,u.test(i)&&(c.lastIndex=0,c.test(i)))))return"";return i=function(e){return e=g(e=e.replace(h,"&quot;"))}(i)}var b=function(e){return"string"==typeof e?e.replace(/'/g,'"').replace('=""',"").replace(/\s+/g,"").toLowerCase():""},k=function(){function e(e){var t=function(e){var t={};for(var i in e)t[i]=e[i];return t}(e||{});t.stripIgnoreTag&&(t.onIgnoreTag,t.onIgnoreTag=function(){return""}),t.whiteList={},t.onTag=function(){},t.onTagAttr=function(){},t.onIgnoreTag=function(){},t.onIgnoreTagAttr=function(){},t.safeAttrValue=A,t.escapeHtml=g,this.options=Object.assign(t,e)}return e.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t,i,n,r,o,a,s=this.options,l=s.whiteList,d=s.onTag,c=s.onIgnoreTag,u=s.onTagAttr,f=s.onIgnoreTagAttr,h=s.safeAttrValue,g=s.escapeHtml;s.stripBlankChar&&(e=(t=(t=e.split("")).filter(function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)})).join("")),s.allowCommentTag||(e=function(e){for(var t="",i=0;i<e.length;){var n=e.indexOf("\x3c!--",i);if(-1===n){t+=e.slice(i);break}t+=e.slice(i,n);var r=e.indexOf("--\x3e",n);if(-1===r)break;i=r+3}return t}(e));var v=!1;s.stripIgnoreTagBody&&(i=s.stripIgnoreTagBody,"function"!=typeof(n=c)&&(n=function(){}),r=!Array.isArray(i),o=[],a=!1,c=(v={onIgnoreTag:function(e,t,s){var l;if(l=e,r||-1!==p.indexOf(i,l)){if(s.isClosing){var d="[/removed]",c=s.position+d.length;return o.push([!1!==a?a:s.position,c]),a=!1,d}return a||(a=s.position),"[removed]"}return n(e,t,s)},remove:function(e){var t="",i=0;return p.forEach(o,function(n){t+=e.slice(i,n[0]),i=n[1]}),t+=e.slice(i)}}).onIgnoreTag);var m=_(e,function(e,t,i,n,r){var o={sourcePosition:e,position:t,isClosing:r,isWhite:Object.prototype.hasOwnProperty.call(l,i)},a=d(i,n,o);if(null!=a)return a;if(o.isWhite){if(o.isClosing)return"</".concat(i,">");var s=function(e){var t=p.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var i="/"===(e=p.trim(e.slice(t+1,-1)))[e.length-1];return i&&(e=p.trim(e.slice(0,-1))),{html:e,closing:i}}(n),v=l[i],m=C(s.html,function(e,t){var n=-1!==p.indexOf(v,e),r=u(i,e,t,n);return null==r?n?(t=h(i,e,t,null))?"".concat(e,'="').concat(t,'"'):e:null==(r=f(i,e,t,n))?void 0:r:r});return n="<".concat(i),m&&(n+=" ".concat(m)),s.closing&&(n+=" /"),n+=">"}return null==(a=c(i,n,o))?g(n):a},g);return v&&(m=v.remove(m)),m},e}(),E=Function("\nvar _checkXSS = function (it) {\n  return it && it.Math == Math && it;\n};\nreturn _checkXSS(typeof globalThis === 'object' && globalThis) ||\n_checkXSS(typeof window === 'object' && window) ||\n_checkXSS(typeof self === 'object' && self) ||\n_checkXSS(typeof global === 'object' && global) ||\nFunction('return this')();\n")(),S=new(function(){function e(){var e=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var t,i,n="douyin_web";if(!p.includes(n,"bid"))return n;if(e.config&&e.config.bid)return e.config.bid;if(E&&E._xssBid)return E._xssBid;if(E&&E.slardar&&"function"==typeof E.slardar.config){var r=(E.slardar.config()||{}).bid;if(r)return r}if(E&&E.Slardar&&"function"==typeof E.Slardar.config){var o=(E.Slardar.config()||{}).bid;if(o)return o}return(null===(i=null===(t=null==E?void 0:E.Slardar)||void 0===t?void 0:t._baseParams)||void 0===i?void 0:i.bid)||"argus"},this.getConfigRegion=function(){var t;return p.includes("cn","region")?e.config&&e.config.region?e.config.region:((null===(t=null==E?void 0:E.gfdatav1)||void 0===t?void 0:t.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=function(){var t={cn:I("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boe:I("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),ttp:I("aHR0cHM6Ly9tb24udXMudGlrdG9rdi5jb20vbW9uaXRvcl9icm93c2VyL2NvbGxlY3QvYmF0Y2gvc2VjdXJpdHkvP2JpZD0="),va:I("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),maliva:I("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),sg:I("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boei18n:I("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9")}[e.getConfigRegion()];if(t)return t+e.getSlardarBid()}}return e.prototype.setConfig=function(e){this.config=e},e.prototype.upload=function(){var e=this,t=this.gerReportUrl();!this.lock&&t&&0!==this.batchData.length&&(this.lock=!0,setTimeout(function(){var i=e.batchData.slice(0,100);e.batchData=e.batchData.slice(100),E.fetch(t,{method:"post",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).catch(function(e){}),e.lock=!1,e.upload()},this.timeout))},e.prototype.generateKey=function(e){return e.collectKey?[e.collectMode,e.collectKey].join("___"):""},e.prototype.push=function(e){this.batchData.push(e),this.upload()},e.prototype.report=function(e){var t=this.generateKey(e);if(E.fetch&&e.collectKey){var i="object"==typeof window?window.location.href:"SSR";e.documentUrl=i;var n={age:Math.floor(Date.now()),type:"xss",url:i,body:e,"user-agent":""};"enforce"===e.disposition&&"SSR"!==i||(n.url=t),"SSR"===i&&(n.url="SSR___".concat(n.url),n.body.ssr=!0),this.push(n)}},e}()),Z=function(e){for(var t=0,i=function(i){Array.isArray(e[i])?0===e[i].length?delete e[i]:(e[i]=p.from(p.uniq(e[i])),t+=e[i].length):0===p.keys(e[i]).length?delete e[i]:p.keys(e[i]).forEach(function(n){e[i][n]=p.from(p.uniq(e[i][n])),t+=e[i][n].length})},n=0,r=p.keys(e);n<r.length;n++)i(r[n]);return{count:t,ret:e}};function T(e,t){return S.setConfig(t),new k(t).process(e)}function R(e){var t,i=(t=/\s|\n|\t/.exec(e))?t.index:-1;if(-1===i)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=e.slice(i+1,-1).trim())[e.length-1];return n&&(e=e.slice(0,-1).trim()),{html:e,closing:n}}var D=function(e){return -1===(e=(e=(e=(e=e.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?e.trim().toLowerCase():e.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,function(e,t,i,n){return String.fromCharCode(t?parseInt(i,16):parseInt(n))}).replace(/(\t|\n|\r)/g,"").toLowerCase()};function w(e,t){if(void 0===e&&(e=""),"string"!=typeof e)return!0;if(e=D(e),p.includes(e,"base64")&&!function(e){if(""===e||""===e.trim())return!0;try{return!p.includes(e,"data:text/html;base64")}catch(e){return!0}}(e))return t&&t("data:text/html;base64"),!1;var i=["expression(","behavior:","view-source:"];if(p.some(i,function(t){return -1!==e.indexOf(t)}))return p.forEach(i,function(i){-1!==e.indexOf(i)&&t&&t(i)}),!1;var n=["data:application","data:javascript","data:text/html","data:texthtml"];if(p.some(n,function(t){return -1!==e.indexOf(t)}))return p.forEach(n,function(i){-1!==e.indexOf(i)&&t&&t(i)}),!1;if(e.indexOf("javascript:")>0)return t&&t("javascript:"),!1;if(/^javascript:/i.test(e)){var r=e.slice(11).replace(/\s/g,"").trim();return!!p.some(["void","void(0)","void0","false","undefined",";"],function(e){return e===r})||(t&&t("javascript:"),!1)}return!0}var L=function(e,t){var i,n,r="<%= isSaveValidUrl =>";if("string"!=typeof e||(n=Number("<%= urlLimit =>"),void 0!==i&&(n=i),"NaN"!==e.toString()&&-1!==n&&e.length>=n)||w(e,t))return e;try{if(!0===(r=JSON.parse(r))||"true"===r){var o=new URL(e);return o.origin+o.pathname}}catch(e){}return"#"};function B(e,t,n){if(void 0===e&&(e=""),void 0===t&&(t=[]),"string"!=typeof e)return!0;if(!w(e=D(e)))return!1;var r,o={url:(r=e.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[])[0],scheme:r[1],slash:r[2],host:r[3],port:r[4],path:r[5],query:r[6],hash:r[7]},a=o.scheme,s=o.host;return n?!!n(e):!(!a||!s)&&(!p.includes(["http","https","file"],a)||("object"==typeof window&&window&&(t=i(i([],t,!0),[location.host],!1)),p.some(t,function(e){return!!(e instanceof RegExp&&e.test(s))||e===s})))}var P={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},x={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var e=Z(this.collect),t=e.count,i=e.ret;return this.collect=null,{collectKey:0===t?null:JSON.stringify(i),collectMode:"white"}},onIgnoreTagAttr:function(e,t,n){return e&&p.indexOf(["href","src"],t)>-1?x.domainWhiteList&&Array.isArray(x.domainWhiteList)&&x.domainWhiteList.length>0&&!B(n,i([],x.domainWhiteList,!0))?"":"".concat(t,'="').concat(L(n,function(e){var t;null===(t=x.collect)||void 0===t||t.filterProtocol.push(e)}),'"'):e&&(p.indexOf(["style","class","id"],t)>-1||t.indexOf("data-")>-1)?"".concat(t,'="').concat(n,'"'):(x.collect.whiteList[e]=x.collect.whiteList[e]||[],void x.collect.whiteList[e].push(t))},onIgnoreTag:function(e,t){if("style"===e)return t;_(t,function(e,t,i,n){C(R(n).html.replace("/",""),function(e){x.collect.whiteList[i]=x.collect.whiteList[i]||[],x.collect.whiteList[i].push(e)})},g)},whiteList:P,mergeWhiteList:function(e){for(var t,i={},n=0,r=p.keys(P);n<r.length;n++)i[t=r[n]]=p.from(P[t]);for(var o=0,a=p.keys(e);o<a.length;o++)i[t=a[o]]=t in P?P[t].concat(e[t]):p.from(e[t]);return i},setWhiteList:function(e){for(var t=0,i=p.keys(e);t<i.length;t++){var n=i[t];this.whiteList[n]=n in P?P[n].concat(e[n]):p.from(e[n])}}};try{var N={},O="merge";p.includes(O,"override")&&(x.whiteList=N.whiteList),p.includes(O,"merge")&&x.setWhiteList(N.whiteList)}catch(e){}var V=function(e,t){for(var i={},n=0,r=p.keys(e);n<r.length;n++){var o=r[n];Array.isArray(e[o])?i[o]=p.from(e[o]):i[o]=V({},e[o])}for(var a=0,s=p.keys(t);a<s.length;a++)(o=s[a])in e?Array.isArray(e[o])?i[o]=e[o].concat(t[o]):i[o]=V(e[o],t[o]):Array.isArray(t[o])?i[o]=p.from(t[o]):i[o]=V({},t[o]);return i},M={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var G={};G.blackAttrRegExps&&(G.blackAttrRegExps=G.blackAttrRegExps.map(function(e){return new RegExp(e.toString().slice(1,e.toString().length-1))}));var U="merge";p.includes(U,"override")&&(M=G),p.includes(U,"merge")&&(M=V(M,G))}catch(e){}var W={mode:"black",whiteList:{},blackConfig:M,collect:null,initCollect:function(){W.collect={blackList:{},blackTags:[],blackAttrs:[],blackAttrRegExps:[],filterAttrs:[],filterList:{},filterProtocol:[]}},removeCollect:function(){var e=Z(W.collect),t=e.count,i=e.ret;return W.collect=null,{collectKey:0===t?null:JSON.stringify(i),collectMode:"black"}},onIgnoreTag:function(e,t){var i;if(!p.includes(M.blackTags,e))return _(t,function(e,t,i,n,r){if(-1!==i.indexOf("/"))return g(n);if(r)return"</".concat(i,">");var o=R(n),a=C(o.html,function(e,t){var n,r=0;if(M.blackList[i]&&p.includes(M.blackList[i],e)&&(W.collect.blackList[i]=W.collect.blackList[i]||[],W.collect.blackList[i].push(e),r++),M.blackAttrRegExps.length&&M.blackAttrRegExps.some(function(t){return t.test(e)})&&p.forEach(M.blackAttrRegExps,function(t){t.test(e)&&(W.collect.blackAttrRegExps.push("".concat(t.toString(),"->").concat(e)),r++)}),M.blackAttrs.length&&p.includes(M.blackAttrs,e)&&(M.blackAttrs.push(e),r++),!r){if(M.filterList&&M.filterList[i]&&p.includes(M.filterList[i],e)){var o=L(t,function(e){var t;null===(t=W.collect)||void 0===t||t.filterProtocol.push(e)});return o!==t&&(W.collect.filterList[i]=W.collect.filterList[i]||[],W.collect.filterList[i].push(e)),t?"".concat(e,"='").concat(o,"'"):e}return M.filterAttrs&&p.includes(M.filterAttrs,e)?((o=L(t,function(e){var t;null===(t=W.collect)||void 0===t||t.filterProtocol.push(e)}))!==t&&(null===(n=W.collect)||void 0===n||n.filterAttrs.push(e)),t?"".concat(e,"='").concat(o,"'"):e):t?"".concat(e,"='").concat(t,"'"):e}});return n="<".concat(i),a&&(n+=" ".concat(a)),o.closing&&(n+=" /"),n+=">"},g);null===(i=W.collect)||void 0===i||i.blackTags.push(e)}},K=function(e){var t=e.reportOnly,i=void 0===t||t,n=e.block;return i&&"all"===i?"report":("string"==typeof i&&("true"===i&&(i=!0),"false"===i&&(i=!1)),n?"enforce":i?"report":"enforce")},H=function(e){return function(i,n,r){if(!i||"string"!=typeof i)return i;var o=n;e===T&&(o=x).initCollect();var a=e(i,o);if(b(a)===b(i))return i;if(!r)return a;var s=r.logType,l=K(r),d=o.removeCollect();return S.report(t(t({type:s,disposition:l},d),{sourceText:y(i),filterText:y(a)})),"enforce"===l?a:i}},Y=H(function(e,t){return void 0===t&&(t={}),t&&t.whiteList||(t.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}),new k(t).process(e)}),F=H(T),X=function(e,t,i){var n=[],r=L(e,function(e){n.push(e)});if(r===e)return e;n=p.from(p.uniq(n));var o=t||i||{};if(!o)return r;var a=o.logType,s=K(i);return S.report({type:a,disposition:s,collectKey:n.join("___"),collectData:JSON.stringify(n),collectMode:"black",sourceText:y(e),filterText:y(r)}),"enforce"===s?r:e},j=E._xssProject||{},z=E.xssNamespace||{},J="3.0.26",q={FilterXSS:k,version:J,webpackPluginVersion:"<%= webpackPluginVersion =>",reportOnly:"<%= reportOnly =>",filterXSS:Y,_filterXSS:F,filterUrl:X,Config:x,BlackConfig:W,project:j,setProjectName:function(e){j[e]=this,E._xssProjectName=e}};z.douyin_web=q,E.xssNamespace=z,E.Math&&!E.Math.xssNamespace&&(E.Math.xssNamespace=z),j[J]=q,E.globalThis=E,E.getFilterXss=function(){return void 0!==this._xssProjectName?this._xssProject[this._xssProjectName]:q},E.xss=q,E.isSafeUrl=B,E.isSafeDomain=B,E.isSafeProtocol=w,E._xssProject=j,E._xssProjectName&&(j[E._xssProjectName]=q);var Q=q.setProjectName.bind(q);e.BlackConfig=W,e.Config=x,e.FilterXSS=k,e._filterXSS=F,e.filterUrl=X,e.filterXSS=Y,e.isSafeDomain=B,e.isSafeProtocol=w,e.isSafeUrl=B,e.project=j,e.setProjectName=Q,e.setXssNamespace=function(e){var t=e.appId,i=e.bid,n=e.region;z[t]=q;x.bid=i,x.region=n,x.enabled=!0},e.xssNamespace=z,Object.defineProperty(e,"__esModule",{value:!0})});"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["264"],{963636:function(e,t,i){i.d(t,{Cy:function(){return f},G9:function(){return d},ZP:function(){return l},_M:function(){return c}}),i(904644),i(227470),i(766282),i(34580),i(41873),i(514312),i(864614),i(632852),i(614521);var n=[{key:"QQBrowser",reg:/(qqbrowser)\/([\d.]+)/},{key:"QIHU360EE",reg:/qihu 360ee/},{key:"QIHU360SE",reg:/qihu 360se/},{key:"2345Explorer",reg:/(2345explorer)\/([\d.]+)/},{key:"Sogou",reg:/(metasr)/},{key:"Wexin",reg:/(micromessenger)\/([\d.]+)/},{key:"Openlanguage",reg:/(openlanguage)\/([\d.]+)/},{key:"NewsArticle",reg:/(newsarticle)\/([\d.]+)/},{key:"VideoArticle",reg:/(videoarticle)\/([\d.]+)/},{key:"Hotsoon",reg:/(live_stream)_([\d.]+)/},{key:"Aweme",reg:/(aweme)_([\d.]+)/},{key:"Lark",reg:/(lark)\/([\d.]+)/},{key:"PlayStation",reg:/(playstation)/},{key:"BingPreview",reg:/(bingpreview)\/([\d.]+)/},{key:"Baiduspider",reg:/(baiduspider-render)\/([\d.]+)/},{key:"YandexBot",reg:/(yandexbot)\/([\d.]+)/},{key:"Chrome",reg:/(chrome)\/([\d.]+)/},{key:"Safari",reg:/(version)\/([\d.]+)\s*(safari)/}],r=[{key:"Trident",reg:/(rv:)([\d.]+)/},{key:"Trident",reg:/(msie)\s*([\d.]+)/}],o=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],a=["Baiduspider","YandexBot"],s=["Baiduspider","googlebot","360Spider","haosouspider","YoudaoBot","Sogou News Spider","Yisouspider","Googlebot","Headless","Applebot","Bingbot","PetalBot"],l="undefined"!=typeof navigator&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e=e.toLocaleLowerCase();var t=/(iphone)/.test(e)||/(ipad)/.test(e),i=/(android)/.test(e),l=/(windows phone)/.test(e),d=t||i||l,c={isIOS:t,isAndroid:i,isMobile:d,isPC:!d,isPad:/(ipad)/.test(e)},u=function(){var e={isSupport:!1,mime:""};if("undefined"==typeof document)return e;var t=document.createElement("video");return"function"==typeof t.canPlayType?(o.map(function(i){"probably"===t.canPlayType('video/mp4; codecs="'.concat(i,'"'))&&(e.isSupport=!0,e.mime+="||".concat(i))}),e):(t=null,e)}();c.isSupportMP4=u.isSupport,c.mime=u.mime;var f="",h=0,g=[],p=n;/trident/.test(e)&&(p=r);for(var v=0;v<p.length;v++)if(g=p[v].reg.exec(e)){f=p[v].key,h=g.length>2?g[2]:"";break}return f?(c["is".concat(f)]=!0,c.name=f,c.appVersion=h):function(){var e=navigator.mimeTypes;if(e){for(var t=0;t<e.length;t++)if(e[t].type&&e[t].type.indexOf("360")>-1||e[t].type&&e[t].type.indexOf("application/vnd.chromium.remoting-viewer")>-1||e[t].description&&e[t].description.indexOf("360")>-1)return!0;return!1}}()&&(c.name="360EE"),c.name&&"Trident"!==c.name&&/(trident)/.exec(e)&&(c.name=c.name?"".concat(c.name,"_Trident"):"Trident"),c.isSpider=function(e,t){var i=!1;a.map(function(t){t===e&&(i=!0)});for(var n=0;n<s.length;n++){var r=s[n];if(-1!==t.indexOf(r)){i=!0;break}}return i}(c.name,e),c}(navigator.userAgent);function d(){return"undefined"!=typeof MediaSource&&!!MediaSource.isTypeSupported&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))}function c(){if("undefined"==typeof MediaSource||!MediaSource.isTypeSupported)return{support:!1,message:"MediaSource API not support"};for(var e=!1,t="",i=0;i<o.length;i++){var n='video/mp4; codecs="'.concat(o[i],'"'),r=MediaSource.isTypeSupported(n);t+="".concat(n," is ").concat(r," "),r&&(e=!0)}return{support:e,message:t}}var u=[1,1,1,1,1];function f(){return parseInt(u.join(""),10)}u[0]=l.isSupportMP4?u[1]+1:u[1],u[1]=d()?u[1]+1:u[1],(function(e){var t={supported:!1,smooth:!1,powerEfficient:!1};if(!e||"undefined"==typeof navigator)return Promise.resolve(t);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(e);var i=e.video||{},n=e.audio||{};try{var r=MediaSource.isTypeSupported(i.contentType),o=MediaSource.isTypeSupported(n.contentType);return Promise.resolve({supported:r&&o,smooth:!1,powerEfficient:!1})}catch(e){return Promise.resolve(t)}})({type:"file",video:{contentType:'video/mp4;codecs="hev1.1.6.L120.90"',width:1920,height:1080,bitrate:1e4,framerate:30}}).then(function(e){e&&e.supported?u[2]=u[2]+1:u[2]=1}).catch(function(){u[2]=u[2]-1})},793849:function(e,t,i){i.d(t,{GX:function(){return o},_K:function(){return a},vr:function(){return r}});var n,r=((n=r||{}).H264="h264",n.H265="h265",n.H266="h266",n),o=8e5;function a(){return{supportHevc:!1,preloadTime:5,preloadSize:0,segmentMinDuration:5,vtype:"MP4",preloadCacheType:1,preloadMaxCacheCount:5,globalKey:null,autoPreload:!1,reqOptions:null,getRequestOptionsCallback:null,minBufferLength:5,timeout:3e3,autoCheck:{enable:!0,interval:1e3},logCacheConfig:{logCacheLevel:2,logMaxSize:204800},pcdnConfig:{openPreloadPCDN:!1,enterMinBuffer:10,outMaxBuffer:5,pcdn_duration:2,pcdn_open:!0,openPCDN:!0,minDuration:25,trackerUrl:""},switchPCDNMaxCnt:2,retryCount:1,retryDelay:1e3,loaderType:"fetch"}}},768891:function(e,t,i){i.d(t,{Z:function(){return V}});var n,r,o,a,s,l,d,c,u=i(884504);i(514312),i(561999),i(11258),i(121621),i(585322),i(577829),i(410121),i(724356),i(947478),i(864614),i(632852),i(130458),i(238658),i(347885),i(616414),i(812735),i(623302),i(983431),i(319386),i(657170),i(853127),i(644952),i(759149),i(949136),i(966922),i(33814),i(29536),i(716005),i(548485),i(260075),i(791017),i(743286),i(310378),i(124539),i(48498),i(728271),i(814647),i(535689),i(659673),i(210434),i(612222),i(510766),i(433257),i(312602);var f=i(241689),h=i.n(f),g=i(587503),p=i.n(g),v=i(801379),m=i(239714),y=i(140709),I=i(611451),_=i(721035),C=i(897948),A=i(927425),b=i(431413),k=i(569898),E=i(479461),S=i(203199),Z=i(280161),T=i(54751),R=i(334884),D=i(907376),w=i(539590),L=i(340412),B=i(342189),P=i(918334),x=i(233343),N=v.EVENT_EME.CDM_LICENSE_ERROR,O=v.EVENT_EME.CDM_LICENSE_SUCCESS;let V=(0,u.qH)(function e(t,i,n){var r,o=this;(0,u.PA)(this,e),h()(this),this._pluginInst=i,this.__dash__=n;var a=i.config,s=i.player,l=i._kernal;this.kernal=l,this.mse=void 0,this.config=a,this.player=s,this.url=t,this.inited=!1,this.loadingTasks=[],this.keyValue=void 0,this.dynamic_video=this.config.dashOpts.dynamic_video,this.useEME=this.config.useEME,this.intertrustServerURL=this.config.intertrustServerURL,this.taskErrorList=[],this.defaultDefinition=this.config.defaultDefinition,this.selectedIdx=0,this.getLicenseUrl=this.config.getLicenseUrl,this.egleIds={},this._resetOptionDataLenInfo(),this._initStates={emitEncrypt:!1};var d=this.config,c=d.loader,f=d.reqOptions,g=d.vid;this.loader=new y.Z(Object.assign({openLog:k.qu,vid:g},c,f),this._pluginInst.preloadManager),this.loader.on(I.K.REAL_TIME_SPEED,function(e){o.player.emit(I.K.REAL_TIME_SPEED,e)}),this._vTrack=null,this._aTrack=null,this._onLoadingItems=[],this._videoEncryption=!1,this._audioEncryption=!1;var p=this.config.duration||this.config.dashOpts.video_duration||this.config.dashOpts.dynamic_video.video_duration;this.config.duration=p;var v=(null===(r=this.config.dashOpts)||void 0===r||null===(r=r.dynamic_video)||void 0===r?void 0:r.dynamic_type)==="segment_base";this._vid=a.vid;var m=this.player.config.uri||a.vid;this._pcdnScv=new B.Z({config:a,isOpenPCDN:v,videoDuration:p,uri:m},this.player),this._dynamicBufferService=new w.Z(this.player,0,p,this.config.adaptRange),this._audioMetaReadyPromise=null,this._videoMetaReadyPromise=null,this._aduioMetaReady=!1,this._videoMetaReady=!1,this._resetProgressInfos(),this._appendBufferDelta={video:this._genEmptyBufferDelta(),audio:this._genEmptyBufferDelta()},this._lastAppendBufferEnd={video:{prevRangeEnd:0,prevItem:null},audio:{prevRangeEnd:0,prevItem:null}},this._preloadSegDatas={video:[],audio:[]},this._allCacheKeys=[],this._pendingAppnedDatas={video:[],audio:[]},this._extDataCache={video:null,audio:null}},[{key:"_genEmptyBufferDelta",value:function(){return{delta:0,item:null,requestDelta:0,isPCDN:!1}}},{key:"_resetProgressInfos",value:function(){this._progressInfos={video:this._genEmptyProgressInfo(),audio:this._genEmptyProgressInfo()}}},{key:"_genEmptyProgressInfo",value:function(){return{data:new Uint8Array(0),range:null,extData:null,done:!1}}},{key:"cachePreloadData",value:function(){var e;null===(e=this.loader)||void 0===e||e.cachePreloadData({vid:this._vid,codecType:this.mpd.getCodecType()},this._progressInfos),this._progressInfos.video.done&&(this._progressInfos.video=this._genEmptyProgressInfo()),this._progressInfos.audio.done&&(this._progressInfos.audio=this._genEmptyProgressInfo())}},{key:"_updateLoadInfo",value:function(e,t){!this.loadInfo&&(this.loadInfo={}),!this.loadInfo[e]&&(this.loadInfo[e]={},this.loadInfo[e].size=0),this.loadInfo[e].size+=t}},{key:"_resetOptionDataLenInfo",value:function(){this._optionDataLenInfo={video:(0,u._x)((0,u._x)({},D.Lj.PCDN,{size:0}),D.Lj.CDN,{size:0}),audio:(0,u._x)((0,u._x)({},D.Lj.PCDN,{size:0}),D.Lj.CDN,{size:0})}}},{key:"getPCDNInOutBuffer",value:function(){var e;return null===(e=this._pcdnScv)||void 0===e?void 0:e.getPCDNInOUtBuffer()}},{key:"updateDynamicBufferServiceBitrate",value:function(e){this._dynamicBufferService.updateBitrate(e)}},{key:"getAdaptCacheBuffer",value:function(e){return this._dynamicBufferService.getAdaptCacheBuffer(e)}},{key:"pushDynamicBufferServiceRes",value:function(e){this._dynamicBufferService.push(e)}},{key:"popDynamicBufferServiceRes",value:function(){var e;return(null===(e=this._dynamicBufferService)||void 0===e?void 0:e.pop())||{}}},{key:"getPCDNTraceInfo",value:function(){var e;return null===(e=this._pcdnScv)||void 0===e?void 0:e.getPCDNTraceInfo()}},{key:"_abortAndRemove",value:(n=(0,u.x)((0,u.l5)().mark(function e(t,i,n){var r,o,a,s,l,d,c,f,h=arguments;return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!(h.length>3)||void 0===h[3]||h[3],a=(null===(r=this.player)||void 0===r?void 0:r.currentTime)||-1,s=i.startRaw<a&&a<i.endRaw,!o){e.next=6;break}return e.next=6,null===(l=this.loader)||void 0===l?void 0:l.cancelTasks(t,!0);case 6:s?this._appendBufferDelta&&((f=this._appendBufferDelta[t]).range&&i.range&&i.range[0]<f.range[1]&&f.range[1]<i.range[1]&&(i.extRange=[f.range[1],i.range[1]],this._extDataCache[t]=i),k.ZP.log("_abortAndRemove",t,"start",i.startRaw,"end",i.endRaw,"extRange",JSON.stringify(i.extRange),"range",JSON.stringify(i.range),n),this._appendBufferDelta[t]=this._genEmptyBufferDelta()):(i.isSatisfied&&(k.ZP.log("_abortAndRemove isSatisfied abort and clear"),null===(d=this.__dash__)||void 0===d||d.abort(t),null===(c=this.__dash__)||void 0===c||c.clearBufferDirect(t,i)),this.updateItemState(i),k.ZP.log("_abortAndRemove",t,"start",i.startRaw,"end",i.endRaw,"from",n));case 7:case"end":return e.stop()}},e,this)})),function(e,t,i){return n.apply(this,arguments)})},{key:"onTimeUpdate",value:function(){if(!this._appendBufferDelta)return;var e=this.config,t=e.usePCDNProgressiveCheck,i=e.progressiveTimeout,n=e.useCDNProgressiveCheck;if(!!t||!!n)for(var r=Object.keys(this._appendBufferDelta),o=S.Z.nowTime(),a=0;a<r.length;a++){var s=r[a],l=this._appendBufferDelta[s],d=l.delta,c=l.requestDelta,u=l.item,f=l.isPCDN,h=!1;if(t&&f&&(h=!0),n&&!f&&(h=!0),u&&h){var g=this.player.playbackRate,p=d>0&&o-d>i,v=c>0&&o-c>(u.end-u.start)*1e3/g;(p||v)&&(k.ZP.log("_abortAndRemove PCDN request cancel, progressiveTimeout",p,"requestTimeout",v,"segDuration",u.end-u.start,"s"),this.player&&this.player.emit("log",{type:"oneevent",end_type:p?"progressive_timeout":"pcdn_request_timeout"}),this._abortAndRemove(s,u,"pcdn onTimeUpdate",!0))}}}},{key:"_emitAbrNextSegmentPredictEvt",value:function(e){var t;null===(t=this.player)||void 0===t||t.emit(x._c.NEXT_SEGMENT_PREDICT,e)}},{key:"getData",value:(r=(0,u.x)((0,u.l5)().mark(function e(t){var i=this,n,r,o,a,s,l,d,c,f,h,g,p,v,m,y,I,A,b,k,E,Z,T,R,w=arguments;return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=w.length>1&&void 0!==w[1]?w[1]:[],r=w.length>2?w[2]:void 0,o=w.length>3&&void 0!==w[3]?w[3]:{},a=w.length>4&&void 0!==w[4]&&w[4],s=w.length>5&&void 0!==w[5]?w[5]:null,l=w.length>6&&void 0!==w[6]?w[6]:null,d=w.length>7&&void 0!==w[7]?w[7]:null,c=w.length>8&&void 0!==w[8]?w[8]:null,f=o.isPCDN?D.Lj.PCDN:D.Lj.CDN,o.url=t,e.next=13,this.loader.load(r,t,n,o,a,s?function(e,t,a,l){var d=f;if(!!i._optionDataLenInfo){var c=i._optionDataLenInfo[r][d];if(e&&e.byteLength&&(c.size+=e.byteLength,c.range=n,c.extData=o),t&&!a.fromCache){var u=n[1]-n[0]+1,h=Date.now()-a.st;i._emitPrfDataSizeEvent(f,u,r,n,o,0,h),c.size=0,c.range=null,c.extData=null}if(o.checkPreload&&!a.fromCache&&i._progressInfos){var g=i._progressInfos[r];g.data=(0,_.gJ)(g.data,e),g.extData=o,null===g.range?g.range=a.range:g.range[1]=Math.min((null==n?void 0:n[1])||1/0,a.range[1]),g.done=t,t&&i.cachePreloadData()}t&&a.fromCache&&(o.fromCache=!0),s(e,t,a,l,o)}}:null,l,d,c);case 13:if(!((h=e.sent)&&h.res instanceof ArrayBuffer)){e.next=20;break}return g=h.res,p=h.headers,v=h.status,m=h.fromCache,y=h.cacheKey,I=h.orgDefinition,A=h.duration,m?this.emitPreloadHit(y):this._emitPrfDataSizeEvent(f,h.res.byteLength,r,n,o,0,h.costTime),e.abrupt("return",{res:g,headers:p,status:v,fromCache:m,orgDefinition:I,duration:A});case 20:h&&"error"===h.res&&(T=this._isAbort(null==h?void 0:h.error),R=(null==h||null===(b=h.error)||void 0===b?void 0:b.isTimeout)===!0,(!T||R)&&this.player&&this.player.emit("source_error",{host:S.Z.getHostFromUrl(null==h?void 0:h.url),src:null==h?void 0:h.url,errorCode:R?C.WE[C.wb.NETWORK_TIMEOUT]:(null==h?void 0:h.status)||"networkError",message:R?"timeout":null==h||null===(k=h.error)||void 0===k?void 0:k.message,range:n,headers:null==h?void 0:h.header,error:{msg:null==h||null===(E=h.error)||void 0===E?void 0:E.message,stack:null==h||null===(Z=h.error)||void 0===Z?void 0:Z.stack},mediaType:r}));case 21:return e.abrupt("return",h);case 22:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_emitPrfDataSizeEvent",value:function(e,t,i,n,r){var o,a,s,l,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,f=y.Z.currentSpeed,h=r.fileId,g=r.definition,p=r.adaptItemParam,v=r.bitrate,m=r.first_gop,I=r.segmentDuration,_=r.start,C=r.end,A=r.url,b=(null===(o=this.player)||void 0===o?void 0:o.config.uri)||(null===(a=this.config)||void 0===a?void 0:a.vid),k="cdn";e===D.Lj.CDN?null===(s=this.player)||void 0===s||s.emit("prf_data_size",(0,u.Zj)((0,u.Zj)({vid:this._vid,task_type:1,cdn_size:t,mediaType:i,range:JSON.stringify(n),fileid:h,definition:g,cdn_speed:f},p),{},{emitType:d,bitrate:v,format:"DASH",uri:b,first_gop:m,segmentDuration:I,costTime:c,start:_,end:C,url:A})):(k="pcdn",null===(l=this.player)||void 0===l||l.emit("prf_data_size",(0,u.Zj)((0,u.Zj)({vid:this._vid,task_type:1,pcdn_size:t,mediaType:i,range:JSON.stringify(n),fileid:h,definition:g,pcdn_speed:f},p),{},{emitType:d,bitrate:v,format:"DASH",uri:b,first_gop:m,segmentDuration:I,costTime:c,start:_,end:C,url:A}))),this._updateLoadInfo(k,t)}},{key:"_getCryptInfos",value:function(){var e="",t="";if(this.dynamic_video.dynamic_video_list&&this.dynamic_video.dynamic_video_list.length>0){for(var i=0;i<this.dynamic_video.dynamic_video_list.length;i++)if(this.dynamic_video.dynamic_video_list[i].kid){e=this.dynamic_video.dynamic_video_list[i].kid,t=this.dynamic_video.dynamic_video_list[i].spade_a,this._videoEncryption=!0;break}}else if(this.dynamic_video.dynamic_audio_list){for(var n=0;n<this.dynamic_video.dynamic_audio_list.length;n++)if(this.dynamic_video.dynamic_audio_list[n].kid){e=this.dynamic_video.dynamic_audio_list[n].kid,t=this.dynamic_video.dynamic_audio_list[n].spade_a,this._audioEncryption=!0;break}}return{keyId:e,spade_a:t}}},{key:"init",value:(o=(0,u.x)((0,u.l5)().mark(function e(t){var i,n,r,o,a,s,l,d;return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._hasDestroyed){e.next=2;break}return e.abrupt("return");case 2:if(this._initStartMs=Date.now(),this.kernal.setNodeTime("initdash"),n=(i=this._getCryptInfos()).keyId,r=i.spade_a,o=this,o.config.usePlaySpade&&(o.config.secretKey=r),s=(a=o.config).secretKey,l=a.drmKeyToken,d=a.playDomain,!(n||s||l&&d)){e.next=18;break}return e.prev=10,e.next=13,this._initSecret(n);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10);case 18:return e.abrupt("return",o.initDash(t));case 19:case"end":return e.stop()}},e,this,[[10,15]])})),function(e){return o.apply(this,arguments)})},{key:"_initSecret",value:function(e){var t=this,i=new Z.XK,n=this.config,r=n.secretKey,o=n.drmKeyToken,a=n.playDomain,s=n.useUnionInfoDRM,l=n.keyTokenExpiredDuration,d=n.sessionId;if(this.player.plugins.drm)return i.resolve(),i;var c=new v.XGSecretKey({kid:e,getLicenseUrl:this.getLicenseUrl,secretKey:r,vid:this.config.vid||"",useUnionInfoDRM:s,drmKeyToken:o||this.config.keyToken,keyTokenExpiredDuration:l,playDomain:a,sessionId:d,useEME:this.useEME,intertrustServerURL:this.config.intertrustServerURL});return this._secret=c,c.getLicenseSecret().then(function(e){if(!t._pluginInst){k.ZP.log("getLicense callback destroy"),i.reject("getLicense callback destroy");return}t.config.dashOpts&&t.useEME?(t._initEME(),null==c||c.setOptions(),null==c||c.setupEME(t.player.video)):(t.__dash__.crypto&&t.__dash__.crypto.updateValue(e),t.keyValue=!0),k.ZP.encrypt("getLicense resolve"),i.resolve()}).catch(function(e){k.ZP.log("DRM_ERROR",e),i.reject("catch error"),void 0!==e.status&&t.emit("error",new b.Z(C.wb.DRM,C.wb.SUB_TYPES.CUSTOM_LICENSE,{url:t.getLicenseUrl,httpCode:e.status,message:"CUSTOM_LICENSE_ERROR"}))}),i}},{key:"_initEME",value:function(){var e=this;if(!(0,v.checkEMEValid)()){this.player.errorHandler(new b.Z(C.wb.MEDIA,C.wb.SUB_TYPES.EME_HIJACK,{message:"EME API被劫持"})),this.__dash__.destroy();return}this._secret.on(N,function(t){e.player&&e.player.emit("log",(0,u.Zj)({type:"oneevent",end_type:N,ua:navigator.userAgent},t)),k.ZP.log("EME CDM_LICENSE_ERROR"),e.player.errorHandler(new b.Z(C.wb.DRM,C.wb.SUB_TYPES.LICENSE,{message:"DRM接口失败".concat(t.data)}))}),this._secret.on(O,function(t){e.player&&e.player.emit("log",(0,u.Zj)({type:"oneevent",end_type:O,ua:navigator.userAgent},t)),k.ZP.log("EME CDM_LICENSE_SUCCESS")})}},{key:"_initDefaultDefinition",value:function(){var e=this,t=this.config,i=this.mpd.mediaList.video,n=t.defaultDefinition?t.defaultDefinition.toString():null,r=this.player.preloader&&this.player.preloader.getPreloadMetaByVid(this.config.vid),o=!1;if(r&&r.definition){n=r.definition,o=!0;var a=this._pluginInst.preloadManager;if(a&&a.supportSync()){var s=this.mpd.getCodecType(),l=a.getPreLoadDataSync({vid:this._vid,codecType:s,vtype:P.l0.DASH});delete l.cacheKey,delete l.loadInfo,this._allCacheKeys=Object.keys(l),this._allCacheKeys.forEach(function(t){var i,n,r,o=l[t];o&&!o.isInitSegment&&(null===(i=o.range)||void 0===i?void 0:i.length)>0&&(null===(n=o.range)||void 0===n?void 0:n[1])<o.rangeEnd&&(null===(r=e._preloadSegDatas[o.mediaType])||void 0===r||r.push(o))})}k.ZP.log("dashDefinition",this.config.vid,"hasPreload",n)}var d=this.player.config;if(d.userSelectDefinition&&d.focusUserDefinition&&(n!==d.userSelectDefinition.toString()&&o&&(o=!1,k.ZP.log("dashDefinition",this.config.vid,"hasPreload",n,"change to userSelectDefinition",d.userSelectDefinition)),n=d.userSelectDefinition.toString()),this._pluginInst.bitRateAdapter&&!o){var c=this.player?d.userSelectDefinition:null,u=S.Z.getBitrateItem(this.config.dashOpts.dynamic_video,this._pluginInst.bitRateAdapter,this.config.dashOpts.dynamic_video.duration,c);if(k.ZP.log("[dashDefinition] onReady BitRateAdapter",this.config.vid,"item",u),u){n=u.definition.toString();var f=this.config.dashOpts.dynamic_video.dynamic_video_list,h=null==f?void 0:f.filter(function(e){return e.definition===u.definition})[0];h&&(h.fromType=u.fromType,h.orgDefinition=u.orgDefinition,h.type=u.type)}}k.ZP.log("[dashDefinition] onReady",this.config.vid,"video definition",n);var g=!1;n&&i.forEach(function(t,r){t.definition.toString()===n.toString()&&(e.config.defaultDefinition=n.toString(),i.selectedIdx=r,g=!0)}),!g&&(i.selectedIdx=0),this.selectAudio()}},{key:"selectAudio",value:function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=this.mpd.mediaList.video,n=this.mpd.mediaList.audio,r=(0,L.Ft)(i,n,e),o=r;return -1===o&&(o=0),t&&(n.selectedIdx=o),k.ZP.log(this._vid,"audio definition",n.selectedIdx),r}},{key:"_initMSE",value:function(){var e,t,i=this;this.kernal.setNodeTime("initmse_sbopen");var n=Date.now(),r=this.mpd.mediaList.audio,o=this.mpd.mediaList.video,a={};if(this._hasAudio&&(a[A.d1.AUDIO]={mimeType:"audio/mp4",codec:'audio/mp4; codecs="'.concat(r[r.selectedIdx].codecs,'"')}),this._hasVideo&&(a[A.d1.VIDEO]={mimeType:"video/mp4",codec:'video/mp4; codecs="'.concat(o[o.selectedIdx].codecs,'"')}),this._hasVideo&&this._pluginInst.softVideo){var s=this.player.video;s.setPlayMode&&s.setPlayMode("VOD"),(e=s).url=URL.createObjectURL(new Blob),t=Promise.resolve()}else{if(this._secret&&!(0,v.checkMSEValid)()){this.player.errorHandler(new b.Z(C.wb.MEDIA,C.wb.SUB_TYPES.MSE_HIJACK,{message:"MSE被劫持"}));return}(t=(e=new A.d1(void 0,{openLog:k.qu})).bindMedia(this.player.video)).then(function(){if(!i._pluginInst){k.ZP.log("open promise ready destroy");return}i.kernal.setNodeTime("initmse_sbopendone"),i._mseOpenDone=!0,i._pluginInst.info({msg:"mse init success",name:"mseInit",startMs:n,profile:!0});try{for(var t=Object.keys(a),r=0;r<t.length;r++){var o=t[r];e.createSource(o,a[o].codec)}}catch(e){k.ZP.log("MSE MSE_MEDIA_TYPES_NOT_SUPPORTED",JSON.stringify({msg:e.message})),i&&i.player&&i.player.errorHandler(new b.Z(C.wb.MEDIA,C.wb.SUB_TYPES.MSE_ADD_SB,{line:329,message:"mse init fail"})),k.ZP.log("mse init error",e,"player destroyed ? ",!(i&&i.player))}}).catch(function(e){})}return this.mse=e,t}},{key:"_addBuffer",value:function(e,t){var i=this,n=this;if(this._hasDestroyed){k.ZP.log("addBuffer destroy");return}if(!this.mpd){k.ZP.log("addBuffer mpd empty");return}var r=this.mpd.mediaList[t],o=this.mpd.mediaList[t];if(o.length<1||!o[o.selectedIdx]||!o[o.selectedIdx].mimeType)return;if(!e.initSegmentRes){k.ZP.log("initSegment null, task request error, stop"),n.emit("error",new b.Z(C.wb.RUNTIME,b.Z.SEG_PARSE_ERROR,{message:"wrapperData.initSegmentRes is null"}));return}if(!!n.__dash__)n.__dash__._appendInitSegment(t,e,o.selectedIdx).then(function(){var e,o,a="video"===t?i._videoMetaReadyPromise:i._audioMetaReadyPromise;a&&(i.kernal.setNodeTime("initSegment ".concat(t," append")),a.resolve()),n.inited=!0;var s=r.selectedIdx;r.length>0&&(r[s].encrypted||r[s].kid)&&!i._hasEmitEncrypt&&(i._hasEmitEncrypt=!0,n._secret&&n._secret.emit(v.EVENT_EME.ENCRYPTED),null===(e=n.player)||void 0===e||e.emit(v.EVENT_EME.ENCRYPTED)),"vod"===n.type&&(null===(o=n.__dash__)||void 0===o||o.loadData(0),n.emit("start_play"))}).catch(function(e){if(!i._hasCatchAppendError){var t;i._hasCatchAppendError=!0,null===(t=n.player)||void 0===t||t.errorHandler(new b.Z(C.wb.MEDIA,C.wb.SUB_TYPES.MSE_APPEND_BUFFER,{line:329,message:"mse append error ".concat(e.message?e.message:e)}))}})}},{key:"appendFirstSegment",value:function(e){var t=this,i=this._pendingAppnedDatas[e];if(i.length>0){for(var n=[],r=0;r<i.length;r++)!function(){var o=i[r];t.mse.isOpened?t.appendSegment(e,o.res,o.item,{},o.extData,!1,o.done):t._openPromise.then(function(){t.appendSegment(e,o.res,o.item,{},o.extData,!1,o.done)}),n.push(o.range)}();this._pendingAppnedDatas[e]=[],k.ZP.log("appendFirstSegment",e,"ranges",n)}if(!("video"===e?this._videoMetaReady:this._audioMetaReady)){var o=function(){"video"===e?t._videoMetaReady=!0:t._audioMetaReady=!0};this.mse.isOpened?o():this._openPromise.then(function(){o()})}}},{key:"initDash",value:(a=(0,u.x)((0,u.l5)().mark(function e(t){var i,n;return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._pluginInst){e.next=3;break}return k.ZP.log("dash.js init dash destroy"),e.abrupt("return");case 3:return this._pluginInst.info({msg:"dash init",data:"dash init",startMs:this._initStartMs,profile:!0}),this.kernal.setNodeTime("initdashdone"),i=this,this.kernal.setNodeTime("initmpd"),n=new m.Z(t,i.config.dashOpts,i),i.mpd=n,n.init(),e.next=12,n.readyPromise;case 12:return this._onMPDReady(n),e.abrupt("return",this.mse);case 14:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"_createMoofSegment",value:function(e,t){var i=t.mediaList[e],n=i[i.selectedIdx].firstMoofMdatRange;if(n){k.ZP.log(null===(r=this.config)||void 0===r?void 0:r.vid,"createMoofSegment, mediaType",e);var r,o,a,s=new Z.XK;e===A.d1.VIDEO?this._videoMetaReadyPromise=s:this._audioMetaReadyPromise=s;var l=(0,u._x)({codecType:this.mpd.getCodecType(),range:n,url:i[i.selectedIdx].initSegment,idx:1,start:0,startRaw:0,moof:!0,checkPreload:!0,mediaType:e,selectedIdx:i.selectedIdx,fileId:i[i.selectedIdx].fileId,vid:this.config.vid,vtype:P.l0.DASH,bitrate:i[i.selectedIdx].bandwidth,definition:i[i.selectedIdx].definition},"codecType",this.mpd.videoCodecType),d=S.Z.generateRequestUniqueKey((0,u.Zj)((0,u.Zj)({},l),{},{range:n}));this._allCacheKeys.includes(d)?(k.ZP.log(null===(a=this.config)||void 0===a?void 0:a.vid,"createMoofSegment mediaType",e,"hit cache, no moof request, use seq requset"),this._resetMoofSegmentDownloadState(e)):(k.ZP.log(null===(o=this.config)||void 0===o?void 0:o.vid,"createMoofSegment mediaType",e,"no cache, request moof request"),this._makeSegmentRequestByItem(l,e,{},!1,s))}}},{key:"_resetMoofSegmentDownloadState",value:function(e){var t=this.mpd;if(t&&t.mediaList){var i,n=t.mediaList[e];n[n.selectedIdx].cancelFirstSegmentReq=!0;var r=null===(i=n[n.selectedIdx].mediaSegments)||void 0===i?void 0:i[0];r&&(r.downloaded=E.Kc.NO_START)}}},{key:"_onMPDReady",value:function(e){var t=this,i=Date.now();if(!this._pluginInst){k.ZP.log("mpd ready destroy");return}k.ZP.log("mpd ready"),this.kernal.setNodeTime("initmpddone"),this._pluginInst.info({msg:"mpd ready",name:"mpd ready",startMs:i,profile:!0}),this.type=e.type;var n=e.mediaList.video,r=e.mediaList.audio;this._initDefaultDefinition();var o=!!(n.length>0&&n[n.selectedIdx])&&this.config&&!this.config.dashOpts.audioOnly,a=!!(r.length>0&&r[r.selectedIdx]);this._hasVideo=o,this._hasAudio=a;var s=this._initMSE();if(!!s){this._pluginInst.setStartTimelineAttr("reqtime",S.Z.nowTime()),this._openPromsie=s;var l=[],d=this.config?this.config.dashOpts.audioOnly:null;if(this.config&&!d&&n&&n.length>0&&n[n.selectedIdx]&&n[n.selectedIdx].initSegment){var c=this.__dash__._makeInitSegemntRequestWithRetry("video",n.selectedIdx,!0);c.then(function(e){t._addBufferSafe(e,A.d1.VIDEO,s)}),l.push(c),this._createMoofSegment(A.d1.VIDEO,e)}if(r[r.selectedIdx]&&r[r.selectedIdx].initSegment){var u=this.__dash__._makeInitSegemntRequestWithRetry("audio",r.selectedIdx,!0);u.then(function(e){t._addBufferSafe(e,A.d1.AUDIO,s)}),l.push(u),this._createMoofSegment(A.d1.AUDIO,e)}Promise.all(l).catch(function(e){t&&t.player&&t.player.errorHandler(e),k.ZP.log("appendInitPromise error",e,"player destroyed ? ",!(t&&t.player))})}}},{key:"_addBufferSafe",value:function(e,t,i){var n=this;this._mseOpenDone?this._addBuffer(e,t):i.then(function(){n._addBuffer(e,t)})}},{key:"seek",value:function(e,t){var i,n,r,o=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=this.mpd.seek(t,s,e),d=this.popDynamicBufferServiceRes(),c=null===(i=this.mpd)||void 0===i||null===(i=i.mediaList)||void 0===i?void 0:i.video,u=null===(n=this.mpd)||void 0===n||null===(n=n.mediaList)||void 0===n?void 0:n.audio;if(!this.mpd){k.ZP.log("dash seek destroy");return}var f=!!(c.length>0&&c[c.selectedIdx]),h=!!(u.length>0&&u[u.selectedIdx]);if(f&&h&&2*c[c.selectedIdx].mediaDuration<u[u.selectedIdx].mediaDuration){!this._hastEmitDurErr&&(this._hastEmitDurErr=!0,this.emit("error",new b.Z(C.wb.RUNTIME,b.Z.DUR_PARSE_ERROR,{message:"the video.mediaDuration not match audio.mediaDuration"})));return}var g={},p=["video","audio"];p.forEach(function(e){l[e]&&l[e].length>0&&(g[e]=[],l[e].forEach(function(t){var i=t.idx,n=t.start,r=t.end,o=t.downloaded,a=t.range;g[e].push({idx:i,start:n,end:r,downloaded:o,range:a})}))}),k.ZP.log(null===(r=this.config)||void 0===r?void 0:r.vid,"currentTime",t,JSON.stringify(g)),(this.config.dashOpts&&this.config.dashOpts.audioOnly?["audio"]:p).forEach(function(e){l[e]&&l[e].length>0&&l[e].every(function(t){return o._makeSegmentRequestByItem(t,e,d,a)})})}},{key:"loadFirstVideoGop",value:function(){var e=this.mpd.getVideoFirstGop();e&&(k.ZP.log("loadFirstVideoGop"),this._makeSegmentRequestByItem(e,A.d1.VIDEO,{},!1,null,!1))}},{key:"_makeSegmentRequestByItem",value:function(e,t,i,n){var r,o=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=!(arguments.length>5)||void 0===arguments[5]||arguments[5],l=this;if(e.downloaded===E.Kc.APPEND||e.downloaded===E.Kc.GOING)return!0;e.downloaded=E.Kc.GOING;var d=Object.assign({},i,{load_tar_dur:e.end-e.start,load_dur:e.end-e.start});e.adaptItemParam=d;var c=this._videoEncryption||this._audioEncryption,f=!c||c&&this.useEME,h=l.config.useProgressiveAppend&&!this._pluginInst.softVideo&&f&&this.loader.isSupportedProgress(),g=0===e.start||n,p=l.mpd.mediaList[t],v=p[p.selectedIdx],m=g&&this.loader.checkProgressSatisfied(v.bandwidth||v.bitrate),y=l.config.useProgressiveAppendAll,I=h&&(m||y);g&&k.ZP.log("progressDownloaded match, config p ".concat(l.config.useProgressiveAppend,", \n      progressDownloaded ").concat(h,", encEnableProgress :").concat(f,",\n      useProgressiveAppendAll:").concat(y)),I&&0===e.start&&("video"===t?l._pluginInst.pvStartup=!0:l._pluginInst.paStartup=!0);var _=function(){if(e.downloaded===E.Kc.APPEND){k.ZP.log("abr_log oncancel appended return",e);return}l.updateItemState(e,!1),k.ZP.log("onCancel",e),l._removeFromList(e),l._setLoading(t,!1),I&&(null==l||l._abortAndRemove(t,e,"oncancel",!1))};if(e.isSatisfied=I,l._addToList(e),this._setLoading(t,!0,!1),e.requestTime=S.Z.nowTime(),I){;k.ZP.log("progressDownloaded, mediaType:".concat(t,",\n              start:").concat(e.start,", bitrate:").concat(v.bandwidth||v.bitrate)),l.makeSegmentRequest(t,e,(r=(0,u.x)((0,u.l5)().mark(function i(n,r,d,c,f){var h,g,p;return(0,u.l5)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,null!==(h=o._appendBufferDelta)&&void 0!==h&&h[t]&&((g=o._appendBufferDelta[t]).delta=S.Z.nowTime(),g.item=e,!g.requestDelta&&(g.requestDelta=S.Z.nowTime())),p=d.range||e.range,f.range=p,f.status=null==c?void 0:c.status,!(200===f.status&&"ftyp"===S.Z.getTopBoxType(n))){i.next=10;break}return i.next=8,o.loader.cancel(t);case 8:return l._onRequestFail({message:"response 200, cancel"},e,t),i.abrupt("return");case 10:a?(t===A.d1.VIDEO?o._videoMetaReady:o._audioMetaReady)?(k.ZP.log("createMoof metaPromise ready",t,p),l.appendSegment(t,n,e,{},f,!1,r,a)):(o._pendingAppnedDatas[t].push({range:p.concat(),res:n,item:JSON.parse(JSON.stringify(e)),extData:JSON.parse(JSON.stringify(f)),done:r}),k.ZP.log("createMoof metaPromise not ready",t,p,n)):l.appendSegment(t,n,e,{},f,!1,r,a),!r&&d.range[1]>=e.range[1]&&(r=!0),r&&(e.extRange=void 0,l._removeFromList(e),o._setLoading(t,!1,s,e.idx),o._appendBufferDelta&&(o._appendBufferDelta[t]=o._genEmptyBufferDelta()),k.ZP.log("mediaType",t,"item",e.idx,"done")),i.next=18;break;case 15:i.prev=15,i.t0=i.catch(0),o.__dash__?(o._abortAndRemove(t,e,"errorCatch"),l._onRequestFail(i.t0,e,t)):k.ZP.log("__dash__ null, destroy");case 18:case"end":return i.stop()}},i,null,[[0,15]])})),function(e,t,i,n,o){return r.apply(this,arguments)}),_,a).catch(function(i){l._onRequestFail(i,e,t)})}else l.makeSegmentRequest(t,e,null,_).then(function(i){var n=i.res,r=i.headers,o=i.extData;k.ZP.log("append ".concat(t," ").concat(e.start," ").concat(e.end)),l._setLoading(t,!1,!0,e.idx),l.appendSegment(t,n,e,r||{},o,!0,!0,a),l._removeFromList(e)},null,a).catch(function(i){l._onRequestFail(i,e,t)}).finally(function(){l._setLoading(t,!1)})}},{key:"_onRequestFail",value:function(e,t,i){if(t&&t.moof&&(k.ZP.log("createMoof request fail, mediaType",i),this._resetMoofSegmentDownloadState(i)),this._setLoading(i,!1),this.updateItemState(t),this._removeFromList(t),e.isPCDN){var n,r;null===(n=this._pcdnScv)||void 0===n||n.setSetRetryInfo(i,e.url),null===(r=this._pcdnScv)||void 0===r||r.removePCDNNode(i,e.bitrate,e.url)}if(!this.mpd){k.ZP.log("_onRequestFail destroy");return}var o=this.mpd.mediaList;k.ZP.log("_onRequestFail",null==e?void 0:e.message,JSON.stringify(t));var a="video"===i?o.video:o.audio,s=a[a.selectedIdx],l=!this._isAbort(e.error)&&!e.isPCDN;if(!s.hasBackup&&s.backupUrl&&l){s.hasBackup=!0;return}s.fallbackUrl&&l&&(s.hasFallback=!0)}},{key:"_setLoading",value:function(e,t){var i,n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;k.ZP.log("setLoading",e,"isLoading",t,"addNext",r,"prevIdx",o),null===(i=this.mpd)||void 0===i||i.setLoadingState(e,t),r&&(null===(n=this.mpd)||void 0===n||n.moveNextSegmentIndex(e,o))}},{key:"_isAbort",value:function(e){var t=null==e?void 0:e.message;return(null==t?void 0:t.includes("The user aborted a request"))||(null==t?void 0:t.includes("Fetch is aborted"))||(null==t?void 0:t.includes("signal is aborted without reason"))}},{key:"_addToList",value:function(e){this._onLoadingItems&&this._onLoadingItems.push(e)}},{key:"_removeFromList",value:function(e){if(this._onLoadingItems)for(var t=this._onLoadingItems.length-1;t>-1;t--)this._onLoadingItems[t]===e&&this._onLoadingItems.splice(t,1)}},{key:"_doSizePreloadCheck",value:function(e){if((this._pluginInst.softVideo||this.__dash__.dashVideoEncrypted||this.__dash__.dashAudioEncrypted)&&!1===this.useEME&&this.__dash__.crypto||"segment_template"===this.mpd.dashType)return{isSlice:!1};var t=e.mediaType,i=e.range,n=this._preloadSegDatas[t];if(!n||(null==n?void 0:n.length)===0)return{isSlice:!1};var r,o=(0,u.sf)(n);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(a.range[0]===i[0]&&e.fileId===a.fileId){var s=a.res,l=a.duration;return{isSlice:!0,range:[a.range[1]+1,i[1]],res:s,duration:l}}}}catch(e){o.e(e)}finally{o.f()}return{isSlice:!1}}},{key:"makeSegmentRequest",value:function(e,t){var i,n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=this,l=new Z.XK;void 0===t.range&&(t.range=[]),"video"===e&&k.ZP.network("http get video start: ".concat(t.start,", end: ").concat(t.end," ,range: ").concat(t.range)),s.player&&s.__dash__._checkUrlRange(t.url);var d={limitSizeM:1/0,segment_resolution:"",isVideo:"video"===e,ratio:s.config.segmentRatio||7.5,vid:s.config.vid,mediaType:e,start:t.start,end:t.end,useUrlRange:s.config.useUrlRange},c=1/0,f=s.mpd.mediaList[e],h=f[f.selectedIdx],g=t.url;h.hasFallback?g=h.fallbackUrl:h.hasBackup&&(g=h.backupUrl);var p=(null===(i=t.extRange)||void 0===i?void 0:i.length)>0,v=!1;if(this._pcdnScv){var m=this._pcdnScv.selectedPCDN(e,!1,h.bandwidth),y="audio"===e||(null==m?void 0:m.includes(h.fileId));m&&!y&&(this._pcdnScv.removePCDNNode(e,h.bandwidth),k.ZP.log("PCDNURL remove, url,",m,"fileid",h.fileId)),y&&m&&!p&&(v=!0,(!this._cdnHost||0>g.indexOf(this._cdnHost))&&(this._cdnHost=S.Z.getHostFromUrl(g)),!this._cdnHost&&(this._cdnHost=S.Z.getHostFromUrl(g)),d.cdnHost=this._cdnHost,g=m,k.ZP.log("PCDNURL",g))}if("video"===e){try{var I=h.definition||s.__dash__.bandwidth2item[h.bandwidth].definition;I=I.toString(),c=E.Y2[I.toLowerCase()],d.segment_resolution=I.toLowerCase(),d.definition=d.segment_resolution,t.definition=I,this.setCurrentHost(g)}catch(e){c=1/0}d.limitSizeM=c}var _=t.range;d.bitrate=h.avg_bitrate||h.bandwidth||h.bitrate,d.bandwidth=h.bandwidth||h.bitrate,d.idx=h.idx,d.first_gop=0===t.start?1:0,d.isPCDN=v,d.fileId=h.fileId,d.codecType=this.mpd.videoCodecType,d.adaptItemParam=t.adaptItemParam,d.segmentDuration=t.end-t.start,delete t.adaptItemParam,d.moof=t.moof;var A=S.Z.generateRequestUniqueKey((0,u.Zj)((0,u.Zj)({},d),{},{range:_})),T=this._allCacheKeys.includes(A);d.checkPreload=t.checkPreload||d.first_gop||T,d.isSatisfied=t.isSatisfied,d.startRaw=t.startRaw,d.endRaw=t.endRaw;var R=this.config.timeout;if(d.first_gop&&this.kernal.setNodeTime("init".concat(e,"_segstart")),this._appendBufferDelta[e].isPCDN=v,this._extDataCache[e]){var D=this._extDataCache[e];D.moof&&0===t.start&&(t.extRange=D.extRange)}if(t.extRange&&(k.ZP.log("_PCDN extRange",t.extRange,"medaiType",e,"isPCDNTimeout",p),t.extRange[0]<t.extRange[1]&&(_=t.extRange)),d.checkPreload){var w=this._doSizePreloadCheck(t),L=w.isSlice,B=w.range,P=w.res,x=w.duration;if(L){_=B,d.isSlice=!0,k.ZP.log("hit preload size",e,"newRange",JSON.stringify(B),"allRange",JSON.stringify(t.range)),d.rangeEnd=t.range[1],d.rangeStart=t.range[0];var N=(0,u.Zj)((0,u.Zj)({},t),{},{range:[t.range[0],B[0]-1]});this.appendSegment(e,P,N,{},d,!1,!1,a),this.kernal.setPreloadData("init".concat(e,"_segcache"),{fromCache:!0,mediaType:e,definition:d.definition,duration:x,byteLength:P.byteLength})}}return this.getData(g,_,e,d,!1,r,o,R,function(){k.ZP.log("onTimeout",t),s._removeFromList(t),s._onRequestFail(Object.assign({url:g,error:{message:"Timeout"}},d),t,e)}).then(function(i){if(!!n._pluginInst)if(i){var o=i.res,a=i.fromCache,c=i.duration,u=o instanceof ArrayBuffer;if(d.first_gop&&!(null!=i&&null!==(p=i.error)&&void 0!==p&&p.isTimeout)){var f="init".concat(e,"_segdone");n.kernal.setNodeTime(f)}if(a&&n.kernal.setPreloadData("".concat(e,"-").concat(d.bitrate,"-").concat(_[0],"-").concat(_[1]),{fromCache:a,mediaType:e,definition:d.definition,duration:c,byteLength:u?o.byteLength:0,error:u||o.done?null:o}),o instanceof ArrayBuffer)l.resolve({res:o,headers:null,extData:{status:i.status,segment_resolution:d.segment_resolution}}),s.mseLog("task loadsucc",t,e);else if(!(206===i.status||200===i.status)){if(s.mseLog("task loaderror",t,e),r&&n._abortAndRemove(e,t,"onProgress task loaderror",!1),403===i.status)!h.fallbackUrl&&(null==s||s.__dash__.clearProgressTimer()),null==s||null===(v=s._pluginInst)||void 0===v||v.emitExpireEvent({url:t.url,response:i});else{var g=n._isAbort(null==i?void 0:i.error);if(h.hasFallback&&!g){k.ZP.log("fallUrl fail",null==i||null===(m=i.error)||void 0===m?void 0:m.message),null==s||s.__dash__.clearProgressTimer();var p,v,m,y,I=new b.Z(C.wb.RUNTIME,b.Z.BACK_URL_FAIL,{message:"fall url fail ".concat(null==i||null===(y=i.error)||void 0===y?void 0:y.message)});n.player.errorHandler(I)}}l.reject(i)}}else l.reject(Error("request error"))}),l}},{key:"setCurrentHost",value:function(e){this._pluginInst.loadURL=e}},{key:"reportMonitorEvent",value:function(e,t,i,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=this.getReportData(i,n,r,o),s=r.eagleid;if(s){if(!this.egleIds||this.egleIds[s])return;this.egleIds[s]=1}this.player&&this.player.emit("log",{type:"oneevent",end_type:e,cdnUrl:t,ext:a})}},{key:"getReportData",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({},{start:e||-1,end:t||-1},S.Z.transformHeaders(i,E.ne),n)}},{key:"reportMenuEvent",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=this._pluginInst.player,a=this.getReportData(t,i,n,r);a.url=e,o.emit("menusegment",a)}},{key:"_reportInvalidEvent",value:function(e,t,i,n){var r=0,o=e.byteLength,a=i.status,s=i.segment_resolution,l=t.realUrl||t.url;try{var d=S.Z.getTopBoxType(e);if("moof"!==d&&"styp"!==d&&(k.ZP.media("segment content error",t,n),r=1,this.reportMonitorEvent(E.wW,l,t.range[0],t.range[1],n,{segment_size:e.byteLength,status:a,segment_resolution:s,box_type:d,step:r,segment_origin_size:o})),"ftyp"===d&&200===a&&2===t.range.length){this.player&&this.player.emit("source_error",{host:S.Z.getHostFromUrl(l),src:l,errorCode:a,message:"boxType error",range:t.range,headers:n}),r=2;var c=t.range[0];if(e=e.subarray(c,t.range[1]+1),d=S.Z.getTopBoxType(e),"moof"!==d&&"styp"!==d)return this.emit("error",new b.Z(C.wb.RUNTIME,b.Z.SEGMENT_CONTENT_ERROR,{message:"boxType is ".concat(d,", range:").concat(JSON.stringify(t.range),", url:").concat(l,", respHeaders:").concat(JSON.stringify(n),", isPCDN:").concat(i.isPCDN)})),this.reportMonitorEvent(E.wW,l,t.range[0],t.range[1],n,{segment_size:e.byteLength,status:a,segment_resolution:s,box_type:d,step:r,segment_origin_size:o}),null;return e}}catch(i){this.reportMonitorEvent(E.wW,l,t.range[0],t.range[1],n,{segment_size:e.byteLength,status:a,segment_resolution:s,step:r,box_type:"error",segment_origin_size:o}),k.ZP.media("segment content catch",t,i)}return null}},{key:"appendSegment",value:function(e,t,i,n,r){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=!(arguments.length>6)||void 0===arguments[6]||arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=this;if(!this._hasDestroyed&&!!l.mpd&&!!t){if(!S.Z.isArrayBuffer(t)){k.ZP.log("appendSegment return done",a);return}var d=new Uint8Array(t instanceof ArrayBuffer?t:t.buffer),c=S.Z.checkValidTopBox(d),u=r.status,f=r.segment_resolution,h=l.mpd.mediaList[e],g=i.selectedIdx;i.fromCache=r.fromCache;var p=i.realUrl||i.url;if(o&&!c){if(null===(d=l._reportInvalidEvent(d,i,r,n))){k.ZP.log("segment content response 200, res is null"),l.updateItemState(i);return}k.ZP.log("segment content response 200, subrange is ok, go ahead")}l.reportMenuEvent(p,i.range[0],i.range[1],n,{segment_size:d.byteLength,status:u,segment_resolution:f});var v=this._pluginInst.softVideo;if(l.keyValue||v){var m=0;(v||l.__dash__.dashVideoEncrypted||l.__dash__.dashAudioEncrypted)&&!1===l.useEME&&l.__dash__.crypto?(m=performance.now(),l.mseLog("decryptBody start",i,e),l.__dash__.crypto.decryptBody(d,"video"===e,!v).then(function(t){var n=t.data,r=t.id,o=t.headerId;if(!n.res&&!v){l.updateItemState(i);return}var d=n.res,c=n.videoTrack,u=n.audioTrack,f=performance.now();if(!l.encryptTotalAll&&(l.encryptTotalAll=0),l.encryptTotalAll+=f-m,k.ZP.encrypt("encryptTotalAll:".concat(l.encryptTotalAll)),"video"===e&&(!l.encryptTotal&&(l.encryptTotal=0),l.encryptTotal+=f-m,k.ZP.encrypt("encryptVideo:".concat(l.encryptTotal)),r<o&&!s)){l.updateItemState(i);return}l.doAppendSegment(e,h,d,i,g,null,a,c,u,s)})):l.doAppendSegment(e,h,d,i,g,r.range,a,null,null,s)}else l.doAppendSegment(e,h,d,i,g,r.range,a,null,null,s)}}},{key:"isAllAppend",value:function(){var e=this.mpd;if(!e)return!1;var t=this.player.currentTime,i=e.isSegmentAppendFromIdx(A.d1.VIDEO,t),n=i.res,r=i.emptySegments,o=e.isSegmentAppendFromIdx(A.d1.AUDIO,t),a=o.res,s=o.emptySegments,l=this._hasVideo&&r,d=this._hasAudio&&s;return!l&&!d&&(!!n&&!!a||!1)}},{key:"doAppendSegment",value:function(e,t,i,n,r,o,a,s,l,d){var c=this;if(!this._hasDestroyed){var f=this,h=f.mse,g=f.mpd,p={start:n.start,end:n.end,index:r,bandwidth:t[t.selectedIdx].bandwidth,fps:t[t.selectedIdx].fps,mediaType:e,sequence:n.idx,definition:t[t.selectedIdx].definition,fromCache:n.fromCache};if(e===A.d1.VIDEO&&-1!==this.__dash__.curVideoInitSegmentIdx&&r!==this.__dash__.curVideoInitSegmentIdx&&this.__dash__.curVideoFileId!==t[r].fileId){this.updateItemState(n),k.ZP.log("init 与 segment不匹配, curVideoInitSegmentIdx",this.__dash__.curVideoInitSegmentIdx,"selectedIdx",r);return}var v=t.switchTag;t.switchTag=!1;var m=function(i){if((null==i||!i.used)&&(null==i||null===(r=i.context)||void 0===r||!r.used)){if(v&&n.start<f.player.currentTime&&e===A.d1.VIDEO&&(f.player._invalidSeekTag=!0,f.player.currentTime+=1e-4,k.ZP.log("appendSuccess seek 0.001")),0===n.start&&c.kernal.setNodeTime("init".concat(e,"SegmentAppend"),i),i&&(i.used=!0),!f.player){k.ZP.log("appendBuffer destroy return");return}if(n.range[1]<=(null==o?void 0:o[1])||a){if(f.updateItemState(n,!0),"video"===e){null===(s=f.player)||void 0===s||s.emit("addVideoBufferEnd",p);var r,s,l,m,y,I=S.Z.nowTime()-n.requestTime,_=p.end-p.start;!p.end&&(_=null===(y=t[t.selectedIdx])||void 0===y||null===(y=y.mediaSegments)||void 0===y?void 0:y[0].segmentDuration);var C=(null==h||null===(l=h._sourceBuffer)||void 0===l||null===(l=l.audio)||void 0===l?void 0:l.buffered)||null,b=0;if(C){var E=c.player.getBufferedRange(C);b=0===E[1]?0:E[1]-c.player.currentTime}else!(null!=h&&null!==(m=h._sourceBuffer)&&void 0!==m&&m.audio)&&(b=-1);c._emitAbrNextSegmentPredictEvt((0,u.Zj)((0,u.Zj)({},p),{},{fix:!0,costTime:I,gopSize:_,audioBuffer:b}))}if(d){var Z,T,R=null===(Z=c.mpd)||void 0===Z?void 0:Z.mediaList[e],D=R&&(null===(T=R[R.selectedIdx])||void 0===T?void 0:T.mediaSegments);D.length>0&&f.updateItemState(D[0],!0)}}if(c.mseLog("appendBuffer success",n,e,o),a){f.updateItemState(n,!0);var w=f.mpd._getBuffered(e);k.ZP.log("fixbuffer: mediaType",e,"buffered",JSON.stringify(w),"item.start",n.start,"item.end",n.end);for(var L=!0,B=0;B<w.length;B++){var P=w[B].start,x=w[B].end;if(n.start>=P-1&&n.end<=x+1){L=!1;continue}}if(L&&n.end>n.start){var N=f.mse.getSourceBuffer(e);k.ZP.log("fixbuffer: buffer Miss",!!N),N&&c._abortAndRemove(e,n,"fixbuffer")}}"video"===e&&f.player.emit("addVideoBufferEnd",p);var O=g.isLastSegmentAndAppend(e,n.idx),V=e===A.d1.AUDIO?A.d1.VIDEO:A.d1.AUDIO,M=g.isLastSegmentAndAppend(V,n.idx);O&&M&&(k.ZP.log("append check endofStream"),h.endOfStream()),c.isAllAppend()&&h.endOfStream()}},y=(0,u.Zj)((0,u.Zj)({range:o,rangesring:JSON.stringify(o)},p),{},{callback:m,item:n});this.appendBuffer(e,new Uint8Array(i),y,s,l,d).then(m).catch(function(e){k.ZP.log("append buffer catch",e);var t=e&&e.errorCode===C.WE[C.wb.MEDIA][C.wb.SUB_TYPES.MSE_FULL];!t&&f.updateItemState(n,!1),t&&f.__dash__&&f.__dash__.checkRemoveBuffer(!0),e&&e.errorCode&&f.player&&f.player.emit(new b.Z(C.wb.MEDIA,e.errorCode,{line:800,message:"append buffer".concat(e.message)}))})}}},{key:"appendBuffer",value:function(e,t,i,n,r,o){var a=this;if(i&&(i.vid=this.config.vid),this._appendBufferDelta&&(this._appendBufferDelta[e].range=i.range),this._lastAppendBufferEnd){var s=this._lastAppendBufferEnd[e],l=s.prevRangeEnd,d=s.prevItem;if(i.range&&i.range.length>0){var c,u,f=l===(null==d?void 0:d.range[1]),h=l>0&&(l===(null==d?void 0:d.range[1])+1||f);l>0&&!h&&l!==i.range[0]&&i.range[1]<i.item.range[1]&&(k.ZP.log("appendBuffer seek remove",e,l,"now",i.range[0],"start",d.startRaw,"endRaw",d.endRaw),null===(c=this.__dash__)||void 0===c||c.abort(e),null===(u=this.__dash__)||void 0===u||u.clearBufferDirect(e,d),i.item.extRange=void 0),this._lastAppendBufferEnd[e]={prevRangeEnd:i.range[1],prevItem:i.item}}}var g=function(){return a._pluginInst.softVideo?(a._hasVideo&&"video"===e&&(a._vTrack=new T.q,Object.keys(n).forEach(function(e){a._vTrack[e]=n[e]})),a._hasAudio&&"audio"===e&&(a._aTrack=new R.W,Object.keys(r).forEach(function(e){a._aTrack[e]=r[e]})),a.mse.appendBuffer(a._vTrack,a._aTrack),Promise.resolve()):a.mse.append(e,new Uint8Array(t),i)};if(!o)return g();var p,v=Date.now();return(e===A.d1.VIDEO?this._videoMetaReady:this._audioMetaReady)&&i.fromCache&&null!==(p=this.config)&&void 0!==p&&p.useGopCacheAcc?(k.ZP.log("createMoof ready append cost",Date.now()-v,"ms mediaType",e,"range",JSON.stringify(i.range),"fromCache",i.fromCache),g()):o.then(function(){return k.ZP.log("createMoof append cost",Date.now()-v,"ms mediaType",e,"range",JSON.stringify(i.range)),g()})}},{key:"changeType",value:function(e,t){var i="";i=e===A.d1.VIDEO?'video/mp4; codecs="'.concat(t,'"'):'audio/mp4; codecs="'.concat(t,'"'),this.mse.changeType&&this.mse.changeType(e,i)}},{key:"emptyAction",value:function(e,t){var i=this.mse;return i._enqueueOp(e,function(){i._onSBUpdateEnd(e)},"emptyAction",t)}},{key:"isProgressiveLoading",value:function(e){var t=this.loader.getCurrentTask(e);return this._isLoadingTaskCancellable(t)}},{key:"_isLoadingTaskCancellable",value:function(e){if(!e||!e._config.priOptions)return{isCancellable:!0,data:null};var t,i=null===(t=this.player)||void 0===t?void 0:t.currentTime,n=e._config.priOptions.extData,r=n.start<=i&&i<=n.end&&n.isSatisfied,o=n.range&&n.range[0]===n.range[1];return{isCancellable:!r&&!o,data:n}}},{key:"_cancelTasks",value:(s=(0,u.x)((0,u.l5)().mark(function e(t,i){var n,r,o,a,s,l,d,c,f,h;return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loader){e.next=2;break}return e.abrupt("return",[]);case 2:o=(r=this.isProgressiveLoading(t)).isCancellable,a=r.data,k.ZP.log("_cancelTasks",t,"isCancellable",o,"data",!!a),s=[],l=null===(n=this.player)||void 0===n?void 0:n.currentTime,d=(0,u.sf)(i);try{for(d.s();!(c=d.n()).done;)(f=c.value).mediaType===t&&!o&&(h=f.start<=l&&l<=f.end&&f.isSatisfied,(f.isInitSegment||h)&&s.push(f))}catch(e){d.e(e)}finally{d.f()}return e.next=10,this.loader.cancelTasks(t,o);case 10:return o&&a&&a.isSatisfied&&k.ZP.log("isCancellable abort"),e.abrupt("return",s);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"abortLoadingTasks",value:(l=(0,u.x)((0,u.l5)().mark(function e(t){var i,n,r,o,a;return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],n=!t,!this._onLoadingItems){e.next=18;break}if(!n){e.next=14;break}return e.next=6,this._cancelTasks(A.d1.VIDEO,this._onLoadingItems);case 6:return r=e.sent,e.next=9,this._cancelTasks(A.d1.AUDIO,this._onLoadingItems);case 9:o=e.sent,i.push.apply(i,(0,u.u)(r)),i.push.apply(i,(0,u.u)(o)),e.next=18;break;case 14:return e.next=16,this._cancelTasks(t,this._onLoadingItems);case 16:a=e.sent,i.push.apply(i,(0,u.u)(a));case 18:this._onLoadingItems=i;case 19:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"_doCancel",value:(d=(0,u.x)((0,u.l5)().mark(function e(t){return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loader.cancel(t);case 2:this._emitCancel();case 3:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"_emitCancel",value:function(){var e=this;try{Object.keys(this._optionDataLenInfo).forEach(function(t){var i=e._optionDataLenInfo[t];Object.keys(i).forEach(function(n){var r=i[n]||{},o=r.size,a=r.range,s=r.extData;o>0&&e._emitPrfDataSizeEvent(Number(n),o,t,a,s,1)})})}catch(e){}this._resetOptionDataLenInfo()}},{key:"updateItemState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];e.length>0?i=e:i.push(e),i.forEach(function(e){t?e.downloaded=E.Kc.APPEND:e.downloaded=E.Kc.NO_START}),!t&&e.moof&&this._resetMoofSegmentDownloadState(e.mediaType)}},{key:"mseLog",value:function(e,t,i,n){var r;k.ZP.mse(null===(r=this.config)||void 0===r?void 0:r.vid,"type-".concat(i,"-start-").concat(t.start,"-end-").concat(t.end,"-").concat(e,",range:").concat(JSON.stringify(n||t.range)))}},{key:"emitPreloadHit",value:function(e){k.ZP.preload("emit preloadhit",e),this.player&&this.player.emit("log",{type:"onetemp",action:"append",data:{preload_hit:"".concat(e,"|")}})}},{key:"destroy",value:function(){var e,t;this._doCancel(),p()(this.loader),null===(e=this._secret)||void 0===e||e.destroy(),this._hasDestroyed=!0,null===(t=this._dynamicBufferService)||void 0===t||t.destroy()}},{key:"checkPCDN",value:(c=(0,u.x)((0,u.l5)().mark(function e(){var t,i,n,r,o;return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.player&&this.player.readyState<=HTMLVideoElement.HAVE_CURRENT_DATA)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t=this._pluginInst.currentDefitionFromPlayer.item,e.next=7,this._pcdnScv.checkPCDN((0,u.Zj)((0,u.Zj)({},t),{},{mediaType:"video"}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2);case 12:return e.prev=12,r=(n=(i=this.mpd.mediaList.audio)[i.selectedIdx]).bandwidth,o=n.baseURL,e.next=17,this._pcdnScv.checkPCDN((0,u.Zj)((0,u.Zj)({},i[i.selectedIdx]),{},{bitrate:r,main_url:o,mediaType:"audio"}));case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(12);case 22:case"end":return e.stop()}},e,this,[[2,9],[12,19]])})),function(){return c.apply(this,arguments)})},{key:"isOpenPCDN",value:function(e){var t=this;if(this._pcdnScv){var i,n,r=this._pluginInst.currentDefitionFromPlayer;if(!r){k.ZP.log("isOpenCPDN curDef is null");return}var o=r.item,a=o.bitrate,s=null===(i=this.mpd)||void 0===i?void 0:i._getCurBuffered(A.d1.VIDEO),l=null===(n=this.mpd)||void 0===n?void 0:n._getCurBuffered(A.d1.AUDIO),d=(e=Math.max(e,null==s?void 0:s[1],null==l?void 0:l[1]))-this.player.currentTime,c=d,f=d,h=this.player.currentTime;this.config.useSeparationMode&&(f=Math.max(0,(null==l?void 0:l[1])-h),c=Math.max(0,(null==s?void 0:s[1])-h)),this._pcdnScv.isOpenPCDN("video",c,a,(0,u.x)((0,u.l5)().mark(function e(){return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.abortLoadingTasks("video");case 2:case"end":return e.stop()}},e)})),o);var g=this.__dash__.dash.mpd.mediaList;if(g.audio.length>0){var p=g.audio[g.audio.selectedIdx],v=this.config.dashOpts.dynamic_video.dynamic_audio_list.filter(function(e){return e.bitrate===p.bandwidth})[0];this._pcdnScv.isOpenPCDN("audio",f,p.bandwidth,(0,u.x)((0,u.l5)().mark(function e(){return(0,u.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.abortLoadingTasks("audio");case 2:case"end":return e.stop()}},e)})),v)}}}},{key:"pcdnReqCnt",value:function(){return this._pcdnScv.pcdnReqCnt||{}}},{key:"pcdnVVStat",value:function(){return this._pcdnScv.pcdnVVStat||{}}}])},787475:function(e,t,i){i.d(t,{C:function(){return s},Z:function(){return d}});var n=i(395770);i(514312),i(121621),i(379493),i(953722),i(410121),i(724356),i(864614),i(238658),i(616414),i(224382),i(74370),i(533431),i(917128),i(621120),i(890568),i(494319),i(631666),i(542074),i(783858),i(677046),i(540865),i(794349),i(210434),i(612222);var r=i(280161),o=["module"],a="danger_d_speed";function s(e){var t=e.toString(16);if(t.length<=8)return{high:0,low:e};var i=parseInt(t.substr(0,t.length-8),16);return{high:i,low:parseInt(t.substr(t.length-8),16)}}var l={stall_penalty:11,switch_penalty:4,interval:1e3,startInterval:1e3,decodeUnderflowBuffer:1,decodeUnderflowMode:1,decodeUnderflowCount:1},d=(0,n.qH)(function e(t,i,o,a){var s=this,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{logger:function(){},openLog:!1};(0,n.PA)(this,e),this._wasmPromise=new r.XK,this._hasDeviceInfoChanged=!0,this.uuid=new Date().getTime().toString(36).slice(4),this._defaultMaxBitrate=0,this._underflowBitrate=0,this._minBitrate=1/0,this.config=t,this.segment_duration=a||5e3,this.logger=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];d.logger.apply(d,["abr(".concat(s.uuid,")::")].concat(t))},this.openLog=d.openLog,this.autoBitrateOpts=Object.assign({},l,t.autoBitrateOpts),this.stall_penalty=this.autoBitrateOpts.stall_penalty,this.switch_penalty=this.autoBitrateOpts.switch_penalty,this.interval=this.autoBitrateOpts.interval;var c=t.progressTimer||1e3,u=this.autoBitrateOpts.startInterval||c;this.initInterval=.8*u,this._preloadMethod=t.preloadmethod||0,this._videoWidth=0,this._videoHeight=0,this._maxDefinition=this.autoBitrateOpts.maxDefinition||null,this._underflowDefinition=this.autoBitrateOpts.underflowDefinition||null,this.updateBitrate(i),this.updateMediaInfos(o,!1)},[{key:"_onLoadWasm",value:function(){var e=this,t=this.autoBitrateOpts.module,i=this.autoBitrateOpts;i.module;var r=(0,n.Kd)(i,o),a=this.autoBitrateOpts.isClassic||!1;return t&&(a?this.module=new t((0,n.Zj)({promise:this._wasmPromise},r)):t(this.module={onRuntimeInitialized:function(){e._wasmPromise.resolve()}})),this._wasmPromise}},{key:"updateMediaInfos",value:function(e){var t=this,i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(this._heightToDefinitionConfig=new Map,this._bitrateToDefinitionConfig=new Map,this._definitionToDefitionConfig=new Map,!e){return}e.dynamic_video_list.forEach(function(e){null===(i=t._heightToDefinitionConfig)||void 0===i||i.set(e.height||e.vheight,e);var i,n,r,o=e.bandwidth||e.bitrate;o<t._minBitrate&&(t._minBitrate=o),null===(n=t._bitrateToDefinitionConfig)||void 0===n||n.set(o,e),e.definition&&(null===(r=t._definitionToDefitionConfig)||void 0===r||r.set(e.definition,e))}),this._maxDefinition&&(this._defaultMaxBitrate=this._getBitrate(this._maxDefinition)),this._underflowDefinition&&(this._underflowBitrate=this._getBitrate(this._underflowDefinition)),this.mediaInfos=e}},{key:"_getBitrate",value:function(e){var t;return(null===(t=this._definitionToDefitionConfig)||void 0===t||null===(t=t.get(e))||void 0===t?void 0:t.bandwidth)||-1}},{key:"transformMediaInfo",value:function(){if(this.setDebugModel(this.openLog),!!this.mediaInfos){this.logger("mediaInfos",this.mediaInfos);try{for(var e,t=[],i=this.mediaInfos.dynamic_video_list,n=0;n<i.length;n++){var r=i[n];t.push({stream_id:"s".concat(n),bandwidth:r.bitrate||r.bandwidth,width:r.vwidth||r.width,height:r.vheight||r.height,codec:r.codecs||r.codec_type||"h264",frame_rate:Number(r.fps)||-1,segment_duration:this.segment_duration,definition:r.qualityType})}var o=JSON.stringify({v_adaptation:t});null===(e=this.module)||void 0===e||e.ccall("parseMPD","null",["string"],[o])}catch(e){}}}},{key:"_getDefaultSpeed",value:function(e){var t=0,i=navigator.connection;if(i&&i.downlink)t=1024*i.downlink/8,this.logger("initSpeed connect",t);else try{t=parseFloat(r.Xb.getItem(a)||"")||0,this.logger("initSpeed connect",t)}catch(e){}return 0===t&&(t=e&&e.historyAvspeed||0,this.logger("initSpeed history",t)),t}},{key:"setDebugModel",value:function(e){var t,i;null===(t=this.module)||void 0===t||null===(i=t._setDebugModel)||void 0===i||i.call(t,e)}},{key:"updateBitrate",value:function(e){var t,i,n=this;this.bitrate=e,e>0&&(this.module?null===(t=(i=this.module).updateBitrate)||void 0===t||t.call(i,e):this.readyPromise().then(function(){var t,i;null===(t=n.module)||void 0===t||null===(i=t.updateBitrate)||void 0===i||i.call(t,e)}))}},{key:"getPreloadBitrate",value:function(){return null}},{key:"_updateDeviceInfo",value:function(e){try{if(this._hasDeviceInfoChanged){var t,i=window.devicePixelRatio||1;null===(t=this.module)||void 0===t||t._updateDeviceInfo(this._videoWidth||Number(this.config.width),this._videoHeight||Number(this.config.height),i,e||-1)}this._hasDeviceInfoChanged=!1}catch(e){}}},{key:"readyPromise",value:function(){return this._wasmPromise}}]);d.SPPED_CACHE=a},799618:function(e,t,i){i.d(t,{v:function(){return o}});var n=i(989798);i(724356);var r=i(194235),o=(0,n.qH)(function e(t){(0,n.PA)(this,e),this._config=Object.assign({},t)},[{key:"select",value:function(e,t,i){if(e.length<=1)return e[0];var n,o=i.autoBitrateParams,a=o.paramA,s=o.paramB,l=o.paramC,d=o.paramD;this._config=Object.assign({},i);var c=this._config.defaultBitrate,u=t<=0||!t?c:a*Math.pow(t,3)+s*Math.pow(t,2)+l*t+d;return!(n=(0,r.v2)(e,u,i.selectAlgType))&&(n=e[e.length-1]),n._targetBitrate=u,n}}])},809068:function(e,t,i){i.d(t,{KR:function(){return l},Rr:function(){return s},dJ:function(){return a}});var n,r,o,a=((n=a||{})[n.DURATION=0]="DURATION",n[n.SIZE=1]="SIZE",n);var s=((r=s||{})[r.INDEXDB=0]="INDEXDB",r[r.MEMORY=1]="MEMORY",r);var l=((o=l||{}).PRELOAD_NEXT="PRELOAD_NEXT",o.PRELOAD_START="PRELOAD_START",o.PRELOAD_CANCEL="PRELOAD_CANCEL",o)},74072:function(e,t,i){i.d(t,{J:function(){return r}});var n,r=((n=r||{}).CHANGE_FLYING_PLUGIN_CONFIG="CHANGE_FLYING_PLUGIN_CONFIG",n)},544999:function(e,t,i){i.d(t,{Z:function(){return n}});var n=(0,i(68950).p)("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyogZXNsaW50LWRpc2FibGUgbm8tZXZhbCAqLwogIC8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmICovCiAgLy8g55uu5YmN5LuF5pSv5oyBeXV2NDIwCgogIGZ1bmN0aW9uIHNoaW1JbXBvcnRTY3JpcHRzIChzcmMpIHsKICAgIHJldHVybiBmZXRjaChzcmMpCiAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICByZXR1cm4gcmVzLnRleHQoKQogICAgICB9KQogICAgICAudGhlbihmdW5jdGlvbiAodGV4dCkgewogICAgICAgIGV2YWwodGV4dCk7CiAgICAgICAgc2VsZi5Nb2R1bGUgPSBNb2R1bGU7CiAgICAgICAgc2VsZi5hZGRPblBvc3RSdW4gPSBhZGRPblBvc3RSdW47CiAgICAgIH0pCiAgfQoKICB2YXIgTUFYX1NUUkVBTV9CVUZGRVJfTEVOR1RIID0gMTAyNCAqIDEwMjQgKiA1OyAvLyDliIbphY0gNU0g56m66Ze05a2Y5YKo5bin5pWw5o2uCiAgdmFyIEJBVENIX0RFQ09ERV9TSVpFID0gODsgLy8g5LiA5qyh5aSE55CG55qE5bin5pWw6YePCiAgdmFyIGluaXRUcyA9IDA7CgogIHZhciBEZWNvZGVyID0gZnVuY3Rpb24gKHNlbGYpIHsKICAgIHRoaXMuaW5pdGVkID0gZmFsc2U7CiAgICB0aGlzLmluZm9JZCA9IDA7CiAgICB0aGlzLnNlbGYgPSBzZWxmOwogICAgdGhpcy5tZXRhID0gc2VsZi5tZXRhOwogICAgdGhpcy50cyA9IDA7CiAgICB0aGlzLmluZm9saXN0ID0gW107CiAgICBzZWxmLnBhcl9icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQgPSB0aGlzLmJyb2Fkd2F5T25Ccm9hZHdheUluaXRlZC5iaW5kKHRoaXMpOwogICAgc2VsZi5wYXJfYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkID0gdGhpcy5icm9hZHdheU9uUGljdHVyZURlY29kZWQuYmluZCh0aGlzKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS50b1U4QXJyYXkgPSBmdW5jdGlvbiAocHRyLCBsZW5ndGgpIHsKICAgIHJldHVybiBNb2R1bGUuSEVBUFU4LnN1YmFycmF5KHB0ciwgcHRyICsgbGVuZ3RoKQogIH07CgogIERlY29kZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICBNb2R1bGUuX2Jyb2Fkd2F5SW5pdCgwLCAyKTsKCiAgICAvLyDlrZjlgqjluKfmlbDmja7nmoRidWZmZXLlvIDlp4vkvY3nva4KICAgIHRoaXMuc3RyZWFtQnVmZmVyUHRyID0gTW9kdWxlLl9icm9hZHdheUNyZWF0ZVN0cmVhbShNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEgpOwogICAgdGhpcy5zdHJlYW1CdWZmZXIgPSB0aGlzLnRvVThBcnJheSh0aGlzLnN0cmVhbUJ1ZmZlclB0ciwgTUFYX1NUUkVBTV9CVUZGRVJfTEVOR1RIKTsKICAgIC8vIOeUqOadpeWtmOWCqOavj+W4p3NpemXnmoTmlbDmja7nmoTlvIDlp4vkvY3nva4KICAgIHRoaXMuYnVmZmVyU2l6ZXNQdHIgPSBNb2R1bGUuX21hbGxvYyg0ICogQkFUQ0hfREVDT0RFX1NJWkUpOwogICAgdGhpcy5idWZmZXJTaXplcyA9IHRoaXMudG9VOEFycmF5KHRoaXMuYnVmZmVyU2l6ZXNQdHIsIDQgKiBCQVRDSF9ERUNPREVfU0laRSk7CiAgICB0aGlzLnN0cmVhbUJ1ZmZlck9mZnNldCA9IDA7CiAgICB0aGlzLmZyYW1lTGVuc09mZnNldCA9IDA7CiAgICB0aGlzLmZyYW1lTGVuc0J1ZmZlciA9IG5ldyBVaW50MzJBcnJheShCQVRDSF9ERUNPREVfU0laRSk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkID0gZnVuY3Rpb24gKG9mZnNldCwgd2lkdGgsIGhlaWdodCkgewogICAgdmFyIGluZm8gPSB0aGlzLmluZm9saXN0LnNoaWZ0KCk7CiAgICB2YXIgeVJvd2NvdW50ID0gaGVpZ2h0OwogICAgdmFyIHV2Um93Y291bnQgPSBoZWlnaHQgLyAyOwogICAgdmFyIHlMaW5lc2l6ZSA9IHdpZHRoOwogICAgdmFyIHV2TGluZXNpemUgPSB3aWR0aCAvIDI7CiAgICBpZiAodGhpcy5tZXRhICYmICh0aGlzLm1ldGEuY2hyb21hRm9ybWF0ID09PSA0NDQgfHwgdGhpcy5tZXRhLmNocm9tYUZvcm1hdCA9PT0gNDIyKSkgewogICAgICB1dlJvd2NvdW50ID0gaGVpZ2h0OwogICAgfQogICAgdmFyIGRhdGEgPSB0aGlzLnRvVThBcnJheShvZmZzZXQsIHlMaW5lc2l6ZSAqIHlSb3djb3VudCArIDIgKiAodXZMaW5lc2l6ZSAqIHV2Um93Y291bnQpKTsKICAgIC8vIHRoaXMuaW5mb2xpc3RbaW5mb2lkXSA9IG51bGw7CiAgICB2YXIgZGF0ZXRlbXAgPSBuZXcgVWludDhBcnJheShkYXRhLmxlbmd0aCk7CiAgICBkYXRldGVtcC5zZXQoZGF0YSk7CiAgICB2YXIgYnVmZmVyID0gZGF0ZXRlbXAuYnVmZmVyOwoKICAgIHRoaXMuc2VsZi5wb3N0TWVzc2FnZSgKICAgICAgewogICAgICAgIG1zZzogJ0RFQ09ERUQnLAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodCwKICAgICAgICB5TGluZXNpemUsCiAgICAgICAgdXZMaW5lc2l6ZSwKICAgICAgICBpbmZvLAogICAgICAgIGJ1ZmZlcgogICAgICB9LAogICAgICBbYnVmZmVyXQogICAgKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5pbml0ZWQpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB0aGlzLmluaXRlZCA9IHRydWU7CiAgICB2YXIgY29zdCA9IDA7CiAgICBpZiAoaW5pdFRzKSB7CiAgICAgIGNvc3QgPSBwZXJmb3JtYW5jZS5ub3coKSAtIGluaXRUczsKICAgIH0KICAgIHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7IG1zZzogJ0RFQ09ERVJfUkVBRFknLCBjb3N0IH0pOwogIH07CgogIERlY29kZXIucHJvdG90eXBlLnN0b3JlQnVmZmVyID0gZnVuY3Rpb24gKGRhdGEsIGZJbmZvKSB7CiAgICBpZiAoZkluZm8gJiYgZkluZm8ua2V5ZnJhbWUpIHsKICAgICAgdGhpcy5mbHVzaCgpOwogICAgfQogICAgdGhpcy5pbmZvbGlzdC5wdXNoKGZJbmZvKTsKICAgIHRoaXMuc3RyZWFtQnVmZmVyLnNldChkYXRhLCB0aGlzLnN0cmVhbUJ1ZmZlck9mZnNldCk7CiAgICB0aGlzLmZyYW1lTGVuc0J1ZmZlclt0aGlzLmZyYW1lTGVuc09mZnNldF0gPSBkYXRhLmxlbmd0aDsKICAgIHRoaXMuc3RyZWFtQnVmZmVyT2Zmc2V0ICs9IGRhdGEubGVuZ3RoOwogICAgdGhpcy5mcmFtZUxlbnNPZmZzZXQgKz0gMTsKICAgIHRoaXMuYmF0Y2hEZWNvZGUoKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS5iYXRjaERlY29kZSA9IGZ1bmN0aW9uIChmbHVzaCkgewogICAgLy8g5pSSMTDluKflpITnkIbkuIDmrKEg5oiW6ICFIOW8uuWItuino+eggQogICAgdmFyIHRvZG8gPSB0aGlzLmZyYW1lTGVuc09mZnNldCA+PSBCQVRDSF9ERUNPREVfU0laRSB8fCAoZmx1c2ggJiYgdGhpcy5mcmFtZUxlbnNPZmZzZXQpOwogICAgaWYgKHRvZG8pIHsKICAgICAgdGhpcy5idWZmZXJTaXplcy5zZXQobmV3IFVpbnQ4QXJyYXkodGhpcy5mcmFtZUxlbnNCdWZmZXIuYnVmZmVyKSwgMCk7CiAgICAgIE1vZHVsZS5fYnJvYWR3YXlQbGF5U3RyZWFtMSh0aGlzLmJ1ZmZlclNpemVzUHRyLCB0aGlzLmZyYW1lTGVuc09mZnNldCk7CiAgICAgIHRoaXMuZnJhbWVMZW5zT2Zmc2V0ID0gMDsKICAgICAgdGhpcy5zdHJlYW1CdWZmZXJPZmZzZXQgPSAwOwogICAgfQogIH07CgogIERlY29kZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLnN0cmVhbUJ1ZmZlci5zZXQoZGF0YSk7CiAgICBNb2R1bGUuX2Jyb2Fkd2F5UGxheVN0cmVhbShkYXRhLmxlbmd0aCwgMCk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuZmx1c2ggPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmJhdGNoRGVjb2RlKHRydWUpOwogICAgTW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKCk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgIE1vZHVsZS5fYnJvYWR3YXlFeGl0KCk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUudXBkYXRlTWV0YSA9IGZ1bmN0aW9uIChtZXRhKSB7CiAgICB0aGlzLm1ldGEgPSBtZXRhOwogIH07CgogIHZhciBkZWNvZGVyOwoKICBmdW5jdGlvbiBvblBvc3RSdW4gKCkgewogICAgZGVjb2RlciA9IG5ldyBEZWNvZGVyKHRoaXMpOwogICAgZGVjb2Rlci5pbml0KCk7CiAgfQoKICB2YXIgV0FTTV9DRE5fUEFUSF9QUkVGSVggPSAnJzsKCiAgZnVuY3Rpb24gaW5pdCAodXJsKSB7CiAgICBXQVNNX0NETl9QQVRIX1BSRUZJWCA9IHVybC5zcGxpdCgnLycpLnNsaWNlKDAsIC0xKS5qb2luKCcvJyk7CiAgICBpbml0VHMgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgIGlmICghZGVjb2RlcikgewogICAgICB2YXIgdGFzazsKCiAgICAgIGlmICghc2VsZi5pbXBvcnRTY3JpcHRzKSB7CiAgICAgICAgdGFzayA9IHNoaW1JbXBvcnRTY3JpcHRzKHVybCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFzayA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIGlmICghc2VsZi5jb25zb2xlKSB7CiAgICAgICAgICAgIHNlbGYuY29uc29sZSA9IHsKICAgICAgICAgICAgICBsb2c6IGZ1bmN0aW9uICgpIHt9LAogICAgICAgICAgICAgIHdhcm46IGZ1bmN0aW9uICgpIHt9LAogICAgICAgICAgICAgIGluZm86IGZ1bmN0aW9uICgpIHt9LAogICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7fQogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2VsZi5pbXBvcnRTY3JpcHRzKHVybCk7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICB0YXNrCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGZldGNoKFdBU01fQ0ROX1BBVEhfUFJFRklYICsgJy9kZWNvZGVyLndvcmtlci5qcycpCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICByZXR1cm4gcmVzLmJsb2IoKQogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoYmxvYikgewogICAgICAgICAgICAgIHJldHVybiBzZWxmLm0oewogICAgICAgICAgICAgICAgbG9jYXRlRmlsZTogZnVuY3Rpb24gKHN1ZmZpeCkgewogICAgICAgICAgICAgICAgICBpZiAoL1wud29ya2VyXC5qcyQvLnRlc3Qoc3VmZml4KSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKC9cLndhc20kLy50ZXN0KHN1ZmZpeCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gV0FTTV9DRE5fUEFUSF9QUkVGSVggKyAnL2RlY29kZXIud2FzbScKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoL1wubWVtJC8udGVzdChzdWZmaXgpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFdBU01fQ0ROX1BBVEhfUFJFRklYICsgJy9kZWNvZGVyLmpzLm1lbScKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1haW5TY3JpcHRVcmxPckJsb2I6IFdBU01fQ0ROX1BBVEhfUFJFRklYICsgJy9kZWNvZGVyLmpzJwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChNb2QpIHsKICAgICAgICAgICAgICBzZWxmLk1vZHVsZSA9IE1vZDsKICAgICAgICAgICAgICBvblBvc3RSdW4uY2FsbChzZWxmKTsKICAgICAgICAgICAgfSkKICAgICAgICB9KQogICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIG1zZzogJ0lOSVRfRkFJTEVEJywKICAgICAgICAgICAgbG9nOiBlLm1lc3NhZ2UKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQogIH0KCiAgc2VsZi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgdmFyIGRhdGEgPSBlLmRhdGE7CiAgICBpZiAoZGF0YS5tc2cgIT09ICdpbml0JyAmJiBkYXRhLm1zZyAhPT0gJ3ByZWxvYWQnICYmICFkZWNvZGVyKSByZXR1cm4KICAgIHN3aXRjaCAoZGF0YS5tc2cpIHsKICAgICAgY2FzZSAncHJlbG9hZCc6CiAgICAgICAgaW5pdChkYXRhLnVybCk7CiAgICAgICAgQkFUQ0hfREVDT0RFX1NJWkUgPSBkYXRhLmJhdGNoRGVjb2RlQ291bnQ7CiAgICAgICAgYnJlYWsKICAgICAgY2FzZSAnaW5pdCc6CiAgICAgICAgc2VsZi5tZXRhID0gZGF0YS5tZXRhOwogICAgICAgIEJBVENIX0RFQ09ERV9TSVpFID0gZGF0YS5iYXRjaERlY29kZUNvdW50OwogICAgICAgIGluaXQoZGF0YS51cmwpOwogICAgICAgIGJyZWFrCiAgICAgIGNhc2UgJ3VwZGF0ZW1ldGEnOgogICAgICAgIHNlbGYubWV0YSA9IGRhdGEubWV0YTsKICAgICAgICBkZWNvZGVyLnVwZGF0ZU1ldGEoZGF0YS5tZXRhKTsKICAgICAgICBicmVhawogICAgICBjYXNlICdpbml0RGVjb2Rlcic6CiAgICAgICAgaWYgKGRlY29kZXIuZnJhbWVMZW5zT2Zmc2V0KSB7CiAgICAgICAgICBkZWNvZGVyLmJhdGNoRGVjb2RlKHRydWUpOwogICAgICAgIH0KICAgICAgICBkZWNvZGVyLmZsdXNoKCk7CiAgICAgICAgZGVjb2Rlci5kZWNvZGUoZGF0YS5kYXRhKTsKICAgICAgICBicmVhawogICAgICBjYXNlICdkZWNvZGUnOgogICAgICAgIGRlY29kZXIuc3RvcmVCdWZmZXIoZGF0YS5kYXRhLCBkYXRhLmluZm8pOwogICAgICAgIGJyZWFrCiAgICAgIGNhc2UgJ2ZsdXNoJzoKICAgICAgICBkZWNvZGVyLmZsdXNoKCk7CiAgICAgICAgYnJlYWsKICAgICAgY2FzZSAnZmluaXNoX2ZsYWcnOgogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgbXNnOiAnQkFUQ0hfRklOSVNIX0ZMQUcnCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWsKICAgICAgY2FzZSAnZGVzdG9yeSc6CiAgICAgICAgZGVjb2Rlci5kZXN0cm95KCk7CiAgICAgICAgYnJlYWsKICAgIH0KICB9OwoKfSgpKTsKCg==",null,!1)},740200:function(e,t,i){i.d(t,{DO:function(){return f},Dd:function(){return h},HQ:function(){return d},J2:function(){return p},Vw:function(){return u},X2:function(){return l},mt:function(){return g},u$:function(){return c}}),i(410121);var n=i(364508),r=0,o=0,a=0,s=!1;function l(){r++}function d(){return r}function c(){o++}function u(){return o}function f(e){try{localStorage.setItem("xgv_dis",e),(2===e||3===e)&&localStorage.setItem("xgv_dist",new Date().getTime())}catch(e){}}function h(){s=!0}function g(){if(!0===(!!s||0!==(0,n.tT)().evaluateVVCount&&(r>=(0,n.tT)().evaluateVVCount&&(a=o/r,r=0,o=0),a>=(0,n.tT)().disabledByLowdecodePrecent&&(s=!0),s)))return!0;try{var e=localStorage.getItem("xgv_dis");if(!e)return!1;if("1"===e)return!0;if("2"===e){var t=localStorage.getItem("xgv_dist")||0;if(t=Number(t),(new Date().getTime()-t)/1e3<(0,n.tT)().disabledDuration)return!0;p()}if("3"===e){var i=localStorage.getItem("xgv_dist")||0;if(i=Number(i),(new Date().getTime()-i)/1e3<(0,n.tT)().longDisabledDuration)return!0;p()}}catch(e){}}function p(){localStorage.removeItem("xgv_dist"),localStorage.removeItem("xgv_dis")}},359447:function(e,t,i){i.d(t,{Z:function(){return A}}),i(530129);var n=i(429250),r=i(247425),o=i(938156),a=i(440669),s=i(356670),l=i(269277),d=i(917970),c=i(197201),u=i(668117);i(210434),i(925745),i(227470),i(459167),i(561999),i(864614),i(632852),i(514312),i(130458),i(410121),i(996022),i(919402),i(904644),i(441609);var f=i(515046),h=i(336849),g=i(495728),p=i(364508),v=i(740200),m=i(635035),y=i(720202),I=i(567819),_=i(119443),C={LOW_LATENCY:1,NO_AUDIO:2,NO_VIDEO:3},A=function(e){(0,l.Z)(A,e);var t,i,u=(t=A,i=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,c.Z)(t);return e=i?Reflect.construct(n,arguments,(0,c.Z)(this).constructor):n.apply(this,arguments),(0,d.Z)(this,e)});function A(){var e;return(0,r.Z)(this,A),(e=u.call(this)).TAG="XGVideo",e._proxyProps(),e._isLive=!0,e._vMeta=null,e._aMeta=null,e._resizeObserver=null,e._eventsBackup=[],e._domConnected=!1,e._hevc="h265"===(0,p.tT)().preloadDecoder,!e._hevc&&(e._degradeVideo=document.createElement("video")),e._onTouchEnd=e._onTouchEnd.bind((0,a.Z)(e)),e.analyse=new I.Z,e}return(0,o.Z)(A,[{key:"_proxyProps",value:function(){var e=this;Object.getOwnPropertyNames(A.prototype).forEach(function(t){/^__/.test(t)&&Object.defineProperty(e,t.replace("__",""),{get:function(){try{return this[t]}catch(e){}return 0},set:function(e){try{this[t]=e}catch(e){}}})})}},{key:"addEventListener",value:function(e,t,i){(0,s.Z)((0,c.Z)(A.prototype),"addEventListener",this).call(this,e,t,i),this._degradeVideo&&this._eventsBackup.push([e,t,i])}},{key:"removeEventListener",value:function(e,t,i){(0,s.Z)((0,c.Z)(A.prototype),"removeEventListener",this).call(this,e,t,i),this._degradeVideo&&(this._eventsBackup=this._eventsBackup.filter(function(n){return!(n.eventName===e&&n.handler===t&&n.capture===i)}))}},{key:"setAttribute",value:function(e,t){var i;(0,s.Z)((0,c.Z)(A.prototype),"setAttribute",this).call(this,e,t),"src"!==e&&(null===(i=this._degradeVideo)||void 0===i||i.setAttribute(e,t))}},{key:"_init",value:function(){this.analyse.reset(),this.timeline=new m.Z({volume:this.volume,canvas:this.querySelector("canvas"),videoContext:this.videoContext,videoDecode:this.videoDecode,maxVideoHeight:this.getAttribute("maxVideoHeight"),endLevel:parseInt(this.getAttribute("endLevel"))},this),g.kg.log(this.TAG,"timeline init"),this._noSleep=new f.Z,this._logFirstFrame=!1,this._playRequest=null,this._degradeVideoUserGestured=!1,this._bindEvents(),this._vMeta&&!this.videoDecode&&this.setVideoMeta(this._vMeta),this._glCtxOptions&&(this.glCtxOptions=this._glCtxOptions),this.timeline&&(this.innerDegrade&&this.timeline.emit(y.ZP.TIMELINE.INNER_DEGRADE),this.timeline.emit(y.ZP.TIMELINE.SET_PLAY_MODE,this._isLive?"LIVE":"VOD"),this.timeline.emit(y.ZP.TIMELINE.SET_PLAYBACKRATE,this.playbackRate),this.muted=this.muted)}},{key:"_bindEvents",value:function(){var e=this;this.timeline.on(y.ZP.TIMELINE.PLAY_EVENT,function(t,i){var n,r;if(t===y.NW.LOADEDDATA&&(!e.querySelector("canvas")&&(g.kg.log(e.TAG,"_bindEvents, appendChild canvas"),e.appendChild(e.canvas)),e.canvas.style.display="block",null===(r=e.timeline)||void 0===r||r.emit(y.ZP.TIMELINE.SET_PLAYBACKRATE,e.playbackRate)),(t===y.NW.RESIZE&&null!==(n=e.timeline)&&void 0!==n&&n.ready||t===y.NW.CANVAS_LAYOUT)&&Promise.resolve().then(function(){e.updateVideoPostion()}),t===y.NW.ERROR){if(g.kg.warn(e.TAG,"detect error:",null==i?void 0:i.message),e.pause(),e._disabled(!0),e.innerDegrade||5===e.decoderMode){e.degradeInfo={decodeFps:e.decodeFps,bitrate:e.bitrate,wasmInitCost:e.wasmInitCost,fps:e.fps,url:e.src,msg:null==i?void 0:i.message,decoderMode:e.decoderMode},e._innerDispatchEvent("lowdecode");return}e._err=i}if(t===y.NW.LOW_DECODE){e._disabled(),e.degradeInfo={decodeFps:e.decodeFps,bitrate:e.bitrate,wasmInitCost:e.wasmInitCost,fps:e.fps,url:e.src,decoderMode:e.decoderMode},e._innerDispatchEvent(y.R_[t],e.degradeInfo);return}if(t===y.NW.LARGE_AV_GAP&&(e.unsyncInfo=i),t===y.NW.ENDED){if(e.paused)return;e.pause()}t===y.NW.PROGRESS&&e._noSleep.toPlay(),t===y.NW.WAITING&&e.analyse.addWaiting(),t===y.NW.SEEKING&&e.analyse.addSeeking(),t===y.NW.SEEKED&&e.analyse.addSeeked(),e._innerDispatchEvent(y.R_[t],i)})}},{key:"_disabled",value:function(e){if(!!this.innerDegrade||!!e){if(e){if((0,p.tT)().evaluateVVCount){(0,v.Dd)();return}(0,v.DO)(1);return}if(!(0,p.tT)().evaluateVVCount){if(this.decodeFps/this.fps<=.6&&this.bitrate<2e6){(0,v.DO)(1);return}(0,v.DO)(2)}}}},{key:"degrade",value:function(e){var t=this;this.querySelector("canvas")?this.replaceChild(this._degradeVideo,this.canvas):this.appendChild(this._degradeVideo),this.destroy(),this._eventsBackup.forEach(function(e){var i,r=(0,n.Z)(e,3),o=r[0],a=r[1],l=r[2];(0,s.Z)((0,c.Z)(A.prototype),"removeEventListener",t).call(t,o,a,l),null===(i=t._degradeVideo)||void 0===i||i.addEventListener(o,a,l)}),this._eventsBackup=[],e&&(this._degradeVideo.muted=!1,this._degradeVideo.src=e,this._degradeVideo.load())}},{key:"disconnectedCallback",value:function(){if(this._domConnected=!1,g.kg.log(this.TAG,"video disconnected"),document.removeEventListener("touchend",this._onTouchEnd,!0),this.querySelector("canvas"))try{this.removeChild(this.querySelector("canvas")),g.kg.log(this.TAG,"remove canvas child")}catch(e){}this.destroy(!0),this._resizeObserver&&this._resizeObserver.disconnect(this)}},{key:"connectedCallback",value:function(){var e,t,i,n=this;if((null===(e=this.childNodes[0])||void 0===e?void 0:null===(t=e.tagName)||void 0===t?void 0:null===(i=t.toLocaleLowerCase)||void 0===i?void 0:i.call(t))==="source"){(0,v.Dd)();var r=Error("not supported source type");r.code=3,this._err=r,this._innerDispatchEvent("error",r);return}g.kg.log(this.TAG,"video connected to document",performance.now()),!this.timeline&&this._init(),this.style.width="100%",this.style.height="100%",this.style.position="absolute",this.style.left="0px",this.style.top="0px",document.addEventListener("touchend",this._onTouchEnd,!0),ResizeObserver&&(this._resizeObserver=new ResizeObserver(function(e){var t;null!==(t=n.timeline)&&void 0!==t&&t.ready&&n.updateVideoPostion()}),this._resizeObserver.observe(this)),this._domConnected=!0}},{key:"_onTouchEnd",value:function(){(0,h.fC)(),this._degradeVideoInteract(),this._noSleep&&this._noSleep.enable()}},{key:"_degradeVideoInteract",value:function(){var e=this;if(this._degradeVideo&&(1===this.innerDegrade||3===this.innerDegrade)){if(this._degradeVideoUserGestured)return;var t=this._degradeVideo.play();t&&t.then(function(){e._degradeVideo.pause(),e._degradeVideoUserGestured=!0}).catch(function(e){})}}},{key:"play",value:function(e){var t=this;if(!this.timeline)return new Promise(function(e){setTimeout(function(){e()},800)});g.kg.log(this.TAG,"play() called, ready:".concat(this.timeline.ready,", paused:").concat(this.timeline.paused,", force:").concat(e)),this._degradeVideoInteract();var i=0;if(this.timeline.ready&&this.timeline.paused||e){if(e=e||this._isLive,this._playRequest=null,!e)return this.timeline.emit(y.ZP.TIMELINE.DO_PLAY),this._innerDispatchEvent("play"),Promise.resolve();this.destroy(),this._init(),i=setTimeout(function(){try{t._innerDispatchEvent("waiting")}catch(e){}},300)}return this._playRequest||!this.timeline.ready||this.timeline.paused?(g.kg.log(this.TAG,"request play!"),this._playRequest=this._playRequest||new Promise(function(e,n){t.timeline._paused=!1,t._innerDispatchEvent("play"),t._noSleep.enable(),t.timeline.once("ready",function(){g.kg.log(t.TAG,"timeline emit ready"),clearTimeout(i),t.timeline.play().then(e).catch(n).finally(function(){t._playRequest=null})})}),this._playRequest):Promise.resolve()}},{key:"pause",value:function(){this._playRequest=null,this.timeline&&this.timeline.pause();try{this._noSleep.disable(),(0,h.BR)()}catch(e){}}},{key:"load",value:function(){}},{key:"appendBuffer",value:function(e,t){if(this.timeline&&!this._err){if(!this._logFirstFrame){var i=e&&e.samples[0],n=t&&t.samples[0];if(!i&&!n)return;if(i||n){var r=(null==e?void 0:e.duration)/((null==e?void 0:e.formatTimescale)||1/0),o=(null==t?void 0:t.duration)/((null==t?void 0:t.formatTimescale)||1/0);g.kg.warn(this.TAG,"video firstDts:".concat(i&&i.dts," , audio firstDts:").concat(n&&n.dts," videoTrack.duration=").concat(r,", audioTrack.duration=").concat(o)),this._logFirstFrame=!0,(r||o)&&(this.setPlayMode("VOD"),this.timeline.emit(y.ZP.TIMELINE.SET_PLAY_MODE,this._isLive?"LIVE":"VOD"),this.duration=Math.min(r||o,o||r)),this.analyse.addFirstData()}this.lowlatency&&(g.kg.warn(this.TAG,"single track! type=",C.LOW_LATENCY),this.timeline.emit(y.ZP.TIMELINE.SINGLE_TRACK,C.LOW_LATENCY)),!t.exist()&&(g.kg.warn(this.TAG,"single track! type=",C.NO_AUDIO),this.timeline.emit(y.ZP.TIMELINE.SINGLE_TRACK,C.NO_AUDIO)),!e.exist()&&(g.kg.warn(this.TAG,"single track! type=",C.NO_VIDEO),this.timeline.emit(y.ZP.TIMELINE.SINGLE_TRACK,C.NO_VIDEO))}e.formatTimescale&&e.samples.forEach(function(t){t.dts=Math.floor(t.dts/e.formatTimescale*1e3),t.pts=Math.floor(t.pts/e.formatTimescale*1e3)}),t.formatTimescale&&t.samples.forEach(function(e){e.dts=Math.floor(e.dts/t.formatTimescale*1e3),e.pts=Math.floor(e.pts/t.formatTimescale*1e3)}),this.timeline.appendBuffer(e,t)}}},{key:"setAudioMeta",value:function(e){this._aMeta=e,this.timeline.emit(y.ZP.TIMELINE.SET_METADATA,"audio",e)}},{key:"setVideoMeta",value:function(e){(this._isLive||!this._vMeta)&&(this.timeline.emit(y.ZP.TIMELINE.SET_METADATA,"video",e),this._vMeta=e)}},{key:"setDecodeMode",value:function(e){this.setAttribute("decodeMode",e)}},{key:"setPlayMode",value:function(e){this._isLive="LIVE"===e}},{key:"endOfStream",value:function(){var e;this.currentTime&&(null===(e=this.timeline)||void 0===e||e.emit(y.ZP.TIMELINE.END_OF_STREAM))}},{key:"updateVideoPostion",value:function(){var e;null===(e=this.timeline)||void 0===e||e.emit(y.ZP.VIDEO.UPDATE_VIDEO_FILLTYPE,this.xgfillType,this.containerLayout)}},{key:"_innerDispatchEvent",value:function(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}},{key:"destroy",value:function(e){this.timeline&&(this._noSleep.destroy(),g.kg.log(this.TAG,"call destroy"),this.timeline.emit(y.ZP.TIMELINE.DESTROY,e),this.querySelector("video")&&this.removeChild(this.querySelector("video")),this.timeline=null,this._err=null,this._noSleep=null,this._eventsBackup=[])}},{key:"updateObjectPosition",value:function(e,t){this.timeline.emit(y.ZP.VIDEO.UPDATE_VIDEO_COVER_POSITION,this.containerLayout,e,t),this._degradeVideo&&(this._degradeVideo.style.objectPosition="".concat(100*e,"% ").concat(100*t,"%"))}},{key:"setVideoDecode",value:function(){g.kg.log(this.TAG,"set videoDecode",this.videoDecode),this.videoDecode&&this.timeline&&this.timeline.videoRender&&(this.timeline.videoRender.videoDecode=this.videoDecode)}},{key:"live",get:function(){return this._isLive}},{key:"lowlatency",get:function(){return"true"===this.getAttribute("lowlatency")},set:function(e){this.setAttribute("lowlatency",e)}},{key:"autoplay",get:function(){return"true"===this.getAttribute("autoplay")},set:function(e){this.setAttribute("autoplay",e)}},{key:"__canvas",get:function(){return this.timeline.canvas}},{key:"__ended",get:function(){return .5>Math.abs(this.currentTime-this.duration)}},{key:"__width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(e){this.setAttribute("width","number"==typeof e?"".concat(e,"px"):e),this.canvas.width=e}},{key:"__height",get:function(){return this.getAttribute("height")},set:function(e){this.setAttribute("height","number"==typeof e?"".concat(e,"px"):e),this.canvas.height=e}},{key:"__videoWidth",get:function(){return this.canvas.width}},{key:"__videoHeight",get:function(){return this.canvas.height}},{key:"__volume",get:function(){return Number(this.getAttribute("volume"))},set:function(e){e<=0&&(e=0),e>=1&&(e=1),this.setAttribute("volume",e),!this.muted&&this.timeline.emit(y.ZP.TIMELINE.UPDATE_VOLUME,e)}},{key:"__muted",get:function(){return"true"===this.getAttribute("muted")},set:function(e){this.setAttribute("muted",e),this._degradeVideoInteract(),this._noSleep.enable(),this.timeline.emit(y.ZP.TIMELINE.UPDATE_VOLUME,e?0:this.volume)}},{key:"__currentTime",get:function(){return this.timeline?Math.min(this.timeline.currentTime,this.timeline.duration):0},set:function(e){this._seek(e)}},{key:"_seek",value:function(e){this.timeline&&(!this.buffered.length&&this.play(),this.paused&&!this._isLive&&e<1&&this.play(),this.timeline.seek(Number(e)))}},{key:"__duration",get:function(){return this._isLive?1/0:this.timeline.duration},set:function(e){this.timeline.emit(y.ZP.TIMELINE.SET_VIDEO_DURATION,e),this._innerDispatchEvent("durationchange")}},{key:"__seeking",get:function(){return this.timeline.seeking}},{key:"__paused",get:function(){return this.timeline.paused}},{key:"__fps",get:function(){return this.timeline.fps}},{key:"__decodeFps",get:function(){return this.timeline.decodeFps}},{key:"__decodeCost",get:function(){return parseInt(this.timeline.decodeCost)}},{key:"__renderCost",get:function(){return this.timeline.renderCost}},{key:"__wasmInitCost",get:function(){return this.timeline.wasmInitCost}},{key:"__totalSize",get:function(){return this.timeline.totalSize}},{key:"__bitrate",get:function(){return this.timeline.bitrate}},{key:"__gopLength",get:function(){return this.timeline.gopLength}},{key:"__readyState",get:function(){return this.timeline.readyState}},{key:"__buffered",get:function(){return this.timeline.buffered}},{key:"__decoderMode",get:function(){return this.timeline.decoderMode}},{key:"src",get:function(){var e;return this.getAttribute("src")||(null===(e=this.childNodes[0])||void 0===e?void 0:e.src)||""},set:function(e){g.kg.log(this.TAG,"set src ",e),this.setAttribute("src",e),this._vMeta=null,(!this._domConnected||this.buffered.length)&&(this.play(!0),!this.timeline&&this._init()),this._innerDispatchEvent("loadstart"),(0,v.X2)()}},{key:"currentSrc",get:function(){var e;return this.getAttribute("src")||(null===(e=this.childNodes[0])||void 0===e?void 0:e.src)||""}},{key:"playbackRate",get:function(){return parseFloat(this.getAttribute("playbackrate")||1)},set:function(e){var t;this.setAttribute("playbackrate",e),null===(t=this.timeline)||void 0===t||t.emit(y.ZP.TIMELINE.SET_PLAYBACKRATE,e)}},{key:"networkState",get:function(){return 1}},{key:"preloadTime",get:function(){var e=this.getAttribute("preloadtime");if(e){var t=Number.parseFloat(e);if(t>0&&!Number.isNaN(t))return t}return 1/0},set:function(e){e&&Number(e)>0&&this.setAttribute("preloadtime",e)}},{key:"innerDegrade",get:function(){return parseInt(this.getAttribute("innerdegrade"))}},{key:"__glCtxOptions",set:function(e){this._glCtxOptions=e,this.timeline.emit(y.ZP.TIMELINE.UPDATE_GL_OPTIONS,e)}},{key:"__error",get:function(){return this._err},set:function(e){this.timeline.emit(y.ZP.TIMELINE.PLAY_EVENT,y.NW.ERROR,e)}},{key:"degradeVideo",get:function(){return this._degradeVideo}},{key:"degradeInfo",get:function(){return this._deradeInfo},set:function(e){this._deradeInfo=e}},{key:"unsyncInfo",get:function(){return this._unsyncInfo},set:function(e){this._unsyncInfo=e}},{key:"xgfillType",get:function(){return this.parentNode.getAttribute("data-xgfill")}},{key:"containerLayout",get:function(){var e=this.parentNode;return{width:e.clientWidth,height:e.clientHeight}}},{key:"videoDecode",get:function(){return"7"===this.getAttribute("decodeMode")}},{key:"audioMedia",get:function(){var e,t;return null===(e=this.timeline)||void 0===e?void 0:null===(t=e.audioRender)||void 0===t?void 0:t.media}},{key:"audioMediaCache",get:function(){var e,t;return(null===(e=this.timeline)||void 0===e?void 0:null===(t=e.audioRender)||void 0===t?void 0:t._mediaCache)||[]}},{key:"getStats",value:function(){return this.analyse.getStats(this)}},{key:"getSeekElapses",value:function(){return this.analyse.seekElapses()}},{key:"disabledDegrade",value:function(){A.forceCanUse=!0,A.cleanDisabled()}},{key:"cleanDisabledCache",value:function(){(0,v.J2)()}},{key:"dump",value:function(){var e=this.buffered;return Array(e.length).fill(0).map(function(t,i){return[e.start(i),e.end(i)]})}}],[{key:"version",get:function(){return"0.1.6-next.27"}},{key:"init",value:function(e){var t=e.h264Url,i=e.h264AsmUrl,n=e.h265AsmUrl,r=e.h265Url,o=e.h265ThreadUrl,a=e.h265SimdUrl;A.h264Url=t||A.h264Url,A.h265Url=r||A.h265Url,A.h265AsmUrl=n||A.h265AsmUrl,A.h264AsmUrl=i||A.h264AsmUrl,A.h265ThreadUrl=o||A.h265ThreadUrl,A.h265SimdUrl=a||A.h265SimdUrl}},{key:"getDecodeCapacity",value:function(){return(0,p.tT)()}},{key:"getDeviceCapacity",value:function(){return(0,p.MP)()}},{key:"setDecodeCapacity",value:function(e){(0,p.rM)(e),e.preloadDecoder&&_.Z.genDecoder().catch(function(){})}},{key:"genDecoder",value:function(e){return _.Z.genDecoder(e)}},{key:"cleanDisabled",value:function(){(0,v.J2)()}},{key:"isSupported",value:function(){return!!(0,p.lF)()&&(!!A.forceCanUse||!1===(0,v.mt)())}}]),A}("undefined"!=typeof HTMLElement?HTMLElement:function(){});(0,u.Z)(A,"decoderCache",_.Z)},439271:function(e,t,i){i.d(t,{Fc:function(){return h},wb:function(){return u}}),i(864614),i(530129);var n,r=i(247425),o=i(938156),a=i(269277),s=i(917970),l=i(197201),d=i(892970),c=i(668117),u={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",OPTION:"OPTION"}},f=(n={},(0,c.Z)(n,u.MANIFEST,{HLS:1100}),(0,c.Z)(n,u.NETWORK,2100),(0,c.Z)(n,u.NETWORK_TIMEOUT,2101),(0,c.Z)(n,u.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400}),(0,c.Z)(n,u.REMUX,{FMP4:4100,MP4:4200}),(0,c.Z)(n,u.MEDIA,{MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202}),(0,c.Z)(n,u.OTHER,8e3),n),h=function(e){(0,a.Z)(d,e);var t,i,n=(t=d,i=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,l.Z)(t);return e=i?Reflect.construct(n,arguments,(0,l.Z)(this).constructor):n.apply(this,arguments),(0,s.Z)(this,e)});function d(e,t,i,o,a){var s;return(0,r.Z)(this,d),(s=n.call(this,a||(null==i?void 0:i.message))).errorType=e===u.NETWORK_TIMEOUT?u.NETWORK:e,s.originError=i,s.ext=o,s.errorCode=f[e][t]||f[e],s.errorMessage=s.message,!s.errorCode&&(s.errorType=u.OTHER,s.errorCode=f[s.errorType]),s}return(0,o.Z)(d,null,[{key:"create",value:function(e,t,i,n,r){return e instanceof d?e:(e instanceof Error&&(i=e,e=""),!e&&(e=u.OTHER),new d(e,t,i,n,r))}},{key:"network",value:function(e){var t;return new d(null!=e&&e.isTimeout?u.NETWORK_TIMEOUT:u.NETWORK,e,null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status})}}]),d}((0,d.Z)(Error))},429571:function(e,t,i){i.d(t,{K:function(){return n}});var n={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"}},15810:function(e,t,i){function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach(function(t){f(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function o(){o=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function d(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,i){return e[t]=i}}function c(e,t,i,r){var o=Object.create((t&&t.prototype instanceof h?t:h).prototype);return n(o,"_invoke",{value:function(e,t,i){var n="suspendedStart";return function(r,o){if("executing"===n)throw Error("Generator is already running");if("completed"===n){if("throw"===r)throw o;return S()}for(i.method=r,i.arg=o;;){var a=i.delegate;if(a){var s=function e(t,i){var n=i.method,r=t.iterator[n];if(void 0===r)return i.delegate=null,"throw"===n&&t.iterator.return&&(i.method="return",i.arg=void 0,e(t,i),"throw"===i.method)||"return"!==n&&(i.method="throw",i.arg=TypeError("The iterator does not provide a '"+n+"' method")),f;var o=u(r,t.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,f;var a=o.arg;return a?a.done?(i[t.resultName]=a.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=void 0),i.delegate=null,f):a:(i.method="throw",i.arg=TypeError("iterator result is not an object"),i.delegate=null,f)}(a,i);if(s){if(s===f)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var l=u(e,t,i);if("normal"===l.type){if(n=i.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n="completed",i.method="throw",i.arg=l.arg)}}}(e,i,new k(r||[]))}),o}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f={};function h(){}function g(){}function p(){}var v={};d(v,a,function(){return this});var m=Object.getPrototypeOf,y=m&&m(m(E([])));y&&y!==t&&i.call(y,a)&&(v=y);var I=p.prototype=h.prototype=Object.create(v);function _(e){["next","throw","return"].forEach(function(t){d(e,t,function(e){return this._invoke(t,e)})})}function C(e,t){var r;n(this,"_invoke",{value:function(n,o){function a(){return new t(function(r,a){!function n(r,o,a,s){var l=u(e[r],e,o);if("throw"!==l.type){var d=l.arg,c=d.value;return c&&"object"==typeof c&&i.call(c,"__await")?t.resolve(c.__await).then(function(e){n("next",e,a,s)},function(e){n("throw",e,a,s)}):t.resolve(c).then(function(e){d.value=e,a(d)},function(e){return n("throw",e,a,s)})}s(l.arg)}(n,o,r,a)})}return r=r?r.then(a,a):a()}})}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:S}}function S(){return{value:void 0,done:!0}}return g.prototype=p,n(I,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:g,configurable:!0}),g.displayName=d(p,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,d(e,l,"GeneratorFunction")),e.prototype=Object.create(I),e},e.awrap=function(e){return{__await:e}},_(C.prototype),d(C.prototype,s,function(){return this}),e.AsyncIterator=C,e.async=function(t,i,n,r,o){void 0===o&&(o=Promise);var a=new C(c(t,i,n,r),o);return e.isGeneratorFunction(i)?a:a.next().then(function(e){return e.done?e.value:a.next()})},_(I),d(I,l,"Generator"),d(I,a,function(){return this}),d(I,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=E,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(i,n){return a.type="throw",a.arg=e,t.next=i,n&&(t.method="next",t.arg=void 0),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),b(i),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;b(i)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:E(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),f}},e}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,i,n,r,o,a){try{var s=e[o](a),l=s.value}catch(e){i(e);return}s.done?t(l):Promise.resolve(l).then(n,r)}function l(e){return function(){var t=this,i=arguments;return new Promise(function(n,r){var o=e.apply(t,i);function a(e){s(o,n,r,a,l,"next",e)}function l(e){s(o,n,r,a,l,"throw",e)}a(void 0)})}}function d(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,E(n.key),n)}}function u(e,t,i){return t&&c(e.prototype,t),i&&c(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e,t,i){return(t=E(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function v(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function m(e,t,i){return(m=v()?Reflect.construct.bind():function(e,t,i){var n=[null];n.push.apply(n,t);var r=new(Function.bind.apply(e,n));return i&&p(r,i.prototype),r}).apply(null,arguments)}i.d(t,{Ac:function(){return a},IP:function(){return g},Kd:function(){return I},Lc:function(){return _},PA:function(){return d},U2:function(){return A},WY:function(){return C},XW:function(){return h},Zj:function(){return r},_x:function(){return f},l5:function(){return o},qH:function(){return u},sf:function(){return k},wm:function(){return y},x:function(){return l}});function y(e){var t="function"==typeof Map?new Map:void 0;return(y=function(e){var i;if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return m(e,arguments,g(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),p(n,e)})(e)}function I(e,t){if(null==e)return{};var i,n,r=function(e,t){if(null==e)return{};var i,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)i=o[n],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++){if(i=o[n],!(t.indexOf(i)>=0))Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}}return r}function _(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){var t=v();return function(){var i,n=g(e);return i=t?Reflect.construct(n,arguments,g(this).constructor):n.apply(this,arguments),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return _(e)}(this,i)}}function A(){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}}).apply(this,arguments)}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=Array(t);i<t;i++)n[i]=e[i];return n}function k(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return b(e,void 0);var i=Object.prototype.toString.call(e).slice(8,-1);if("Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(e,t)}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{!a&&null!=i.return&&i.return()}finally{if(s)throw o}}}}function E(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}},237125:function(e,t,i){i.d(t,{Vc:function(){return n},_e:function(){return r},yQ:function(){return o}});var n={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},r={AVC:"avc",HEVC:"hevc",VVCC:"vvcC"},o={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"}},146575:function(e,t,i){i.d(t,{Z:function(){return c}});var n=i(857953),r=i(129801),o=i(745196),a=i(789057),s=i(266537),l=i(120915),d=i(798857),c={decryptWordArray:function(e,t,i){var d=n.pU.parse(t),u=n.pU.parse((0,l.mw)(i)),f=n.Ic.create(new Uint8Array(e)),h=o.e.decrypt(r.Qt.create({ciphertext:f}),d,{iv:u,mode:a.M,padding:s.g});return c.wordArrayToUint8Array(h)},wordArrayToUint8Array:function(e){for(var t=e.sigBytes,i=e.words,n=new Uint8Array(t),r=0,o=0;r!==t;){;var a=i[o++];if(n[r++]=(4278190080&a)>>>24,r===t)break;if(n[r++]=(16711680&a)>>>16,r===t)break;if(n[r++]=(65280&a)>>>8,r===t)break;n[r++]=255&a}return n},decoderAESCTRData:function(e,t,i){if(e.videoSenc){var n=e.kidValue,r=e.videoSenc;e.samples.forEach(function(t,o){var a=r[o],s=t.data,l=[],u=[],f=a.InitializationVector;if(a.subsamples&&a.subsamples.length)a.subsamples.forEach(function(e){var t=e.BytesOfClearData+e.BytesOfProtectedData,i=s.slice(0,t);l.push(i.slice(0,e.BytesOfClearData)),u.push(i.slice(e.BytesOfClearData)),s=s.slice(t)});else{var h=t.size;l.push(s.slice(0,0)),u.push(s.slice(0,h)),s=s.slice(h)}var g=new d.Z;g.write.apply(g,u);var p=i?i(g.buffer,n,f):c.decryptWordArray(g.buffer,n,f),v=new d.Z;l.forEach(function(e,t){var i=u[t].length,n=p.slice(0,i);v.write(e),v.write(n),p=p.slice(i)}),e.samples[o].data=v.buffer})}if(t.audioSenc){var o=t.kidValue,a=t.audioSenc;t.samples.forEach(function(e,n){var r=a[n],s=i?i(e.data,o,r.InitializationVector):c.decryptWordArray(e.data,o,r.InitializationVector);t.samples[n].data=s})}}}},410486:function(e,t,i){i.d(t,{I:function(){return l}});var n=i(177595),r=i(120915),o=i(38484),a=i(187960),s=i(583484),l=function(){function e(){(0,n.PA)(this,e)}return(0,n.qH)(e,null,[{key:"findBox",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=[];if(!t)return o;for(var a=0,s="",l=0;t.length>7;){if(a=(0,r.Bh)(t),s=String.fromCharCode.apply(null,t.subarray(4,8)),l=8,1===a?(a=(0,r.h9)(t,8),l+=8):!a&&(a=t.length),!i[0]||s===i[0]){var d=t.subarray(0,a);if(!(i.length<2))return e.findBox(d.subarray(l),i.slice(1),n+l);o.push({start:n,size:a,headerSize:l,type:s,data:d})}n+=a,t=t.subarray(a)}return o}},{key:"tfhd",value:function(e){return f(e,!0,function(e,t){e.trackId=(0,r.Bh)(t);var i=4,n=1&e.flags,o=2&e.flags,a=8&e.flags,s=16&e.flags,l=32&e.flags;n&&(i+=4,e.baseDataOffset=(0,r.Bh)(t,i),i+=4),o&&(e.sampleDescriptionIndex=(0,r.Bh)(t,i),i+=4),a&&(e.defaultSampleDuration=(0,r.Bh)(t,i),i+=4),s&&(e.defaultSampleSize=(0,r.Bh)(t,i),i+=4),l&&(e.defaultSampleFlags=(0,r.Bh)(t,i))})}},{key:"sidx",value:function(e){return f(e,!0,function(e,t){var i=0;e.reference_ID=(0,r.Bh)(t,i),i+=4,e.timescale=(0,r.Bh)(t,i),i+=4,0===e.version?(e.earliest_presentation_time=(0,r.Bh)(t,i),i+=4,e.first_offset=(0,r.Bh)(t,i),i+=4):(e.earliest_presentation_time=(0,r.h9)(t,i),i+=8,e.first_offset=(0,r.h9)(t,i),i+=8),i+=2,e.references=[];var n=(0,r.i4)(t,i);i+=2;for(var o=0;o<n;o++){var a={};e.references.push(a);var s=(0,r.Bh)(t,i);i+=4,a.reference_type=s>>31&1,a.referenced_size=2147483647&s,a.subsegment_duration=(0,r.Bh)(t,i),i+=4,s=(0,r.Bh)(t,i),i+=4,a.starts_with_SAP=s>>31&1,a.SAP_type=s>>28&7,a.SAP_delta_time=268435455&s}})}},{key:"moov",value:function(t){return f(t,!1,function(t,i,n){t.mvhd=e.mvhd(e.findBox(i,["mvhd"],n)[0]),t.trak=e.findBox(i,["trak"],n).map(function(t){return e.trak(t)}),t.pssh=e.pssh(e.findBox(i,["pssh"],n)[0])})}},{key:"mvhd",value:function(e){return f(e,!0,function(e,t){var i=0;1===e.version?(e.timescale=(0,r.Bh)(t,16),e.duration=(0,r.h9)(t,20),i+=28):(e.timescale=(0,r.Bh)(t,8),e.duration=(0,r.Bh)(t,12),i+=16),e.nextTrackId=(0,r.Bh)(t,i+76)})}},{key:"trak",value:function(t){return f(t,!1,function(t,i,n){t.tkhd=e.tkhd(e.findBox(i,["tkhd"],n)[0]),t.mdia=e.mdia(e.findBox(i,["mdia"],n)[0]),t.edts=e.edts(e.findBox(i,["edts"],n)[0])})}},{key:"tkhd",value:function(e){return f(e,!0,function(e,t){var i=0;1===e.version?(e.trackId=(0,r.Bh)(t,16),e.duration=(0,r.h9)(t,24),i+=32):(e.trackId=(0,r.Bh)(t,8),e.duration=(0,r.Bh)(t,16),i+=20),e.width=(0,r.Bh)(t,i+52),e.height=(0,r.Bh)(t,i+56)})}},{key:"mdia",value:function(t){return f(t,!1,function(t,i,n){t.mdhd=e.mdhd(e.findBox(i,["mdhd"],n)[0]),t.hdlr=e.hdlr(e.findBox(i,["hdlr"],n)[0]),t.minf=e.minf(e.findBox(i,["minf"],n)[0])})}},{key:"edts",value:function(t){return f(t,!1,function(t,i,n){t.elst=e.elst(e.findBox(i,["elst"],n)[0])})}},{key:"elst",value:function(e){return f(e,!0,function(e,t,i){e.entries=[],e.entriesData=t;var n=0,o=(0,r.Bh)(t,n);n+=4;for(var a=0;a<o;a++){var s={};e.entries.push(s),1===e.version?(s.segment_duration=(0,r.h9)(t,n),n+=8,s.media_time=(0,r._b)(t,n),n+=8):(s.segment_duration=(0,r.Bh)(t,n),n+=4,s.media_time=(0,r.e2)(t,n),n+=4),s.media_rate_integer=(0,r.i4)(t,n),n+=2,s.media_rate_fraction=(0,r.i4)(t,i),n+=2}})}},{key:"mdhd",value:function(e){return f(e,!0,function(e,t){var i=0;1===e.version?(e.timescale=(0,r.Bh)(t,16),e.duration=(0,r.h9)(t,20),i+=28):(e.timescale=(0,r.Bh)(t,8),e.duration=(0,r.Bh)(t,12),i+=16);var n=(0,r.i4)(t,i);e.language=String.fromCharCode((n>>10&31)+96,(n>>5&31)+96,(31&n)+96)})}},{key:"hdlr",value:function(e){return f(e,!0,function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))})}},{key:"minf",value:function(t){return f(t,!1,function(t,i,n){t.vmhd=e.vmhd(e.findBox(i,["vmhd"],n)[0]),t.smhd=e.smhd(e.findBox(i,["smhd"],n)[0]),t.stbl=e.stbl(e.findBox(i,["stbl"],n)[0])})}},{key:"vmhd",value:function(e){return f(e,!0,function(e,t){e.graphicsmode=(0,r.i4)(t),e.opcolor=[(0,r.i4)(t,2),(0,r.i4)(t,4),(0,r.i4)(t,6)]})}},{key:"smhd",value:function(e){return f(e,!0,function(e,t){e.balance=(0,r.i4)(t)})}},{key:"stbl",value:function(t){return f(t,!1,function(t,i,n){t.stsd=e.stsd(e.findBox(i,["stsd"],n)[0]),t.stts=e.stts(e.findBox(i,["stts"],n)[0]),t.ctts=e.ctts(e.findBox(i,["ctts"],n)[0]),t.stsc=e.stsc(e.findBox(i,["stsc"],n)[0]),t.stsz=e.stsz(e.findBox(i,["stsz"],n)[0]),t.stco=e.stco(e.findBox(i,["stco"],n)[0]),!t.stco&&(t.co64=e.co64(e.findBox(i,["co64"],n)[0]),t.stco=t.co64);var r,o,a,s=null===(r=t.stsd.entries[0])||void 0===r?void 0:null===(o=r.sinf)||void 0===o?void 0:null===(a=o.schi)||void 0===a?void 0:a.tenc.default_IV_size;t.stss=e.stss(e.findBox(i,["stss"],n)[0]),t.senc=e.senc(e.findBox(i,["senc"],n)[0],s)})}},{key:"senc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return f(e,!0,function(e,i){var n=0,o=(0,r.Bh)(i,n);n+=4,e.samples=[];for(var a=0;a<o;a++){var s={};s.InitializationVector=[];for(var l=0;l<t;l++)s.InitializationVector[l]=i[n+l];if(n+=t,2&e.flags){s.subsamples=[];var d=(0,r.i4)(i,n);n+=2;for(var c=0;c<d;c++){var u={};u.BytesOfClearData=(0,r.i4)(i,n),n+=2,u.BytesOfProtectedData=(0,r.Bh)(i,n),n+=4,s.subsamples.push(u)}}e.samples.push(s)}})}},{key:"pssh",value:function(e){return f(e,!0,function(e,t){for(var i=[],n=[],o=0,a=0;a<16;a++)n.push(g(t[o+a]));if(o+=16,e.version>0){var s=(0,r.Bh)(t,o);o+=4;for(var l=0;l<(""+s).length;l++)for(var d=0;d<16;d++){var c=t[o];o+=1,i.push(g(c))}}var u=(0,r.Bh)(t,o);e.data_size=u,o+=4,e.kid=i,e.system_id=n,e.buffer=t})}},{key:"bvc2",value:function(t){return f(t,!1,function(t,i,n){var r=c(t,i),o=i.subarray(r);n+=r,t.vvcC=e.bv2C(e.findBox(o,["bv2C"],n)[0]),t.pasp=e.pasp(e.findBox(o,["pasp"],n)[0])})}},{key:"bv2C",value:function(e){return f(e,!1,function(e,t,i){var n=a.i.parseVVCDecoderConfigurationRecord(t);for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])})}},{key:"stsd",value:function(t){return f(t,!0,function(t,i,n){t.entryCount=(0,r.Bh)(i),t.entries=e.findBox(i.subarray(4),[],n+4).map(function(t){switch(t.type){case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"bvc2":return e.bvc2(t);case"mp4a":return e.mp4a(t);case"alaw":case"ulaw":return e.alaw(t);case"enca":return f(t,!1,function(t,i,n){t.channelCount=(0,r.i4)(i,16),t.samplesize=(0,r.i4)(i,18),t.sampleRate=(0,r.Bh)(i,24)/65536,i=i.subarray(28),t.sinf=e.sinf(e.findBox(i,["sinf"],n)[0]),t.esds=e.esds(e.findBox(i,["esds"],n)[0])});case"encv":return f(t,!1,function(t,i,n){t.width=(0,r.i4)(i,24),t.height=(0,r.i4)(i,26),t.horizresolution=(0,r.Bh)(i,28),t.vertresolution=(0,r.Bh)(i,32),i=i.subarray(78),t.sinf=e.sinf(e.findBox(i,["sinf"],n)[0]),t.avcC=e.avcC(e.findBox(i,["avcC"],n)[0]),t.hvcC=e.hvcC(e.findBox(i,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(i,["pasp"],n)[0])})}}).filter(Boolean)})}},{key:"tenc",value:function(e){return f(e,!1,function(e,t){var i=6;e.default_IsEncrypted=t[i],i+=1,e.default_IV_size=t[i],i+=1,e.default_KID=[];for(var n=0;n<16;n++)e.default_KID.push(g(t[i])),i+=1})}},{key:"schi",value:function(t){return f(t,!1,function(t,i,n){t.tenc=e.tenc(e.findBox(i,["tenc"],n)[0])})}},{key:"sinf",value:function(t){return f(t,!1,function(t,i,n){t.schi=e.schi(e.findBox(i,["schi"],n)[0]),t.frma=e.frma(e.findBox(i,["frma"],n)[0])})}},{key:"frma",value:function(e){return f(e,!1,function(e,t){e.data_format="";for(var i=0;i<4;i++)e.data_format+=String.fromCharCode(t[i])})}},{key:"avc1",value:function(t){return f(t,!1,function(t,i,n){var r=c(t,i),o=i.subarray(r);n+=r,t.avcC=e.avcC(e.findBox(o,["avcC"],n)[0]),t.pasp=e.pasp(e.findBox(o,["pasp"],n)[0])})}},{key:"avcC",value:function(e){return f(e,!1,function(e,t){e.configurationVersion=t[0],e.AVCProfileIndication=t[1],e.profileCompatibility=t[2],e.AVCLevelIndication=t[3],e.codec=(0,r.dB)([t[1],t[2],t[3]]),e.lengthSizeMinusOne=3&t[4],e.spsLength=31&t[5],e.sps=[];for(var i=6,n=0;n<e.spsLength;n++){var o=(0,r.i4)(t,i);i+=2,e.sps.push(t.subarray(i,i+o)),i+=o}e.ppsLength=t[i],i+=1,e.pps=[];for(var a=0;a<e.ppsLength;a++){var s=(0,r.i4)(t,i);i+=2,e.pps.push(t.subarray(i,i+=s)),i+=s}})}},{key:"hvc1",value:function(t){return f(t,!1,function(t,i,n){var r=c(t,i),o=i.subarray(r);n+=r,t.hvcC=e.hvcC(e.findBox(o,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(o,["pasp"],n)[0])})}},{key:"hvcC",value:function(e){return f(e,!1,function(t,i){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=i[0];var n=i[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(32&n)>>5,t.generalProfileIdc=31&n,t.generalProfileCompatibility=(0,r.Bh)(i,2),t.generalConstraintIndicatorFlags=i.subarray(6,12),t.generalLevelIdc=i[12],t.avgFrameRate=(0,r.i4)(i,19),t.numOfArrays=i[22],t.vps=[],t.sps=[],t.pps=[];for(var o=23,a=0,s=0,l=0,d=0;d<t.numOfArrays;d++){a=63&i[o],s=(0,r.i4)(i,o+1),o+=3;for(var c,u,f,h=[],g=0;g<s;g++)l=(0,r.i4)(i,o),o+=2,h.push(i.subarray(o,o+l)),o+=l;32===a?(c=t.vps).push.apply(c,h):33===a?(u=t.sps).push.apply(u,h):34===a&&(f=t.pps).push.apply(f,h)}})}},{key:"pasp",value:function(e){return f(e,!1,function(e,t){e.hSpacing=(0,r.Bh)(t),e.vSpacing=(0,r.Bh)(t,4)})}},{key:"mp4a",value:function(t){return f(t,!1,function(t,i,n){var r=u(t,i);t.esds=e.esds(e.findBox(i.subarray(r),["esds"],n+r)[0])})}},{key:"esds",value:function(e){return f(e,!0,function(e,t){e.codec="mp4a.";for(var i=0,n=0,r=0,o=0;t.length;){for(o=t[i=0],n=t[i+1],i+=2;128&n;)r=(127&n)<<7,n=t[i],i+=1;if(r+=127&n,3===o)t=t.subarray(i+3);else if(4===o)e.codec+=(t[i].toString(16)+".").padStart(3,"0"),t=t.subarray(i+13);else if(5===o){var a=e.config=t.subarray(i,i+r),s=(248&a[0])>>3;31===s&&a.length>=2&&(s=32+((7&a[0])<<3)+((224&a[1])>>5)),e.objectType=s,e.codec+=s.toString(16),"."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1));return}else{"."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1));return}}})}},{key:"alaw",value:function(e){return f(e,!1,function(e,t){u(e,t)})}},{key:"stts",value:function(e){return f(e,!0,function(e,t){for(var i=(0,r.Bh)(t),n=[],o=4,a=0;a<i;a++)n.push({count:(0,r.Bh)(t,o),delta:(0,r.Bh)(t,o+4)}),o+=8;e.entryCount=i,e.entries=n})}},{key:"ctts",value:function(e){return f(e,!0,function(e,t){var i=(0,r.Bh)(t),n=[],o=4;if(1===e.version)for(var a=0;a<i;a++)n.push({count:(0,r.Bh)(t,o),offset:(0,r.Bh)(t,o+4)}),o+=8;else for(var s=0;s<i;s++)n.push({count:(0,r.Bh)(t,o),offset:-(~(0,r.Bh)(t,o+4)+1)}),o+=8;e.entryCount=i,e.entries=n})}},{key:"stsc",value:function(e){return f(e,!0,function(e,t){for(var i=(0,r.Bh)(t),n=Array(i),o=4,a=0;a<i;a++)n[a]={firstChunk:(0,r.Bh)(t,o),samplesPerChunk:(0,r.Bh)(t,o+4),sampleDescriptionIndex:(0,r.Bh)(t,o+8)},o+=12;e.entryCount=i,e.entries=n})}},{key:"stsz",value:function(e){return f(e,!0,function(e,t){var i=(0,r.Bh)(t),n=(0,r.Bh)(t,4),o=Array(n);if(!i){for(var a=8,s=0;s<n;s++)o[s]=(0,r.Bh)(t,a),a+=4}e.sampleSize=i,e.sampleCount=n,e.entrySizes=o})}},{key:"stco",value:function(e){return f(e,!0,function(e,t){for(var i=(0,r.Bh)(t),n=Array(i),o=4,a=0;a<i;a++)n[a]=(0,r.Bh)(t,o),o+=4;e.entryCount=i,e.entries=n})}},{key:"co64",value:function(e){return f(e,!0,function(e,t){for(var i=(0,r.Bh)(t),n=Array(i),o=4,a=0;a<i;a++)n[a]=(0,r.h9)(t,o),o+=8;e.entryCount=i,e.entries=n})}},{key:"stss",value:function(e){return f(e,!0,function(e,t){for(var i=(0,r.Bh)(t),n=Array(i),o=4,a=0;a<i;a++)n[a]=(0,r.Bh)(t,o),o+=4;e.entryCount=i,e.entries=n})}},{key:"moof",value:function(t){return f(t,!1,function(t,i,n){t.mfhd=e.mfhd(e.findBox(i,["mfhd"],n)[0]),t.traf=e.findBox(i,["traf"],n).map(function(t){return e.traf(t)})})}},{key:"mfhd",value:function(e){return f(e,!0,function(e,t){e.sequenceNumber=(0,r.Bh)(t)})}},{key:"traf",value:function(t){return f(t,!1,function(t,i,n){t.tfhd=e.tfhd(e.findBox(i,["tfhd"],n)[0]),t.tfdt=e.tfdt(e.findBox(i,["tfdt"],n)[0]),t.trun=e.trun(e.findBox(i,["trun"],n)[0])})}},{key:"trun",value:function(e){return f(e,!0,function(e,t){var i=e.version,n=e.flags,o=t.length,a=e.sampleCount=(0,r.Bh)(t),s=4;if(o>4&&1&n&&(e.dataOffset=-(~(0,r.Bh)(t,s)+1),s+=4),o>s&&4&n&&(e.firstSampleFlags=(0,r.Bh)(t,s),s+=4),o>s){e.samples=Array(a);for(var l,d=0;d<a;d++)l={},256&n&&(l.duration=(0,r.Bh)(t,s),s+=4),512&n&&(l.size=(0,r.Bh)(t,s),s+=4),1024&n&&(l.flags=(0,r.Bh)(t,s),s+=4),2048&n&&(i?l.cts=-(~(0,r.Bh)(t,s+4)+1):l.cts=(0,r.Bh)(t,s),s+=4),e.samples[d]=l}})}},{key:"tfdt",value:function(e){return f(e,!0,function(e,t){1===e.version?e.baseMediaDecodeTime=(0,r.h9)(t):e.baseMediaDecodeTime=(0,r.Bh)(t)})}},{key:"probe",value:function(t){return!!e.findBox(t,["ftyp"])}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,i){var n=e.trak;if(n&&n.length){var r=n.find(function(e){var t,i;return(null===(t=e.mdia)||void 0===t?void 0:null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)==="vide"}),a=n.find(function(e){var t,i;return(null===(t=e.mdia)||void 0===t?void 0:null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)==="soun"});if(r&&t){var l,d,c,u,f,h,g,p,v,m,y,I,_,C,A,b,k,E,S=null===(c=r.tkhd)||void 0===c?void 0:c.trackId;null!=S&&(t.id=r.tkhd.trackId),t.tkhdDuration=r.tkhd.duration,t.mvhdDurtion=e.mvhd.duration,t.mvhdTimecale=e.mvhd.timescale,t.timescale=t.formatTimescale=r.mdia.mdhd.timescale,t.duration=r.mdia.mdhd.duration||t.mvhdDurtion/t.mvhdTimecale*t.timescale,null!==(u=r.edts)&&void 0!==u&&u.elst&&(t.editList=r.edts.elst,t.editListApplied=r.editListApplied);var Z=r.mdia.minf.stbl.stsd.entries[0];if(t.width=Z.width,t.height=Z.height,Z.pasp&&(t.sarRatio=[Z.pasp.hSpacing,Z.pasp.vSpacing]),Z.hvcC)t.codecType=s._e.HEVC,t.codec=Z.hvcC.codec,t.vps=Z.hvcC.vps,t.sps=Z.hvcC.sps,t.pps=Z.hvcC.pps,t.hvcC=Z.hvcC.data;else if(Z.avcC)t.codec=Z.avcC.codec,t.sps=Z.avcC.sps,t.pps=Z.avcC.pps;else if(Z.vvcC)t.codecType=s._e.VVCC,t.codec=Z.vvcC.codec,t.sps=Z.vvcC.sps,t.pps=Z.vvcC.pps,t.vps=Z.vvcC.vps,t.vvcC=Z.vvcC.data;else throw Error("unknown video stsd entry");t.present=!0,t.ext={},t.ext.stss=null===(f=r.mdia)||void 0===f?void 0:null===(h=f.minf)||void 0===h?void 0:null===(g=h.stbl)||void 0===g?void 0:g.stss,t.ext.ctts=null===(p=r.mdia)||void 0===p?void 0:null===(v=p.minf)||void 0===v?void 0:null===(m=v.stbl)||void 0===m?void 0:m.ctts,Z&&"encv"===Z.type&&(t.isVideoEncryption=!0,Z.default_KID=null===(y=Z.sinf)||void 0===y?void 0:null===(I=y.schi)||void 0===I?void 0:I.tenc.default_KID,Z.default_IsEncrypted=null===(_=Z.sinf)||void 0===_?void 0:null===(C=_.schi)||void 0===C?void 0:C.tenc.default_IsEncrypted,Z.default_IV_size=null===(A=Z.sinf)||void 0===A?void 0:null===(b=A.schi)||void 0===b?void 0:b.tenc.default_IV_size,t.videoSenc=r.mdia.minf.stbl.senc&&r.mdia.minf.stbl.senc.samples,Z.data_format=null===(k=Z.sinf)||void 0===k?void 0:null===(E=k.frma)||void 0===E?void 0:E.data_format,t.useEME=e.useEME,t.kidValue=e.kidValue,t.pssh=e.pssh,t.encv=Z)}if(a&&i){var T,R,D,w,L,B,P,x,N,O,V,M,G,U,W,K,H,Y,F=null===(T=a.tkhd)||void 0===T?void 0:T.trackId;null!=F&&(i.id=a.tkhd.trackId),i.tkhdDuration=a.tkhd.duration,i.mvhdDurtion=e.mvhd.duration,i.mvhdTimecale=e.mvhd.timescale,i.timescale=i.formatTimescale=a.mdia.mdhd.timescale,i.duration=a.mdia.mdhd.duration||i.mvhdDurtion/i.mvhdTimecale*i.timescale,null!==(R=a.edts)&&void 0!==R&&R.elst&&(i.editList=a.edts.elst,i.editListApplied=a.editListApplied);var X=a.mdia.minf.stbl.stsd.entries[0];switch(i.sampleSize=X.sampleSize,i.sampleRate=X.sampleRate,i.channelCount=X.channelCount,i.present=!0,X.type){case"alaw":i.codecType=i.codec=s.yQ.G711PCMA,i.sampleRate=8e3;break;case"ulaw":i.codecType=i.codec=s.yQ.G711PCMU,i.sampleRate=8e3;break;default:i.sampleDuration=o.W.getFrameDuration(i.sampleRate,i.timescale),i.sampleRateIndex=o.W.getRateIndexByRate(i.sampleRate),i.objectType=(null===(l=X.esds)||void 0===l?void 0:l.objectType)||2,X.esds&&(i.config=Array.from(X.esds.config)),i.codec=(null===(d=X.esds)||void 0===d?void 0:d.codec)||"mp4a.40.2"}i.sampleDuration=o.W.getFrameDuration(i.sampleRate,i.timescale),i.objectType=(null===(D=X.esds)||void 0===D?void 0:D.objectType)||2,X.esds&&X.esds.config&&(i.config=Array.from(X.esds.config)),i.codec=(null===(w=X.esds)||void 0===w?void 0:w.codec)||"mp4a.40.2",i.sampleRateIndex=o.W.getRateIndexByRate(i.sampleRate),i.ext={},i.ext.stss=null===(L=a.mdia)||void 0===L?void 0:null===(B=L.minf)||void 0===B?void 0:null===(P=B.stbl)||void 0===P?void 0:P.stss,i.ext.ctts=null===(x=a.mdia)||void 0===x?void 0:null===(N=x.minf)||void 0===N?void 0:null===(O=N.stbl)||void 0===O?void 0:O.ctts,i.present=!0,X&&"enca"===X.type&&(i.isAudioEncryption=!0,X.data_format=null===(V=X.sinf)||void 0===V?void 0:null===(M=V.frma)||void 0===M?void 0:M.data_format,X.default_KID=null===(G=X.sinf)||void 0===G?void 0:null===(U=G.schi)||void 0===U?void 0:U.tenc.default_KID,X.default_IsEncrypted=null===(W=X.sinf)||void 0===W?void 0:null===(K=W.schi)||void 0===K?void 0:K.tenc.default_IsEncrypted,X.default_IV_size=null===(H=X.sinf)||void 0===H?void 0:null===(Y=H.schi)||void 0===Y?void 0:Y.tenc.default_IV_size,i.audioSenc=a.mdia.minf.stbl.senc&&a.mdia.minf.stbl.senc.samples,i.useEME=e.useEME,i.kidValue=e.kidValue,i.enca=X)}if(i&&(i.isVideoEncryption=!!t&&t.isVideoEncryption),t&&(t.isAudioEncryption=!!i&&i.isAudioEncryption),null!=t&&t.encv||null!=i&&i.enca){var j,z,J=null==t?void 0:null===(j=t.encv)||void 0===j?void 0:j.default_KID,q=null==i?void 0:null===(z=i.enca)||void 0===z?void 0:z.default_KID,Q=J||q?(J||q).join(""):null;t&&(t.kid=Q),i&&(i.kid=Q)}return t&&(t.flags=3841),i&&(i.flags=1793),{videoTrack:t,audioTrack:i}}}},{key:"evaluateDefaultDuration",value:function(e,t,i){var n,r=null==t?void 0:null===(n=t.samples)||void 0===n?void 0:n.length;return r?1024*r/t.timescale*e.timescale/i:1024}},{key:"moofToSamples",value:function(t,i,n){var r={};return t.mfhd&&(i&&(i.sequenceNumber=t.mfhd.sequenceNumber),n&&(n.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach(function(t){var o=t.tfhd,a=t.tfdt,s=t.trun;if(o&&s){a&&(i&&i.id===o.trackId&&(i.baseMediaDecodeTime=a.baseMediaDecodeTime),n&&n.id===o.trackId&&(n.baseMediaDecodeTime=a.baseMediaDecodeTime));var l=o.defaultSampleSize||0,d=o.defaultSampleDuration||e.evaluateDefaultDuration(i,n,s.samples.length||s.sampleCount),c=s.dataOffset||0,u=0,f=-1;if(!s.samples.length&&s.sampleCount){r[o.trackId]=Array(s.sampleCount);for(var h=0;h<s.sampleCount;h++)r[o.trackId][h]={offset:c,dts:u,duration:d,size:l},u+=d,c+=l}else r[o.trackId]=s.samples.map(function(e,t){return(e={offset:c,dts:u,pts:u+(e.cts||0),duration:e.duration||d,size:e.size||l,gopId:f,keyframe:0===t||null!==e.flags&&void 0!==e.flags&&(65536&e.flags)>>>0!=65536}).keyframe&&(f++,e.gopId=f),u+=e.duration,c+=e.size,e})}}),r}},{key:"moovToSamples",value:function(e){var t=e.trak;if(!!t&&!!t.length){var i=t.find(function(e){var t,i;return(null===(t=e.mdia)||void 0===t?void 0:null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)==="vide"}),n=t.find(function(e){var t,i;return(null===(t=e.mdia)||void 0===t?void 0:null===(i=t.hdlr)||void 0===i?void 0:i.handlerType)==="soun"});if(i||n){if(i){var r,o,a,s,l=null===(a=i.mdia)||void 0===a?void 0:null===(s=a.minf)||void 0===s?void 0:s.stbl;if(!l)return;var c=l.stts,u=l.stsc,f=l.stsz,h=l.stco,g=l.stss,p=l.ctts;if(!c||!u||!f||!h||!g)return;r=d(c,u,f,h,p,g)}if(n){var v,m,y,I=null===(v=n.mdia)||void 0===v?void 0:null===(m=v.minf)||void 0===m?void 0:m.stbl;if(!I)return;var _=null===(y=n.mdia.mdhd)||void 0===y?void 0:y.timescale,C=I.stts,A=I.stsc,b=I.stsz,k=I.stco;if(!_||!C||!A||!b||!k)return;o=d(C,A,b,k)}return{videoSamples:r,audioSamples:o}}}}}]),e}();function d(e,t,i,n,r,o){var a,s,l,d=[],c=null==r?void 0:r.entries,u=t.entries,f=n.entries,h=i.entrySizes,g=null==o?void 0:o.entries;g&&(a={},g.forEach(function(e){a[e-1]=!0})),c&&(s=[],c.forEach(function(e){for(var t=e.count,i=e.offset,n=0;n<t;n++)s.push(i)}));var p=-1,v=0,m=0,y=0,I=0,_=0,C=u[0].samplesPerChunk,A=u[1]?u[1].firstChunk-1:1/0;return e.entries.forEach(function(e){for(var t=e.count,n=e.delta,r=0;r<t;r++)l={dts:v,duration:n,size:h[m]||i.sampleSize,offset:f[y]+_,index:m},g&&(l.keyframe=a[m],l.keyframe&&p++,l.gopId=p),s&&m<s.length&&(l.pts=l.dts+s[m]),d.push(l),v+=n,++m<C?_+=l.size:(y++,_=0,y>=A&&(A=u[++I+1]?u[I+1].firstChunk-1:1/0),C+=u[I].samplesPerChunk)}),d}function c(e,t){return e.dataReferenceIndex=(0,r.i4)(t,6),e.width=(0,r.i4)(t,24),e.height=(0,r.i4)(t,26),e.horizresolution=(0,r.Bh)(t,28),e.vertresolution=(0,r.Bh)(t,32),e.frameCount=(0,r.i4)(t,40),e.depth=(0,r.i4)(t,74),78}function u(e,t){return e.dataReferenceIndex=(0,r.i4)(t,6),e.channelCount=(0,r.i4)(t,16),e.sampleSize=(0,r.i4)(t,18),e.sampleRate=(0,r.Bh)(t,24)/65536,28}function f(e,t,i){if(e){if(e.size!==e.data.length)throw Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=(0,r.sV)(e.data,e.headerSize+1),n.headerSize+=4),i(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}var h=function(e,t,i){for(var n=String(i),r=t>>0,o=Math.ceil(r/n.length),a=[],s=String(e);o--;)a.push(n);return a.join("").substring(0,r-s.length)+s},g=function(){for(var e=[],t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];return i.forEach(function(t){e.push(h(Number(t).toString(16),2,0))}),e[0]}}}]);