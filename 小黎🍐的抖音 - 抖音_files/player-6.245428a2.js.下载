/*! For license information please see player-6.245428a2.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).xss={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function a(e,t,a){if(a||2==arguments.length)for(var r,n=0,i=t.length;n<i;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}var r=/[^a-zA-Z0-9\\_:.-]/gim,n=/</g,i=/>/g,o=/&#([a-zA-Z0-9]*);?/gim,s=/&quot;/g,l=/&colon;?/gim,c=/&newline;?/gim,u=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,d=/u\s*r\s*l\s*\(.*/gi,h=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,p=/"/g,f=function(e){return e.replace(n,"&lt;").replace(i,"&gt;")},g={indexOf:function(e,t){var a,r;for(a=0,r=e.length;a<r;a++)if(e[a]===t)return a;return -1},forEach:function(e,t,a){var r,n;for(r=0,n=e.length;r<n;r++)t.call(a,e[r],r,e)},some:function(e,t,a){var r,n;for(r=0,n=e.length;r<n;r++)if(t.call(a,e[r],r,e))return!0;return!1},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},includes:function(e,t){if("string"==typeof e)return -1!==e.indexOf(t);for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1},uniq:function(e){for(var t={},a=[],r=0;r<e.length;r++)t[e[r]]||(a.push(e[r]),t[e[r]]=!0);return a},from:function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a]);return t},keys:function(e){var t=[];for(var a in e)t.push(a);return t}};function _(e){return null==e}function v(e){var t;return'"'===(t=e)[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]?e.substr(1,e.length-2):e}function y(e){var t,a,r,n,i,o,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0;for(e=function(e){e=e.replace(/rn/g,"n");for(var t="",a=0;a<e.length;a++){var r=e.charCodeAt(a);r<128?t+=String.fromCharCode(r):r>127&&r<2048?t+=String.fromCharCode(r>>6|192)+String.fromCharCode(63&r|128):t+=String.fromCharCode(r>>12|224)+String.fromCharCode(r>>6&63|128)+String.fromCharCode(63&r|128)}return t}(e);u<e.length;)n=(t=e.charCodeAt(u++))>>2,i=(3&t)<<4|(a=e.charCodeAt(u++))>>4,o=(15&a)<<2|(r=e.charCodeAt(u++))>>6,s=63&r,isNaN(a)?o=s=64:isNaN(r)&&(s=64),c=c+l.charAt(n)+l.charAt(i)+l.charAt(o)+l.charAt(s);return c}function m(e){var t,a,r,n,i,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");c<e.length;)t=s.indexOf(e.charAt(c++))<<2|(n=s.indexOf(e.charAt(c++)))>>4,a=(15&n)<<4|(i=s.indexOf(e.charAt(c++)))>>2,r=(3&i)<<6|(o=s.indexOf(e.charAt(c++))),l+=String.fromCharCode(t),64!==i&&(l+=String.fromCharCode(a)),64!==o&&(l+=String.fromCharCode(r));return function(e){for(var t="",a=0,r=0,n=0,i=0;a<e.length;)(r=e.charCodeAt(a))<128?(t+=String.fromCharCode(r),a++):r>191&&r<224?(t+=String.fromCharCode((31&r)<<6|63&(i=e.charCodeAt(a+1))),a+=2):(i=e.charCodeAt(a+1),t+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&(n=e.charCodeAt(a+2))),a+=3);return t}(l)}function b(e,t,a){var r="",n=0,i=!1,o=!1,s=0,l=e.length,c="",u="";e:for(s=0;s<l;s++){var d=e.charAt(s);if(!1===i){if("<"===d){i=s;continue}}else if(!1===o){if("<"===d){r+=a(e.slice(n,s)),i=s,n=s;continue}if(">"===d||s===l-1){r+=a(e.slice(n,i)),c=function(e){var t,a=g.spaceIndex(e);return t=-1===a?e.slice(1,-1):e.slice(1,a+1),"/"===(t=g.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}(u=e.slice(i,s+1)),r+=t(i,r.length,c,u,"</"===u.slice(0,2)),n=s+1,i=!1;continue}if('"'===d||"'"===d)for(var h=1,p=e.charAt(s-h);""===p.trim()||"="===p;){if("="===p){o=d;continue e}p=e.charAt(s-++h)}}else if(d===o){o=!1;continue}}return n<l&&(r+=a(e.substr(n))),r}function k(e,t){var a=0,n=0,i=[],o=!1,s=e.length;function l(e,a){if(!((e=(e=g.trim(e)).replace(r,"").toLowerCase()).length<1)){var n=t(e,a||"");n&&i.push(n)}}for(var c=0;c<s;c++){var u=e.charAt(c),d=void 0;if(!1!==o||"="!==u){if(!1===o||c!==n){if(/\s|\n|\t/.test(u)){if(e=e.replace(/\s|\n|\t/g," "),!1===o){if(-1===(d=function(e,t){for(;t<e.length;t++){var a=e[t];if(" "!==a)return"="===a?t:-1}return -1}(e,c))){l(g.trim(e.slice(a,c))),o=!1,a=c+1;continue}c=d-1;continue}if(-1===(d=function(e,t){for(;t>0;t--){var a=e[t];if(" "!==a)return"="===a?t:-1}return -1}(e,c-1))){l(o,v(g.trim(e.slice(a,c)))),o=!1,a=c+1;continue}}}else{if(-1===(d=e.indexOf(u,c+1)))break;l(o,g.trim(e.slice(n+1,d))),o=!1,a=(c=d)+1}}else o=e.slice(a,c),a=c+1,n='"'===e.charAt(a)||"'"===e.charAt(a)?a:function(e,t){for(;t<e.length;t++){var a=e[t];if(" "!==a)return"'"===a||'"'===a?t:-1}return -1}(e,c+1)}return a<e.length&&(!1===o?l(e.slice(a)):l(o,v(g.trim(e.slice(a))))),g.trim(i.join(" "))}function x(e,t,a){if(a=function(e){return e=function(e){for(var t="",a=0,r=e.length;a<r;a++)t+=32>e.charCodeAt(a)?" ":e.charAt(a);return g.trim(t)}(e=(e=(e=e.replace(s,'"')).replace(o,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})).replace(l,":").replace(c," "))}(a),"href"===t||"src"===t){if("#"===(a=g.trim(a)))return"#";if("http://"!==a.substr(0,7)&&"https://"!==a.substr(0,8)&&"mailto:"!==a.substr(0,7)&&"tel:"!==a.substr(0,4)&&"data:image/"!==a.substr(0,11)&&"ftp://"!==a.substr(0,6)&&"./"!==a.substr(0,2)&&"../"!==a.substr(0,3)&&"#"!==a[0]&&"/"!==a[0])return""}else if("background"===t){if(u.lastIndex=0,u.test(a))return""}else if("style"===t&&(h.lastIndex=0,h.test(a)||(d.lastIndex=0,d.test(a)&&(u.lastIndex=0,u.test(a)))))return"";return a=function(e){return e=f(e=e.replace(p,"&quot;"))}(a)}var L=function(e){return"string"==typeof e?e.replace(/'/g,'"').replace('=""',"").replace(/\s+/g,"").toLowerCase():""},S=function(){function e(e){var t=function(e){var t={};for(var a in e)t[a]=e[a];return t}(e||{});t.stripIgnoreTag&&(t.onIgnoreTag,t.onIgnoreTag=function(){return""}),t.whiteList={},t.onTag=function(){},t.onTagAttr=function(){},t.onIgnoreTag=function(){},t.onIgnoreTagAttr=function(){},t.safeAttrValue=x,t.escapeHtml=f,this.options=Object.assign(t,e)}return e.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t,a,r,n,i,o,s=this.options,l=s.whiteList,c=s.onTag,u=s.onIgnoreTag,d=s.onTagAttr,h=s.onIgnoreTagAttr,p=s.safeAttrValue,f=s.escapeHtml;s.stripBlankChar&&(e=(t=(t=e.split("")).filter(function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)})).join("")),s.allowCommentTag||(e=function(e){for(var t="",a=0;a<e.length;){var r=e.indexOf("\x3c!--",a);if(-1===r){t+=e.slice(a);break}t+=e.slice(a,r);var n=e.indexOf("--\x3e",r);if(-1===n)break;a=n+3}return t}(e));var _=!1;s.stripIgnoreTagBody&&(a=s.stripIgnoreTagBody,"function"!=typeof(r=u)&&(r=function(){}),n=!Array.isArray(a),i=[],o=!1,u=(_={onIgnoreTag:function(e,t,s){var l;if(l=e,n||-1!==g.indexOf(a,l)){if(s.isClosing){var c="[/removed]",u=s.position+c.length;return i.push([!1!==o?o:s.position,u]),o=!1,c}return o||(o=s.position),"[removed]"}return r(e,t,s)},remove:function(e){var t="",a=0;return g.forEach(i,function(r){t+=e.slice(a,r[0]),a=r[1]}),t+=e.slice(a)}}).onIgnoreTag);var v=b(e,function(e,t,a,r,n){var i={sourcePosition:e,position:t,isClosing:n,isWhite:Object.prototype.hasOwnProperty.call(l,a)},o=c(a,r,i);if(null!=o)return o;if(i.isWhite){if(i.isClosing)return"</".concat(a,">");var s=function(e){var t=g.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var a="/"===(e=g.trim(e.slice(t+1,-1)))[e.length-1];return a&&(e=g.trim(e.slice(0,-1))),{html:e,closing:a}}(r),_=l[a],v=k(s.html,function(e,t){var r=-1!==g.indexOf(_,e),n=d(a,e,t,r);return null==n?r?(t=p(a,e,t,null))?"".concat(e,'="').concat(t,'"'):e:null==(n=h(a,e,t,r))?void 0:n:n});return r="<".concat(a),v&&(r+=" ".concat(v)),s.closing&&(r+=" /"),r+=">"}return null==(o=u(a,r,i))?f(r):o},f);return _&&(v=_.remove(v)),v},e}(),T=Function("\nvar _checkXSS = function (it) {\n  return it && it.Math == Math && it;\n};\nreturn _checkXSS(typeof globalThis === 'object' && globalThis) ||\n_checkXSS(typeof window === 'object' && window) ||\n_checkXSS(typeof self === 'object' && self) ||\n_checkXSS(typeof global === 'object' && global) ||\nFunction('return this')();\n")(),I=new(function(){function e(){var e=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var t,a,r="douyin_web";if(!g.includes(r,"bid"))return r;if(e.config&&e.config.bid)return e.config.bid;if(T&&T._xssBid)return T._xssBid;if(T&&T.slardar&&"function"==typeof T.slardar.config){var n=(T.slardar.config()||{}).bid;if(n)return n}if(T&&T.Slardar&&"function"==typeof T.Slardar.config){var i=(T.Slardar.config()||{}).bid;if(i)return i}return(null===(a=null===(t=null==T?void 0:T.Slardar)||void 0===t?void 0:t._baseParams)||void 0===a?void 0:a.bid)||"argus"},this.getConfigRegion=function(){var t;return g.includes("cn","region")?e.config&&e.config.region?e.config.region:((null===(t=null==T?void 0:T.gfdatav1)||void 0===t?void 0:t.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=function(){var t={cn:m("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boe:m("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),ttp:m("aHR0cHM6Ly9tb24udXMudGlrdG9rdi5jb20vbW9uaXRvcl9icm93c2VyL2NvbGxlY3QvYmF0Y2gvc2VjdXJpdHkvP2JpZD0="),va:m("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),maliva:m("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),sg:m("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boei18n:m("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9")}[e.getConfigRegion()];if(t)return t+e.getSlardarBid()}}return e.prototype.setConfig=function(e){this.config=e},e.prototype.upload=function(){var e=this,t=this.gerReportUrl();!this.lock&&t&&0!==this.batchData.length&&(this.lock=!0,setTimeout(function(){var a=e.batchData.slice(0,100);e.batchData=e.batchData.slice(100),T.fetch(t,{method:"post",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).catch(function(e){}),e.lock=!1,e.upload()},this.timeout))},e.prototype.generateKey=function(e){return e.collectKey?[e.collectMode,e.collectKey].join("___"):""},e.prototype.push=function(e){this.batchData.push(e),this.upload()},e.prototype.report=function(e){var t=this.generateKey(e);if(T.fetch&&e.collectKey){var a="object"==typeof window?window.location.href:"SSR";e.documentUrl=a;var r={age:Math.floor(Date.now()),type:"xss",url:a,body:e,"user-agent":""};"enforce"===e.disposition&&"SSR"!==a||(r.url=t),"SSR"===a&&(r.url="SSR___".concat(r.url),r.body.ssr=!0),this.push(r)}},e}()),P=function(e){for(var t=0,a=function(a){Array.isArray(e[a])?0===e[a].length?delete e[a]:(e[a]=g.from(g.uniq(e[a])),t+=e[a].length):0===g.keys(e[a]).length?delete e[a]:g.keys(e[a]).forEach(function(r){e[a][r]=g.from(g.uniq(e[a][r])),t+=e[a][r].length})},r=0,n=g.keys(e);r<n.length;r++)a(n[r]);return{count:t,ret:e}};function R(e,t){return I.setConfig(t),new S(t).process(e)}function C(e){var t,a=(t=/\s|\n|\t/.exec(e))?t.index:-1;if(-1===a)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=e.slice(a+1,-1).trim())[e.length-1];return r&&(e=e.slice(0,-1).trim()),{html:e,closing:r}}var O=function(e){return -1===(e=(e=(e=(e=e.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?e.trim().toLowerCase():e.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,function(e,t,a,r){return String.fromCharCode(t?parseInt(a,16):parseInt(r))}).replace(/(\t|\n|\r)/g,"").toLowerCase()};function D(e,t){if(void 0===e&&(e=""),"string"!=typeof e)return!0;if(e=O(e),g.includes(e,"base64")&&!function(e){if(""===e||""===e.trim())return!0;try{return!g.includes(e,"data:text/html;base64")}catch(e){return!0}}(e))return t&&t("data:text/html;base64"),!1;var a=["expression(","behavior:","view-source:"];if(g.some(a,function(t){return -1!==e.indexOf(t)}))return g.forEach(a,function(a){-1!==e.indexOf(a)&&t&&t(a)}),!1;var r=["data:application","data:javascript","data:text/html","data:texthtml"];if(g.some(r,function(t){return -1!==e.indexOf(t)}))return g.forEach(r,function(a){-1!==e.indexOf(a)&&t&&t(a)}),!1;if(e.indexOf("javascript:")>0)return t&&t("javascript:"),!1;if(/^javascript:/i.test(e)){var n=e.slice(11).replace(/\s/g,"").trim();return!!g.some(["void","void(0)","void0","false","undefined",";"],function(e){return e===n})||(t&&t("javascript:"),!1)}return!0}var w=function(e,t){var a,r,n="<%= isSaveValidUrl =>";if("string"!=typeof e||(r=Number("<%= urlLimit =>"),void 0!==a&&(r=a),"NaN"!==e.toString()&&-1!==r&&e.length>=r)||D(e,t))return e;try{if(!0===(n=JSON.parse(n))||"true"===n){var i=new URL(e);return i.origin+i.pathname}}catch(e){}return"#"};function E(e,t,r){if(void 0===e&&(e=""),void 0===t&&(t=[]),"string"!=typeof e)return!0;if(!D(e=O(e)))return!1;var n,i={url:(n=e.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[])[0],scheme:n[1],slash:n[2],host:n[3],port:n[4],path:n[5],query:n[6],hash:n[7]},o=i.scheme,s=i.host;return r?!!r(e):!(!o||!s)&&(!g.includes(["http","https","file"],o)||("object"==typeof window&&window&&(t=a(a([],t,!0),[location.host],!1)),g.some(t,function(e){return!!(e instanceof RegExp&&e.test(s))||e===s})))}var M={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},N={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var e=P(this.collect),t=e.count,a=e.ret;return this.collect=null,{collectKey:0===t?null:JSON.stringify(a),collectMode:"white"}},onIgnoreTagAttr:function(e,t,r){return e&&g.indexOf(["href","src"],t)>-1?N.domainWhiteList&&Array.isArray(N.domainWhiteList)&&N.domainWhiteList.length>0&&!E(r,a([],N.domainWhiteList,!0))?"":"".concat(t,'="').concat(w(r,function(e){var t;null===(t=N.collect)||void 0===t||t.filterProtocol.push(e)}),'"'):e&&(g.indexOf(["style","class","id"],t)>-1||t.indexOf("data-")>-1)?"".concat(t,'="').concat(r,'"'):(N.collect.whiteList[e]=N.collect.whiteList[e]||[],void N.collect.whiteList[e].push(t))},onIgnoreTag:function(e,t){if("style"===e)return t;b(t,function(e,t,a,r){k(C(r).html.replace("/",""),function(e){N.collect.whiteList[a]=N.collect.whiteList[a]||[],N.collect.whiteList[a].push(e)})},f)},whiteList:M,mergeWhiteList:function(e){for(var t,a={},r=0,n=g.keys(M);r<n.length;r++)a[t=n[r]]=g.from(M[t]);for(var i=0,o=g.keys(e);i<o.length;i++)a[t=o[i]]=t in M?M[t].concat(e[t]):g.from(e[t]);return a},setWhiteList:function(e){for(var t=0,a=g.keys(e);t<a.length;t++){var r=a[t];this.whiteList[r]=r in M?M[r].concat(e[r]):g.from(e[r])}}};try{var A={},B="merge";g.includes(B,"override")&&(N.whiteList=A.whiteList),g.includes(B,"merge")&&N.setWhiteList(A.whiteList)}catch(e){}var j=function(e,t){for(var a={},r=0,n=g.keys(e);r<n.length;r++){var i=n[r];Array.isArray(e[i])?a[i]=g.from(e[i]):a[i]=j({},e[i])}for(var o=0,s=g.keys(t);o<s.length;o++)(i=s[o])in e?Array.isArray(e[i])?a[i]=e[i].concat(t[i]):a[i]=j(e[i],t[i]):Array.isArray(t[i])?a[i]=g.from(t[i]):a[i]=j({},t[i]);return a},U={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var Z={};Z.blackAttrRegExps&&(Z.blackAttrRegExps=Z.blackAttrRegExps.map(function(e){return new RegExp(e.toString().slice(1,e.toString().length-1))}));var F="merge";g.includes(F,"override")&&(U=Z),g.includes(F,"merge")&&(U=j(U,Z))}catch(e){}var V={mode:"black",whiteList:{},blackConfig:U,collect:null,initCollect:function(){V.collect={blackList:{},blackTags:[],blackAttrs:[],blackAttrRegExps:[],filterAttrs:[],filterList:{},filterProtocol:[]}},removeCollect:function(){var e=P(V.collect),t=e.count,a=e.ret;return V.collect=null,{collectKey:0===t?null:JSON.stringify(a),collectMode:"black"}},onIgnoreTag:function(e,t){var a;if(!g.includes(U.blackTags,e))return b(t,function(e,t,a,r,n){if(-1!==a.indexOf("/"))return f(r);if(n)return"</".concat(a,">");var i=C(r),o=k(i.html,function(e,t){var r,n=0;if(U.blackList[a]&&g.includes(U.blackList[a],e)&&(V.collect.blackList[a]=V.collect.blackList[a]||[],V.collect.blackList[a].push(e),n++),U.blackAttrRegExps.length&&U.blackAttrRegExps.some(function(t){return t.test(e)})&&g.forEach(U.blackAttrRegExps,function(t){t.test(e)&&(V.collect.blackAttrRegExps.push("".concat(t.toString(),"->").concat(e)),n++)}),U.blackAttrs.length&&g.includes(U.blackAttrs,e)&&(U.blackAttrs.push(e),n++),!n){if(U.filterList&&U.filterList[a]&&g.includes(U.filterList[a],e)){var i=w(t,function(e){var t;null===(t=V.collect)||void 0===t||t.filterProtocol.push(e)});return i!==t&&(V.collect.filterList[a]=V.collect.filterList[a]||[],V.collect.filterList[a].push(e)),t?"".concat(e,"='").concat(i,"'"):e}return U.filterAttrs&&g.includes(U.filterAttrs,e)?((i=w(t,function(e){var t;null===(t=V.collect)||void 0===t||t.filterProtocol.push(e)}))!==t&&(null===(r=V.collect)||void 0===r||r.filterAttrs.push(e)),t?"".concat(e,"='").concat(i,"'"):e):t?"".concat(e,"='").concat(t,"'"):e}});return r="<".concat(a),o&&(r+=" ".concat(o)),i.closing&&(r+=" /"),r+=">"},f);null===(a=V.collect)||void 0===a||a.blackTags.push(e)}},G=function(e){var t=e.reportOnly,a=void 0===t||t,r=e.block;return a&&"all"===a?"report":("string"==typeof a&&("true"===a&&(a=!0),"false"===a&&(a=!1)),r?"enforce":a?"report":"enforce")},H=function(e){return function(a,r,n){if(!a||"string"!=typeof a)return a;var i=r;e===R&&(i=N).initCollect();var o=e(a,i);if(L(o)===L(a))return a;if(!n)return o;var s=n.logType,l=G(n),c=i.removeCollect();return I.report(t(t({type:s,disposition:l},c),{sourceText:y(a),filterText:y(o)})),"enforce"===l?o:a}},W=H(function(e,t){return void 0===t&&(t={}),t&&t.whiteList||(t.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}),new S(t).process(e)}),z=H(R),J=function(e,t,a){var r=[],n=w(e,function(e){r.push(e)});if(n===e)return e;r=g.from(g.uniq(r));var i=t||a||{};if(!i)return n;var o=i.logType,s=G(a);return I.report({type:o,disposition:s,collectKey:r.join("___"),collectData:JSON.stringify(r),collectMode:"black",sourceText:y(e),filterText:y(n)}),"enforce"===s?n:e},q=T._xssProject||{},X=T.xssNamespace||{},Q="3.0.26",Y={FilterXSS:S,version:Q,webpackPluginVersion:"<%= webpackPluginVersion =>",reportOnly:"<%= reportOnly =>",filterXSS:W,_filterXSS:z,filterUrl:J,Config:N,BlackConfig:V,project:q,setProjectName:function(e){q[e]=this,T._xssProjectName=e}};X.douyin_web=Y,T.xssNamespace=X,T.Math&&!T.Math.xssNamespace&&(T.Math.xssNamespace=X),q[Q]=Y,T.globalThis=T,T.getFilterXss=function(){return void 0!==this._xssProjectName?this._xssProject[this._xssProjectName]:Y},T.xss=Y,T.isSafeUrl=E,T.isSafeDomain=E,T.isSafeProtocol=D,T._xssProject=q,T._xssProjectName&&(q[T._xssProjectName]=Y);var K=Y.setProjectName.bind(Y);e.BlackConfig=V,e.Config=N,e.FilterXSS=S,e._filterXSS=z,e.filterUrl=J,e.filterXSS=W,e.isSafeDomain=E,e.isSafeProtocol=D,e.isSafeUrl=E,e.project=q,e.setProjectName=K,e.setXssNamespace=function(e){var t=e.appId,a=e.bid,r=e.region;X[t]=Y;N.bid=a,N.region=r,N.enabled=!0},e.xssNamespace=X,Object.defineProperty(e,"__esModule",{value:!0})});"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["3385"],{997739:function(e,t,a){a.d(t,{Z:function(){return y}});var r=a(346754);a(514312),a(904644),a(947478),a(443611),a(864614),a(238658),a(210434),a(410121),a(766282),a(614521),a(632852),a(130458),a(585322),a(842903);var n=a(824813),i=a(158690),o=a(284938),s=a(670797),l=a(963636),c=a(273626),u=a(3095),d=a(74043),h=["try_req_num","req_node_succ","conn_req_num","has_ret_node","conn_fail_num","conn_jump_num"];(0,n.cM)("xgVodLogger version is ".concat(d.Z));var p=(0,n.P9)("Object"),f=1300,g="__tea_cache_tokens_".concat(f),_="",v=null,y=function(){function e(t,a){var s=this;if((0,r.PA)(this,e),(0,r._x)(this,"initializeUrlLog",function(e){var t=e&&e.url?e.url:"String"===(0,n.kM)(e)?e:"";"String"!==(0,n.kM)(t)&&(t=""),s.urlLog={initial_url:t,initial_host:(0,n._P)(t),initial_ip:""}}),(0,r._x)(this,"onXgLogCache",function(){var e,t=s._getLogCache();t&&(s._templog={vtype:null===(e=s.player)||void 0===e?void 0:e.vtype,log:t},s.onOneTemp())}),(0,r._x)(this,"onPrfDataSize",function(e){s._progressInfo.upDateDownload(e)}),(0,r._x)(this,"onDegrade",function(e){e&&(e.local_time=new Date().getTime(),s.onOneEvent({end_type:"degrade"},e))}),(0,r._x)(this,"onMediaFormatError",function(e){s.onOneEvent({end_type:"".concat(e.error_type||"","Error")})}),(0,r._x)(this,"onReplayBtnClick",function(){s.resetLoggerParams()}),(0,r._x)(this,"onBeforeDefinitionChange",function(){s.resLogs.ldst=(0,n.je)(),s._endType="switch"}),(0,r._x)(this,"onDefinitionChangeDetail",function(e){var t=s._progressInfo;t.updateDefInfo(e,s.player.currentTime),t.lastBitrate&&"video"===e.mediaType&&s.sendSwitchOpera("changedetail")}),(0,r._x)(this,"onDefinitionChange",function(e){var t=e.from,a=e.to;s.changeResolution({from:t,to:a,startTime:s.resLogs.ldst,operaType:"switch"}),(0,n.cM)("onDefinitionChange from:".concat(t,", to:").concat(a))}),(0,r._x)(this,"onDefiChangeSuccess",function(){(0,n.cM)("onDefinitionChangeSuccess"),s.updateVideoSize(),s.triggerTask("start")}),(0,r._x)(this,"onAbrChange",function(e){var t=e.prev,a=e.cur,r=e.abrInfo;if(s.player.abrInstance){var i=s.player.abrInstance.eventInfo;(0,n.cM)("abrChange",i),i.last_definition=t,i.now_definition=a,s.abrInfo.abr_event_info.video_switch.push(i),s.changeResolution({from:t,to:a,startTime:(0,n.je)(),operaType:"abr_switch",abrInfo:r})}}),(0,r._x)(this,"onTimeUpdate",function(){var e=s.playlogs,t=s.resLogs,a=s.player;if(s.errorLog.try_err_c=0,!e.vt&&1===s.startStep&&(e.vt=(0,n.L8)(),(0,n.cM)("onTimeUpdate: first frame inited","currentTime11:".concat(a.currentTime," vt-pt:").concat(e.vt-e.pt," vt-nt:").concat(e.vt-e.nt," vt-rt:").concat(e.vt-e.rt)),s.startStep=2),!t.initial_resolution){var r=a.currentDefitionFromPlayer&&a.currentDefitionFromPlayer.definition?a.currentDefitionFromPlayer.definition:a.config.defaultDefinition||"".concat(a.video.videoHeight,"p")||"";r=(0,n.fC)(r),t.initial_resolution=r}!t.final_resolution&&(t.final_resolution=t.initial_resolution);var i=e.played.length;i<1?e.played.push({begin:a.currentTime,end:-1}):e.played[i-1].end=a.currentTime,s._progressInfo.updatePlayed(a.currentTime),s._progressInfo.checkNextBitrate(a.currentTime);var o=t.played.length;o<1?t.played.push({begin:a.currentTime,end:-1}):t.played[o-1].end=a.currentTime,s.lastVideoTime=a.currentTime||0}),(0,r._x)(this,"onVideoProgress",function(){s.updateBuffers(),s._progressInfo.updateBuffered(s.player.buffered)}),(0,r._x)(this,"onCanplay",function(){(0,n.cM)("onCanplay","this.startStep:".concat(s.startStep," ").concat((0,n.L8)())),s.setVt()}),(0,r._x)(this,"onLoadeddata",function(){(0,n.cM)("onLoadeddata","this.startStep:".concat(s.startStep," ").concat((0,n.L8)())),s.setVt(),s.updateVideoSize()}),(0,r._x)(this,"onLoadStart",function(){s.commonParams.web_url=location.href;var e=(0,n.LM)(s.player.currentSrc);s.triggerTask("start"),(0,n.cM)("onLoadStart","this.startStep:".concat(s.startStep," ").concat((0,n.L8)()," isSrcEmpty:").concat(e," player.src:").concat(s.player.src)),0===s.startStep&&!e&&"visible"===document.visibilityState&&s.setPt()}),(0,r._x)(this,"onBufferedChange",function(){var e=s.player.video&&s.player.video.buffered;if(e){var t=e.length;t>0&&e.end(t-1)+1>s.player.duration&&(s.bft=(0,n.L8)())}}),(0,r._x)(this,"onPlayerInited",function(){(0,n.cM)("player init"),s._playerCreatedTime=(0,n.L8)(),s.playlogs.rt=(0,n.L8)()}),(0,r._x)(this,"onNotAutoPlay",function(){(0,n.cM)("onNotAutoPlay","autoplay:".concat(s.isAutoplay)),0===s.isAutoplay?s.isAutoplay=2:1===s.isAutoplay&&(s.isAutoplay=3)}),(0,r._x)(this,"onPlayerError",function(e){e=e||{};var t=s.errorLog,a=s.player;if((0,n.cM)("onPlayerError","this.player.type:".concat(s.player.type," this.player.replayRunning:").concat(s.player.replayRunning," isSupportMP4:").concat(l.ZP.isSupportMP4," isPC:").concat(l.ZP.isPC)),(0,n.cM)("onPlayerError",e),s.load_state=o.fp.ERROR,s._endType="error",s.suspendWaitingStatus("onPlayerError"),s._progressInfo.calculatePlaySize(),"dash"!==a.type||!a.replayRunning){if(!e.url&&(e.url=s.player.currentSrc),l.ZP.isPC&&!l.ZP.isSupportMP4||l.ZP.isSpider){t.errc=o.O1["5"],t.errt=o.iR.notSupport,s.onOneError({errorType:t.errt,code:t.errc,url:e.url,headers:e.headers||{},message:e.message||""},0),s._isOnePlayReport=!0;return}t.errt=e.errorTypeCode||(e.errorType&&o.iR[e.errorType]?o.iR[e.errorType]:9999),t.message=e.message||"",e.errorCode?t.errc=e.errorCode>0&&o.O1[e.errorCode]?o.O1[e.errorCode]:e.errorCode:e.code&&(t.errc=e.code>0&&o.O1[e.code]?o.O1[e.code]:e.code),t.last_errors.push(t.errc),0===t.fir_errc&&(t.fir_errc=t.errc),s.sendSwitchOpera(o.av.ERROR),s.onOnePlay(o.av.ERROR),s.onOneTemp(o.av.ERROR),s.sendDegradeLog("playCatch_end",s.playlogs.degrade);var r=!1,i=e.mediaError;i&&s._options.needXhrCheck&&(4===i.code||2===i)&&(r=!0),s.onOneError({endState:o.av.PLAY_ERROR,errorType:t.errt,code:t.errc,url:e.url,headers:e.headers||{},message:e.message||""},0,r),s.sendEventsQueue()}}),(0,r._x)(this,"onPlayInterfaceInfo",function(e){(0,n.cM)("onPlayInterfaceInfo",e);var t=s.errorLog,a=s.apiLog,r=s.playlogs;if(e&&Object.keys(e).map(function(t){"code"===t?a.vsc=e[t]:"message"===t?a.vsc_message=e.message||"success，视频可正常播放":a[t]=e[t]}),r.at=e.timestamep||new Date().getTime(),!e.error||-9988!==e.error.errc){if(a.vsc=e.code||10,a.vsc_message=e.message||"success，视频可正常播放",e.error){var i=e.error;t.errt=1e3,t.errc=i.errc||-9998,t.last_errors.push(i.errc||-9998),0===t.fir_errc&&(t.fir_errc=i.errc||-9998),t.accu_errc++,1===t.accu_errc&&(t.fir_errt=(0,n.je)()),s.onOneError({errorType:1e3,code:i.errc||-9998,url:"",headers:{}})}}}),(0,r._x)(this,"onProgressEvent",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.netLog;if(e.speed){var a=e.speed>1e6?Math.floor(e.speed/1e3):e.speed;t.downloadSpeed=a,t.totalSpeed+=a,t.rqCount++}"oversize"!==e.type&&t.requestCount++,e.connectTime&&(t.connectCost=e.connectTime);var o=t.rqCount<7?100:e.costTime>=5e3?20:10;if(!("success"===e.type&&parseInt(100*Math.random(),10)<=o)){var l=(0,i.I)(e.cdnUrl),c=e.xhr||{},u=e.type?"progress_".concat(e.type):"progress",d=e.headers;!d&&(d=(0,n.rg)(c)),d=(0,n.xV)(d);var h=(0,r.Zj)((0,r.Zj)({},d),{},{download_speed:t.downloadSpeed,connect_cost:t.connectCost,c_dur:l.connectDuration||0,d_dur:l.domainDuration||0,r_dur:l.duration||0,rqtt:new Date().getTime(),x_cache:d.x_response_cache||"",server_ip:d.x_response_sinfo});e.status?t.status=e.status:c&&c instanceof window.XMLHttpRequest&&(t.status=c.status||0),h.status=t.status;var p=e.cdnUrl||e.url;"error"===e.type&&s.merror.cdn.push((0,r.Zj)((0,r.Zj)({costTime:e.costTime,cur_play_pos:e.pos,cdn_url:p,cdn_host:(0,n._P)(p)},h),d)),s.onOneEvent({costTime:e.costTime,vid:e.vid,end_type:u,cur_play_pos:e.pos,cdn_url:p,cdn_host:(0,n._P)(p)},h,"error"===e.type?0:2)}}),(0,r._x)(this,"onNext",function(){if((0,n.cM)("onNext:startStep:",s.startStep),s.startStep>0){if(s._reportInvalidVV(o.av.NEXT))return;s.sendSwitchOpera(o.av.NEXT),s.onOnePlay(o.av.NEXT),s.onOneTemp(o.av.NEXT),s.sendEventsQueue()}s.vtype=null,s.playlogs.lc=0,s.resetLoggerParams()}),(0,r._x)(this,"onNextEnded",function(){var e=s.player,t=s.resLogs,a=(0,n.fC)(e.config.defaultDefinition||"");t.initial_resolution=a,t.final_resolution=a}),(0,r._x)(this,"onXgLogWaiting",function(e){var t=s.playlogs,a=s.resLogs,r=s.stall;if(!!s._options.checkByInnerLog&&0===e.type){(0,n.cM)("onXgLogWaiting",e);var i=e.endType,o=e.costTime,l=e.start,c={download_speed:s.realSpeed,avg_speed:s.avgSpeed,mse_op:s.mp4MseOpLength,mp4_load_range:s.mp4LoadSegmentTimeRange,bitrate:s.curBitrate};if("waitingStart"===e.eventType){s.onOneEvent({costTime:o,end_type:"waitstart"},c,2),s.appendStallInfo("start",l);return}if("waitingEnd"===e.eventType){var u=(0,n.je)();(0,n.cM)("onXgLogWaiting>>".concat(i,"|costTime:").concat(o,"  vt:").concat(t.vt)),s.appendStallInfo("end",u,i),t.bc++,s.checkInBuffer(s.player.currentTime)?(t.de_bu_acu_t+=o,t.dbc++):(t.nbc++,t.n_bu_acu_t+=o),a.bc++,t.bu_acu_t+=o,a.bu_acu_t+=o,r.end=s.cur_play_pos,r.cost=o,r.acc+=r.cost,1===r.sc&&(r.endf=s.cur_play_pos),s.onOneEvent({costTime:o,end_type:"waitend"},c,2)}}}),(0,r._x)(this,"onSeeking",function(){if(!(0,n.LM)(s.player.src)){var e=s.resLogs,t=s.playlogs,a=s.player,r=s.seekLog;(0,n.cM)("onSeeking","currentTime:".concat(a.currentTime)),0===s.startStep&&s.setPt(),s.suspendWaitingStatus("seek"),s.isSeeking&&s.suspendSeekStatus("seek",!1),s.isSeeking=!0,t.played.push({begin:a.currentTime,end:-1}),e.played.push({begin:a.currentTime,end:-1}),s._progressInfo.updatePlayed(a.currentTime,0),r.lastSeekStartTime=(0,n.je)(),r.seekBefore=s.lastVideoTime.toString(),r.buf_include=s.checkInBuffer(s.player.currentTime)?1:0,r.intervalId=setTimeout(function(){s.isSeeking&&s.suspendSeekStatus("seekTimeout",!0)},o.co)}}),(0,r._x)(this,"onSeeked",function(){if(!(0,n.LM)(s.player.src))s.isSeeking&&s.suspendSeekStatus("seeked",!0)}),(0,r._x)(this,"onPlaying",function(){s.suspendWaitingStatus("play"),s.load_state=o.fp.PLAYABLE;var e=(0,n.je)();s.pauseLog.isPausing&&(s.pauseLog.isPausing=!1,s.pauseLog.pause_acu_t+=e-s.pauseLog.pause_start)}),(0,r._x)(this,"onPlayCatch",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorTypeCode:0,errorCode:0,url:"",headers:{},status:0};if((0,n.cM)("onPlayCatch",e,t),!!e){switch(e){case"mp42dash":s.vtype="DASH_2";break;case"dash2mp4":s.vtype="MP4_2";break;case"dash1mp4":s.vtype="MP4_1";break;default:s.vtype=e}var a=s.errorLog,i=s.playlogs;s.merror.playCatch.push((0,r.Zj)({errc:t.errorCode,errt:t.errorType},t.headers)),s.setBr("playcatch"),a.accu_errc++,a.try_err_c++,a.fir_errc=t.errorCode,t.errorCode&&a.last_errors.push(t.errorCode),s.suspendWaitingStatus("playcatch"),s.suspendSeekStatus("playcatch"),s.sendDegradeLog("playCatch",i.degrade,{cdn_url:t.url}),i.degrade=e,s.onOneError({errorType:t.errorTypeCode,code:t.errorCode,url:t.url||"",status:t.httpCode||t.status,headers:t.headers||{},vid:t.vid||s.vid,preload_hit:t.preloadHit||0,preload_cached:t.preloadCached||0,endState:o.av.PLAY_CATCH,costTime:t.costTime,message:t.errorMessage||t.message,interval_time:t.timerStep||0},0)}}),(0,r._x)(this,"onMediaExpied",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{errorType:"",errorTypeCode:0,errorCode:0,url:"",headers:{},status:0},t=s.errorLog,a=s.playlogs;(0,n.cM)("onMediaExpied",e),s.suspendWaitingStatus("expied"),s.setBr("expied"),t.accu_errc++,t.try_err_c++,t.last_errors.push(e.errorCode),a.at=new Date().getTime(),s.merror.expied.push((0,r.Zj)({errorType:e.errorTypeCode||e.errorType,code:e.errorCode,url:e.url||"",status:e.status},(0,n.xV)(e.headers||{}))),s.onOneError({errorType:e.errorTypeCode||e.errorType,code:e.errorCode,url:e.url||"",status:e.status,headers:e.headers||{}},0)}),(0,r._x)(this,"onLog",function(e){(0,n.cM)("onLog",e);var t=e.type;if(delete e.type,!!t)switch(t){case o.LH.RETRY:break;case o.LH.ONETEMP:!s._templog&&(s._templog={}),s._templog=(0,n.yc)(s._templog,e.data,e.action),s._templog.preload_hit&&(s._cacheFile=o.c3.CACHED);break;case o.LH.ONEERROR:var a=s.errorLog;a.accu_errc++,a.try_err_c++,s.setBr("mp4error"),a.last_errors.push(e.code),s.onOneError(e,0);break;case o.LH.ONEEVENT:var r=(0,n.lv)(e,{costTime:"costTime",vid:"vid",end_type:"end_type",pos:"cur_play_pos",cdnUrl:"cdn_url"});r.ext&&["start","end"].map(function(e){r.ext[e]&&(r.ext["ext_".concat(e)]=r.ext[e],delete r.ext[e])}),s.onOneEvent(r.data,r.ext,2)}}),(0,r._x)(this,"onPlay",function(){(0,n.cM)("onPlay","this.startStep :".concat(s.startStep," this.isEnded:").concat(s.isEnded)),s.isEnded&&(s.resetLoggerParams(),s.setPt())}),(0,r._x)(this,"onPause",function(){(0,n.cM)("onPause");var e=s.pauseLog;e.isPausing=!0,e.pause_start=(0,n.je)()}),(0,r._x)(this,"onWaiting",function(){var e=s._options;if(s.updateCurBuffer("onWaiting"),e.checkByInnerLog)return;if((0,n.cM)("onWaiting>","isSeeking:".concat(s.isSeeking," startStep:").concat(s.startStep," intervalId:").concat(s.stallIntervalId)),s.wait_buf_include=s.checkInBuffer(s.player.currentTime,-1e3)?1:0,!s.isSeeking&&0!==s.playlogs.vt&&!(s.inWaitingStart>0))s.stallIntervalId&&(window.clearTimeout(s.stallIntervalId),s.stallIntervalId=null),s.inWaitingStart=(0,n.je)(),s.waitStartTime=s.cur_play_pos,s.stallIntervalId=window.setTimeout(function(){var e=s.stall;(0,n.cM)("this.stallIntervalId>>".concat(s.stallIntervalId," cost: ").concat((0,n.je)()-s.inWaitingStart)),s._endType="wait",s.load_state=o.fp.STALLED,s.vtype.indexOf("MP4")>-1&&s.player.currentTime>10&&s.task&&(s.triggerTask("waiting",s.initial_url),s.requestCount++),e.start=s.waitStartTime,e.bc++,1===e.bc&&(e.startf=s.waitStartTime),window.clearTimeout(s.stallIntervalId),s.stallIntervalId=null,s.startWaitingStatus(s.inWaitingStart,(0,n.je)()-s.inWaitingStart),s.stallIntervalId=setTimeout(function(){s.inWaitingStart>0&&s.suspendWaitingStatus("timeout")},o.co)},o.bJ)}),(0,r._x)(this,"onEnded",function(){if(!!s.initial_url){(0,n.cM)("onEnded","watchDur:".concat(s.watchDur," vt:").concat(s.vt," pt:").concat(s.pt)),s.isEnded=!0;var e=s.resLogs.df,t=s._progressInfo;t.calculatePlaySize(),t.cachedSize<1?s.changeResolution({from:e,to:e,startTime:(0,n.je)(),operaType:"leave_switch",endType:"ended"}):s.sendSwitchOpera(o.av.ENDED),s.onOnePlay(o.av.ENDED),s.sendDegradeLog("playCatch_end",s.playlogs.degrade),s.onOneTemp(o.av.ENDED),s.sendEventsQueue(),s.playlogs.lc++}}),(0,r._x)(this,"onUnload",function(){if(0===s.startStep||!s.initial_url)return;if(s.onOneTemp(o.av.UNLOAD),s.sendDegradeLog("playCatch_end",s.playlogs.degrade),!s._reportInvalidVV(o.av.UNLOAD))s.sendSwitchOpera(o.av.UNLOAD),s.onOnePlay(o.av.UNLOAD,!0)}),(0,r._x)(this,"onVisibilitychange",function(){var e=s.playlogs.vt;"visible"===document.visibilityState&&!e&&s.setPt()}),(0,r._x)(this,"onDestroy",function(){(0,n.cM)("onDestroy:this.startStep:".concat(s.startStep," initial_url:").concat(s.initial_url," ").concat(!!s.initial_url)),s.onOnePlay(o.av.DESTROY),s.startStep>0&&s.initial_url&&(s.onOneTemp(o.av.DESTROY),s.sendDegradeLog("playCatch_end",s.playlogs.degrade));var e=s.resLogs.df;s._progressInfo.cachedSize<1?s.changeResolution({from:e,to:e,startTime:(0,n.je)(),operaType:"leave_switch",endType:"destroy"}):s.sendSwitchOpera(o.av.ENDED),s.sendEventsQueue(),l.ZP.isPC?window.removeEventListener("beforeunload",s.onUnload):(l.ZP.isMobile||l.ZP.isPad)&&window.removeEventListener("pagehide",s.onUnload),document.removeEventListener("visibilitychange",s.onVisibilitychange),s.listeners.forEach(function(e){s.player.off(e.evt,e.handler)}),s.clearTimers(),s.player.off("destroy",s.onDestroy),s.task&&s.task.clear()}),(0,r._x)(this,"onOnePlay",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((0,n.cM)("onOnePlay _isOnePlayReport:".concat(s._isOnePlayReport," isLeave: ").concat(t," endState:").concat(e)),!s._isOnePlayReport){var a=s.errorLog,i=s.playlogs,c=s.abrInfo,u=s.resLogs,d=s.player,h=s.apiLog,p=s.pauseLog,f=s.stall,g=s.netLog,_=s.watchDur;s._isOnePlayReport=!0;var v=(0,n.L8)();s.getBufferTime(d);var y=s.getFrameInfo(),m=s.getPerformance(),b=a.errc,k=s._progressInfo,x=k.playedSize,L=k.cachedSize,S=k.pcdnCached,T=k.cachedVideoSize,I=k.pcdnVideoCached,P=s._progressInfo.getFileSize(d.duration),R=s.seekLog,C=R.sc,O=R.sat,D={bc:(0,n.RB)(_,s.bc),bu_acu_t:(0,n.RB)(_,s.bu_acu_t),sc:(0,n.RB)(_,C),sat:(0,n.RB)(_,O)};s.setExt();var w=s._getCompatibilityInfo();s.setNovv(null,e);var E=(0,r.Zj)((0,r.Zj)((0,r.Zj)((0,r.Zj)({local_time:new Date().getTime(),log_type:"video_playq",plugin_exception:0,player_create_exception:"",v:s.vid,initial_url:s.initial_url,initial_host:s.initial_host,initial_ip:s.curHeaders.x_response_sinfo||0,initial_type:s.initial_type},s.curHeaders),{},{initial_resolution:u.initial_resolution,final_resolution:u.final_resolution,pt:s.pt,prepare_start_time:i.nt,prepare_end_time:i.rt||(0,n.L8)(),vt:s.vt,lt:s.lt,lpt:s.lpt,fvt:s.fvt,nvt:s.nvt,bft:s.bft,sc:C,sat:O,bc:s.bc,dbc:i.dbc||0,nbc:i.nbc||0,video_net_s:s.videoNetworkState,status:s.curStatus,first_buf_startt:f.startf,first_buf_endt:f.endf,lc:i.lc,bu_acu_t:s.bu_acu_t,de_bu_acu_t:i.de_bu_acu_t||0,n_bu_acu_t:i.n_bu_acu_t||0,pause_acu_t:p.pause_acu_t,cur_play_pos:s.cur_play_pos,load_state:s.load_state,play_speed:s.playbackRate,playback_state:s.playback_state,end_state:e,watch_dur:_,switch_resolution_c:s.switchResolutionCount,is_start_play_automatically:s.isAutoplay,start_time:s.start_time,finish:s.finish,errt:a.errt,errc:b,vsc:h.vsc,vsc_message:a.message||h.vsc_message,api_str:h.api_str,auth:h.auth||h.logid,width:s.videoWidth,height:s.videoHeight,vd:s.vd,video_length:P.video,audio_length:P.audio,df:s.resolution,lf:u.lf,play_c:0,player_created_t:s.player_created_t,fir_errt:a.fir_errt,fir_errc:a.fir_errc,lv_method:0,ldst:u.ldst,ldet:u.ldet,is_disable_short_seek:0,mute:s.mute,volume:s.volume,download_speed:s.realSpeed?s.realSpeed:s.task&&s.task.speed?s.task.speed:g.downloadSpeed,avg_speed:s.avgSpeed?s.avgSpeed:g.rqCount>0?parseInt(g.totalSpeed/g.rqCount,10):0,bitrate:s.curBitrate,preload_state:s.preloadState,preload_hit:s.preLoadData.hit||0,preload_cached:s.preLoadData.duration||s.preLoadData.byteLength||0,mdl_req_num:g.requestCount,watingcost:s.watingCost,br:i.br,fbrt:i.fbrt,try_err_c:a.try_err_c,accu_errc:a.accu_errc,merror:(0,n.LQ)(s.merror),ex:(0,n.LQ)(s.exInfo),perf:(0,n.LQ)(m),bufs:(0,n.LQ)(s.buffers.allBuffer),vds:L,pvds:S,vps:x,vvds:T,pvvds:I,pcdn:(0,n.LQ)(s.getPCDNStat())},s.buffers.curBuffer),{},{degrade:i.degrade,cache_file:s._cacheFile},y),{},{fullScreen:s._getFullScreenType(),encryptedInfo:(0,n.LQ)(s.encryptedInfo),per100_info:(0,n.LQ)(D)},w);0!==s.vt&&(E.et=v);var M=s._logstrcache||s._getLogCache();0===E.fvt&&M&&(E.log=M,s._logstrcache=null),null!=d&&d.softDecoder&&(E.soft_decoder=d.softDecoder),d&&d.dashState&&(E.dash_state=d.dashState),null!=d&&d.softDecoder&&(E.soft_decoder=d.softDecoder),c.abr_init_opts=d.config.autoBitrateOpts||{},E.abr_info=(0,n.LQ)(s.abrInfo);var N=w.is_support_mp4&&w.is_support_mse_mp4;if(w.is_spider||l.ZP.isPC&&!N&&0===s.fvt){(0,n.cM)("is_spider",w.is_spider,"is_support_mp4",w.is_support_mp4);return}if(t){var A=!s._options.disableLocalCache;s.reportLog(o.bT.ONE_PLAY,E,A?1:0)}else s.reportLog(o.bT.ONE_PLAY,E)}}),(0,r._x)(this,"onOneEvent",function(e){var t=e.costTime,a=e.vid,i=e.end_type,l=e.cur_play_pos,c=e.cdn_url,u=e.cdn_host,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;(0,n.cM)("onOneEvent",i);var p=s.buffers,f=p.curBuffer,g=p.allBuffer,_=s.getFrameInfo(),v=(0,r.Zj)((0,r.Zj)({local_time:new Date().getTime(),v:a||s.vid,cost_time:t,end_type:i||s.end_type,cdn_url:c||s.url,cdn_host:u||"",initial_type:s.initial_type,resolution:s.resolution,play_speed:s.playbackRate,first_frame_interval:(0,n.je)()-s.pt,last_switch_interval:s.getLastInterval("lastSwitchStartTime",s.resLogs,!1),last_seek_interval:s.updateSeekPt(!1),last_event_interval:s.getLastInterval("lastEventTime"),cur_play_pos:l||s.cur_play_pos,video_ready_s:s.videoReadyState,video_seeking:s.videoSeeking,video_paused:s.videoPaused,bufs:(0,n.LQ)(g),retry_count:s._retryCount,at:s.playlogs.at,bc:s.stall.bc,stay_seconds:parseInt((new Date().getTime()-s.playlogs.at)/1e3,10),preload_state:s.preloadState,preload_hit:s.preLoadData.hit,preload_cached:s.preLoadData.duration||s.preLoadData.byteLength},f),_);i.indexOf("waitend")>=0&&t>3e3&&(v.log=s._getLogCache());var y=s.player,m=y.currentTime,b=y.duration;if(i.indexOf("waitstart")>=0&&b-m<=1){var k=v.local_time,x=v.v,L=v.cost_time,S=v.cdn_url,T=v.first_frame_interval,I=v.cur_play_pos,P=v.video_ready_s,R=v.video_seeking,C=v.video_paused,O=v.bufs,D=v.bc,w=v.preload_hit;s.reportLog(o.bT.ONE_EVENT,(0,r.Zj)({end_type:"longwait",local_time:k,v:x,cost_time:L,cdn_url:S,first_frame_interval:T,cur_play_pos:I,video_ready_s:P,video_seeking:R,video_paused:C,bufs:O,bc:D,preload_hit:w},f),h)}if("waitstart"===i&&"function"==typeof s._options.getPageFPS){var E=s._options.getPageFPS();v.cur_fps=E.curFPS||0,v.avg_fps=E.avgFPS||0}i.indexOf("wait")>-1&&(v.buf_include=s.wait_buf_include),i.indexOf("timeout")>-1&&v.cost_time>o.YL&&(v.cost_time=o.YL);var M=s.player;M&&M.dashState&&(v.dash_state=s.player.dashState),Object.keys(d).forEach(function(e){v[e]=d[e]}),v.ex=(0,n.LQ)(s.getPlayerExt()),s.addIfExist("drm_type",s._options,v),s.reportLog(o.bT.ONE_EVENT,v,h)}),(0,r._x)(this,"onOneTemp",function(){if((0,n.cM)("onOneTemp>>",!s._templog),!!s._templog){var e=s.player,t=s.playlogs,a=s.pauseLog,i=s.errorLog,l=s.resLogs,c=s.watchDur,u=(0,r.Zj)((0,r.Zj)((0,r.Zj)({local_time:new Date().getTime()},s._templog),{},{v:s.vid,initial_type:s.initial_type,pt:s.pt,vt:s.vt,lt:s.lt,fvt:s.fvt,bc:s.bc,bu_acu_t:s.bu_acu_t>o.bB?0:s.bu_acu_t,pause_acu_t:a.pause_acu_t,cur_play_pos:s.cur_play_pos,watch_dur:c>o.bB?0:c,finish:s.finish,errt:i.errt,errc:i.errc,vd:s.vd,df:s.resolution,lf:l.lf,br:t.br,fbrt:t.fbrt,try_err_c:i.try_err_c,accu_errc:i.accu_errc,dash_break:2===e.dashBufferBreak?1:0,bufs:(0,n.LQ)(s.buffers.allBuffer),vs:l.vs,vds:l.vds,vps:l.vps},s.buffers.curBuffer),{},{degrade:t.degrade});0!==s.vt&&(u.et=(0,n.L8)()),["drm_type","dynamic_type"].forEach(function(e){s.addIfExist(e,s._options,u)}),s.reportLog(o.bT.ONE_TEMP,u,0),s._templog=null}}),this.player=t,void 0===this.player||null===this.player)throw Error("player is ".concat(this.player));if(!!a&&!!a.line_app_id){a.isTask&&(this.task=new c.Z),this.eventQueue=[],this._instanceCreateTime=new Date().getTime(),a.codec_type=a.codec_type||"h264",this._envInfo=a.envInfo||{},this._options=a,this._options.maxQueueCount||(this._options.maxQueueCount=5),this.line_app_id=parseInt(a.line_app_id,10)||0,this.line_user_id=(a.line_user_id||"").toString(),this.playerCoreVersion=t.version,this.playerVersion=a.playerVersion,this.closeSeekLog=a.closeSeekLog||!1,this.start_time=1e3*(a.start_time||0),this._initial_resolution="",this.__vtype=null,this.__dt="",this._progressInfo=new u.Z,this.resetLoggerParams();try{this.initializeTracker(),this.sendLocalLog(),this.bindEvt(),(0,n.cM)("logger constructor:".concat(this.player.video))}catch(e){}}}return(0,r.qH)(e,[{key:"resetLoggerParams",value:function(){(0,n.cM)("resetLoggerParams");var e=this.playlogs?this.playlogs.lc:0;this.playlogs={nt:(0,n.L8)(),vt:0,rt:this.isEnded?(0,n.L8)():0,at:0,pt:0,bu_acu_t:0,bc:0,br:0,fbrt:"",dbc:0,de_bu_acu_t:0,nbc:0,n_bu_acu_t:0,played:[{begin:0,end:-1}],degrade:"none",lc:e},this.degradeLog={bu_acu_t:0,bc:0,watch_dur:0,hasSendEnd:!1},this.buffers={allBuffer:[],curBuffer:{buf_diff:0,buf_s_pos:0,buf_e_pos:0,buf_include:0}},this.netLog={downloadSpeed:0,requestCount:0,connectCost:0,totalSpeed:0,rqCount:0,status:0},this.merror={cdn:[],player:[],playCatch:[],expied:[]},this.exInfo={stall:[]},this._templog=null,this._isOnePlayReport=!1,this.startStep=0,this.bft=0,this._progressInfo.reset(),this._novv={log_pt:(0,n.L8)()},this.initializeLogDatas(),this.initializeUrlLog()}},{key:"setNovv",value:function(e,t){if(!!this._novv&&!(this.fvt>0))e&&(this._novv.errc=e.code,this._novv.errt=e.errorType,this._novv.errorMessage=e.message),this._novv.end_state=t,!this._novv.novv_pt&&(this._novv.novv_pt=(0,n.L8)(),this._novv.novv_lpt=(0,n.L8)()-this._novv.log_pt),this.player&&(this._novv.vtype=this.player.vtype,this.player.novv=this._novv)}},{key:"initializeLogDatas",value:function(){this.startStep=0,this.inWaitingStart=0,this.waitStartTime=0,this.lastVideoTime=0,this._endType="",this._retryCount=0,this.lastOperaTime=-1,this.lastEventTime=-1,this.stallIntervalId=null,this.seekLog={intervalId:0,lastSeekStartTime:(0,n.je)(),seekBefore:0,sat:0,sc:0,buf_include:0},this.resLogs={lastSwitchStartTime:-1,switch_count:0,abr_switch_count:0,initial_resolution:"",final_resolution:"",ldst:0,ldet:0,df:"",lf:"",played:[],bc:0,bu_acu_t:0,sc:0,sat:0,buf:0,lbuf:0,lplayed:0,vs:0,vds:0,vps:0,vis:0,bitrate:0},this.apiLog={code:0,message:"",logid:"",api:"",auth:"",error:{}},this.errorLog={accu_errc:0,try_err_c:0,errt:0,errc:0,fir_errt:0,fir_errc:l.ZP.isSupportMP4?0:1005,last_errors:[],message:""},this.pauseLog={pause_acu_t:0,isPausing:!1,pause_start:0},this.stall={sc:0,startf:0,endf:0,start:0,end:0,cost:0,acc:0},this._playerCreatedTime=0,this.load_state=o.fp.UNKNOWN,this.lv_method=6,this.isSeeking=!1,this.isEnded=!1,this.startStep=0,this.isAutoplay=this.player.config&&this.player.config.autoplay?1:0,this.abrInfo={abr_general_info:{},abr_event_info:{video_switch:[],video_stall:[],video_exit:{}},abr_play_info:{start_play_time_ms:0,is_hint:0,playback_info:{internet_speed_record:[],play_bitrate_record:[],buffer_length_record:[],play_speed_record:[]}},abr_user_info:{cancel_abr:0},abr_init_opts:this.player.config.autoBitrateOpts||{}},this._cacheFile=o.c3.NO_CACHE}},{key:"initSessionId",value:function(){var e="0";try{e=window.localStorage.getItem(g).web_id||"0"}catch(t){e="0"}this._sessionId=(0,n.xv)(e),(0,n.cM)("sessionId ".concat(this._sessionId))}},{key:"initializeTracker",value:function(){var e=this,t=this._options;if(window.__xgplayer_vod_log__)this.tracker=window.__xgplayer_vod_log__;else{this.tracker=window.__xgplayer_vod_log__=new v("tracker");var a=t.channel||"cn",i={app_id:"cn"===(a="va"===a||"sg"===a?a:"cn")?f:1300===f?323254:f,channel:a,log:!1,disable_sdk_monitor:!0,disable_heartbeat:!0};t.channelDomain&&(i.channel_domain=t.channelDomain),i.enable_ab_test=!!t.enableAbTest,this.tracker.init(i)}this.initSessionId();var o=navigator?navigator.hardwareConcurrency:0,s=navigator?navigator.deviceMemory:0;this.commonParams={play_type:0,source_type:"vid",sdk_version:d.Z,pc:this.playerCoreVersion,pv:this.playerVersion,line_app_id:this.line_app_id,line_user_id:this.line_user_id,app_version:t.appVersion||"",platform:l.ZP.isPad?"pad":l.ZP.isMobile?"mobile":"pc",cpu_core:Number(o)||0,memory_size:Number(s)||0,support:(0,l.Cy)(),webdriver:navigator&&navigator.webdriver?1:0,player_sessionid:this.sessionId,web_url:window.location.href,user_agent:navigator.userAgent};var c=t.trackerConfig||{};(0,n.cM)("commonParams ",this.commonParams,c);var u=(0,r.Zj)({evtParams:this.commonParams,disable_auto_pv:!0},c);l.ZP.name&&!l.ZP.isChrome&&!l.ZP.isSafari&&(u.browser=l.ZP.name,l.ZP.appVersion&&(u.browser_version=l.ZP.appVersion)),this.line_user_id&&(u.user_unique_id=this.line_user_id,t.enableTeaWebId||(u.web_id=this.line_user_id)),t.referrer&&(u.referrer=t.referrer,u.referrer_host=(0,n._P)(t.referrer)),t.ext&&Object.keys(t.ext).map(function(a){e.exInfo[a]=t.ext[a]}),(0,n.cM)("trackConfig",u),this.tracker.config(u),this.tracker.start()}},{key:"resetDefiInfo",value:function(){var e=this.resLogs;e.played=[],e.bc=0,e.bu_acu_t=0,e.sc=0,e.sat=0}},{key:"sendLocalLog",value:function(){var e=this,t=s.Z.get();s.Z.remove(),t.map(function(t){Object.keys(t).map(function(a){if((0,n.cM)("sendLocalLog",a,t[a]),e.player){e.player.emit("abLog",a,t[a]);var r=e._options.sendLocalCallback;r&&"function"==typeof r&&r(a,t[a])}e._track(a,t[a])})})}},{key:"_track",value:function(e,t){"function"==typeof this.tracker?this.tracker(e,t):this.tracker.event(e,t)}},{key:"bindEvt",value:function(){var e=this;this.listeners=[{evt:"play",handler:this.onPlay},{evt:"playing",handler:this.onPlaying},{evt:"pause",handler:this.onPause},{evt:"waiting",handler:this.onWaiting},{evt:"playInterfaceInfo",handler:this.onPlayInterfaceInfo},{evt:"ended",handler:this.onEnded},{evt:"loadeddata",handler:this.onLoadeddata},{evt:"loadstart",handler:this.onLoadStart},{evt:"canplay",handler:this.onCanplay},{evt:"progress",handler:this.onVideoProgress},{evt:"autoplay_was_prevented",handler:this.onNotAutoPlay},{evt:"seeking",handler:this.onSeeking},{evt:"seeked",handler:this.onSeeked},{evt:"complete",handler:this.onPlayerInited},{evt:"timeupdate",handler:this.onTimeUpdate},{evt:"bufferedChange",handler:this.onBufferedChange},{evt:"beforeDefinitionChange",handler:this.onBeforeDefinitionChange},{evt:"definitionChange",handler:this.onDefinitionChange},{evt:"definitionChangeSuccess",handler:this.onDefiChangeSuccess},{evt:"replayBtnClick",handler:this.onReplayBtnClick},{evt:"initialUrl",handler:this.initializeUrlLog},{evt:"ABR_CHANGE",handler:this.onAbrChange},{evt:"playCatch",handler:this.onPlayCatch},{evt:"log",handler:this.onLog},{evt:"progress_event",handler:this.onProgressEvent},{evt:"logger_next",handler:this.onNext},{evt:"playnext",handler:this.onNext},{evt:"nextEnded",handler:this.onNextEnded},{evt:"media_format_error",handler:this.onMediaFormatError},{evt:"xglog",handler:this.onXgLogWaiting},{evt:"xglog_cache",handler:this.onXgLogCache},{evt:"degrade",handler:this.onDegrade},{evt:"definitionChangeDetail",handler:this.onDefinitionChangeDetail},{evt:"prf_data_size",handler:this.onPrfDataSize}];var t=this.player.config.errorKey;(0,n.cM)(">>>errorKey",t);var a={evt:"error",handler:this.onPlayerError};t&&(a.evt=t),this.listeners.push(a),this.listeners.forEach(function(t){e.player.on(t.evt,t.handler)}),this.bindUnload()}},{key:"_getLogCache",value:function(){var e,t;return(null===(e=this.player)||void 0===e?void 0:e.logCache)||(null===(t=this.player)||void 0===t?void 0:t.getLogCache)}},{key:"addIfExist",value:function(e,t,a){if(!!p(t)){var r=t[e];null!=r&&(a[e]=r)}}},{key:"sendSwitchOpera",value:function(e){var t=this._progressInfo,a=t.lastBitrate,r=t.curBitrate,n=t.nextBitrate,i={costTime:0,operaType:"detail_switch",stateBefore:"",stateAfter:"",endType:e},o=null;if("changedetail"===e){if(!a)return;o=a,i.stateBefore=a.definition,i.stateAfter=n.definition}else o=r,i.stateBefore=r.definition,i.stateAfter="";var s={vds:o.cdnSize,pvds:o.pcdnSize,fileid:o.fileid};this.onOneOperator(i,s)}},{key:"changeResolution",value:function(e){var t=e.from,a=e.to,r=e.startTime,i=e.operaType,o=e.abrInfo,s=e.endType,l=this.resLogs;t=(0,n.fC)(t),a=(0,n.fC)(a),l.ldet=(0,n.je)(),l.df=a,l.lf=t,l.final_resolution=a,l.switch_count++;var c=l.ldet-r,u={bc:l.bc,bu_acu_t:l.bu_acu_t,sc:l.sc,sat:l.sat,watch_dur:(0,n.uV)(l.played)};o&&(u.abrInfo=o),this.updateVds(),this.resetDefiInfo(),!this._options.closeResolutionLog&&this.onOneOperator({costTime:c,operaType:i,endType:void 0===s?"":s,stateBefore:t,stateAfter:a},u,0)}},{key:"getLastInterval",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=t[e],i=(0,n.je)();return a&&(t[e]=i),-1===r?-1:i-r}},{key:"updateSeekPt",value:function(e){return this.getLastInterval("lastSeekStartTime",this.seekLog,e)}},{key:"_reportInvalidVV",value:function(e){return!!this._isInvaidVV()&&(this.onOneError({endState:e,errorType:9998,code:-1,url:this.player.currentSrc,headers:{}},0),this._isOnePlayReport=!0,!0)}},{key:"_isInvaidVV",value:function(){return 0===this.vt&&-1===this.curStatus}},{key:"bindUnload",value:function(){l.ZP.isPC?window.addEventListener("beforeunload",this.onUnload):(l.ZP.isMobile||l.ZP.isPad)&&window.addEventListener("pagehide",this.onUnload),document.addEventListener("visibilitychange",this.onVisibilitychange),this.player.once("destroy",this.onDestroy)}},{key:"clearTimers",value:function(){var e=this.seekLog;e.intervalId&&window.clearTimeout(e.intervalId),this.stallIntervalId&&window.clearTimeout(this.stallIntervalId)}},{key:"sendDegradeLog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"playCatch",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,n.cM)("sendDegradeLog",e,t,a);var i=this.degradeLog;if(!i.hasSendEnd&&("playCatch_end"!==e||"none"!==t)){"playCatch_end"===e&&(i.hasSendEnd=!0);var s=this.bu_acu_t-i.bu_acu_t;this.onOneEvent({costTime:this.vd,vid:this.vid,end_type:e,cur_play_pos:this.player.currentTime,cdn_url:a.url},(0,r.Zj)({degrade:t,vt:this.vt,pt:this.pt,fvt:this.fvt,bc:this.bc-i.bc,bu_acu_t:s>o.bB?0:s,watch_dur:this.watchDur-i.watch_dur},a),0)}}},{key:"_getFullScreenType",value:function(){return this.player.isFullscreen?o.UK.FULLSCREEN_TYPE:this.player.isCssfullScreen?o.UK.CSS:o.UK.NO_FULLSCREEN}},{key:"getBufferTime",value:function(e){var t=0,a=0,r=e.video&&e.video.buffered;if(r){for(var n=r.length,i=0,o=0;o<n;o++)i+=r.end(o)-r.start(o);t=a=1e3*i}return{video:t,audio:a}}},{key:"updateAbrInfo",value:function(e,t,a){e.abr_general_info=t.generalInfo,e.abr_event_info.video_exit={local_time_ms:new Date().getTime(),buffer_length:t.bufferLength,internet_speed:t.downloadSpeed,now_bitrate:t.nowBitrate,play_speed:a},t.getAbrPlayInfo&&(e.abr_play_info=t.getAbrPlayInfo())}},{key:"getPerformance",value:function(){return this.player.performance||{}}},{key:"setExt",value:function(){var e=this,t=this.player.ext||{};t.performance&&delete t.performance,Object.keys(t).map(function(a){"performance"!==a&&(e.exInfo[a]=t[a])})}},{key:"onOneOperator",value:function(e){var t=e.costTime,a=e.operaType,r=e.stateBefore,i=e.stateAfter,s=e.endType,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,u=this.getLastInterval("lastOperaTime"),d={local_time:new Date().getTime(),v:this.vid,opera_type:a,state_before:r,state_after:i,cost_time:t,end_type:s||this.end_type,cdn_url:this.url,resolution:this.resolution,last_interval:u,bufs:(0,n.LQ)(this.buffers.allBuffer),cur_play_pos:this.cur_play_pos,retry_count:this._retryCount};"seek"===a&&(d.buf_include=this.seekLog.buf_include,this.seekLog.buf_include=0);var h=this.player;h&&h.dashState&&(d.dash_state=this.player.dashState),Object.keys(l).forEach(function(e){d[e]=l[e]}),this.addIfExist("drm_type",this._options,d),this.reportLog(o.bT.ONE_OPERA,d,c)}},{key:"onOneError",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{errorType:0,code:0,url:"",headers:{},costTime:0,vid:"",message:"",preload_hit:0,preload_cached:0,interval_time:0},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,n.cM)("onOneError",t);var s=this.errorLog,l=this.apiLog,c=this.resLogs,u=this.player,d=this.playlogs,h=(0,n.xV)(t.headers||{}),p=this.getPerformance(),f=t.code>0?0-t.code:t.code;this.setExt();var g=this._getCompatibilityInfo();this.setNovv(t,t.endState||o.av.ERROR);var _=(0,r.Zj)((0,r.Zj)((0,r.Zj)({v:t.vid||this.vid,video_pos:this.cur_play_pos,local_time:new Date().getTime(),cost_time:t&&t.costTime?t.costTime:0,errt:t.errorType,errc:f,es:this.es,cdn_url:t.url||this.url,bufs:(0,n.LQ)(this.buffers.allBuffer),resolution:c.final_resolution,last_errors:s.last_errors.join(";"),vsc:l.vsc,vsc_message:t.message||l.vsc_message,server_ip:h.x_response_sinfo||0,initial_url:this.initial_url,initial_host:this.initial_host},h),{},{cur_play_pos:this.cur_play_pos},this.buffers.curBuffer),{},{degrade:d.degrade,end_state:t.endState||o.av.ERROR,preload_hit:t.preload_hit||0,preload_cached:t.preload_cached||0,ex:(0,n.LQ)(this.exInfo),pref:(0,n.LQ)(p),video_ready_s:this.videoReadyState,interval_time:t.interval_time||0},g);u&&u.dashState&&(_.dash_state=u.dashState);var v=this.player.currentSrc,y=(0,n.ky)(v)?(0,n.ky)(t.url)?this.initial_url:t.url:v,m={connectTime:0,status:0,statusText:"",isexpired:0,isBlob:(0,n.ky)(v)?1:0};if(i&&"String"===(0,n.kM)(y)){var b={};(0,n.vR)(y,{range:"0-8",timeout:2e3}).then(function(e){(0,n.cM)("getXhr>>check result ",e);var t=(0,n.xV)(e.headers||{});_.server_ip=t.x_response_sinfo,b=(0,r.Zj)((0,r.Zj)({},m),{},{statusText:e.statusText||"",status:e.status||0,connectTime:0|e.connectTime,sinfo:t.x_response_sinfo||"",cinfo:t.x_response_cinfo||""})}).catch(function(e){b=(0,r.Zj)((0,r.Zj)({},m),{},{statusText:-2===e.status?"timeout":"error",status:e.status})}).finally(function(){var t=(0,n.qP)(y);b.isexpired=t,_.net=(0,n.LQ)(b),e.reportLog(o.bT.ONE_ERROR,_,a)})}else _.net=(0,n.LQ)(m),this.reportLog(o.bT.ONE_ERROR,_,a)}},{key:"_getCompatibilityInfo",value:function(){var e=(0,l._M)();return{is_spider:l.ZP.isSpider?1:0,is_support_mp4:l.ZP.isSupportMP4?1:0,is_support_hevc:(0,l.G9)()?1:0,is_support_mse_mp4:e.support?1:0,support_mse_mp4:e.message}}},{key:"reportLog",value:function(t,a,r){var i=this,c=this._options,u=this.player.ABTestTag,d=this.commonParams;a.dynamic_type=this.dynamicType;var h="Array"===(0,n.kM)(c.absdkVersion)?c.absdkVersion.join(","):c.absdkVersion;a.absdkVersion=h||e.AB_SDK_VERSION,null!=u&&(a.abtest_tag=u);var f=this._options;if(a.codec_type=this.codecType,p(f)&&(o.qC.forEach(function(e){i.addIfExist(e,f,a)}),Object.keys(d).forEach(function(e){i.addIfExist(e,d,a)}),a.vtype=this.vtype),a.env_info=(0,n.LQ)(this._envInfo||{}),a.support=(0,l.Cy)(),a.visible=(0,n.ab)(),1===r){var g={};g[t]=a,s.Z.set(g);return}if(2===r){this.addEventsQueue(t,a);return}this.player&&this.player.emit("abLog",t,a),this._track(t,a)}},{key:"addEventsQueue",value:function(e,t){this.eventQueue.push({event:e,params:t}),this.eventQueue.length>=this._options.maxQueueCount&&this.sendEventsQueue()}},{key:"sendEventsQueue",value:function(){for(;this.eventQueue.length>0;){var e=this.eventQueue.pop();this._track(e.event,e.params)}}},{key:"startWaitingStatus",value:function(e,t){this.appendStallInfo("start",e),this.updateCurBuffer("startWaitingStatus"),this.onOneEvent({costTime:t,end_type:"waitstart"},{},2)}},{key:"triggerTask",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"start",t=arguments.length>1?arguments[1]:void 0;(0,n.cM)("triggerTask>>",e),t=t||this.player.src,!(0,n.LM)(t)&&this.vtype.indexOf("MP4")>-1&&this.task&&this.task.trigger(t,e)}},{key:"appendStallInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"start",t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;!this.exInfo.stall&&(this.exInfo.stall=[]);var r=this.exInfo.stall;if("start"===e){r.length>6&&r.splice(0,r.length-6);var i=this.buffers.curBuffer;r.push({start:t,end:-1,endType:"waitstart",cost:0,cur:this.cur_play_pos,buf_s:i.buf_s_pos,buf_e:i.buf_e_pos,buf_i:i.buf_include})}else if("end"===e){var o=r.length-1;if(o<0)return;r[o].end<0&&(r[o].end=t,r[o].endType=a,r[o].cost=t-r[o].start)}(0,n.cM)("appendStallInfo",r)}},{key:"suspendWaitingStatus",value:function(e){var t=(0,n.je)(),a=this.playlogs,r=this.resLogs,i=this.stall,s=this.inWaitingStart;if(!(s<=0)&&!this.isSeeking&&!(a.vt<=0)){if((0,n.cM)("suspendWaitingStatus>>".concat(e,"|costTime:").concat(t-s," isSeeking:").concat(this.isSeeking)),this.appendStallInfo("end",t,e),t-s>o.bJ){var l=t-this.inWaitingStart;if(a.bc++,this.checkInBuffer(this.player.currentTime)?(a.de_bu_acu_t+=l,a.dbc++):(a.nbc++,a.n_bu_acu_t+=l),r.bc++,a.bu_acu_t+=l,r.bu_acu_t+=l,i.end=this.cur_play_pos,i.cost=l,i.acc+=i.cost,1===i.sc&&(i.endf=this.cur_play_pos),this.player.abrInstance&&!this.isSeeking&&this.playlogs.vt){var c=this.player.abrInstance;this.abrInfo.abr_event_info.video_stall.push({local_time_ms:new Date().getTime(),stall_duration:parseFloat((l/1e3).toFixed(2)),buffer_length:c.bufferLength,internet_speed:c.downloadSpeed,now_bitrate:c.nowBitrate,play_speed:this.player.playbackRate,is_abr:c.isCurrentInAbr?1:0})}this.onOneEvent({costTime:l,end_type:"waitend_".concat(e)||"waitend"},{},2)}this._endType="",this.load_state=o.fp.PLAYABLE,this.inWaitingStart=0,this.waitStartTime=0,window.clearTimeout(this.stallIntervalId),this.stallIntervalId=null}}},{key:"suspendSeekStatus",value:function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!!this.isSeeking){var a=this.seekLog,r=this.resLogs,i=this.player,s=(0,n.je)()-a.lastSeekStartTime;(0,n.cM)("suspendSeekStatus>>","".concat(e," currentTime:").concat(i.currentTime," costTime:").concat(s," sat:").concat(a.sat," resLogs.sat:").concat(r.sat)),a.intervalId&&window.clearTimeout(a.intervalId),a.intervalId=null,this.isSeeking=!1;var l=this._endType="seek",c=a.seekBefore,u=(i.currentTime||0).toString();a.sc++,a.sat+=s>o.YL?0:s,r.sc++,r.sat+=s>o.YL?0:s,s>o.YL&&(s=o.YL),this.updateSeekPt(!0),!this.closeSeekLog&&t&&this.onOneOperator({costTime:s,operaType:l,stateBefore:c,stateAfter:u,endType:e})}}},{key:"setPt",value:function(){var e=this.playlogs;this.startStep=1,!e.pt&&this.player.currentTime&&(this.isSeeking=!0),!e.pt&&(e.pt=(0,n.L8)(),(0,n.cM)("setPt","init pt :".concat(e.pt,", document.visibilityState:").concat(document.visibilityState)))}},{key:"setVt",value:function(){var e=this.playlogs;1===this.startStep&&(!e.vt&&(e.vt=(0,n.L8)(),(0,n.cM)("setVt: first frame inited","vt-pt:".concat(e.vt-e.pt," vt-nt:").concat(e.vt-e.nt))),this.startStep=2)}},{key:"setBr",value:function(e){var t=this.playlogs;t.vt>0&&(0===t.br&&(t.fbrt=e||""),t.br++)}},{key:"codecType",get:function(){var e=this.player;return e&&e.config&&e.config.codecType?e.config.codecType:this._options.codec_type||"h264"}},{key:"url",get:function(){var e=this.player;return e&&e.config?e.config.url:""}},{key:"vid",get:function(){var e=this.player;return e&&e.config?e.config.vid:""}},{key:"bc",get:function(){return this.playlogs.bc}},{key:"bu_acu_t",get:function(){var e=this.playlogs.bu_acu_t;return e>o.bB?0:e}},{key:"pt",get:function(){return this.playlogs.pt||(0,n.L8)()}},{key:"vt",get:function(){var e=this.playlogs,t=e.vt;return e.pt>0?t:0}},{key:"fvt",get:function(){var e=this.playlogs,t=e.vt,a=e.pt,r=0;return t>0&&a>0&&(r=parseInt(t-a,10)),r>o.T3?o.T3:r}},{key:"nvt",get:function(){var e=this.playlogs,t=e.vt,a=e.nt;return t>0&&a>0?parseInt(t-a,10):0}},{key:"getFrameInfo",value:function(){if(!this.player||!this.player.videoFrameInfo)return{f_total:0,drop_count:0,drop_rate:0,corrupted:0};var e=this.player.videoFrameInfo,t=e.dropped,a=e.corrupted,r=e.droppedRate;return{f_total:e.total,drop_count:t,drop_rate:r,corrupted:a}}},{key:"vd",get:function(){var e=this.player;return e.duration&&"number"==typeof e.duration&&e.duration>0?parseInt(1e3*e.duration,10):e.config.duration&&"number"==typeof e.config.duration?parseInt(1e3*e.config.duration,10):0}},{key:"cur_play_pos",get:function(){return parseInt(1e3*this.player.currentTime,10)}},{key:"volume",get:function(){return this.player.volume}},{key:"buffer_time",get:function(){var e=0;try{var t=this.player.getBufferedRange();e=t[1]-t[0]}catch(t){e=0}return e}},{key:"player_created_t",get:function(){return this._playerCreatedTime}},{key:"playbackRate",get:function(){return this.player.playbackRate}},{key:"mute",get:function(){return this.player.muted?0:1}},{key:"videoWidth",get:function(){var e=this.player;return e&&e.video?e.video.videoWidth:0}},{key:"videoHeight",get:function(){var e=this.player;return e&&e.video?e.video.videoHeight:0}},{key:"preload",get:function(){var e=this.player;return!!e&&!!e.video&&e.video.preload}},{key:"initial_url",get:function(){var e=this.player.currentSrc;return e.indexOf("blob:")>-1&&this.urlLog.initial_url?this.urlLog.initial_url:(0,n.LM)(e)?"":e}},{key:"initial_host",get:function(){var e=this.player.currentSrc;return e.indexOf("blob:")>-1&&this.urlLog.initial_host?this.urlLog.initial_host:(0,n._P)((0,n.LM)(e)?"":e)}},{key:"curHeaders",get:function(){var e=this.player,t=this.task;if(e&&e.__dash__&&e.__dash__.curReqVideoSegInfo){var a=e.__dash__.curReqVideoSegInfo.headers||{};return(0,n.xV)(a)}return t?t.headers:{}}},{key:"curStatus",get:function(){var e=this.task,t=this.vtype,a=this.netLog;return t.indexOf("MP4")>-1?e?e.status:0:a.status}},{key:"play_type",get:function(){return 0}},{key:"resolution",get:function(){var e=this.player.curDefinition;return e?"".concat(e.definition):this.resLogs.df}},{key:"sessionId",get:function(){return this._sessionId}},{key:"finish",get:function(){return this.isEnded?1:0}},{key:"end_type",get:function(){return this._endType}},{key:"avgSpeed",get:function(){return this.player&&this.player.avgSpeed?this.player.avgSpeed:0}},{key:"realSpeed",get:function(){return this.player&&this.player.realTimeSpeed?this.player.realTimeSpeed:0}},{key:"mp4MseOpLength",get:function(){if(!this.player||!this.player.plugins)return -1;var e=this.player.plugins.mp4encryptplayer;return e?e.opQueueLen||0:-1}},{key:"mp4LoadSegmentTimeRange",get:function(){if(!this.player||!this.player.plugins)return"";var e=this.player.plugins.mp4encryptplayer;return e?e.loadSegmentTimeRange.join(","):""}},{key:"preLoadData",get:function(){if(!this.player||!this.player.plugins)return[];var e=this.player.plugins.mp4encryptplayer;if(e&&e.preLoadData)return{hit:1,duration:e.preLoadData.duration,length:e.preLoadData.byteLength};var t=this.player.stat||{};if(t.preLoadData){var a=t.preLoadData.length;return{hit:a>0,length:a}}return{hit:0,duration:0,length:0}}},{key:"preloadState",get:function(){if(!this.player||!this.player.plugins)return 0;if(void 0!==this.player.preloadState)return this.player.preloadState||0;var e=this.player.plugins.mp4encryptplayer;return e&&e.preloadState?e.preloadState:0}},{key:"curBitrate",get:function(){var e=this.player,t=e.config,a=e.curDefinition;return a&&a.bitrate?a.bitrate:t.defaultBitrate?t.defaultBitrate:0}},{key:"videoReadyState",get:function(){var e=this.player;return e&&e.video?e.video.readyState:-1}},{key:"videoSeeking",get:function(){var e=this.player;return e&&e.video&&e.video.seeking?1:0}},{key:"videoPaused",get:function(){var e=this.player;return e&&e.video&&e.video.paused?1:0}},{key:"switchResolutionCount",get:function(){return this.resLogs.switch_count}},{key:"isError",get:function(){return this.player._isError||this.player.video.error}},{key:"isPlaying",get:function(){return(0,n.pv)(this.player.root,"xgplayer-playing")}},{key:"isStop",get:function(){return(0,n.pv)(this.player.root,"xgplayer-ended")||(0,n.pv)(this.player.root,"xgplayer-nostart")}},{key:"isPause",get:function(){return(0,n.pv)(this.player.root,"xgplayer-pause")}},{key:"isLoading",get:function(){return(0,n.pv)(this.player.root,"xgplayer-isloading")}},{key:"es",get:function(){return this.isPlaying?"playing":"beforePlay"}},{key:"lt",get:function(){var e=0;return 0===this.vt&&((0,n.cM)("lt init",this.playlogs.lt),e=(0,n.L8)()),e}},{key:"lpt",get:function(){return this.lt?this.lt-this.pt:0}},{key:"playback_state",get:function(){return this.isError?o.kU.ERROR:this.isStop?o.kU.STOP:this.isPause?o.kU.PAUSE:this.isLoading?o.kU.LOADING:o.kU.PLAYING}},{key:"is_start_play_automatically",get:function(){return"".concat(this.isAutoplay)}},{key:"watchDur",get:function(){var e=this.player,t=this.playlogs,a=e.cumulateTime?e.cumulateTime:(0,n.uV)(t.played);return a>=0?a>o.bB?o.bB:a:0}},{key:"vtype",get:function(){if(this.__vtype)return this.__vtype;var e=this.player?this.player.vtype||this.player.config.vtype:"";return e||(this.player.dash?"DASH":this._options.vtype||"MP4")},set:function(e){this.__vtype=e}},{key:"envInfo",get:function(){return this._envInfo},set:function(e){if(!!e)this._envInfo=e}},{key:"getPlayerExt",value:function(){var e=this.player.ext;if(e)return e}},{key:"watingCost",get:function(){if(!(this.inWaitingStart>0))return 0;var e=(0,n.je)()-this.inWaitingStart;return e>o.YL?0:e}},{key:"videoNetworkState",get:function(){var e=this.player;return e&&e.video?e.video.networkState:-1}},{key:"eagleid",get:function(){var e=this.player;return e&&e.__dash__&&e.__dash__.curReqVideoSegInfo?(e.__dash__.curReqVideoSegInfo.headers||{}).eagleid:""}},{key:"initial_type",get:function(){var e=this.player.config||{};return e&&e.vodLogOpts&&void 0!==e.vodLogOpts.currentDashType?parseInt(e.vodLogOpts.currentDashType,10):-1}},{key:"dynamicType",get:function(){var e=this.player;return this.__dt?this.__dt:e&&e.__dash__&&e.__dash__.dash&&e.__dash__.dash.mpd?(this.__dt=e.__dash__.dash.mpd.dashType,this.__dt):""}},{key:"updateBuffers",value:function(){var e=this.player.buffered,t=[];if(!e||e.length<1){this.buffers.allBuffer=[];return}for(var a=0;a<e.length;a++){var r=parseInt(1e3*e.start(a),10),n=parseInt(1e3*e.end(a),10);t.push({s:r,e:n})}this.buffers.allBuffer=t}},{key:"updateCurBuffer",value:function(e){var t=this.player,a=t.buffered,r=t.currentTime,n={buf_s_pos:0,buf_e_pos:0,buf_include:0,buf_diff:0};if(!a||a.length<1)return n;for(var i=-1,o=-1,s=parseInt(1e3*r,10),l=a.length-1;l>-1;l--){var c=parseInt(1e3*a.start(l),10),u=parseInt(1e3*a.end(l),10);if(s>=c&&s<=u){n.buf_include=1,n.buf_s_pos=c,n.buf_e_pos=u,n.buf_diff=u-s;break}s<c&&(i<0||c-s<i)?(i=c-s,o=l):s>u&&(i<0||s-u<i)&&(i=s-u,o=l)}1!==n.buf_include&&(o<0&&(o=a.length-1),n.buf_s_pos=parseInt(1e3*a.start(o),10),n.buf_e_pos=parseInt(1e3*a.end(o),10)),this.buffers.curBuffer=n}},{key:"checkInBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=this.player.buffered;if(!a)return!1;e=parseInt(1e3*e,10);for(var r=0;r<a.length;r++){var n=parseInt(1e3*a.start(r),10),i=parseInt(1e3*a.end(r),10)+t;if(e>n&&e<i)return!0}return!1}},{key:"getPCDNStat",value:function(){if(!this.player||!this.player.pcdnVVStat)return{};var e=this.player.pcdnVVStat,t=e.try_req_num,a=e.req_node_succ,n=e.conn_req_num,i=e.has_ret_node,o=e.conn_fail_num,s=e.conn_jump_num,l=(0,r.Kd)(e,h);return(0,r.Zj)({try_req:t,req_succ:a,has_ret:i,conn_req:n,conn_fail:o,conn_jump:s},l)}},{key:"updateVideoSize",value:function(){var e=this._options,t=this.player,a=this.resLogs,r=0,i=0;if(t.__dash__&&t.__dash__.dash&&t.__dash__.dash.mpd.mediaList){var o=t.__dash__.dash.mpd.mediaList.video,s=o[o.selectedIdx];(0,n.cM)("updateVideoSize》》videoItem",s),i=s?s.bitrate||s.bandwidth:0,r=s?s.size:0}else{var l=this.player.curDefinition;l?(i=l.bitrate||t.config.bitrate||0,r=parseInt(l.bitrate*t.duration/8,10)):(r=e.videoSize||t.config.videoSize||0,i=e.bitrate||t.config.bitrate||0)}(0,n.cM)("updateVideoSize","bitrate:".concat(i,", vs:").concat(r)),r&&(a.vs=r,a.vis=parseInt(r/t.duration,10),a.bitrate=i||a.vis)}},{key:"updateVds",value:function(){var e=this.resLogs,t=this.playlogs,a=this.player;if(0===e.vis){(0,n.cM)("updateVds","vis:".concat(e.vis));return}for(var r=parseInt((0,n.uV)(t.played)/1e3,10),i=a.buffered,o=0,s=0;s<i.length;s++)o+=parseInt(i.end(s)-i.start(s),10);(0,n.cM)("updateVds","pdur:".concat(r," bdur:").concat(o," \n         lbuf:").concat(e.lbuf," lplayed:").concat(e.lplayed," bitrate: ").concat(e.bitrate," vis:").concat(e.vis," vs:").concat(e.vs)),e.lplayed=r,e.lbuf=o}},{key:"encryptedInfo",get:function(){return this.player.encryptedInfo||{encryptedType:0}}}],[{key:"TEA_ID",get:function(){return f},set:function(e){f=e,g="__tea_cache_tokens_".concat(f)}},{key:"AB_SDK_VERSION",get:function(){return _},set:function(e){_="Array"===(0,n.kM)(e)?e.join(","):e}},{key:"Collector",set:function(e){v=e}},{key:"defaultConfig",value:function(){return{line_app_id:"",line_user_id:"",isTask:!1,codec_type:"",playerCoreVersion:"",playerVersion:"",start_time:0,maxQueueCount:5,channel:"cn",channelDomain:"",absdkVersion:"",checkByInnerLog:!0,drm_type:0,vtype:"MP4",tag:"普通视频",subtag:"",dynamic_type:"",sendLocalCallback:function(){},disableLocalCache:!1,closeResolutionLog:!1,closeSeekLog:!1,needXhrCheck:!1,trackerConfig:{},envInfo:{},enableTeaWebId:!1}}}]),e}()},24166:function(e,t,a){a.d(t,{Tw:function(){return k},Yx:function(){return x},_R:function(){return m},kL:function(){return y},oy:function(){return b}});var r=a(167846);a(514312),a(561999),a(831528),a(121621),a(904644),a(379493),a(577829),a(953722),a(410121),a(947478),a(864614),a(616414),a(812735),a(623302),a(983431),a(319386),a(657170),a(853127),a(644952),a(759149),a(949136),a(966922),a(33814),a(29536),a(716005),a(548485),a(260075),a(791017),a(743286),a(310378),a(124539),a(48498),a(728271),a(814647),a(535689),a(659673),a(224382),a(74370),a(533431),a(917128),a(621120),a(890568),a(494319),a(631666),a(542074),a(783858),a(677046),a(540865),a(794349),a(612222);var n=a(159322),i=a.n(n),o=a(742983),s=a(101132),l=a(317419),c=a(672898),u=a(264543),d=a(891097),h=a(935672),p=a(480514),f=a(857877),g=a(244694),_=a(183981),v=a(906399),y={ERROR:"error",META_READY:"metaReady",META_REQ_DONE:"meta_request_done",MOOV_REQ_PROGRESS:"moov_request_progress",TASK_PROGRESS:"progress_event",REMOVE_URL:"remove_url",FRAGMENT:"fragment",UPDATE_EME:"update_eme",INIT_MSE:"init_mse",CHANGE_URL:"change_url",UPDATE_LOAD_IDX:"update_load_fragmentIdx",REMOVE_PCDN_NODE:"remove_pcdn_node",LOAD_ERROR:"load_error",CANCEL_LOADED_LEN:"cancel_loaded_len"},m={CDN:"cdn",PCDN:"pcdn"},b={CLOSE:"close",OPEN:"open",FORBIDDEN:"forbidden"},k={},x=function(e){var t,a,n,i,x,L,S,T,I,P,R,C,O;function D(e,t,a,n){var i,l,c;return(0,r.PA)(this,D),l=(0,r.$w)(this,D),(0,r._x)(l,"markErrHost",function(e){e&&(k[e]=!0,l.log(s._.WARN,"[mp4loader markErrHost]",e))}),(0,r._x)(l,"onprogressDataArrive",(c=(0,r.x)((0,r.l5)().mark(function e(t,a,n,i){var o,c,d,h,g,_,b,k,x;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d=null===(o=n.priOptions)||void 0===o?void 0:o.range,h=(null===(c=n.priOptions)||void 0===c?void 0:c.type)||m.CDN,l.checkResPonse(i,n.priOptions)){e.next=7;break}return e.next=6,l.notVailRangeResError(i,n.priOptions,n.index);case 6:return e.abrupt("return");case 7:if(g=t&&t.byteLength>0,l.log(s._.LOG,"[DataArrive] rev data","index: ".concat(n.index,", range: ").concat(JSON.stringify(n.range),", dataLen: ").concat(null==t?void 0:t.byteLength),"loadType: ".concat(h,", state: ").concat(a)),!a){e.next=29;break}if(l._optionDataLenInfo[h]=0,!((null==d?void 0:d.length)>=0&&(!Number(d[1])||Number(d[1])&&(null==n?void 0:n.range[1])===d[1]+1))){e.next=17;break}l.adaptTimeRange[n.index].downloaded=!0,l.log(s._.LOG,"[FragLoadDowned],fragmentIdx,",n.index,",rangeEnd,",n.range[1]),e.next=29;break;case 17:return _=(0,f.xj)(i.headers),e.next=20,l.cancelLoading();case 20:if(b=h===m.CDN?l.url:l._pcdnNodeList[0].url,k=p.Z.getHostFromUrl(b),l.emit(y.LOAD_ERROR,{src:b,host:k,errorCode:u.O1.lenNotMatch,message:v.Z1,range:JSON.stringify(d),headers:_}),x=[null==n?void 0:n.range[1],d[1]],l.log(s._.LOG,"".concat(v.Z1),"fragmentIdx: ".concat(n.index),"rangeEnd: ".concat(n.range[1],", ").concat(JSON.stringify(d)),"headers: ".concat(JSON.stringify(_),", url: ").concat(b,", ").concat(null==i?void 0:i.url),"retryRange: ".concat(JSON.stringify(x))),!((null==n?void 0:n.range[1])<d[1]+1)){e.next=29;break}return l.startMux(t,h,n,a),e.next=29,l.loadAllFragmentData(l._curLoadSegIdx,l._loadSuccessCallBack,null,!1,x);case 29:g&&l.startMux(t,h,n,a);case 30:case"end":return e.stop()}},e)})),function(e,t,a,r){return c.apply(this,arguments)})),n=n||[],l.updateUrl(e,n||[]),l._bitRate=t||0,l.options=D.getDefaultConfig(),Object.keys(a).map(function(e){void 0!==a[e]&&null!==a[e]&&(l.options[e]=a[e])}),l.logger=a.logger,l.timeRange=[],l.adaptTimeRange=[],l.fileSize=null==a?void 0:a.fileSize,l.CHUNK_SIZE=(null===(i=l.options)||void 0===i?void 0:i.firstLoadSize)||(0,d.T)(a.duration,l.options.chunkSize,l.fileSize),l._firstLoadSize=l.CHUNK_SIZE,l.log(s._.LOG,"[getFirstLoadSize], firstLoadSize ".concat(l._firstLoadSize),"dur ".concat(a.duration,", chunkSize ").concat(l.CHUNK_SIZE,",fileSize ").concat(l.fileSize)),l.repeatInfo={startPos:-1,curDataPos:0,usedPos:0,data:p.Z.newUint8Array(1048576)},l.meta=null,l.preloadCache=null,l.videoTrak=null,l.audioTrak=null,l._loadSuccessCallBack=null,l._isPending=!1,l.metaLoading=!1,l.MP4Loader=new o.b((0,r.Zj)((0,r.Zj)({url:e,vid:"".concat(a.vid,"-").concat(t),retry:a.retryCount,retryDelay:a.retryDelay,timeout:a.timeout,segmentDuration:a.segmentDuration,audioGroupingStrategy:a.audioGroupingStrategy,fixEditListOffset:a.fixEditListOffset,fixEditListOffsetThreshold:a.fixEditListOffsetThreshold},a.reqOptions),{},{memoryOpt:a.memoryOpt,loaderType:a.loaderType,retryCheckFunc:a.loadRangeType===v.TJ.SIZE?h.mH:h.Wp,openLog:g.i5,processMaxGapTime:a.processMaxGapTime})),l.MP4Demuxer=null,l.FMP4Remuxer=null,l._needInitSegment=!0,l._bitRateInfoMap=new Map,l._switchBitRate=!1,l._segmentToBitRateMap=new Map,l.useEME=!1,l.secretKey=null,l.decryptKey=null,l.keyValue=null,l.initTransMuxWorker(),l.seekTime=-1,l.changeBitRateTime=-1,l._PCDNState=b.CLOSE,l._pcdnNodeList=[],l.loadInfo={},l.pcdnTraceInfo=null,l._loadedDataState=!1,l._PCDNSwitchCnt=0,l._isUseCDN=!0,l._curLoadSegIdx=0,l._receiveDataPos=-1,l._optionDataLenInfo={},l._lastPCDNUrl="",l.lastTargetDur=0,l.pcdnVVStat=l.resetPcdnVVStat(),l.pSCCancelCnt=0,l.lastDemuxSampleIdxRange={video:-1,audio:-1},l._mediaEndTime=-1,l.lastMuxRemainBufferInfo=null,l}return(0,r.XW)(D,e),(0,r.qH)(D,[{key:"size",get:function(){return this.fileSize}},{key:"bufferTimeFuncCallBack",set:function(e){this.getbufferTimeFunc=e}},{key:"fillFirSeg",set:function(e){this.fillFirstSegment=e}},{key:"setLastMuxRemainBufferInfo",value:function(e,t){this.lastMuxRemainBufferInfo={data:e,pos:t}}},{key:"initTransMuxWorker",value:function(){var e=this,t=this.options;if(this.enableWorker=t.enableWorker&&("h265"!==t.codecType||t.supportHevc),this.enableWorker&&"undefined"!=typeof Worker){try{this.workerSequence=0,this.transmuxerWorkerControl=new _.Z({id:this.workerSequence,codecType:t.codecType,supportHevc:this.options.supportHevc,openLog:g.i5,memoryOpt:t.memoryOpt}),this.transmuxerWorkerControl.on("transmux",function(t){var a=t.args,r=a.context;e.log(s._.LOG,"[transmuxerWorker end], range: ".concat(JSON.stringify(a.range)),"dataLen: ".concat(a.buffer.byteLength),JSON.stringify(a.context)),e.updateDemuxSampleIdxRange(null==r?void 0:r.videoSampleIdxRange,null==r?void 0:r.audioSampleIdxRange),e._loadSuccessCallBack&&e._loadSuccessCallBack(a)})}catch(e){this.log(s._.ERROR,"Error in worker:",e),this.enableWorker=!1,this.transmuxerWorkerControl=null}!this.enableWorker&&(this.MP4Demuxer=null,this.FMP4Remuxer=null)}}},{key:"updateSecretKey",value:function(e,t,a,r){var n;this.useEME=e,!e&&t?(this.log(s._.LOG,"[updateSecretKey] ,force enableWorker"),this.options.enableWorker=!0,!this.transmuxerWorkerControl&&this.initTransMuxWorker()):!e&&r&&(this.keyValue=r),this.log(s._.LOG,"[updateSecretKey] ,useEME, ",e,",secretKey,",t,",decryptKey",a),null===(n=this.transmuxerWorkerControl)||void 0===n||n.updateValue({secretKey:t,decryptKey:a})}},{key:"updateLoadedDataDone",value:function(){this._loadedDataState=!0}},{key:"PCDNSwitchCnt",get:function(){return this._PCDNSwitchCnt}},{key:"updateLoadInfo",value:function(e,t){!this.loadInfo&&(this.loadInfo={}),!this.loadInfo[e]&&(this.loadInfo[e]={},this.loadInfo[e].loadLen=0),this.loadInfo[e].loadLen+=t}},{key:"updatePCDNState",value:(t=(0,r.x)((0,r.l5)().mark(function e(t){var a,n,i;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._PCDNState!==b.FORBIDDEN&&this._PCDNState!==t&&this.log(s._.LOG,"[pcdn state update]",this._PCDNState," - ",t),t!==b.FORBIDDEN){e.next=5;break}this._PCDNState=t,e.next=25;break;case 5:if(!(this._PCDNState!==b.FORBIDDEN&&this._PCDNState!==t)){e.next=25;break}if(!(!this._isUseCDN&&t===b.CLOSE)){e.next=23;break}if(this._PCDNState=t,!(this.adaptTimeRange[this._curLoadSegIdx].downloaded||this._switchBitRate)){e.next=11;break}return this.log(s._.LOG,"[pcdn] switch cdn ",this._curLoadSegIdx,"downloaded",",switchBitRate, ",this._switchBitRate),e.abrupt("return");case 11:return e.next=13,this.cancelLoading();case 13:return this.pSCCancelCnt++,a=this._curLoadSegIdx,this.log(s._.LOG,"[pcdn] cancelLoading ",a,"switch cdn load"),n=this.getFragRange(a),this._receiveDataPos&&this._receiveDataPos>=n[0]&&this._receiveDataPos<=n[1]&&(i=[this._receiveDataPos,n[1]],this.log(s._.LOG,"[pcdn] switch cdn, adjust range",a,JSON.stringify(i),",oldRange,","".concat(n[0]," - ").concat(n[1]))),this._receiveDataPos=-1,e.next=21,this.startLoad(i||n,a);case 21:e.next=24;break;case 23:this._PCDNState=t;case 24:this.log(s._.LOG,"[pcdn] openPCDN ",t);case 25:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"updateNode",value:function(e){if(e&&e.length>0){var t=e.filter(function(e){if(!Object.prototype.hasOwnProperty.call(k,p.Z.getHostFromUrl(null==e?void 0:e.url)))return e});this._pcdnNodeList=t}}},{key:"clearPCDNNodeList",value:function(){this.log(s._.LOG,"[pcdn] clearPCDNNodeList"),this._pcdnNodeList=[]}},{key:"isUpdateNode",get:function(){return!this._pcdnNodeList||!this._pcdnNodeList.length}},{key:"isUsePCDN",value:function(){var e;return this._PCDNState===b.OPEN&&(null===(e=this._pcdnNodeList)||void 0===e?void 0:e.length)>0}},{key:"readyToChangeBitrate",value:function(e){this._switchBitRate=!0,this.changeBitrateInfo=e}},{key:"changeBitRate",value:(a=(0,r.x)((0,r.l5)().mark(function e(){var t;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.changeBitrateInfo).bitrate!==this._bitRate)){e.next=11;break}return this.updateUrl(t._mainURL,t._backupURL),this._bitRate=t.bitrate,this._receiveDataPos=-1,e.next=7,this.MP4Loader.changeUrl(this.url,"".concat(this.options.vid,"-").concat(this._bitRate),this.CHUNK_SIZE);case 7:this._pcdnNodeList=null,this.emit(y.CHANGE_URL,this.url),this._mediaEndTime=-1,this.log(s._.LOG,"[switchBitrate] changeUrl, bitRate,",this._bitRate,"url",this.url);case 11:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"_getByPreload",value:function(e,t,a,r){try{if(e&&e.byteLength>=t){var n={endTime:new Date().getTime(),startTime:new Date().getTime(),index:r,range:[],vid:this.options.vid,from:"local"};if(a<=e.byteLength){var i=e.slice(t,a);return n.range=[t,a],n.state=!0,{buffer:i,context:n,state:!0}}var o=e.byteLength-1,s=e.slice(t,o);return n.range=[t,o],{context:n,buffer:s,state:!1}}return null}catch(e){return null}}},{key:"log",value:function(e,t){for(var a=this.options,r=a&&a.vid?"[MP4]".concat(this.logTag," ").concat(a.vid," ").concat(t):"[MP4]".concat(this.logTag," ").concat(t),n=arguments.length,i=Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];g.cM.apply(void 0,[this.logger,e,r].concat(i))}},{key:"errorHandler",value:(n=(0,r.x)((0,r.l5)().mark(function e(t,a){var n,i,o,l,c,d,h,p,f,g,_,v,m,b=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=b.length>2&&void 0!==b[2]?b[2]:{},i=t.response,o=t.message,l=t.headers,c=this.options?this.options.vid:"",d=null,this._isPending=!0,!i){e.next=38;break}if(d=new u.oO("network",i.status,{httpText:i.httpText,message:o,url:i.url,range:n.range,headers:l}),this.log(s._.LOG,"[MP4] [".concat(c,"] errorHandler error state:[").concat(a,"],\n          _isPending:[").concat(this._isPending,"] "),null==i?void 0:i.status,o),!(1e3*(f=null===(h=this.getbufferTimeFunc)||void 0===h?void 0:h.call(this))>=this.options.timeout||(null===(p=this.backUrl)||void 0===p?void 0:p.length)>0)){e.next=32;break}if(!((null===(_=this.backUrl)||void 0===_?void 0:_.length)>0)){e.next=19;break}return g=this.backUrl.shift(),e.next=14,this.updateUrl(g,this.backUrl);case 14:if(this._isPending=!1,!this.MP4Loader){e.next=19;break}return e.next=18,this.MP4Loader.changeUrl(this.url,"".concat(this.url,"-").concat(this._bitRate),this.CHUNK_SIZE);case 18:this.emit(y.CHANGE_URL,this.url);case 19:if(this._isPending=!1,this.log(s._.LOG,"[".concat(c,"] errorHandler retry,backUrlLen:").concat(this.backUrl.length,", buffer:").concat(f,",").concat(g)),this.emit(y.TASK_PROGRESS,{type:"error",error:t}),"getMetaInfo"!==a){e.next=27;break}return this.getMetaInfo(),e.abrupt("return");case 27:if("loadFragment"!==a){e.next=32;break}if(v=n.fragIndex,m=n.range,!(null!==v&&v>=0&&m)){e.next=32;break}return this.startLoad(m,v),e.abrupt("return");case 32:d.context=n,d.response=i,this.log(s._.LOG,"errorHandler end, ".concat(JSON.stringify(n))),this.emit(y.ERROR,d,a),e.next=42;break;case 38:this.log(s._.LOG,"errorHandler other end, ".concat(a,",").concat(null==i?void 0:i.status,", ").concat(o)),(d=t).context=n,this.emit(y.ERROR,d,a);case 42:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"init",value:(i=(0,r.x)((0,r.l5)().mark(function e(t){var a,n,i,o,l,c,u,d,h,f,g,_,m,b,k,x,L;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t&&(t={}),!(this.options.loadRangeType===v.TJ.SIZE&&this.MP4Loader.url!==this.url)){e.next=4;break}return e.next=4,this.MP4Loader.changeUrl(this.url,"".concat(this.options.vid,"-").concat(this._bitRate),this.CHUNK_SIZE);case 4:if(this.emit(y.CHANGE_URL,this.url),this.meta=null,n=(a=t).meta,i=a.mediaSegList,o=a.buffer,l=a.fileSize,c=a.initSeg,u=a.bitrate,d=a.adaptTimeRange,h=a.repeatData,f=a.repeatDataStartPos,g=a.generateBy,!(n&&n.ext)){e.next=24;break}for(l&&(this.fileSize=l),this.meta=n,this.videoTrak=n.ext.videoTrak,this.audioTrak=n.ext.audioTrak,this._bitRate=u,this.timeRange=this.getTimeRange(),this.adaptTimeRange=p.Z.ArrayCopy(d),i?(this.preloadCache={segList:i||[],initSeg:c},(null===(_=this.adaptTimeRange)||void 0===_?void 0:_.length)>0&&(null==h?void 0:h.byteLength)>0&&this.cacheRepeatData(this.adaptTimeRange[0].repeatRange,this.adaptTimeRange[0].repeatRange,h),f>0&&(null==h?void 0:h.byteLength)>0&&(this.lastMuxRemainBufferInfo={data:h,pos:f})):o&&(null===(m=this.adaptTimeRange)||void 0===m?void 0:m.length)>0&&(null==o?void 0:o.byteLength)>0&&this.cacheRepeatData(this.adaptTimeRange[0].range,this.adaptTimeRange[0].range,o),"preloader"!==g&&(this.adaptTimeRange.map(function(e){e.downloaded=!1,e.isLoading=!1}),this.log(s._.LOG,"[mp4.init] reset adaptTimeRange")),b=0;b<(null===(k=this.adaptTimeRange)||void 0===k?void 0:k.length);b++)null===(x=this.updateTimeRangeInAdaptTimeRangeIdx)||void 0===x||x.call(this,this.adaptTimeRange[b].timeRangeIdx,b);L={meta:n,videoSegments:n.ext.videoTrak,audioSegments:n.ext.audioTrak,bufferLoaded:o||null},this.log(s._.LOG,"preloadCache init done, emit meta ready"),this._bitRateInfoMap.set(this._bitRate,L),this.emit(y.META_READY,this.meta,this),e.next=26;break;case 24:return e.next=26,this.getMetaInfo();case 26:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"getTimeRange",value:function(){for(var e,t=[],a=null,r=0;this.videoTrak&&r<this.videoTrak.length;r++){var n=this.videoTrak[r].startTime,i=this.videoTrak[r].endTime;a={startTime:n,endTime:i,duration:i-n,downloaded:!1,isLoading:!1},t.push(a)}if(this.audioTrak&&this.audioTrak.length>t.length)for(var o=t.length;o<this.audioTrak.length;o++){var s=Math.max(this.audioTrak[o].startTime,a?a.endTime:0),l=Math.max(this.audioTrak[o].endTime,a?a.endTime:0);a={startTime:s,endTime:l,duration:l-s,downloaded:!1,isLoading:!1},t.push(a)}return null!==(e=this.options)&&void 0!==e&&e.emitMediaListControl&&this._emitMediaList(t),t}},{key:"_emitMediaList",value:function(e){if(!!this.videoTrak||!!this.audioTrak){for(var t=[],a=0;a<e.length;a++){var n=e[a].startTime,i=this.getFragmentIdx(n),o=p.Z.getFragRange(i,this.videoTrak,this.audioTrak);t.push((0,r.Zj)((0,r.Zj)({},e[a]),{},{range:o,url:this._addRangeToUrl(this.url,o)}))}this.emit(v.fD.MEDIA_LIST,t)}}},{key:"_addRangeToUrl",value:function(e,t){return this.options.isAddRange?p.Z.extUrl(e,{range:"".concat(t[0],"-").concat(t[1])}):e}},{key:"getMetaInfo",value:(x=(0,r.x)((0,r.l5)().mark(function e(){var t=this,a,n,i,o,l=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(l.length>0)||void 0===l[0]||l[0],e.prev=1,n=-1,this.metaLoading=!0,this.log(s._.LOG,"getMetaInfo start, bitRate: ".concat(this._bitRate,", firstLoadSize: ").concat(this._firstLoadSize),"url: ".concat(this.MP4Loader.url)),this.resetRepeatInfo(),i=function(){var e=(0,r.x)((0,r.l5)().mark(function e(i,o,l,c,d){var h,g,_,v,b,k,x;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=6;break}return e.next=3,t.cancelLoading();case 3:return g=new u.zO(u.iR.DEMUX,u.O1.metaError,{msg:JSON.stringify(c)}),t.errorHandler(g,"getMetaInfo",{range:[0,t._firstLoadSize]}),e.abrupt("return");case 6:_=(null==l||null===(h=l.priOptions)||void 0===h?void 0:h.type)||m.CDN,i&&(null!==(v=t.options)&&void 0!==v&&v.memoryOpt?n>0?(t.partCacheRepeatData(n),t.cacheRepeatData([n,t._firstLoadSize],l.range,i)):(t.resetRepeatInfo(),t.cacheRepeatData(l.range,l.range,i)):t.cacheRepeatData([0,t._firstLoadSize],l.range,i),t._optionDataLenInfo[_]||(t._optionDataLenInfo[_]=0),t._optionDataLenInfo[_]+=i.byteLength),l.meta&&!t.meta&&(k=l.meta,t.videoTrak=k.videoSegments,t.audioTrak=k.audioSegments,null!==(b=t.options)&&void 0!==b&&b.memoryOpt&&(n=p.Z.getFirstFrameStartRange(t.videoTrak,t.audioTrak)),t.fileSize=Number((0,f.Xz)(d.headers)),!t.fileSize&&(t.fileSize=p.Z.getEndFramePos(t.videoTrak,t.audioTrak)),t.log(s._.LOG," getFirstFrameStartRange ".concat(n)),t.timeRange=t.getTimeRange(),t.meta=(0,r.Zj)((0,r.Zj)({},k.meta),{},{ext:{videoTrak:t.videoTrak,audioTrak:t.audioTrak},fileSize:t.fileSize}),t._bitRateInfoMap.set(t._bitRate,(0,r.Zj)((0,r.Zj)({},k),{},{fileSize:t.fileSize})),t.log(s._.LOG,"meta reach, bitRate,",t._bitRate,t.repeatInfo.curDataPos),a&&t.emit(y.META_READY,t.meta,t)),t.meta&&o&&(t.log(s._.LOG,"[getMetaInfo req end]",t.repeatInfo.curDataPos),t.metaLoading=!1),o&&(t._optionDataLenInfo[_]&&(t._optionDataLenInfo[_]=0),t.emit(y.META_REQ_DONE,t)),t._loadedDataState?(x=!1,t.repeatInfo.curDataPos-t.repeatInfo.usedPos>=t.options.afterLoadeddataCallBackLen&&(x=!0),t.meta&&(x||o)&&(t.log(s._.LOG,"emit moov_req_progress loadeddata after",JSON.stringify(l.range)),t.emit(y.MOOV_REQ_PROGRESS))):t.meta&&(i||o)&&(t.log(s._.LOG,"emit moov_req_progress loadeddata before",JSON.stringify(l.range)),t.emit(y.MOOV_REQ_PROGRESS));case 12:case"end":return e.stop()}},e)}));return function(t,a,r,n,i){return e.apply(this,arguments)}}(),e.next=9,this.MP4Loader.loadMetaProcess(this.MP4Loader.cache,[0,this._firstLoadSize],i);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),this.log(s._.ERROR,"[MP4] trigger errorHandler getMetaInfo",null===e.t0||void 0===e.t0||null===(o=e.t0.response)||void 0===o?void 0:o.status,null===e.t0||void 0===e.t0?void 0:e.t0.message),this.loadError(e.t0,"getMetaInfo",!1,{url:e.t0.url||this.url,range:[0,this._firstLoadSize]});case 15:case"end":return e.stop()}},e,this,[[1,11]])})),function(){return x.apply(this,arguments)})},{key:"getFragmentIdx",value:function(e){if(!this.videoTrak.length)return(a=this.audioTrak.find(function(t){return t.startTime<=e&&t.endTime>e}))?a.index:0;if(t=this.videoTrak.find(function(t){return t.startTime<=e&&t.endTime>e}),a=this.audioTrak.find(function(t){return t.startTime<=e&&t.endTime>e}),t&&a)return Math.min(t.index,a.index);if(t||a)return t?t.index:a.index;else{var t,a,r=Number.MAX_VALUE;return this.videoTrak&&this.videoTrak.length>0&&(r=this.videoTrak.length-1),this.audioTrak&&this.audioTrak.length>0&&(r=Math.min(this.audioTrak.length-1,r)),r}}},{key:"_checkHasMeta",value:(L=(0,r.x)((0,r.l5)().mark(function e(){var t,a,n,i,o,l,c,u;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._bitRateInfoMap.get(this._bitRate)){e.next=20;break}return this.log(s._.LOG,"[switchBitrate], need load InitSegment, bitRate, ",this._bitRate),this.metaLoading=!0,e.next=6,this.MP4Loader.loadMeta(this.MP4Loader.cache,Math.round(this.CHUNK_SIZE/2));case 6:n=e.sent,this.log(s._.LOG,"[switchBitrate], loadMeta end, ",this._bitRate),this.metaLoading=!1,i=Number((0,f.Xz)(null==n||null===(a=n.responses)||void 0===a||null===(a=a[0])||void 0===a||null===(a=a.response)||void 0===a?void 0:a.headers)),this.fileSize=i,o=n.videoSegments,l=n.audioSegments,!this.fileSize&&(this.fileSize=p.Z.getEndFramePos(o,l)),this.log(s._.LOG,"[switchBitrate], fileSize set , ",i),this.meta=(0,r.Zj)((0,r.Zj)({},n.meta),{},{ext:{videoTrak:o,audioTrak:l},fileSize:this.fileSize}),(t=n).fileSize=this.fileSize,this._bitRateInfoMap.set(this._bitRate,n),e.next=22;break;case 20:this.log(s._.LOG,"[switchBitrate], not need load InitSegment, bitRate, ",this._bitRate),this.meta=t.meta;case 22:for(this.videoTrak=t.videoSegments,this.audioTrak=t.audioSegments,this.fileSize=t.fileSize,this.emit(y.UPDATE_EME,this.meta),this.emit(y.INIT_MSE,this.meta),this.timeRange=this.getTimeRange(),c=0;c<this.adaptTimeRange.length;c++)null===(u=this.updateTimeRangeInAdaptTimeRangeIdx)||void 0===u||u.call(this,this.adaptTimeRange[c].timeRangeIdx,c);return this._firstLoadSize=0,e.abrupt("return",!0);case 31:case"end":return e.stop()}},e,this)})),function(){return L.apply(this,arguments)})},{key:"load",value:(S=(0,r.x)((0,r.l5)().mark(function e(t,a){var n,i,o,l,c,u,d,h,p,f,g;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loadSuccessCallBack=a,!(this._switchBitRate&&!this.metaLoading)){e.next=29;break}if(this.log(s._.LOG,"[switchBitrate], switch bitRate start load, bitRate,",this._bitRate,", fragIndex,",t),this.fillGopDataInfo){e.next=29;break}return this.log(s._.LOG,"[switchBitrate] changeBitrate~~"),e.next=7,this.changeBitRate();case 7:return e.next=9,this._checkHasMeta();case 9:if(n=e.sent,!(this.changeBitRateTime>0)){e.next=26;break}if(this.resetFragmentLoadState(t,!0),this.resetRepeatInfo(),this.resetDemuxSampleIdx(this.changeBitRateTime),i=this.getFragmentIdx(this.changeBitRateTime),o=t,!((t=this.getAdaptIdxBySrcIdx(i))<0)){e.next=20;break}return this.log(s._.ERROR,"[switchBitrate] start new bitrate fragIndex error"),e.abrupt("return");case 20:o!==t&&this.resetFragmentLoadState(t),this._curLoadSegIdx=t,this.log(s._.LOG,"[switchBitrate], need update load fragIndex: ".concat(t,"/").concat(o),"stTime: ".concat(this.changeBitRateTime),"adaptTimeRange: ".concat(this.adaptTimeRange[t].startTime,"-").concat(this.adaptTimeRange[t].endTime)),this.emit(y.UPDATE_LOAD_IDX,t),this.seekTime=this.changeBitRateTime,this.changeBitRateTime=-1;case 26:this._needInitSegment=!0,this.resetTransmuxer(),n&&(this._switchBitRate=!1);case 29:if(!(!this.fillGopDataInfo&&this._switchBitRate&&this.metaLoading)){e.next=31;break}return e.abrupt("return");case 31:l=this.getFragRange(t),(c=this.getFragmentFromCache(t,l))&&this._needInitSegment&&!c.initSeg&&(c=null,this.log(s._.LOG,"[mp4.load] fragIndex ".concat(t,", Data In Cache but not has init, so not use cacheData"))),(this.seekTime<0||this.options.loadRangeType===v.TJ.GOP)&&c?(d=(u=c.muxSampleIdxRange).video,h=u.audio,this.lastDemuxSampleIdxRange.video=d,this.lastDemuxSampleIdxRange.audio=h,this.log(s._.LOG,"[mp4.load] fragIndex: ".concat(t," Data In Cache"),"needInit: ".concat(this._needInitSegment,", muxSampleIdxRange: ").concat(JSON.stringify(c.muxSampleIdxRange)),JSON.stringify(l)),this.adaptTimeRange[t].downloaded=!0,this.adaptTimeRange[t].isLoading=!0,this._needInitSegment=!1,this._loadSuccessCallBack&&this._loadSuccessCallBack(c)):(p=[l[0],l[1]],this.fillGopDataInfo&&l[0]<this.fillGopDataInfo.endRange&&(l[1]=this.fillGopDataInfo.endRange,this.log(s._.LOG,"[switchBitrate] fillGopDataInfo fix load range ~~")),this.log(s._.LOG,"loadFragment ".concat(t),"bitRate: ".concat(this._bitRate,", range: ").concat(JSON.stringify(l)),"fillGopDataInfo: ".concat(JSON.stringify(this.fillGopDataInfo),", srcRange: ").concat(p)),this.seekTime>=0?(g=this.getSubRange(t,this.seekTime,l),null===(f=this.resetDemuxSampleIdx)||void 0===f||f.call(this,this.seekTime,g),this.repeatInfo.usedPos=0,this.loadFragment(t,g),this.repeatInfo.curDataPos=0,this.seekTime=-1):this.loadFragment(t,l));case 35:case"end":return e.stop()}},e,this)})),function(e,t){return S.apply(this,arguments)})},{key:"getFragmentFromCache",value:function(e,t){var a=this.preloadCache;if(!a||!a.segList)return null;for(var r=-1,n=a.segList,i=a.initSeg,o=0;o<n.length;o++)if(n[o].index===e){r=o;break}if(r<0)return null;var s=n[r];if(!(s.range[1]>=t[1]))return null;var l=[this.adaptTimeRange[e].startTime,this.adaptTimeRange[e].endTime];return{buffer:s.buffer,range:t,muxSampleIdxRange:s.muxSampleIdxRange,context:{range:t,fragIndex:e,state:!0,adaptTimeRange:[l[0],l[1]]},state:!0,initSeg:this._needInitSegment?i:void 0}}},{key:"notVailRangeResError",value:(T=(0,r.x)((0,r.l5)().mark(function e(t,a,n,i){var o;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return e.next=3,this.cancelLoading();case 3:o=(null==a?void 0:a.load_type)===m.PCDN,this.loadError({response:t,message:(null==t?void 0:t.status)!==206?"responseCode not 206":"datalen not match"},"loadFragment",o,{range:null==a?void 0:a.range,fragIndex:n});case 5:case"end":return e.stop()}},e,this)})),function(e,t,a,r){return T.apply(this,arguments)})},{key:"checkResPonse",value:function(e,t){if(e.hasCheck)return!0;e.hasCheck=!0;var a=t.range?t.range[1]-t.range[0]+1:-1,r=Number((0,f.He)(e.headers));return(null==e?void 0:e.status)===206&&(!(a>0)||!(r>0)||a===r)||(this.log(s._.LOG,"[DataArrive] response code, ".concat(e.status,",\n        contentLength: ").concat(r,",\n        reqLen: ").concat(a)),!1)}},{key:"startMux",value:function(e,t,a,r){if(!!(null!=e&&e.byteLength))this._optionDataLenInfo[t]||(this._optionDataLenInfo[t]=0),this._optionDataLenInfo[t]+=e.byteLength,this._receiveDataPos=null==a?void 0:a.range[1],this.cacheRepeatData(this.adaptTimeRange[a.index].repeatRange,a.range,e),this._mux(e,a.range[0],a.index,r)}},{key:"partCacheRepeatData",value:function(e){if(!this.repeatInfo)return;var t=this.repeatInfo,a=t.curDataPos,r=t.startPos,n=t.usedPos;if(!(a<=0)&&!(r>e)&&!(r+a<r)&&e!==r)this.log(s._.LOG,"[partCacheRepeatData bebore],startPos: ".concat(r),",usedPos: ".concat(this.repeatInfo.usedPos),"curDataPos: ".concat(a)),this.repeatInfo.data.set(this.repeatInfo.data.subarray(e-r,r+a),0),this.repeatInfo.usedPos=Math.max(r+n-e,0),this.repeatInfo.curDataPos=r+a-e,this.repeatInfo.startPos=e,this.log(s._.LOG,"[partCacheRepeatData after],startPos: ".concat(this.repeatInfo.startPos),",usedPos: ".concat(this.repeatInfo.usedPos),"curDataPos: ".concat(this.repeatInfo.curDataPos))}},{key:"cacheRepeatData",value:function(e,t,a){var r;if(!!e&&!!(null!=e&&e.length)&&!!(null!==(r=this.repeatInfo.data)&&void 0!==r&&r.byteLength)&&!this.options.disableRepeatRange){if(this.repeatInfo.startPos<0&&t[0]+a.byteLength>=e[0]&&t[0]+a.byteLength<=e[1]+1&&(this.repeatInfo.startPos=e[0]),this.repeatInfo.startPos>=0&&t[0]+a.byteLength>=e[0]&&t[0]+a.byteLength<=e[1]+1){var n=this.repeatInfo.startPos+this.repeatInfo.curDataPos-t[0];if(n<0)return;var i=a.subarray(n);if(this.repeatInfo.curDataPos+i.byteLength<this.repeatInfo.data.byteLength){try{this.repeatInfo.data.set(i,this.repeatInfo.curDataPos),this.repeatInfo.curDataPos+=i.byteLength}catch(e){}this.log(s._.LOG,"repeatInfo pos: ".concat(this.repeatInfo.startPos,"-").concat(this.repeatInfo.startPos+this.repeatInfo.curDataPos),"curAppendLen: ".concat(i.byteLength))}else try{var o=2*a.byteLength,l=Math.max(this.repeatInfo.data.byteLength+o,e[1]-e[0]+o),c=p.Z.newUint8Array(l);if(!c)return;c.set(this.repeatInfo.data.slice(0,this.repeatInfo.curDataPos),0),c.set(i,this.repeatInfo.curDataPos),this.repeatInfo.curDataPos+=i.byteLength,delete this.repeatInfo.data,this.repeatInfo.data=c,this.log(s._.LOG,"exp repeatInfo pos: ".concat(this.repeatInfo.startPos,", curDataPos: ").concat(this.repeatInfo.curDataPos,", capacity: ").concat(l))}catch(e){}}}}},{key:"_mux",value:function(e,t,a,n){var i=this.getSamplesRange(a,"video"),o=this.getSamplesRange(a,"audio");if(this.log(s._.LOG,"mux sampleRange src",JSON.stringify(i),JSON.stringify(o)),this.fillFirstSegment&&(i[1]=1/0,o[1]=1/0),this.fillFirstSegment&&n&&(this.fillFirstSegment=!1),this.fillGopDataInfo){this.log(s._.LOG,"mux sampleRange, fillGopDataInfo",JSON.stringify(this.fillGopDataInfo));var d=this.fillGopDataInfo,h=d.endVFrameIdx,f=d.endAFrameIdx;h>=0&&(null==i?void 0:i[1])>h&&(null==i?void 0:i[0])<=h&&i[1]&&(i[1]=h),f>=0&&(null==o?void 0:o[1])>f&&(null==o?void 0:o[0])<=f&&o[1]&&(o[1]=f)}this.log(s._.LOG,"mux sampleRange,",JSON.stringify(i),JSON.stringify(o));var _=[t,t+e.byteLength];if(this.transmuxerWorkerControl){var v,y,m={range:_,state:n,fragIndex:a};this.log(s._.LOG,"[transmuxerWorker start] range: ".concat(JSON.stringify(_)),",dataLen: ".concat(e.byteLength),m);var b=null!==(v=this.lastMuxRemainBufferInfo)&&void 0!==v&&v.data?new Uint8Array(this.lastMuxRemainBufferInfo.data):null,k=null===(y=this.lastMuxRemainBufferInfo)||void 0===y?void 0:y.pos;this.lastMuxRemainBufferInfo=null;var x=this.transmuxerWorkerHasTrak;!this.transmuxerWorkerHasTrak&&(this.transmuxerWorkerHasTrak=!0),this.transmuxerWorkerControl.transmux(this.workerSequence,e,t,i,o,this.meta.moov,this.useEME,this.secretKey,m,x?null:this.videoTrak,x?null:this.audioTrak,b,k)}else{var L=this.options.memoryOpt;try{!this.MP4Demuxer&&(this.MP4Demuxer=new l._(this.videoTrak,this.audioTrak,null,{openLog:g.i5,memoryOpt:L})),this.lastMuxRemainBufferInfo&&(this.MP4Demuxer.setLastRemainBufferInfo(this.lastMuxRemainBufferInfo.data,this.lastMuxRemainBufferInfo.pos),this.lastMuxRemainBufferInfo=null);var S,T,I,P,R=this.MP4Demuxer.demuxPart(e,t,i,o,this.meta.moov,this.useEME,this.keyValue);!this.FMP4Remuxer&&(!this.checkCodecH265()||this.options.supportHevc)&&(this.FMP4Remuxer=new c.N(this.MP4Demuxer.videoTrack,this.MP4Demuxer.audioTrack,{openLog:g.i5}));var C=R.videoTrack,O=R.audioTrack,D=R.lastRemainBufferInfo,w=null==C?void 0:C.samples,E=(null==w?void 0:w.length)>0?w[0].sampleOffset:-1,M=(null==w?void 0:w.length)>0?w[w.length-1].sampleOffset:-1,N=null==O?void 0:O.samples,A=(null==N?void 0:N.length)>0?N[0].sampleOffset:-1,B=(null==N?void 0:N.length)>0?N[N.length-1].sampleOffset:-1,j=this.meta.videoTimescale,U=(null==w?void 0:w.length)>0?w[0].dts/j:-1,Z=(null==w?void 0:w.length)>0?w[w.length-1].dts/j:-1,F=n||(null==N?void 0:N.length)>0?null==R||null===(S=R.audioTrack)||void 0===S?void 0:S.startPts:-1,V=n||(null==N?void 0:N.length)>0?null==R||null===(T=R.audioTrack)||void 0===T?void 0:T.endPts:-1;if(this.log(s._.LOG,"[mux] ".concat(a),",videoTimeRange: ".concat(U,"-").concat(Z),",videoSampleIdx: ".concat(E,"-").concat(M),",audioTimeRange: ".concat(F,"-").concat(V),",audioSampleIdx: ".concat(A,"-").concat(B),JSON.stringify(_),n),E>=0&&E!==(null==i?void 0:i[0])||A>=0&&A!==(null==o?void 0:o[0])){this.log(s._.LOG,"mux sample is not continue, so abandon");return}this.updateDemuxSampleIdxRange([E,M],[A,B]);var G=[Math.min.apply(Math,(0,r.u)([U,F].filter(function(e){return -1!==e}))),Math.max.apply(Math,(0,r.u)([Z,V].filter(function(e){return -1!==e})))];if(this.FMP4Remuxer){var H=this.FMP4Remuxer.remux(this._needInitSegment,{initMerge:!0,range:_});H.initSegment&&(this._needInitSegment=!1),P={buffer:p.Z.concatData(H.audioSegment,H.videoSegment),range:_,state:n,context:{range:_,fragIndex:a,timeRange:G},initSeg:H.initSegment,lastRemainBufferInfo:D,mp4:this}}else P={videoTrack:R.videoTrack,audioTrack:R.audioTrack,buffer:null,range:_,state:n,context:{range:_,fragIndex:a,timeRange:G},lastRemainBufferInfo:D,mp4:this};(null==_?void 0:_[1])>=(null===(I=this.fillGopDataInfo)||void 0===I?void 0:I.endRange)&&(this.fillGopDataInfo=null,this.log(s._.LOG,"clear fillGopDataInfo")),this._loadSuccessCallBack&&this._loadSuccessCallBack(P)}catch(r){var W=null==r?void 0:r.message;this.log(s._.ERROR,"mux err:",W);var z=new u.zO(u.iR.REMUX,u.O1.muxError,{msg:W});this.errorHandler(z,"mux",{fragIndex:a,range:[t,t+e.byteLength]})}}}},{key:"updateDemuxSampleIdxRange",value:function(e,t){(null==e?void 0:e[1])>=0&&(this.lastDemuxSampleIdxRange.video=e[1]),(null==t?void 0:t[1])>=0&&(this.lastDemuxSampleIdxRange.audio=t[1]),this.log(s._.LOG,"updateDemuxSampleIdxRange",JSON.stringify(this.lastDemuxSampleIdxRange))}},{key:"loadFragment",value:(I=(0,r.x)((0,r.l5)().mark(function e(t,a){var n,i,o,l,c,u,d,h,p,f,g,_,v,y,m,b;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._curLoadSegIdx=t,!(this._isPending||(null==a?void 0:a[1])===0||!this.adaptTimeRange[t]||this.adaptTimeRange[t].isLoading||(null==a?void 0:a.length)===0)){e.next=3;break}return e.abrupt("return");case 3:if(this.log(s._.LOG,"[MP4.loadFragment] fragIndex: ".concat(t),",range: ".concat(JSON.stringify(a),", len: ").concat(a[1]-a[0],","),"repeatInfo: ".concat(this.repeatInfo.startPos,"-").concat(this.repeatInfo.startPos+this.repeatInfo.curDataPos)),this._segmentToBitRateMap.set(t,this._bitRate),!(a.length>=2&&a[1]&&a[1]>0&&a[0]>=this.repeatInfo.startPos&&a[1]<this.repeatInfo.startPos+this.repeatInfo.curDataPos)){e.next=15;break}this.adaptTimeRange[t].isLoading=!0,n=Math.max(a[0],this.repeatInfo.startPos+this.repeatInfo.usedPos),i=new Uint8Array(this.repeatInfo.data.slice(n-this.repeatInfo.startPos,a[1]-this.repeatInfo.startPos+1)),this.log(s._.LOG,"[mp4.loadFragment] fragIndex: ".concat(t),"has all data: ".concat(n,", ").concat(a[1]),"repeatInfo: ".concat(this.repeatInfo.startPos,"-").concat(this.repeatInfo.startPos+this.repeatInfo.usedPos),"curDataPos: ".concat(this.repeatInfo.startPos+this.repeatInfo.curDataPos)),this.adaptTimeRange[t].downloaded=!0,this.metaLoading||0===this.repeatInfo.startPos?(this.repeatInfo.usedPos=0,this.log(s._.LOG,"[mp4.loadFragment] has all data set repeatInfo.usedPos = 0")):(o=this.adaptTimeRange[t].range[0]-this.repeatInfo.startPos,l=this.adaptTimeRange[t].range[1]+1-this.repeatInfo.startPos,c=new Uint8Array(this.repeatInfo.data.slice(o,l)),this.resetRepeatInfo(),this.cacheRepeatData(this.adaptTimeRange[t].repeatRange,this.adaptTimeRange[t].range,c)),this._mux(i,n,t,!0),e.next=42;break;case 15:if(!(a.length>=2&&a[0]&&a[0]>=this.repeatInfo.startPos&&a[0]<=this.repeatInfo.startPos+this.repeatInfo.curDataPos)){e.next=36;break}if(this.adaptTimeRange[t].isLoading){e.next=34;break}if(u=Math.max(a[0],this.repeatInfo.startPos+this.repeatInfo.usedPos),d=Math.min(a[1]+1,this.repeatInfo.startPos+this.repeatInfo.curDataPos),!((h=new Uint8Array(this.repeatInfo.data.slice(u-this.repeatInfo.startPos,d-this.repeatInfo.startPos))).byteLength>0)){e.next=26;break}return this.repeatInfo.usedPos=d-this.repeatInfo.startPos,this.log(s._.LOG,"[mp4.loadFragment] has part data: ",u,u+h.byteLength),this.log(s._.LOG,"[mp4.loadFragment] ","repeatInfo, pos: ".concat(this.repeatInfo.startPos,"-").concat(this.repeatInfo.startPos+this.repeatInfo.usedPos),",curDataPos: ".concat(this.repeatInfo.startPos+this.repeatInfo.curDataPos,", usedPos: ").concat(this.repeatInfo.usedPos)),this._mux(h,u,t,a[1]<=this.repeatInfo.startPos+this.repeatInfo.usedPos),e.abrupt("return");case 26:if(!(!this.metaLoading&&!this.adaptTimeRange[t].isLoading)){e.next=34;break}return this.log(s._.LOG,"[mp4.loadFragment] load part data >>> ",this.repeatInfo.startPos+this.repeatInfo.curDataPos,a[1]),this.adaptTimeRange[t].isLoading=!0,f=[this.repeatInfo.startPos+this.repeatInfo.usedPos,a[1]],(g=null===(p=this.adaptTimeRange[t])||void 0===p?void 0:p.repeatRange)&&g[0]<f[0]?(_=[this.adaptTimeRange[t].repeatRange[0],f[0]],y=(v=this.repeatInfo).startPos,m=v.curDataPos,b=v.data.slice(_[0]-y,m),this.resetRepeatInfo(),this.cacheRepeatData(this.adaptTimeRange[t].repeatRange,_,b)):this.resetRepeatInfo(),e.next=34,this.startLoad(f,t);case 34:e.next=42;break;case 36:if(!((!this.metaLoading||a[0]>this.repeatInfo.startPos)&&!this.adaptTimeRange[t].isLoading)){e.next=42;break}return this.adaptTimeRange[t].isLoading=!0,this.log(s._.LOG,"[mp4.loadFragment] ready to load all data ,fragIdx: ".concat(t,", range: ").concat(a)),this.resetRepeatInfo(),e.next=42,this.startLoad(a,t);case 42:case"end":return e.stop()}},e,this)})),function(e,t){return I.apply(this,arguments)})},{key:"resetRepeatInfo",value:function(){this.log(s._.LOG,", resetRepeatInfo"),this.repeatInfo.startPos=-1,this.repeatInfo.curDataPos=0,this.repeatInfo.usedPos=0}},{key:"setSwitchPCDNCallBack",value:function(e){this._switchPCDNCallBack=e}},{key:"updateChangeBitRateTime",value:function(e){this.changeBitRateTime=e}},{key:"startLoad",value:(P=(0,r.x)((0,r.l5)().mark(function e(t,a){var n,i,o,l,c,u,d,h,p,f,g=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=g.length>2&&void 0!==g[2]&&g[2],o=(i=this.selectedPCDN(n))||this.url,o=this._addRangeToUrl(o,t),this.log(s._.LOG,"[startLoad], ",a,JSON.stringify(t),o),e.prev=5,l={index:a,onProgress:this.onprogressDataArrive,onProcessMinLen:this.options.onProcessMinLen,url:o,priOptions:{type:i?m.PCDN:m.CDN,range:t}},i&&(l.headers={"X-Origin-Server-Host":this._domain}),e.next=10,this.MP4Loader.loadData(t,this.MP4Loader.cache,l);case 10:e.next=29;break;case 12:if(e.prev=12,e.t0=e.catch(5),u=(null===e.t0||void 0===e.t0||null===(c=e.t0.options)||void 0===c||null===(c=c.priOptions)||void 0===c?void 0:c.type)===m.PCDN||!!i,d=null,h=e.t0.url||(u?i:this.url),!u){e.next=27;break}return this.pcdnVVStat.conn_fail_num++,D.pcdn_download_failed_cnt++,d=this._pcdnNodeList.shift(),this.emit(y.REMOVE_PCDN_NODE,d),this.log(s._.ERROR,"pcdn load err, retry use cdn, fragIndex: ".concat(a),"range: ".concat(JSON.stringify(t),", err: ").concat(null===e.t0||void 0===e.t0?void 0:e.t0.message,", ").concat((null===e.t0||void 0===e.t0?void 0:e.t0.isTimeout)||(null===e.t0||void 0===e.t0||null===(p=e.t0.response)||void 0===p?void 0:p.status)),"url: ".concat(h)),e.next=25,this.startLoad(t,a,!0);case 25:e.next=28;break;case 27:this.log(s._.ERROR,"cdn load err, fragIndex: ".concat(a),"range: ".concat(JSON.stringify(t),", err: ").concat(null===e.t0||void 0===e.t0?void 0:e.t0.message,", ").concat((null===e.t0||void 0===e.t0?void 0:e.t0.isTimeout)||(null===e.t0||void 0===e.t0||null===(f=e.t0.response)||void 0===f?void 0:f.status)),"url: ".concat(h));case 28:this.loadError(e.t0,"loadFragment",u,{range:t,fragIndex:a,url:h});case 29:case"end":return e.stop()}},e,this,[[5,12]])})),function(e,t){return P.apply(this,arguments)})},{key:"loadError",value:function(e,t,a,r){e.response||(e.response={}),e.isTimeout?e.response.status=u.O1.timeout:!(null!=e&&null!==(n=e.response)&&void 0!==n&&n.status)&&(e.response.status=u.O1.networkError);var n,i,o,l=p.Z.getHostFromUrl(null==r?void 0:r.url);this.markErrHost(l);var c=e.response.headers?(0,f.xj)(e.response.headers):null;c&&(e.headers=c),this.log(s._.ERROR,"load err, headers: ".concat(JSON.stringify(c),",\n      errC: ").concat(null==e||null===(i=e.response)||void 0===i?void 0:i.status,",\n      errM: ").concat(null==e?void 0:e.message)),this.emit(y.LOAD_ERROR,{src:null==r?void 0:r.url,host:l,errorCode:null==e||null===(o=e.response)||void 0===o?void 0:o.status,message:null==e?void 0:e.message,range:(null==r?void 0:r.range)&&JSON.stringify(r.range),headers:c}),!a&&this.errorHandler(e,t,r)}},{key:"loadAllFragmentData",value:(R=(0,r.x)((0,r.l5)().mark(function e(t,a,n){var i,o,l,c,u,d,h,f,g,_,v,y,b,k,x,L,S=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=S.length>3&&void 0!==S[3]&&S[3],l=S.length>4&&void 0!==S[4]?S[4]:null,!this.hasDestroyed){e.next=4;break}return e.abrupt("return");case 4:return this.resetRepeatInfo(),c=l||(null===(i=this.adaptTimeRange[t])||void 0===i?void 0:i.range)||this.getFragRange(t),this._curLoadSegIdx=t,u=this.selectedPCDN(o),d=p.Z.extUrl(u||this.url,(0,r.Zj)({__rand:new Date().getTime()},this.options.reqParams)),e.prev=9,this.log(s._.LOG,"loadAllFragmentData before, index: ".concat(t),"range: ".concat(JSON.stringify(c)),"use-pcdn: ".concat(!!u)),h={index:t,url:d,priOptions:{type:u?m.PCDN:m.CDN,range:c}},u&&(h.headers={"X-Origin-Server-Host":this._domain}),e.next=15,this.MP4Loader.loadData(c,this.MP4Loader.cache,h);case 15:if(f=e.sent,this.log(s._.LOG,"loadAllFragmentData after, index: ".concat(t),"range: ".concat(JSON.stringify(c))),g=f.options.priOptions,this.checkResPonse(null==f?void 0:f.response,g)){e.next=22;break}return this.notVailRangeResError(null==f?void 0:f.response,g,null===(_=f.options)||void 0===_?void 0:_.index,!0),e.abrupt("return");case 22:if(this.log(s._.LOG,"loadAllFragmentData after, index: ".concat(t),"range: ".concat(JSON.stringify(c))),!(!f||!f.data)){e.next=27;break}return v=Error("response null"),n?n(v):this.loadError(v,"loadFragment",!!u,{range:c,fragIndex:t,url:u||this.url}),e.abrupt("return");case 27:(y=f.data)&&c&&c.length>=2&&(null==y?void 0:y.byteLength)===c[1]-c[0]+1&&(this._receiveDataPos=c[0]+(null==y?void 0:y.byteLength),this._loadSuccessCallBack=a,this.adaptTimeRange[t].downloaded=!0,this.cacheRepeatData(this.adaptTimeRange[t].repeatRange,c,y),this._mux(y,c[0],t,!0)),e.next=44;break;case 31:if(e.prev=31,e.t0=e.catch(9),!(k=(null===e.t0||void 0===e.t0||null===(b=e.t0.options)||void 0===b||null===(b=b.priOptions)||void 0===b?void 0:b.type)===m.PCDN||!!u)){e.next=42;break}return D.pcdn_download_failed_cnt++,this._pcdnNodeList.shift(),this.log(s._.ERROR,"[loadAllFragmentData], pcdn load err, retry use cdn","fragIndex: ".concat(t,", ").concat((null===e.t0||void 0===e.t0?void 0:e.t0.isTimeout)||(null===e.t0||void 0===e.t0||null===(x=e.t0.response)||void 0===x?void 0:x.status),", ").concat(null===e.t0||void 0===e.t0?void 0:e.t0.message)),e.next=40,this.loadAllFragmentData(t,a,n,!0);case 40:e.next=43;break;case 42:this.log(s._.ERROR,"[MP4] loadAllFragmentData error: ".concat(JSON.stringify({fragIndex:t,range:c})),(null===e.t0||void 0===e.t0?void 0:e.t0.isTimeout)||(null===e.t0||void 0===e.t0||null===(L=e.t0.response)||void 0===L?void 0:L.status),null===e.t0||void 0===e.t0?void 0:e.t0.message);case 43:this.loadError(e.t0,"loadFragment",k,{range:c,fragIndex:t,url:e.t0.url||(k?u:this.url)});case 44:case"end":return e.stop()}},e,this,[[9,31]])})),function(e,t,a){return R.apply(this,arguments)})},{key:"currentLoadUseUrl",value:function(){var e;if(this._isUseCDN)return this.url;return(null===(e=this._pcdnNodeList)||void 0===e?void 0:e.length)>0?this._pcdnNodeList[0].url:""}},{key:"getCurSwitchPCDNCnt",value:function(){return this._PCDNSwitchCnt}},{key:"selectedPCDN",value:function(e){if(this._PCDNState===b.FORBIDDEN||e){this._isUseCDN=!0;return}if(this.isUsePCDN()){if(this._isUseCDN){if(this._switchPCDNCallBack){var t,a=this._switchPCDNCallBack();a>0&&(this.options.switchPCDNMaxCnt=a)}if(this._PCDNSwitchCnt>=this.options.switchPCDNMaxCnt)return this._isUseCDN=!0,this.log(s._.LOG,"cdn switch pcdn out limit, curSwitchCnt: ".concat(this._PCDNSwitchCnt,", maxCnt: ").concat(this.options.switchPCDNMaxCnt)),null;this._PCDNSwitchCnt++;this.log(s._.LOG,"cdn switch pcdn, curSwitchCnt: ".concat(this._PCDNSwitchCnt,", maxCnt: ").concat(this.options.switchPCDNMaxCnt))}this._isUseCDN=!1,t=p.Z.extUrl(this._pcdnNodeList[0].url,(0,r.Zj)({__vid:this.options.vid},this.options.reqParams)),this._lastPCDNUrl!==t&&(this.emit(y.CHANGE_URL,t),this._lastPCDNUrl=t,this.pcdnVVStat.conn_req_num+=1),D.pcdn_download_request_cnt++}else!this._isUseCDN&&(this.log(s._.LOG,"pcdn switch cdn PCDNSwitchCnt: ".concat(this._PCDNSwitchCnt,", maxCnt: ").concat(this.options.switchPCDNMaxCnt)),this.pcdnVVStat.conn_jump_num+=1),this._isUseCDN=!0;return t}},{key:"cancelLoading",value:(C=(0,r.x)((0,r.l5)().mark(function e(){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.MP4Loader){e.next=3;break}return e.next=3,this.MP4Loader.cancel();case 3:this._optionDataLenInfo[m.PCDN]&&this._optionDataLenInfo[m.PCDN]>0&&(this.emit(y.CANCEL_LOADED_LEN,{load_type:m.PCDN,len:this._optionDataLenInfo[m.PCDN]}),this._optionDataLenInfo[m.PCDN]=0),this._optionDataLenInfo[m.CDN]&&this._optionDataLenInfo[m.CDN]>0&&(this.emit(y.CANCEL_LOADED_LEN,{load_type:m.CDN,len:this._optionDataLenInfo[m.CDN]}),this._optionDataLenInfo[m.CDN]=0);case 5:case"end":return e.stop()}},e,this)})),function(){return C.apply(this,arguments)})},{key:"updateUrl",value:function(e,t){var a=p.Z.getHostFromUrl(e);!this._defaultDomain&&(this._defaultDomain=a),0>a.indexOf("www.")?this._domain=a:this._domain=this._defaultDomain,this.url=e,this.backUrl=t||[]}},{key:"getDataBitRate",value:function(e){return this._segmentToBitRateMap.get(e)}},{key:"checkCodecH265",value:function(){return this.meta&&(this.meta.videoCodec.indexOf("hvc1")>-1||this.meta.videoCodec.indexOf("hev1")>-1)}},{key:"checkCodecH266",value:function(){return this.meta&&this.meta.videoCodec.indexOf("bvc2")>-1}},{key:"destroy",value:(O=(0,r.x)((0,r.l5)().mark(function e(){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasDestroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.resetTransmuxer(),this.transmuxerWorkerControl&&this.transmuxerWorkerControl.destroy(),this.fileSize=0,this._isPending=!1,this.metaLoading=!1,this.resetRepeatInfo(),delete this.repeatInfo.data,this._bitRateInfoMap.clear(),this._segmentToBitRateMap.clear(),!this.MP4Loader){e.next=15;break}return e.next=14,this.MP4Loader.cancel();case 14:this.MP4Loader.destroy();case 15:this.removeAllListeners(),this.hasDestroyed=!0,this.pcdnVVStat=this.resetPcdnVVStat();case 18:case"end":return e.stop()}},e,this)})),function(){return O.apply(this,arguments)})},{key:"resetPcdnVVStat",value:function(){return{try_req_node:0,req_node_succ:0,has_ret_node:0,conn_req_num:0,conn_fail_num:0,conn_jump_num:0}}},{key:"resetTransmuxer",value:function(){this.MP4Demuxer&&this.MP4Demuxer.reset(),this.MP4Demuxer=null,this.FMP4Remuxer&&this.FMP4Remuxer.reset(),this.FMP4Remuxer=null,this.transmuxerWorkerControl&&this.transmuxerWorkerControl.reset()}},{key:"getMediaEndTime",value:function(){if(this._mediaEndTime>0)return this._mediaEndTime;var e=this.videoTrak,t=this.audioTrak;if((null==e?void 0:e.length)>0){var a=e[e.length-1].endTime;this._mediaEndTime=this._mediaEndTime<0?a:Math.min(a,this._mediaEndTime)}if((null==t?void 0:t.length)>0){var r=t[t.length-1].endTime;this._mediaEndTime=this._mediaEndTime<0?r:Math.min(r,this._mediaEndTime)}return this._mediaEndTime}},{key:"checkIsLoadEnd",value:function(e){var t=this.videoTrak,a=this.audioTrak;if(!t&&!a)return!1;var r=0,n=0;if((null==t?void 0:t.length)>0){var i=t[t.length-1].range;(null==i?void 0:i.length)>0&&(r=i[1])}if((null==a?void 0:a.length)>0){var o=a[a.length-1].range;(null==o?void 0:o.length)>0&&(n=o[1])}return e>=Math.max(r,n)}}],[{key:"pcdnDownLoadReqCnt",get:function(){var e=D.pcdn_download_request_cnt,t=D.pcdn_download_failed_cnt;return D.pcdn_download_request_cnt=0,D.pcdn_download_failed_cnt=0,{pcdn_download_request_cnt:e,pcdn_download_failed_cnt:t}}},{key:"getDefaultConfig",value:function(){return{onProcessMinLen:1024,xhrSetup:null,chunkSize:8e5,isCache:!1,playerId:"",vid:"",afterLoadeddataCallBackLen:0,ext:{}}}}])}(i());(0,r._x)(x,"pcdn_download_request_cnt",0),(0,r._x)(x,"pcdn_download_failed_cnt",0)},203199:function(e,t,a){a.d(t,{Z:function(){return d}});var r=a(884504);a(514312),a(121621),a(614521),a(379493),a(969642),a(577829),a(410121),a(842903),a(724356),a(947478),a(864614),a(77848),a(632852),a(130458),a(227470),a(238658),a(999921),a(459167),a(812735),a(623302),a(983431),a(319386),a(657170),a(853127),a(644952),a(759149),a(949136),a(966922),a(33814),a(29536),a(716005),a(548485),a(260075),a(791017),a(743286),a(310378),a(124539),a(48498),a(728271),a(814647),a(535689),a(659673),a(210434);var n=a(918334),i=a(721035),o=["bitrate","definition"],s={};function l(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function c(e){var t,a=Object.values(e);if(a.sort(function(e,t){return e.range[0]-t.range[0]}),0===a.length)return{};for(var n=0,o=0,l=new Uint8Array,c=0;c<a.length;c++){var u=a[c],d=u.range[0],h=u.range[1];if(n>0){if(o+1===d)l=(0,i.gJ)(l,new Uint8Array(u.res));else break}else l=(0,i.gJ)(l,new Uint8Array(u.res));n=d,o=h,t=u}var p=t.cacheKey.split("#"),f=(0,r.ZQ)(p,9),g=f[0],_=f[1],v=f[2],y=f[3],m=f[4],b=f[5],k=f[6],x=f[7],L=f[8],S=a[0].range[0],T={vid:g,mediaType:_,codecType:v,vtype:y,definition:m,start:b,end:k,fileId:"video"===_?x:L,range:[S,o],bitrate:x},I=s.generateRequestUniqueKey(T);return delete t.cacheKey,(0,r._x)({},I,(0,r.Zj)((0,r.Zj)({},t),{},{res:l.buffer,range:[S,o],memory:l.buffer.byteLength}))}function u(e){for(var t=Object.keys(e),a={},r=0;r<t.length;r++){var n=t[r],i=e[n],o=n.split("#"),s=o[1],l=o[4],c=o[7],u="video"===s?l:c;!a[u]&&(a[u]={}),a[u][n]=i}return a}s.ArrayBufferToString=function(e){for(var t="",a=new Uint8Array(e),r=0;r<a.length;r++)t+=String.fromCharCode(a[r]);return t},s.StringToArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),r=0;r<e.length;r++)a[r]=e.charCodeAt(r);return t},s.Base64ToHex=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=window.atob(e.replace(/-/g,"+").replace(/_/g,"/"));if(t){for(var r=[],n=0;n<a.length;n++)r.push(a.charCodeAt(n));return new Uint8Array(r).buffer}for(var i="",o=0;o<a.length;o++)i+="0".concat(a.charCodeAt(o).toString(16)).substr(-2);return i},s.HexToBase64=function(e){for(var t="",a=0;a<e.length;a+=2)t+=String.fromCharCode(parseInt(e.substr(a,2),16));return window.btoa(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},s.padStart=function(e,t,a){for(var r=String(a),n=t>>0,i=Math.ceil(n/r.length),o=[],s=String(e);i--;)o.push(r);return o.join("").substring(0,n-s.length)+s},s.durationConvert=function(e){var t=0,a=0,r=0;return(e=e.slice(e.indexOf("PT")+2)).indexOf("H")>-1&&e.indexOf("M")>-1&&e.indexOf("S")>-1?(t=parseFloat(e.slice(0,e.indexOf("H"))),a=parseFloat(e.slice(e.indexOf("H")+1,e.indexOf("M"))),r=parseFloat(e.slice(e.indexOf("M")+1,e.indexOf("S")))):e.indexOf("H")>-1&&e.indexOf("M")>-1&&0>e.indexOf("S")?(t=parseFloat(e.slice(0,e.indexOf("H"))),a=parseFloat(e.slice(e.indexOf("H")+1,e.indexOf("M")))):0>e.indexOf("H")&&e.indexOf("M")>-1&&e.indexOf("S")>-1?(a=parseFloat(e.slice(0,e.indexOf("M"))),r=parseFloat(e.slice(e.indexOf("M")+1,e.indexOf("S")))):e.indexOf("H")>-1&&0>e.indexOf("M")&&e.indexOf("S")>-1?(t=parseFloat(e.slice(0,e.indexOf("H"))),r=parseFloat(e.slice(e.indexOf("H")+1,e.indexOf("S")))):0>e.indexOf("H")&&0>e.indexOf("M")&&e.indexOf("S")>-1?r=parseFloat(e.slice(0,e.indexOf("S"))):0>e.indexOf("H")&&e.indexOf("M")>-1&&0>e.indexOf("S")&&(a=parseFloat(e.slice(0,e.indexOf("M")))),3600*t+60*a+r},s.preFixInterge=function(e,t){return(Array(t).join(0)+e).slice(-t)},s.toHex=function(){for(var e=[],t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];return a.forEach(function(t){e.push(s.padStart(Number(t).toString(16),2,0))}),e},s.sum=function(){for(var e=0,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];return a.forEach(function(t){e+=t}),e},s.toUTF8=function(e){for(var t=unescape(encodeURIComponent(e)),a=new Uint8Array(t.length),r=0;r<t.length;++r)a[r]=t.charCodeAt(r);return a.buffer},s.fromHex=function(e){for(var t=new Uint8Array(e.length/2),a=0;a<e.length;a+=2)t[a/2]=parseInt(e.substr(a,2),16);return t},s.fromCharCode=function(e){for(var t="",a=0;a<e.length;a+=16e3){var r=e.subarray(a,a+16e3);t+=String.fromCharCode.apply(null,r)}return t},s.toBase64=function(e,t){var a=s.fromCharCode(e);t=void 0===t||t;var r=window.btoa(a).replace(/\+/g,"-").replace(/\//g,"_");return t?r:r.replace(/=*$/,"")},s.str2hex=function(e){if(""===e)return"";for(var t=[],a=0;a<e.length;a++)t.push(e.charCodeAt(a));return t},s.bufferToString=function(e){return"0".concat(Number(e).toString(16)).slice(-2).toUpperCase()},s.stringToBuffer=function(e){for(var t=[],a=0;a<e.length;a+=2)t.push(parseInt(e[a]+e[a+1],16));return new Uint8Array(t)},s.round=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number(e.toFixed(t))},s.isEdge=function(){var e=window.navigator.userAgent.toLowerCase();return e.indexOf("edge")>-1||e.indexOf("edg/")>-1},s.offInDestroy=function(e,t,a,r){e.once(r,function n(){e.off(t,a),e.off(r,n)})},s.on=function(e,t,a,r){if(r)e.on(t,a),s.offInDestroy(e,t,a,r);else{var n=function(r){a(r),e.off(t,n)};e.on(t,n)}},s.once=function(e,t,a,r){if(r)e.once(t,a),s.offInDestroy(e,t,a,r);else{var n=function(r){a(r),e.off(t,n)};e.once(t,n)}},s.promisePolyfill=function(){!Promise.prototype.finally&&(Promise.prototype.finally=({finally:function(e){var t=function(t){return Promise.resolve(e()).then(t)};return this.then(function(e){return t(function(){return e})},function(e){return t(function(){return Promise.reject(e)})})}}).finally)},s.transformHeaders=function(e,t){var a=Object.assign({},e);return Object.keys(t).forEach(function(r){var n=t[r];e&&e[r]&&(a[n]=e[r],delete a[r])}),a},s.generateRequestUniqueKey=function(e){var t=e.vid,a=e.start,r=e.end,i=e.mediaType,o=e.definition,s=e.codecType,l=e.vtype,c=e.bitrate,u=e.fileId,d=e.range;if(d&&d.length>0?(a=d[0],r=d[1]):(a=a||0,r=r||0),s="hevc"===s?"h265":s||"h264",l=l||n.l0.DASH,!t||!i)return null;var h=o?"".concat(t,"#").concat(i,"#").concat(s,"#").concat(l,"#").concat(o,"#").concat(a,"#").concat(r):"".concat(t,"#").concat(i,"#").concat(s,"#").concat(l,"##").concat(a,"#").concat(r,"#").concat(c);return u?"".concat(h,"#").concat(u):h},s.getDefinition=function(e){if(!e)return null;var t=e.split("#");return t.length>2?t[2]:null},s.exchangeListUrl=function(e){if(!!e&&0!==e.length)for(var t=0;t<e.length;t++)s.exchangeUrl(e[t])},s.exchangeUrl=function(e){if(!!e&&!!e.main_url&&!!e.backup_url_1){var t=e.main_url,a=e.backup_url_1,r=t.split("?");2===r.length&&-1===a.indexOf("?")?(e.main_url="".concat(a,"?").concat(r[1]),e.backup_url_1=r[0]):(e.main_url=a,e.backup_url_1=t)}},s.validateFragment=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!(e instanceof ArrayBuffer))return!1;try{var a=new Uint8Array(e,4,4),r=String.fromCharCode.apply(null,a),n=!0;if(2===t.length){var i=t[1]-t[0]+1;if(!(n=e.byteLength===i))return}if("moof"!==r&&"styp"!==r&&"ftyp"!==r)return!1}catch(e){return!1}return!0},s.validateUrlRange=function(e,t){if((e=e||[]).length>0&&t)for(var a=0;a<e.length;a++){var r=e[a];if(/([0-9.\-A-Za-z]+)/.test(r)&&t.indexOf(r)>-1)return!0}return!1},s.nowTime=function(){try{return parseInt(performance.now(),10)}catch(e){return new Date().getTime()}},s.getBitrateItem=function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=s.getSelectorList(e,a);return t.getSuitableBitrate?t.getSuitableBitrate(n,r):t.bitRateAdapter.select(n)},s.getSelectorList=function(e,t){for(var a=e.dynamic_video_list,n=[],i=0;i<a.length;i++){var s=a[i],l=s.bitrate,c=s.definition,u=(0,r.Kd)(s,o);!s.isExtra&&n.push((0,r.Zj)({bitrate:l,definition:c,duration:t,mediaType:"video"},u))}return n},s.typeof=l,s.getHostFromUrl=function(e){if("String"!==l(e)||!e)return"";var t=e.split("/"),a="";return t.length>3&&t[2]&&(a=t[2]),a},s.checkValidTopBox=function(e){var t=s.getTopBoxType(e);return("moof"===t||"styp"===t)&&!0},s.getTopBoxType=function(e){if(s.isArrayBuffer(e)){var t=e.subarray(4,8);return String.fromCharCode.apply(null,t)}return null},s.isArrayBuffer=function(e){return!!(e instanceof ArrayBuffer||e instanceof Uint8Array)||!1},s.getBufferData=function(e,t){var a=0,r=0,n=0,i=0,o=0;if(!e||0===e.length)return{beforeBufLen:a,afterBufLen:r,beforeLastBuffEnd:n,afterFirstBuffEnd:i,afterFirstBuffStart:o};i=1/0,o=1/0;for(var s=0,l=e.length;s<l;s++){var c=e.end(s),u=e.start(s),d=c-u;c<t?(a+=d,n=c):u<=t&&t<=c?(a+=t-u,r+=c-t):(o=Math.min(u,o),i=Math.min(c,i),r+=d)}return{beforeBufLen:a,afterBufLen:r,beforeLastBuffEnd:n,afterFirstBuffEnd:i}},s.combinePreloadData=function(e){for(var t=Object.keys(e),a={},r={},n={},i=0;i<t.length;i++){var o,s,l=t[i],d=e[l];d.isInitSegment?n[l]=d:(d.rangeEnd===(null===(o=d.range)||void 0===o?void 0:o[1])&&d.rangeStart===(null===(s=d.range)||void 0===s?void 0:s[0])?n[l]=d:"audio"===d.mediaType?a[l]=d:"video"===d.mediaType&&(r[l]=d),d.cacheKey=l)}for(var h=u(a),p=0,f=Object.keys(h);p<f.length;p++)Object.assign(n,c(h[f[p]]));for(var g=u(r),_=0,v=Object.keys(g);_<v.length;_++)Object.assign(n,c(g[v[_]]));return n};let d=s},20440:function(e,t,a){a.d(t,{_:function(){return n}});var r=a(809068);function n(){return{autoPreload:!1,autoCheck:{enable:!1,interval:1e3},preloadMaxCacheCount:5,preloadCacheType:r.Rr.MEMORY,autoCheckPreload:!0,startPreloadControl:!1,startPreloadMinBuffer:5,startPreloadMinPosTime:5,minBufferLength:5,endPreloadControl:!1,endPreloadTaskStrategy:0}}},554946:function(e,t,a){a.d(t,{c:function(){return n}});var r=a(981500),n=(0,r.qH)(function e(t,a){(0,r.PA)(this,e),this.type="file",this.message=t,this.data=a})}}]);