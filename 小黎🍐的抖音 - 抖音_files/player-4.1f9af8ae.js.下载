/*! For license information please see player-4.1f9af8ae.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).xss={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,t,r){if(r||2==arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var n=/[^a-zA-Z0-9\\_:.-]/gim,i=/</g,a=/>/g,o=/&#([a-zA-Z0-9]*);?/gim,s=/&quot;/g,l=/&colon;?/gim,c=/&newline;?/gim,u=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,d=/u\s*r\s*l\s*\(.*/gi,f=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,h=/"/g,p=function(e){return e.replace(i,"&lt;").replace(a,"&gt;")},g={indexOf:function(e,t){var r,n;for(r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return -1},forEach:function(e,t,r){var n,i;for(n=0,i=e.length;n<i;n++)t.call(r,e[n],n,e)},some:function(e,t,r){var n,i;for(n=0,i=e.length;n<i;n++)if(t.call(r,e[n],n,e))return!0;return!1},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},includes:function(e,t){if("string"==typeof e)return -1!==e.indexOf(t);for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1},uniq:function(e){for(var t={},r=[],n=0;n<e.length;n++)t[e[n]]||(r.push(e[n]),t[e[n]]=!0);return r},from:function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t},keys:function(e){var t=[];for(var r in e)t.push(r);return t}};function v(e){return null==e}function y(e){var t;return'"'===(t=e)[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]?e.substr(1,e.length-2):e}function m(e){var t,r,n,i,a,o,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0;for(e=function(e){e=e.replace(/rn/g,"n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t+=String.fromCharCode(n):n>127&&n<2048?t+=String.fromCharCode(n>>6|192)+String.fromCharCode(63&n|128):t+=String.fromCharCode(n>>12|224)+String.fromCharCode(n>>6&63|128)+String.fromCharCode(63&n|128)}return t}(e);u<e.length;)i=(t=e.charCodeAt(u++))>>2,a=(3&t)<<4|(r=e.charCodeAt(u++))>>4,o=(15&r)<<2|(n=e.charCodeAt(u++))>>6,s=63&n,isNaN(r)?o=s=64:isNaN(n)&&(s=64),c=c+l.charAt(i)+l.charAt(a)+l.charAt(o)+l.charAt(s);return c}function _(e){var t,r,n,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");c<e.length;)t=s.indexOf(e.charAt(c++))<<2|(i=s.indexOf(e.charAt(c++)))>>4,r=(15&i)<<4|(a=s.indexOf(e.charAt(c++)))>>2,n=(3&a)<<6|(o=s.indexOf(e.charAt(c++))),l+=String.fromCharCode(t),64!==a&&(l+=String.fromCharCode(r)),64!==o&&(l+=String.fromCharCode(n));return function(e){for(var t="",r=0,n=0,i=0,a=0;r<e.length;)(n=e.charCodeAt(r))<128?(t+=String.fromCharCode(n),r++):n>191&&n<224?(t+=String.fromCharCode((31&n)<<6|63&(a=e.charCodeAt(r+1))),r+=2):(a=e.charCodeAt(r+1),t+=String.fromCharCode((15&n)<<12|(63&a)<<6|63&(i=e.charCodeAt(r+2))),r+=3);return t}(l)}function b(e,t,r){var n="",i=0,a=!1,o=!1,s=0,l=e.length,c="",u="";e:for(s=0;s<l;s++){var d=e.charAt(s);if(!1===a){if("<"===d){a=s;continue}}else if(!1===o){if("<"===d){n+=r(e.slice(i,s)),a=s,i=s;continue}if(">"===d||s===l-1){n+=r(e.slice(i,a)),c=function(e){var t,r=g.spaceIndex(e);return t=-1===r?e.slice(1,-1):e.slice(1,r+1),"/"===(t=g.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}(u=e.slice(a,s+1)),n+=t(a,n.length,c,u,"</"===u.slice(0,2)),i=s+1,a=!1;continue}if('"'===d||"'"===d)for(var f=1,h=e.charAt(s-f);""===h.trim()||"="===h;){if("="===h){o=d;continue e}h=e.charAt(s-++f)}}else if(d===o){o=!1;continue}}return i<l&&(n+=r(e.substr(i))),n}function x(e,t){var r=0,i=0,a=[],o=!1,s=e.length;function l(e,r){if(!((e=(e=g.trim(e)).replace(n,"").toLowerCase()).length<1)){var i=t(e,r||"");i&&a.push(i)}}for(var c=0;c<s;c++){var u=e.charAt(c),d=void 0;if(!1!==o||"="!==u){if(!1===o||c!==i){if(/\s|\n|\t/.test(u)){if(e=e.replace(/\s|\n|\t/g," "),!1===o){if(-1===(d=function(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"="===r?t:-1}return -1}(e,c))){l(g.trim(e.slice(r,c))),o=!1,r=c+1;continue}c=d-1;continue}if(-1===(d=function(e,t){for(;t>0;t--){var r=e[t];if(" "!==r)return"="===r?t:-1}return -1}(e,c-1))){l(o,y(g.trim(e.slice(r,c)))),o=!1,r=c+1;continue}}}else{if(-1===(d=e.indexOf(u,c+1)))break;l(o,g.trim(e.slice(i+1,d))),o=!1,r=(c=d)+1}}else o=e.slice(r,c),r=c+1,i='"'===e.charAt(r)||"'"===e.charAt(r)?r:function(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"'"===r||'"'===r?t:-1}return -1}(e,c+1)}return r<e.length&&(!1===o?l(e.slice(r)):l(o,y(g.trim(e.slice(r))))),g.trim(a.join(" "))}function k(e,t,r){if(r=function(e){return e=function(e){for(var t="",r=0,n=e.length;r<n;r++)t+=32>e.charCodeAt(r)?" ":e.charAt(r);return g.trim(t)}(e=(e=(e=e.replace(s,'"')).replace(o,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})).replace(l,":").replace(c," "))}(r),"href"===t||"src"===t){if("#"===(r=g.trim(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"data:image/"!==r.substr(0,11)&&"ftp://"!==r.substr(0,6)&&"./"!==r.substr(0,2)&&"../"!==r.substr(0,3)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===t){if(u.lastIndex=0,u.test(r))return""}else if("style"===t&&(f.lastIndex=0,f.test(r)||(d.lastIndex=0,d.test(r)&&(u.lastIndex=0,u.test(r)))))return"";return r=function(e){return e=p(e=e.replace(h,"&quot;"))}(r)}var L=function(e){return"string"==typeof e?e.replace(/'/g,'"').replace('=""',"").replace(/\s+/g,"").toLowerCase():""},w=function(){function e(e){var t=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{});t.stripIgnoreTag&&(t.onIgnoreTag,t.onIgnoreTag=function(){return""}),t.whiteList={},t.onTag=function(){},t.onTagAttr=function(){},t.onIgnoreTag=function(){},t.onIgnoreTagAttr=function(){},t.safeAttrValue=k,t.escapeHtml=p,this.options=Object.assign(t,e)}return e.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t,r,n,i,a,o,s=this.options,l=s.whiteList,c=s.onTag,u=s.onIgnoreTag,d=s.onTagAttr,f=s.onIgnoreTagAttr,h=s.safeAttrValue,p=s.escapeHtml;s.stripBlankChar&&(e=(t=(t=e.split("")).filter(function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)})).join("")),s.allowCommentTag||(e=function(e){for(var t="",r=0;r<e.length;){var n=e.indexOf("\x3c!--",r);if(-1===n){t+=e.slice(r);break}t+=e.slice(r,n);var i=e.indexOf("--\x3e",n);if(-1===i)break;r=i+3}return t}(e));var v=!1;s.stripIgnoreTagBody&&(r=s.stripIgnoreTagBody,"function"!=typeof(n=u)&&(n=function(){}),i=!Array.isArray(r),a=[],o=!1,u=(v={onIgnoreTag:function(e,t,s){var l;if(l=e,i||-1!==g.indexOf(r,l)){if(s.isClosing){var c="[/removed]",u=s.position+c.length;return a.push([!1!==o?o:s.position,u]),o=!1,c}return o||(o=s.position),"[removed]"}return n(e,t,s)},remove:function(e){var t="",r=0;return g.forEach(a,function(n){t+=e.slice(r,n[0]),r=n[1]}),t+=e.slice(r)}}).onIgnoreTag);var y=b(e,function(e,t,r,n,i){var a={sourcePosition:e,position:t,isClosing:i,isWhite:Object.prototype.hasOwnProperty.call(l,r)},o=c(r,n,a);if(null!=o)return o;if(a.isWhite){if(a.isClosing)return"</".concat(r,">");var s=function(e){var t=g.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=g.trim(e.slice(t+1,-1)))[e.length-1];return r&&(e=g.trim(e.slice(0,-1))),{html:e,closing:r}}(n),v=l[r],y=x(s.html,function(e,t){var n=-1!==g.indexOf(v,e),i=d(r,e,t,n);return null==i?n?(t=h(r,e,t,null))?"".concat(e,'="').concat(t,'"'):e:null==(i=f(r,e,t,n))?void 0:i:i});return n="<".concat(r),y&&(n+=" ".concat(y)),s.closing&&(n+=" /"),n+=">"}return null==(o=u(r,n,a))?p(n):o},p);return v&&(y=v.remove(y)),y},e}(),P=Function("\nvar _checkXSS = function (it) {\n  return it && it.Math == Math && it;\n};\nreturn _checkXSS(typeof globalThis === 'object' && globalThis) ||\n_checkXSS(typeof window === 'object' && window) ||\n_checkXSS(typeof self === 'object' && self) ||\n_checkXSS(typeof global === 'object' && global) ||\nFunction('return this')();\n")(),O=new(function(){function e(){var e=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var t,r,n="douyin_web";if(!g.includes(n,"bid"))return n;if(e.config&&e.config.bid)return e.config.bid;if(P&&P._xssBid)return P._xssBid;if(P&&P.slardar&&"function"==typeof P.slardar.config){var i=(P.slardar.config()||{}).bid;if(i)return i}if(P&&P.Slardar&&"function"==typeof P.Slardar.config){var a=(P.Slardar.config()||{}).bid;if(a)return a}return(null===(r=null===(t=null==P?void 0:P.Slardar)||void 0===t?void 0:t._baseParams)||void 0===r?void 0:r.bid)||"argus"},this.getConfigRegion=function(){var t;return g.includes("cn","region")?e.config&&e.config.region?e.config.region:((null===(t=null==P?void 0:P.gfdatav1)||void 0===t?void 0:t.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=function(){var t={cn:_("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boe:_("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),ttp:_("aHR0cHM6Ly9tb24udXMudGlrdG9rdi5jb20vbW9uaXRvcl9icm93c2VyL2NvbGxlY3QvYmF0Y2gvc2VjdXJpdHkvP2JpZD0="),va:_("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),maliva:_("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),sg:_("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boei18n:_("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9")}[e.getConfigRegion()];if(t)return t+e.getSlardarBid()}}return e.prototype.setConfig=function(e){this.config=e},e.prototype.upload=function(){var e=this,t=this.gerReportUrl();!this.lock&&t&&0!==this.batchData.length&&(this.lock=!0,setTimeout(function(){var r=e.batchData.slice(0,100);e.batchData=e.batchData.slice(100),P.fetch(t,{method:"post",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).catch(function(e){}),e.lock=!1,e.upload()},this.timeout))},e.prototype.generateKey=function(e){return e.collectKey?[e.collectMode,e.collectKey].join("___"):""},e.prototype.push=function(e){this.batchData.push(e),this.upload()},e.prototype.report=function(e){var t=this.generateKey(e);if(P.fetch&&e.collectKey){var r="object"==typeof window?window.location.href:"SSR";e.documentUrl=r;var n={age:Math.floor(Date.now()),type:"xss",url:r,body:e,"user-agent":""};"enforce"===e.disposition&&"SSR"!==r||(n.url=t),"SSR"===r&&(n.url="SSR___".concat(n.url),n.body.ssr=!0),this.push(n)}},e}()),I=function(e){for(var t=0,r=function(r){Array.isArray(e[r])?0===e[r].length?delete e[r]:(e[r]=g.from(g.uniq(e[r])),t+=e[r].length):0===g.keys(e[r]).length?delete e[r]:g.keys(e[r]).forEach(function(n){e[r][n]=g.from(g.uniq(e[r][n])),t+=e[r][n].length})},n=0,i=g.keys(e);n<i.length;n++)r(i[n]);return{count:t,ret:e}};function C(e,t){return O.setConfig(t),new w(t).process(e)}function S(e){var t,r=(t=/\s|\n|\t/.exec(e))?t.index:-1;if(-1===r)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=e.slice(r+1,-1).trim())[e.length-1];return n&&(e=e.slice(0,-1).trim()),{html:e,closing:n}}var T=function(e){return -1===(e=(e=(e=(e=e.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?e.trim().toLowerCase():e.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,function(e,t,r,n){return String.fromCharCode(t?parseInt(r,16):parseInt(n))}).replace(/(\t|\n|\r)/g,"").toLowerCase()};function D(e,t){if(void 0===e&&(e=""),"string"!=typeof e)return!0;if(e=T(e),g.includes(e,"base64")&&!function(e){if(""===e||""===e.trim())return!0;try{return!g.includes(e,"data:text/html;base64")}catch(e){return!0}}(e))return t&&t("data:text/html;base64"),!1;var r=["expression(","behavior:","view-source:"];if(g.some(r,function(t){return -1!==e.indexOf(t)}))return g.forEach(r,function(r){-1!==e.indexOf(r)&&t&&t(r)}),!1;var n=["data:application","data:javascript","data:text/html","data:texthtml"];if(g.some(n,function(t){return -1!==e.indexOf(t)}))return g.forEach(n,function(r){-1!==e.indexOf(r)&&t&&t(r)}),!1;if(e.indexOf("javascript:")>0)return t&&t("javascript:"),!1;if(/^javascript:/i.test(e)){var i=e.slice(11).replace(/\s/g,"").trim();return!!g.some(["void","void(0)","void0","false","undefined",";"],function(e){return e===i})||(t&&t("javascript:"),!1)}return!0}var E=function(e,t){var r,n,i="<%= isSaveValidUrl =>";if("string"!=typeof e||(n=Number("<%= urlLimit =>"),void 0!==r&&(n=r),"NaN"!==e.toString()&&-1!==n&&e.length>=n)||D(e,t))return e;try{if(!0===(i=JSON.parse(i))||"true"===i){var a=new URL(e);return a.origin+a.pathname}}catch(e){}return"#"};function A(e,t,n){if(void 0===e&&(e=""),void 0===t&&(t=[]),"string"!=typeof e)return!0;if(!D(e=T(e)))return!1;var i,a={url:(i=e.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[])[0],scheme:i[1],slash:i[2],host:i[3],port:i[4],path:i[5],query:i[6],hash:i[7]},o=a.scheme,s=a.host;return n?!!n(e):!(!o||!s)&&(!g.includes(["http","https","file"],o)||("object"==typeof window&&window&&(t=r(r([],t,!0),[location.host],!1)),g.some(t,function(e){return!!(e instanceof RegExp&&e.test(s))||e===s})))}var R={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},j={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var e=I(this.collect),t=e.count,r=e.ret;return this.collect=null,{collectKey:0===t?null:JSON.stringify(r),collectMode:"white"}},onIgnoreTagAttr:function(e,t,n){return e&&g.indexOf(["href","src"],t)>-1?j.domainWhiteList&&Array.isArray(j.domainWhiteList)&&j.domainWhiteList.length>0&&!A(n,r([],j.domainWhiteList,!0))?"":"".concat(t,'="').concat(E(n,function(e){var t;null===(t=j.collect)||void 0===t||t.filterProtocol.push(e)}),'"'):e&&(g.indexOf(["style","class","id"],t)>-1||t.indexOf("data-")>-1)?"".concat(t,'="').concat(n,'"'):(j.collect.whiteList[e]=j.collect.whiteList[e]||[],void j.collect.whiteList[e].push(t))},onIgnoreTag:function(e,t){if("style"===e)return t;b(t,function(e,t,r,n){x(S(n).html.replace("/",""),function(e){j.collect.whiteList[r]=j.collect.whiteList[r]||[],j.collect.whiteList[r].push(e)})},p)},whiteList:R,mergeWhiteList:function(e){for(var t,r={},n=0,i=g.keys(R);n<i.length;n++)r[t=i[n]]=g.from(R[t]);for(var a=0,o=g.keys(e);a<o.length;a++)r[t=o[a]]=t in R?R[t].concat(e[t]):g.from(e[t]);return r},setWhiteList:function(e){for(var t=0,r=g.keys(e);t<r.length;t++){var n=r[t];this.whiteList[n]=n in R?R[n].concat(e[n]):g.from(e[n])}}};try{var N={},M="merge";g.includes(M,"override")&&(j.whiteList=N.whiteList),g.includes(M,"merge")&&j.setWhiteList(N.whiteList)}catch(e){}var U=function(e,t){for(var r={},n=0,i=g.keys(e);n<i.length;n++){var a=i[n];Array.isArray(e[a])?r[a]=g.from(e[a]):r[a]=U({},e[a])}for(var o=0,s=g.keys(t);o<s.length;o++)(a=s[o])in e?Array.isArray(e[a])?r[a]=e[a].concat(t[a]):r[a]=U(e[a],t[a]):Array.isArray(t[a])?r[a]=g.from(t[a]):r[a]=U({},t[a]);return r},K={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var B={};B.blackAttrRegExps&&(B.blackAttrRegExps=B.blackAttrRegExps.map(function(e){return new RegExp(e.toString().slice(1,e.toString().length-1))}));var G="merge";g.includes(G,"override")&&(K=B),g.includes(G,"merge")&&(K=U(K,B))}catch(e){}var F={mode:"black",whiteList:{},blackConfig:K,collect:null,initCollect:function(){F.collect={blackList:{},blackTags:[],blackAttrs:[],blackAttrRegExps:[],filterAttrs:[],filterList:{},filterProtocol:[]}},removeCollect:function(){var e=I(F.collect),t=e.count,r=e.ret;return F.collect=null,{collectKey:0===t?null:JSON.stringify(r),collectMode:"black"}},onIgnoreTag:function(e,t){var r;if(!g.includes(K.blackTags,e))return b(t,function(e,t,r,n,i){if(-1!==r.indexOf("/"))return p(n);if(i)return"</".concat(r,">");var a=S(n),o=x(a.html,function(e,t){var n,i=0;if(K.blackList[r]&&g.includes(K.blackList[r],e)&&(F.collect.blackList[r]=F.collect.blackList[r]||[],F.collect.blackList[r].push(e),i++),K.blackAttrRegExps.length&&K.blackAttrRegExps.some(function(t){return t.test(e)})&&g.forEach(K.blackAttrRegExps,function(t){t.test(e)&&(F.collect.blackAttrRegExps.push("".concat(t.toString(),"->").concat(e)),i++)}),K.blackAttrs.length&&g.includes(K.blackAttrs,e)&&(K.blackAttrs.push(e),i++),!i){if(K.filterList&&K.filterList[r]&&g.includes(K.filterList[r],e)){var a=E(t,function(e){var t;null===(t=F.collect)||void 0===t||t.filterProtocol.push(e)});return a!==t&&(F.collect.filterList[r]=F.collect.filterList[r]||[],F.collect.filterList[r].push(e)),t?"".concat(e,"='").concat(a,"'"):e}return K.filterAttrs&&g.includes(K.filterAttrs,e)?((a=E(t,function(e){var t;null===(t=F.collect)||void 0===t||t.filterProtocol.push(e)}))!==t&&(null===(n=F.collect)||void 0===n||n.filterAttrs.push(e)),t?"".concat(e,"='").concat(a,"'"):e):t?"".concat(e,"='").concat(t,"'"):e}});return n="<".concat(r),o&&(n+=" ".concat(o)),a.closing&&(n+=" /"),n+=">"},p);null===(r=F.collect)||void 0===r||r.blackTags.push(e)}},q=function(e){var t=e.reportOnly,r=void 0===t||t,n=e.block;return r&&"all"===r?"report":("string"==typeof r&&("true"===r&&(r=!0),"false"===r&&(r=!1)),n?"enforce":r?"report":"enforce")},z=function(e){return function(r,n,i){if(!r||"string"!=typeof r)return r;var a=n;e===C&&(a=j).initCollect();var o=e(r,a);if(L(o)===L(r))return r;if(!i)return o;var s=i.logType,l=q(i),c=a.removeCollect();return O.report(t(t({type:s,disposition:l},c),{sourceText:m(r),filterText:m(o)})),"enforce"===l?o:r}},Z=z(function(e,t){return void 0===t&&(t={}),t&&t.whiteList||(t.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}),new w(t).process(e)}),W=z(C),X=function(e,t,r){var n=[],i=E(e,function(e){n.push(e)});if(i===e)return e;n=g.from(g.uniq(n));var a=t||r||{};if(!a)return i;var o=a.logType,s=q(r);return O.report({type:o,disposition:s,collectKey:n.join("___"),collectData:JSON.stringify(n),collectMode:"black",sourceText:m(e),filterText:m(i)}),"enforce"===s?i:e},H=P._xssProject||{},J=P.xssNamespace||{},Y="3.0.26",V={FilterXSS:w,version:Y,webpackPluginVersion:"<%= webpackPluginVersion =>",reportOnly:"<%= reportOnly =>",filterXSS:Z,_filterXSS:W,filterUrl:X,Config:j,BlackConfig:F,project:H,setProjectName:function(e){H[e]=this,P._xssProjectName=e}};J.douyin_web=V,P.xssNamespace=J,P.Math&&!P.Math.xssNamespace&&(P.Math.xssNamespace=J),H[Y]=V,P.globalThis=P,P.getFilterXss=function(){return void 0!==this._xssProjectName?this._xssProject[this._xssProjectName]:V},P.xss=V,P.isSafeUrl=A,P.isSafeDomain=A,P.isSafeProtocol=D,P._xssProject=H,P._xssProjectName&&(H[P._xssProjectName]=V);var Q=V.setProjectName.bind(V);e.BlackConfig=F,e.Config=j,e.FilterXSS=w,e._filterXSS=W,e.filterUrl=X,e.filterXSS=Z,e.isSafeDomain=A,e.isSafeProtocol=D,e.isSafeUrl=A,e.project=H,e.setProjectName=Q,e.setXssNamespace=function(e){var t=e.appId,r=e.bid,n=e.region;J[t]=V;j.bid=r,j.region=n,j.enabled=!0},e.xssNamespace=J,Object.defineProperty(e,"__esModule",{value:!0})});"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["5431"],{375867:function(e,t,r){r.r(t),r.d(t,{Mp4Preloader:function(){return P},default:function(){return n.Z}});var n=r("932508"),i=r("167846");r("514312"),r("831528"),r("477416"),r("121621"),r("904644"),r("379493"),r("577829"),r("410121"),r("724356"),r("947478"),r("864614"),r("632852"),r("812735"),r("623302"),r("983431"),r("319386"),r("657170"),r("853127"),r("644952"),r("759149"),r("949136"),r("966922"),r("33814"),r("29536"),r("716005"),r("548485"),r("260075"),r("791017"),r("743286"),r("310378"),r("124539"),r("48498"),r("728271"),r("814647"),r("535689"),r("659673"),r("210434");var a=r("809068"),o=r("362043"),s=r("918334"),l=r("868685"),c=r("267223"),u=r.n(c),d=r("742983"),f=r("101132"),h=r("906399"),p=r("891097"),g=r("24166"),v=r("228908"),y=r("169198"),m=r("935672"),_=r("857877"),b=r("480514"),x=r("930770"),k=r("244694"),L=r("793849"),w=0,P=function(e){var t,r,n,o,c,P,O,I,C;function S(e,t){(0,i.PA)(this,S),(a=(0,i.$w)(this,S,[e,t]))._pendingTask={resolve:void 0,data:void 0},a._nextPreloadCount=0,a._updateRealTimeSpeed=function(e){w=e.speed,a.emit(h.kW,e)};var r,n,a,o=(0,L._K)();Object.keys(t).forEach(function(e){o[e]=t[e]}),a.options=o,a.playerId=(null===(r=e.player)||void 0===r?void 0:r.playerId)||"default";var s=a.options.logCacheConfig,l=s.logCacheLevel,c=s.logMaxSize;return a.logger=new f.Y("[Mp4Preloader]",{logCacheLevel:l,logMaxSize:c}),void 0===t.supportHevc&&(0,x.G9)()&&(a.options.supportHevc=!0),a.loadRangeType=(null===(n=a.options)||void 0===n?void 0:n.loadRangeType)||h.TJ.GOP,a.log(f._.DEBUG,"[Preloader] new preloader, playerId",a.playerId),a}return(0,i.XW)(S,e),(0,i.qH)(S,[{key:"currentPreloadInst",get:function(){return this.preloadManager.currentPreloadInst}},{key:"allCachedKeys",get:function(){return this.preloadManager.getAllCachedDataKeys()}},{key:"cacheInst",get:function(){return this.preloadManager.cacheInst}},{key:"realTimeSpeed",get:function(){return w}},{key:"taskInProgress",get:function(){return!!this._pendingTask.resolve&&!!this._pendingTask.data}},{key:"log",value:function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];k.cM.apply(void 0,[this.logger,e,t].concat(n))}},{key:"getPreloadUnuseInfo",value:function(){return this.preloadManager.getPreloadUnuseInfo()}},{key:"generateUniqueKey",value:function(e){var t=e.vid,r=e.definition,n=e.mediaType,i=e.codecType,a=e.vtype;return S.generateUniqueKey({vid:t,mediaType:n,definition:r,codecType:i,vtype:a})}},{key:"_beforeStart",value:function(e,t){var r=e.payload||[];if(0===r.length)return this.log(f._.LOG,"preload_is_null"),null;var n=e.vid,a=e.steps,o=e.stepIdx,l=e.targetDefinition,c=e.vtype||s.l0.MP4,u=e.codecType||L.vr.H264,d=this.getUserSelectDefinition(),h=this.checkCacheKey(n,r,d,c,u);if(this.log(f._.LOG,"".concat(this.playerId," ").concat(n),"codecType:".concat(u," vtype:").concat(c," hasCache:").concat(h)),h&&!this.stepwise||"MP3"===c)return this.log(f._.LOG,"vtype_".concat(c)),null;var p=l||this.getInitDefinition(r,t);if(this.log(f._.LOG," ".concat(this.playerId," ").concat(n," getInitDefinition"),null==p?void 0:p.definition),!p)return this.log(f._.WARN,"definition_error"),null;var g=p.definition,v=p.orgDefinition,y=this.stepwise?a[e.stepIdx]:e.preloadTime||this.options.preloadTime,m=this.stepwise?a[e.stepIdx]*Math.floor(p.bitrate/8):e.preloadSize||this.options.preloadSize||390624,_=this.generateUniqueKey({vid:n,definition:g,vtype:c,codecType:u});this._nextPreloadCount>0&&this._nextPreloadCount--,this.log(f._.LOG,"".concat(this.playerId," ").concat(n),"cacheKey:".concat(_," duration:").concat(p.duration," preloadTime:").concat(y));var b=(0,i.Zj)({vid:n,definition:g,orgDefinition:v,preloadTime:y,preloadSize:m,cacheKey:_,codecType:u,vtype:c,steps:a,stepIdx:o,payload:e},p);return e.reqOptions&&(b.reqOptions=e.reqOptions),this.log(f._.LOG,"start preload,".concat(n," playerId:").concat(this.playerId)),b}},{key:"start",value:(t=(0,i.x)((0,i.l5)().mark(function e(t,r){var n,a,o,s,c,u,d,f;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._beforeStart(t,r)){e.next=3;break}return e.abrupt("return",{remove:!0});case 3:if(s=(o=Promise.withResolvers()).promise,c=o.resolve,u=a.codecType,this._pendingTask.resolve=c,this._pendingTask.data=a,null!==(n=this.options)&&void 0!==n&&null!==(n=n.pcdnConfig)&&void 0!==n&&n.openPreloadPCDN&&(d=Object.assign({},{productConfig:h.tE},this.options.pcdnConfig),this._pcdn=new l.e(d,void 0,void 0,void 0)),f=null,!this.stepwise){e.next=13;break}return e.next=12,this.getPreLoadData(a);case 12:f=e.sent;case 13:return(u!==L.vr.H265||this.options.supportHevc)&&this.loadRangeType!==h.TJ.UNMUX?this.loadRangeType===h.TJ.GOP?this.loadByPreloadTime(a,f):this.loadRangeType===h.TJ.SIZE&&this.loadByChunkSize(a,f):this.loadByChunkSizeUnMux(a,f),e.next=16,s;case 16:return e.abrupt("return",{remove:!this.stepwise});case 17:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"getInitDefinition",value:function(e,t){for(var r=null,n=0,i=0;i<e.length;i++)if(e[i].definition===t){n=i;break}return!(r=e[n])&&(r=e[0]),r}},{key:"getPreLoadData",value:function(e){var t=this,r=Promise.withResolvers(),n=r.promise,o=r.resolve,s=r.reject;return this.getItemSameVid(e).then(function(e){if(t.log(f._.DEBUG,"[Preloader] getPreLoadData",!!e.value),e.value){var r=e.value,n=r.mediaSegList,s=r.meta,l=r.type,c=r.buffer,u=r.preloadTime,d=r.vid,h=r.cacheKey,p=r.definition,g=r.orgDefinition,v=r.byteLength,y=r.duration,m=r.fileSize,_=r.from,b=r.vtype,x=r.codecType,k=r.initSeg,L=r.bitrate,w=r.adaptTimeRange,P=r.repeatData,O=r.repeatDataStartPos,I=r.memory;o((0,i.Zj)({generateBy:"preloader",vid:d,type:l,vtype:b,codecType:x,definition:p,orgDefinition:g,bitrate:L,cacheKey:h,duration:y||0,byteLength:v,from:_,adaptTimeRange:w,repeatData:P,repeatDataStartPos:O,memory:I,meta:s,preloadTime:u,fileSize:m||0},l===a.dJ.SIZE?{buffer:c}:{initSeg:k,mediaSegList:n}))}else o(null)}).catch(function(e){s(e)}),n}},{key:"setPreLoadData",value:(r=(0,i.x)((0,i.l5)().mark(function e(t,r){var n,o,s,l,c,u,d,h,p,g,v,y,m,_,b,x,k,L,w,P,O,I,C,S,T=this;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=r.mediaSegList,o=r.meta,s=r.vid,l=r.definition,c=r.orgDefinition,u=r.type,d=r.buffer,h=r.duration,p=r.byteLength,g=r.preloadTime,v=r.fileSize,y=r.from,m=r.vtype,_=r.codecType,b=r.initSeg,x=r.bitrate,k=r.adaptTimeRange,L=r.repeatData,w=r.repeatDataStartPos,O={codecType:_,vtype:m,vid:s,definition:l,orgDefinition:c,cacheKey:P=r.cacheKey,type:u,from:y,meta:o,fileSize:v,adaptTimeRange:k,repeatData:L,repeatDataStartPos:w,bitrate:x,memory:0},O.memory+=(null==L?void 0:L.byteLength)||0,u===a.dJ.SIZE?(O.buffer=d,O.byteLength=p||0,O.preloadSize=p||0,O.preloadTime=g||0,O.fileSize=v,O.buffer&&O.buffer.byteLength>0&&(O.memory+=(null==d?void 0:d.byteLength)||0,this.setItem(t,O))):(O.mediaSegList=[],O.duration=h,O.byteLength=p||0,O.preloadTime=g||0,O.initSeg=b,O.memory+=(null==b?void 0:b.byteLength)||0,O.fileSize=v,null==n||n.forEach(function(e){var t;O.memory+=(null==e||null===(t=e.buffer)||void 0===t?void 0:t.byteLength)||0,O.mediaSegList.push(e)}),o&&0===n.length?(this.log(f._.LOG,"[Preloader] meta setPreLoadData1 success",P,null==O||null===(I=O.mediaSegList)||void 0===I?void 0:I.length),this.setItem(t,O)):(S=n.every(function(e){return!!e.buffer&&e.state}),this.log(f._.LOG,"[Preloader] mediaSegList setPreLoadData1 success",P,null==O||null===(C=O.mediaSegList)||void 0===C?void 0:C.length,S),S&&this.setItem(t,O).then(function(){T.log(f._.LOG,"[Preloader] setPreLoadData1 success",P)})));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"getInitCacheData",value:function(e,t){var r={type:e,meta:null,byteLength:0,fileSize:0,bitrate:0,preloadTime:0};return e===a.dJ.DURATION?(r.mediaSegList=[],r.initSeg=null,r.duration=0):r.buffer=null,Object.keys(t).map(function(e){r[e]=t[e]}),r}},{key:"updatePreCacheData",value:function(e,t,r,n,i,o,s,l,c,d){var h,p=e.mediaSegList;if(e.type===a.dJ.SIZE||-1===i)return e.buffer=u()(Uint8Array,(null===(h=e.buffer)||void 0===h?void 0:h.buffer)||[],new Uint8Array(t)),e;var g=-1;if(p){for(var v=0;v<p.length;v++)if(p[v].index===i){g=v;break}}var y=o||[0,0];if(g>-1&&p)t&&(p[g].buffer=u()(Uint8Array,p[g].buffer||[],new Uint8Array(t))),r.length>1&&(p[g].range.length>1?p[g].range[1]=r[1]:p[g].range=r),s&&-1!==s[1]&&(n=p[g].range[1]>=s[1]),p[g].state=n;else{e.duration=y[1],p&&p.push({buffer:t,range:r||[],index:i,totalRange:s||[],timeRange:[y[0],y[1]],muxSampleIdxRange:l,unMuxPos:c,state:n});var m="".concat(null==t?void 0:t.byteLength,",").concat(JSON.stringify(r),",").concat(i,",").concat(JSON.stringify(s),",").concat(JSON.stringify(o));this.log(f._.DEBUG,"[Preloader] ".concat(e.cacheKey," mediaSegList set, dataLen"),m)}return n&&(e.byteLength+=r[1]-r[0],e.preloadTime+=d),n}},{key:"checkCacheKey",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.l0.MP4,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s.u7.H264;if(r){var a=this.generateUniqueKey({vid:e,definition:r,vtype:n,codecType:i});return a&&this.hasItemSameVid(a)?a:null}for(var o=0;o<t.length;o++){var l=this.generateUniqueKey({vid:e,definition:t[o].definition,vtype:n,codecType:i});if(l&&this.hasItemSameVid(l))return l}return null}},{key:"getRangeStartPos",value:function(e){var t,r=this,n=null==e||null===(t=e.pktOffsetMap)||void 0===t?void 0:t.find(function(e){var t;return(null==e?void 0:e.time)===((null===(t=r.options)||void 0===t?void 0:t.firstLoadTimePos)||h.he)});return null==n?void 0:n.offset}},{key:"loadByChunkSizeUnMux",value:(n=(0,i.x)((0,i.l5)().mark(function e(t,r){var n,o,s,l,c,u,v,y,x,w,P,O,I,C,S,T,D,E,A,R,j,N,M,U,K,B,G,F=this;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.vid,o=t.cacheKey,s=t.definition,l=t.orgDefinition,c=t.duration,u=t.bitrate,v=t.codecType,y=t.vtype,x=t.size,w=t.uri,P=t.file_id,O=this.options,I=this._getLoadUrl(t)){e.next=6;break}return this._endLoadFragments(!1),e.abrupt("return");case 6:if(I=b.Z.extUrl(I,{__vid:n}),C=x||b.Z.getFileSize(u,c),T=null==(S=null==t||null===(G=t.pktOffsetMap)||void 0===G?void 0:G.find(function(e){return(null==e?void 0:e.time)===((null==O?void 0:O.firstLoadTimePos)||h.he)}))?void 0:S.offset,D=(0,p.T)(c,L.GX,C),this.log(f._.LOG,"".concat(n," loadByChunkSizeUnMux"),t.cacheKey,t.definition,T||D),E=this.getInitCacheData(a.dJ.SIZE,{vid:n,definition:s,orgDefinition:l,cacheKey:o,codecType:v,vtype:y,fileSize:x,bitrate:u||0}),A=this.getRequestOption((0,i.Zj)((0,i.Zj)({},t),{},{url:I})),this.startPCDN(I,w,n,u,P,y.toLowerCase()||"mp4",Math.floor(c),C),this.mp4Loader=new d.b({url:I,vid:"".concat(n,"-").concat(u),retry:O.retryCount||2,retryDelay:O.retryDelay||1e3,timeout:O.timeout||3e3,reqOptions:A,loaderType:O.loaderType,retryCheckFunc:m.Wp,openLog:(0,k.qw)(),memoryOpt:this.options.memoryOpt,audioGroupingStrategy:O.audioGroupingStrategy,fixEditListOffset:O.fixEditListOffset,fixEditListOffsetThreshold:O.fixEditListOffsetThreshold}),this.mp4Loader.on(h.kW,function(e){if((null==e?void 0:e.len)>0){var t,r=(null==e||null===(t=e.priOptions)||void 0===t?void 0:t.type)||g._R.CDN,i=(0,m.pl)(e.len,e.time);F.bwEventEmit(n,r,e.len,i,o)}}),e.prev=17,R=new Uint8Array(3145728),j=0,N=0,M=-1,U=null,K=null,B=function(){var e=(0,i.x)((0,i.l5)().mark(function e(r,a,s,l,c){var u,d,h,p,v,y,m,x,k,L,w,P,O,C,S,T;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!E.fileSize&&(E.fileSize=Number((0,_.Xz)(c.headers))),r&&(M>0?(u=R.slice(M-j,j+N),(null==r?void 0:r.byteLength)+N>R.byteLength?((d=b.Z.newUint8Array(R.byteLength+r.byteLength)).set(u,0),d.set(r,u.byteLength),R=d):(R.set(u,0),R.set(r,u.byteLength)),j=M,N=u.byteLength+r.byteLength):((null==r?void 0:r.byteLength)>(null===(h=R)||void 0===h?void 0:h.byteLength)&&(R=b.Z.newUint8Array(R.byteLength+r.byteLength)),R.set(r,0),N+=(null==r?void 0:r.byteLength)||0,j=s.range[0])),s.meta&&(v=(null==r||null===(p=r.priOptions)||void 0===p?void 0:p.type)||g._R.CDN,F.bwEventEmit(n,v,N,null,o),m=(y=s.meta).videoSegments,x=y.audioSegments,!E.fileSize&&(E.fileSize=b.Z.getEndFramePos(m,x)),M=b.Z.getFirstFrameStartRange(m,x),K=(0,i.Zj)((0,i.Zj)({},y.meta),{},{ext:{videoTrak:m,audioTrak:x}}),E.meta=K,U=b.Z.getFragRange(0,m,x),E.buffer=R.subarray(0,N),E.byteLength=E.buffer.byteLength,k=b.Z.getFragRange(1,m,x),L=[],k[0]<k[1]&&U[1]>k[0]&&(L=[k[0],U[1]]),P=(w=(null==m?void 0:m.length)>0?m:x)[0].startTime,C={startTime:P,endTime:O=w[0].endTime,range:(0,i.u)(U),repeatRange:L,duration:O-P,downloaded:!1,isLoading:!1,timeRangeIdx:[0,1]},E.adaptTimeRange=[C],F.log(f._.LOG,"".concat(n," loadMetaProcess ret"),o,R.byteLength,JSON.stringify(U),E.buffer.byteLength,JSON.stringify(L)),F.setPreLoadData(t,E),T=[S=j+N,U[1]],F.log(f._.LOG,"".concat(o," loadMetaProcess end, loadOneChunk start"),a,JSON.stringify(T),S,R.byteLength),F.loadOneChunk(E,T,I,C.duration,t));case 3:case"end":return e.stop()}},e)}));return function(t,r,n,i,a){return e.apply(this,arguments)}}(),!this.mp4Loader){e.next=28;break}return e.next=28,this.mp4Loader.loadMetaProcess(this.mp4Loader.cache,[0,T||D],B,{});case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(17),this._endLoadFragments(!1);case 34:case"end":return e.stop()}},e,this,[[17,30]])})),function(e,t){return n.apply(this,arguments)})},{key:"loadOneChunk",value:(o=(0,i.x)((0,i.l5)().mark(function e(t,r,n,a,o){var s,l,c,u,d,h,p,v,y,m,x;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null==r?void 0:r.length)>0&&r[0]>=r[1])){e.next=3;break}return this._endLoadFragments(),e.abrupt("return");case 3:return(l=(null===(s=this._pcdnNodeList)||void 0===s?void 0:s.length)>0?b.Z.extUrl(this._pcdnNodeList[0].url,{__vid:t.vid}):null)&&g.Yx.pcdn_download_request_cnt++,this.log(f._.LOG,"".concat(null==t?void 0:t.cacheKey," loadOneChunk start"),JSON.stringify(r),",loadType,",!!l),c=l||n,u=t.vid,d=t.cacheKey,h=t.buffer,e.prev=8,e.next=11,null===(p=this.mp4Loader)||void 0===p?void 0:p.loadData(r,this.mp4Loader.cache,{index:0,url:c,headers:l?{"X-Origin-Server-Host":b.Z.getHostFromUrl(n)}:null,priOptions:{type:l?g._R.PCDN:g._R.CDN}});case 11:v=e.sent,this.log(f._.LOG,"".concat(u," loadOneChunk"),JSON.stringify(r),d),y=v.response,(m=v.data)?(this._endLoadFragments(),y&&y.headers&&(x=Number((0,_.Xz)(y.headers)))&&(t.fileSize=x),t.buffer=b.Z.concatData(h,m),t.byteLength=t.buffer.byteLength,t.preloadTime+=a,this.log(f._.LOG,"".concat(u," loadOneChunk ret"),d,t.buffer.byteLength,null==m?void 0:m.byteLength),t.from=4,this.setPreLoadData(o,t)):(g.Yx.pcdn_download_failed_cnt++,this._endLoadFragments(!1)),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(8),this.log(f._.ERROR,"[Preloader] ".concat(u," loadByChunkSize error"),null===e.t0||void 0===e.t0?void 0:e.t0.message),this._endLoadFragments(!1);case 21:case"end":return e.stop()}},e,this,[[8,17]])})),function(e,t,r,n,i){return o.apply(this,arguments)})},{key:"loadByPreloadTime",value:(c=(0,i.x)((0,i.l5)().mark(function e(t,r){var n,o,s,l,c,u,d,h,p,y,m,_,x,k,L,w,P,O,I,C,S,T=this;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.vid,o=t.cacheKey,s=t.preloadTime,l=t.definition,c=t.orgDefinition,u=t.duration,d=t.bitrate,h=t.codecType,p=t.vtype,y=t.size,m=t.uri,_=t.file_id,x=this._getLoadUrl(t)){e.next=6;break}return this._endLoadFragments(!1),e.abrupt("return");case 6:return x=b.Z.extUrl(x,{__vid:n}),k=s>=this.options.segmentMinDuration?this.options.segmentMinDuration:s,L=this.getRequestOption((0,i.Zj)((0,i.Zj)({},t),{},{_url:x})),this.log(f._.DEBUG,"[Preloader] loadByPreloadTime","".concat(t.cacheKey,", definition:").concat(t.definition,",segmentMinDuration:").concat(k),L),w=y||b.Z.getFileSize(d,u),P=this.getRangeStartPos(t),O=this.createConfig(t,L,P,w,k),this.mp4=new v.Z(x,d,O,[],"[Preloader]"),I=this.getInitCacheData(a.dJ.DURATION,{vid:n,definition:l,orgDefinition:c,cacheKey:o,codecType:h,vtype:p,bitrate:d||0}),this.startPCDN(x,m,n,d,_,p.toLowerCase()||"mp4",Math.floor(u),w),null!=r&&null!==(C=r.meta)&&void 0!==C&&C.ext?(this.uddatePreCacheInfoByCache(r,I),this.updateMP4InfoByCache(r)):this.mp4.once(g.kL.META_READY,function(){var e=(0,i.x)((0,i.l5)().mark(function e(r,n){var a;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n||n.hasDestroyed)){e.next=2;break}return e.abrupt("return");case 2:return T.log(f._.DEBUG,"[Preloader] ".concat(t.vid," metaReady ").concat(null==I||null===(a=I.mediaSegList)||void 0===a?void 0:a.length)),I.meta=r,I.from=2,I.fileSize=n.size,e.next=8,n.cancelLoading();case 8:if(!n.hasDestroyed){e.next=10;break}return e.abrupt("return");case 10:return n.metaLoading=!1,e.next=13,T.setPreLoadData(t,I);case 13:if(!n.hasDestroyed){e.next=15;break}return e.abrupt("return");case 15:T.startLoadByFragments(I,t);case 16:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),this.mp4EventAdd(t.vid,I.cacheKey),e.next=20,this.mp4.init(r);case 20:if(this.mp4){e.next=22;break}return e.abrupt("return");case 22:null!=r&&null!==(S=r.meta)&&void 0!==S&&S.ext&&this.startLoadByFragments(I,t);case 23:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"bwEventEmit",value:function(e,t,r,n,i){var a,o,l=(null===(a=this._pendingTask.data)||void 0===a?void 0:a.duration)||0,c=(null===(o=this._pendingTask.data)||void 0===o?void 0:o.bitrate)||0;this.preloadManager.bwEventEmit({vid:e,loadType:t,size:r,speed:n,cacheKey:i,vtype:s.l0.MP4,duration:l,bitrate:c})}},{key:"startPCDN",value:function(e,t,r,n,i,a,o,s){var l=this;if(this._pcdn){if(null===(c=this.mp4)||void 0===c||c.updatePCDNState(g.oy.OPEN),!(0,m.Pj)(e)){;e=document.location.protocol+e}this.curPCDNReqId=(u=t||r,d=n,u.slice(-20)+d);var c,u,d,h={vid:t,cdn_url:e,sfid:i,file_type:a,bitrate:n,duration:Math.floor(o),size:s};this.log(f._.DEBUG,"[Preloader] ".concat(r," get peer start")),this._pcdn.fetchPCDNNode(null,h,this.curPCDNReqId).then(function(e){var t;if(null!=e&&e.req_id&&e.req_id!==l.curPCDNReqId){l.log(f._.LOG,",[Preloader] fetchPCDNNode not match reqId",l.curPCDNReqId,", pcdnRet.req_id",e.req_id);return}l.log(f._.LOG,"[Preloader] ".concat(r," get peer end,pcdn node update,"),null==e||null===(t=e.nodes)||void 0===t?void 0:t.length),l.mp4?l.mp4.updateNode(null==e?void 0:e.nodes):l._pcdnNodeList=(null==e?void 0:e.nodes)||null}).catch(function(t){var r,n,i,a=b.Z.checkUrlIsExpired(e);1===a&&l._pcdn&&(l._pcdn=void 0);var o=(null==t||null===(r=t.response)||void 0===r?void 0:r.url)||(null===(n=l.options)||void 0===n||null===(n=n.pcdnConfig)||void 0===n?void 0:n.trackerUrl);l.emit("source_error",{host:b.Z.getHostFromUrl(o),src:o,errorCode:null==t||null===(i=t.response)||void 0===i?void 0:i.status,message:"".concat(null==t?void 0:t.message,"-").concat(a,"_preload")})})}}},{key:"_getLoadUrl",value:function(e){var t="Array"===b.Z.typeOf(e.url)?e.url[0].src:e.url;return this.preloadManager.preProcessUrl&&(t=this.preloadManager.preProcessUrl(t).url),t}},{key:"mp4EventAdd",value:function(e,t){var r,n=this;this.mp4.on(g.kL.ERROR,function(t){n.log(f._.ERROR,"[Preloader] ".concat(e," load error ").concat(null==t?void 0:t.errorCode,", ").concat((null==t?void 0:t.errorMessage)||(null==t?void 0:t.message)," ")),n._endLoadFragments(!1)}),this.mp4.on(g.kL.REMOVE_PCDN_NODE,function(e){n._pcdn&&e&&n._pcdn.removePCDNNode(e.vid,e.bitrate,e.url)}),this.mp4.on(g.kL.CANCEL_LOADED_LEN,function(r){n.bwEventEmit(e,r.load_type,r.len,null,t)}),null===(r=this.mp4.MP4Loader)||void 0===r||r.on(h.kW,function(r){if((null==r?void 0:r.len)>0){var i,a=(null==r||null===(i=r.priOptions)||void 0===i?void 0:i.type)||g._R.CDN,o=(0,m.pl)(r.len,r.time);n.bwEventEmit(e,a,r.len,o,t)}})}},{key:"createConfig",value:function(e,t,r,n,i){var a=e.vid,o=e.duration,s=this.options,l=s.preloadSize,c=s.memoryOpt,u=s.supportHevc,d=s.emitMediaListControl,f=s.audioGroupingStrategy,h=s.fixEditListOffsetThreshold,p=s.fixEditListOffset,g=s.segmentMinDuration;return{segmentDuration:i||g,codecType:this.codecType,chunkSize:l,firstLoadSize:r,duration:o,fileSize:n,playerId:this.playerId,vid:a,useUrlRange:!1,retryCount:1,retryDelay:1e3,supportHevc:u,retryCheckFunc:m.Wp,switchPCDNMaxCnt:Number.MAX_VALUE,logger:this.logger,reqOptions:t,memoryOpt:c,emitMediaListControl:d,audioGroupingStrategy:f,fixEditListOffset:p,fixEditListOffsetThreshold:h,loadRangeType:this.loadRangeType}}},{key:"uddatePreCacheInfoByCache",value:function(e,t){t.meta=e.meta,t.from=5,t.fileSize=e.fileSize,t.mediaSegList=e.mediaSegList||t.mediaSegList||[],t.repeatData=e.repeatData,t.repeatDataStartPos=e.repeatDataStartPos,t.initSeg=e.initSeg,t.adaptTimeRange=e.adaptTimeRange,t.byteLength=e.byteLength}},{key:"updateMP4InfoByCache",value:function(e){var t;if(e.initSeg&&(this.mp4._needInitSegment=!1),e.adaptTimeRange&&(this.mp4.adaptTimeRange=e.adaptTimeRange),(null===(t=e.mediaSegList)||void 0===t?void 0:t.length)>0){var r=e.mediaSegList,n=r[r.length-1].muxSampleIdxRange,i=n.video,a=n.audio;this.mp4.lastDemuxSampleIdxRange.video=i,this.mp4.lastDemuxSampleIdxRange.audio=a}}},{key:"loadByChunkSize",value:(P=(0,i.x)((0,i.l5)().mark(function e(t,r){var n,o,s,l,c,u,d,h,v,m,_,x,k,w,P,O,I,C,S,T=this;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.vid,o=t.cacheKey,s=t.definition,l=t.orgDefinition,c=t.duration,u=t.bitrate,d=t.codecType,h=t.vtype,v=t.size,m=t.uri,_=t.file_id,this.options,x=this._getLoadUrl(t)){e.next=6;break}return this._endLoadFragments(!1),e.abrupt("return");case 6:if(x=b.Z.extUrl(x,{__vid:n}),k=v||b.Z.getFileSize(u,c),w=this.getRangeStartPos(t),P=(0,p.T)(c,L.GX,k),this.log(f._.LOG,"".concat(n," loadByChunkSize"),t.cacheKey,t.definition,w||P),O=this.getInitCacheData(a.dJ.DURATION,{vid:n,definition:s,orgDefinition:l,cacheKey:o,codecType:d,vtype:h,fileSize:v,bitrate:u||0}),I=this.getRequestOption((0,i.Zj)((0,i.Zj)({},t),{},{url:x})),this.startPCDN(x,m,n,u,_,h.toLowerCase()||"mp4",Math.floor(c),k),C=this.createConfig(t,I,w||P,k,null),this.mp4=new y.Z(x,u,C,[],"[Preloader]"),this.mp4EventAdd(t.vid,O.cacheKey),S=-1,!(null!=r&&r.meta)){e.next=26;break}return this.uddatePreCacheInfoByCache(r,O),this.updateMP4InfoByCache(r),e.next=23,this.mp4.init(r);case 23:this.startLoadBySize(O,t),e.next=29;break;case 26:this.mp4.once(g.kL.META_READY,function(){var e=(0,i.x)((0,i.l5)().mark(function e(r,n){return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n||n.hasDestroyed)){e.next=2;break}return e.abrupt("return");case 2:return T.log(f._.DEBUG,"[Preloader] ".concat(t.vid," metaReady, metaReq, ").concat(S)),O.meta=r,O.from=2,O.fileSize=n.size,e.next=8,T.setPreLoadData(t,O);case 8:if(!n.hasDestroyed){e.next=10;break}return e.abrupt("return");case 10:1===S&&(S=2,T.startLoadBySize(O,t));case 11:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),this.mp4.once(g.kL.META_REQ_DONE,function(e){if(!!e&&!e.hasDestroyed){T.log(f._.DEBUG,"[Preloader] ".concat(t.vid," metaReq done,meta:， ").concat(!!e.meta));var r=e.repeatInfo,n=r.curDataPos,i=r.startPos,a=r.data;n>0&&(O.repeatData=a.subarray(0,n),O.repeatDataStartPos=i),e.meta?(S=2,T.startLoadBySize(O,t)):S=1}}),this.mp4.init(r);case 29:case"end":return e.stop()}},e,this)})),function(e,t){return P.apply(this,arguments)})},{key:"findLoadAdaptTimeRangeIdx",value:function(e){var t,r,n=this,i=e.steps,a=e.stepIdx,o=e.preloadTime,l=0,c=null===(t=this.mp4)||void 0===t?void 0:t.adaptTimeRange,u=!(null!==(r=this.options)&&void 0!==r&&r.openStepwiseType)||this.options.openStepwiseType.toUpperCase()===s.l0.MP4;if(this.stepwise&&u&&Array.isArray(i)&&i.length>0&&"number"==typeof a){var d,f=i[a];if((!c||(null==c?void 0:c.length)<(null==i?void 0:i.length))&&i.map(function(e,t,r){return e-(0===t?0:r[t-1])}).forEach(function(e){if(!Array.isArray(c)||0===c.length||c[c.length-1].endTime<i[i.length-1]){var t;null===(t=n.mp4)||void 0===t||t.updateAdaptTimeRange(null,e||o||5)}}),c)for(var h=0;h<c.length;h++)if(c[h].startTime<=f)l=h;else break;null===(d=this.mp4)||void 0===d||d.getFragRange(l)}else if(!c||(null==c?void 0:c.length)===0){var p,g,v=null===(p=this.mp4)||void 0===p?void 0:p.updateAdaptTimeRange(null,o||5);null===(g=this.mp4)||void 0===g||g.getFragRange(v),l=v}return l}},{key:"updateAdaptTimeRangeState",value:function(e,t){var r=e.mediaSegList;if(!!r&&!((null==r?void 0:r.length)<=0))r.forEach(function(e,r){var n;e.state&&(null==e||null===(n=e.buffer)||void 0===n?void 0:n.byteLength)>0&&r<(null==t?void 0:t.length)&&(t[r].downloaded=!0)})}},{key:"startLoadBySize",value:(O=(0,i.x)((0,i.l5)().mark(function e(t,r){var n,a,o,s,l,c,u,d,h,p,g,v=this;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.vid,a=this.mp4,o=this.findLoadAdaptTimeRangeIdx(r),!(!(s=null==a?void 0:a.adaptTimeRange)||!(null!=s&&s.length))){e.next=8;break}return this.log(f._.ERROR,"[Preloader] ".concat(n," adaptTimeRange is null")),this._endLoadFragments(!1),e.abrupt("return");case 8:if(this.updateAdaptTimeRangeState(t,s),(l=s.findIndex(function(e){return!e.downloaded}))>=0&&(o=Math.min(l,o)),c=s[o].range,this.log(f._.LOG,"[Preloader] ".concat(n,"$ startLoadBySize, loading ").concat(o),s?s[o].downloaded:"",s),!(s&&s[o].downloaded)){e.next=16;break}return this._endLoadFragments(),e.abrupt("return");case 16:if(e.prev=16,u=function(e){v.log(f._.ERROR,"[Preloader] ".concat(n," failedCallback error"),null==e?void 0:e.message),v._endLoadFragments(!1)},d=function(){var e=(0,i.x)((0,i.l5)().mark(function e(n){var a,o,l,c,h,p,y,m,_,b,x,k,L;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(null!=n&&n.mp4)||null!=n&&n.mp4.hasDestroyed)){e.next=2;break}return e.abrupt("return");case 2:if(o=n.mp4,l=n.buffer,c=n.state,h=n.context,p=n.initSeg,y=n.lastRemainBufferInfo,m=o.adaptTimeRange,_=h.fragIndex,b=h.timeRange,x=null===(a=m[_])||void 0===a?void 0:a.range,!t.initSeg&&p&&(t.initSeg=p,t.adaptTimeRange=m),k=o.lastDemuxSampleIdxRange,t.repeatData=y.data,t.repeatDataStartPos=y.pos,v.log(f._.LOG,"[Preloader] ".concat(t.cacheKey," lastUnMuxData, ").concat(_,", \n            appendLastUnMuxData start: ").concat(t.repeatDataStartPos," \n            end: ").concat(t.repeatDataStartPos+t.repeatData.byteLength)),L=v.updatePreCacheData(t,l,x,c,_,b,x,k,y.pos,m[_].duration),v.log(f._.LOG,"[Preloader] ".concat(t.cacheKey," successCallback"),h.fragIndex,c,L),t.from=3,!L){e.next=27;break}return e.next=18,v.setPreLoadData(r,t);case 18:if(!(s&&_>=s.length-1||v.stepwise)){e.next=24;break}return v.log(f._.LOG,"[Preloader] ".concat(t.cacheKey," mp4.load end"),_),v._endLoadFragments(!0),e.abrupt("return");case 24:return v.appendLastUnMuxData(_+1,t),e.next=27,o.loadAllFragmentData(_+1,d,u,!1,g);case 27:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),h=t.repeatData,p=t.repeatDataStartPos,!this.checkCacheIsHasAllData(c,t)){e.next=26;break}return this.log(f._.LOG,"[Preloader] ".concat(n," startLoadBySize loadIdx:").concat(o," , cache has all data,loadIdx:").concat(o," range:").concat(c)),this.mp4._loadSuccessCallBack=d,this.mp4._mux(h.subarray(c[0]-p),c[0],o,!0),e.abrupt("return");case 26:return g=[(null==h?void 0:h.byteLength)>0&&p<=c[0]&&p+h.byteLength<c[1]?p+h.byteLength:c[0],s[o].range[1]],this.appendLastUnMuxData(o,t),e.next=31,this.mp4.loadAllFragmentData(o,d,u,!1,g);case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(16),this.log(f._.ERROR,"[Preloader] ".concat(t.cacheKey," mp4.load error"),o),this._endLoadFragments(!1);case 37:case"end":return e.stop()}},e,this,[[16,33]])})),function(e,t){return O.apply(this,arguments)})},{key:"checkCacheIsHasAllData",value:function(e,t){var r=t.repeatData,n=t.repeatDataStartPos;return!!((null==r?void 0:r.byteLength)>0)&&!!((null==e?void 0:e[0])>=n)&&!!((null==e?void 0:e[1])<=n+(null==r?void 0:r.byteLength))||!1}},{key:"appendLastUnMuxData",value:function(e,t){var r;(null===(r=t.repeatData)||void 0===r?void 0:r.byteLength)>0&&(this.log(f._.LOG,"[Preloader] ".concat(t.cacheKey," appendLastUnMuxData, ").concat(e,", \n            appendLastUnMuxData start: ").concat(t.repeatDataStartPos," \n            end: ").concat(t.repeatDataStartPos+t.repeatData.byteLength)),this.mp4.setLastMuxRemainBufferInfo(t.repeatData,t.repeatDataStartPos))}},{key:"startLoadByFragments",value:(I=(0,i.x)((0,i.l5)().mark(function e(t,r){var n,a,o,s,l,c,u,d=this;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.vid,this.log(f._.LOG,"[Preloader] ".concat(n," startLoadByFragments"),r),a=this.findLoadAdaptTimeRangeIdx(r),!(!(o=null===(u=this.mp4)||void 0===u?void 0:u.adaptTimeRange)||!(null!=o&&o.length))){e.next=8;break}return this.log(f._.ERROR,"[Preloader] ".concat(n," adaptTimeRange is null")),this._endLoadFragments(!1),e.abrupt("return");case 8:if(this.updateAdaptTimeRangeState(t,o),(s=o.findIndex(function(e){return!e.downloaded}))>=0&&(a=Math.min(s,a)),this.log(f._.LOG,"[Preloader] loading ".concat(a),o?o[a].downloaded:"",o),!(o&&o[a].downloaded)){e.next=15;break}return this._endLoadFragments(),e.abrupt("return");case 15:if(l=function(e){d.log(f._.ERROR,"[Preloader] ".concat(n," failedCallback error"),null==e?void 0:e.message),d._endLoadFragments(!1)},c=function(){var e=(0,i.x)((0,i.l5)().mark(function e(n){var a,s,u,h,p,g,v,y,m,_,b,x,k,L,w,P;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(null!=n&&n.mp4)||null!=n&&null!==(a=n.mp4)&&void 0!==a&&a.hasDestroyed)){e.next=2;break}return e.abrupt("return");case 2:if(h=n.mp4,p=n.buffer,g=n.context,v=n.state,y=n.initSeg,m=g.fragIndex,_=g.range,b=g.timeRange,x=h.repeatInfo,L=null===(s=(k=h.adaptTimeRange)[m])||void 0===s?void 0:s.range,!t.initSeg&&y&&(t.initSeg=y,t.adaptTimeRange=k),w=h.lastDemuxSampleIdxRange,t.repeatData=(null===(u=x.data)||void 0===u?void 0:u.slice(0,x.curDataPos))||[],P=d.updatePreCacheData(t,p,_,v,m,b,L,w,-1,k[m].duration),d.log(f._.LOG,"[Preloader] ".concat(t.cacheKey," successCallback"),m,v,P),t.from=3,!P){e.next=25;break}return e.next=16,d.setPreLoadData(r,t);case 16:if(!(o&&m>=o.length-1||d.stepwise)){e.next=22;break}return d.log(f._.LOG,"[Preloader] ".concat(t.cacheKey," mp4.load end"),m),d._endLoadFragments(!0),e.abrupt("return");case 22:return d.log(f._.LOG,"[Preloader] ".concat(t.cacheKey," mp4.load start"),m+1),e.next=25,h.loadAllFragmentData(m+1,c,l);case 25:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),!this.mp4){e.next=20;break}return e.next=20,this.mp4.loadAllFragmentData(a,c,l);case 20:case"end":return e.stop()}},e,this)})),function(e,t){return I.apply(this,arguments)})},{key:"_endLoadFragments",value:function(e){this.log(f._.LOG,"[Preloader] _endLoadFragments ".concat(this.playerId)),null!==(t=this._pendingTask)&&void 0!==t&&t.resolve&&(null===(i=this._pendingTask)||void 0===i||i.resolve(),this._pendingTask.resolve=void 0);var t,r,n,i,a=!(null!==(r=this.options)&&void 0!==r&&r.openStepwiseType)||this.options.openStepwiseType.toUpperCase()===s.l0.MP4;null!==(n=this._pendingTask)&&void 0!==n&&n.data&&(this.stepwise&&(!1===e||!a)&&this._pendingTask.data.payload&&(this._pendingTask.data.payload.stepIdx=1/0),this._pendingTask.data=void 0),this.mp4&&(this.mp4.destroy(),this.mp4.cancelLoading(),this.mp4=void 0),this.mp4Loader&&(this.mp4Loader.cancel(),this.mp4Loader.destroy(),this.mp4Loader=void 0)}},{key:"hasItemSameVid",value:function(e){if(!e)return null;for(var t=e.split("#"),r=this.allCachedKeys,n=0;n<r.length;n++){var i=r[n];if(i===e)return i;var a=i.split("#");if(a.length>=4&&t.length>=4&&a[0]===t[0]){if(0===a[2].indexOf("pretime")&&0===t[2].indexOf("pretime"))return i;var o=[parseInt(a[2]),parseInt(a[3])],s=[parseInt(t[2]),parseInt(t[3])];if(s[0]>=o[0]&&s[1]>s[0]&&s[1]<=o[1])return i}}return null}},{key:"getItemSameVid",value:(C=(0,i.x)((0,i.l5)().mark(function e(t){var r,n,a;return(0,i.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(r=S.generateUniqueKey(t))&&this.hasItemSameVid(r),this.log(f._.DEBUG,"getItemSameVid: key:".concat(r," checkResult:").concat(n)),n){e.next=5;break}return e.abrupt("return",{});case 5:return e.next=7,this.preloadManager.getItem(t);case 7:return a=e.sent,e.abrupt("return",{value:a,key:n});case 9:case"end":return e.stop()}},e,this)})),function(e){return C.apply(this,arguments)})},{key:"setItem",value:function(e,t){return this.preloadManager.setItem(e,t,!1)}},{key:"clearPreloaderList",value:function(){(0,i.Vx)(S,"clearPreloaderList",this,3)([])}},{key:"setUserSelectDefinition",value:function(e){this.preloadManager&&this.preloadManager.setUserSelectDefinition(e)}},{key:"getUserSelectDefinition",value:function(){return this.preloadManager.getUserSelectDefinition()}},{key:"cancel",value:function(){this.log(f._.LOG,"cancelLoading"),this._endLoadFragments()}},{key:"destroy",value:function(){this.cancel()}},{key:"on",value:function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];(0,i.Vx)(S,"on",this,3)([e,t].concat(n))}},{key:"off",value:function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];(0,i.Vx)(S,"off",this,3)([e,t].concat(n))}}],[{key:"vtype",get:function(){return s.l0.MP4}},{key:"PRELOAD_TYPES",get:function(){return a.dJ}},{key:"getDefaultConfig",value:function(){return(0,L._K)()}},{key:"getInfoByUniqueKey",value:function(e){var t=e.split("#"),r=["vid","mediaType","codecType","vtype","definition"],n={};return t.forEach(function(e,t){n[r[t]]=e}),n}},{key:"generateUniqueKey",value:function(e){var t=e.vid,r=e.mediaType,n=e.definition,i=e.codecType,a=e.vtype;return(r=r||"video",n=n||"-1",i=i||s.u7.H264,a=a||s.l0.MP4,t)?"".concat(t,"#").concat(r,"#").concat(i,"#").concat(a,"#").concat(n):null}}])}(o.d)},539590:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(884504);r(919402);var i=r(402482),a=(0,n.qH)(function e(t,r,a,o){(0,n.PA)(this,e),this.adaptRangeRes=[],o&&(this.adaptRange=new i.Q(t,r,a,o))},[{key:"push",value:function(e){var t;null===(t=this.adaptRangeRes)||void 0===t||t.push(e)}},{key:"pop",value:function(){var e;return null===(e=this.adaptRangeRes)||void 0===e?void 0:e.shift()}},{key:"updateBitrate",value:function(e){var t;null===(t=this.adaptRange)||void 0===t||t.updateBitrate(e)}},{key:"getAdaptCacheBuffer",value:function(e){var t,r=null===(t=this.adaptRange)||void 0===t?void 0:t.getAdaptCacheBuffer();return(Number.isNaN(r)||!r)&&(r=e),r}},{key:"destroy",value:function(){this.adaptRange=null,this.adaptRangeRes=[]}}])},569898:function(e,t,r){r.d(t,{ZP:function(){return h},jl:function(){return f},qu:function(){return a}}),r(514312),r(11258),r(227470),r(677546);var n=r(280161),i=r(41866),a=function(){return"undefined"!=typeof window&&(window.location.search.indexOf("log=true")>-1||!!n.Xb.getItem("abrdebug")||!!n.Xb.getItem("playerlog"))}(),o=new i.Y("Logger",{logCacheLevel:i._.DEBUG});a&&i.Y.enable();var s={},l={log:"log",network:"network",abr:"abr",encrypt:"encrypt",segment:"segment",definition:"definition",content:"content",mse:"mse",media:"media",time:"time",preload:"preload",gap:"gap"},c=["abr"],u=function(e){c.includes(e)?a?s[e]=function(){for(var t,r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,["[".concat(e,"]"),new Date().toLocaleString()].concat(n))}:s[e]=function(){}:s[e]=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];o.log.apply(o,["[".concat(e,"]")].concat(r))}};for(var d in l)u(d);function f(){return o}let h=s},171138:function(e,t,r){r.d(t,{GK:function(){return d},Rl:function(){return a},eO:function(){return f},s8:function(){return l},te:function(){return u}});var n,i=r(811156);function a(e){return(0,i.Zj)({disabled:!1,algType:o.RAISEROPT,scaleType:s.SCALE_20X_LEGACY,backend:c.OPENGL,poolSize:2,maxWidth:2048,maxHeight:2048,wasmUrl:"",degradeFrameRate:.15,degradeFrameRateCount:3,canvasId:"",useVFC:!0,isSingle:!1,threshold:2,minRenderCount:20,useDelayedSR:!1,useScale:!1,useVideoTexture:!1},e)}var o={RAISEROPT:2},s={SCALE_20X_LEGACY:0,SCALE_15X:1,SCALE_11X:4,SCALE_12X:8,SCALE_13X:16,SCALE_14X:32},l=(n={},(0,i._x)(n,s.SCALE_20X_LEGACY,2),(0,i._x)(n,s.SCALE_11X,1.1),(0,i._x)(n,s.SCALE_12X,1.2),(0,i._x)(n,s.SCALE_13X,1.3),(0,i._x)(n,s.SCALE_14X,1.4),(0,i._x)(n,s.SCALE_15X,1.5),n),c={OPENGL:3},u={SUCCESS:0,WASM_URL_MISS:1,WASM_INIT_FAIL:2,WASM_RENDER_FAIL:3,FPS_DEGRADE:4,SR_DISABLED:5,NOT_ACTIVE:6,NOT_PLAY:7,LIMIT_WIDTH_HEIGHT:8,WASM_NOT_READY:9,WASM_LOADED_FAILED:10,WEBGL_CONTEXT_LOST:11,HIJACK:12,ENCRYPTED:13},d=[u.WEBGL_CONTEXT_LOST,u.WASM_URL_MISS,u.WASM_RENDER_FAIL],f={"-100":{recover:!1,msg:"内存错误"},"-200":{recover:!0,msg:"参数错误"},"-201":{recover:!0,msg:"未创建超分处理上下文"},"-300":{recover:!1,msg:"GL错误"},"-600":{recover:!1,msg:"hydra错误"}}},154340:function(e,t,r){r.d(t,{i:function(){return n}});var n="1.0.13"},395770:function(e,t,r){function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{$w:function(){return i},Kd:function(){return h},PA:function(){return a},XW:function(){return c},Zj:function(){return f},qH:function(){return s},u:function(){return g}});function i(e,t,r){return t=l(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,v(n.key),n)}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(u=function(){return!!e})()}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){var n,i,a;n=e,i=t,a=r[t],(i=v(i))in n?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function h(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if(({}).hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function g(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}},989798:function(e,t,r){r.d(t,{$w:function(){return n},PA:function(){return i},XW:function(){return c},Zj:function(){return f},_x:function(){return s},qH:function(){return o}});function n(e,t,r){return t=l(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,r||[],l(e).constructor):t.apply(e,r))}function i(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function o(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,r){return(t=p(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(u=function(){return!!e})()}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}},975048:function(e,t,r){r.d(t,{s:function(){return p}});var n=r(673295);r(585322),r(514312),r(724356),r(969642),r(561999),r(864614),r(632852),r(210434),r(947478);var i=r(344584),a=r(159322),o=r.n(a),s=r(809068),l=r(678480),c=r(814162),u=r(20440),d=r(743107),f=["vid","loadType","size","speed","cacheKey","vtype","duration","bitrate"],h=!1,p=function(e){(0,n.XW)(y,e);var t,r,a,o,p,g,v=(0,n.WY)(y);function y(){var e;return(0,n.PA)(this,y),(e=v.call(this))._loaders={},e._loaderInsts={},e._taskIntervalId=0,e._currentPreloadInst=null,e._preloadDataList=[],e._player=null,e._stepwise=!1,e._playingVids=[],e._isOpen=!0,e._userDefinition=null,e._startDefinition=null,e.onPreloadNext=(0,n.x)((0,n.l5)().mark(function t(){var r,i,a,o,l,c,u,d,f,h,p,g,v,y;return(0,n.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(a=(0,n.Lc)(e))._preloadDataList,l=a._config,!(!e._isOpen||e._currentPreloadInst||e._preloadDataList.length<1)){t.next=3;break}return t.abrupt("return",!1);case 3:if(u=null==(c=e.findPreloadItem(o,!1))?void 0:c.data,!(!c||!(null!=u&&u.payload))){t.next=7;break}return t.abrupt("return",!1);case 7:if(d=null,d=e.selectBeforeStart(u),e._filterMixPayload(u,d),e.setStartDefinition(null===(r=d)||void 0===r?void 0:r.definition),e.log("log","selectBeforeStart",null===(i=d)||void 0===i?void 0:i.vtype,d),f=e._getPreloaderKey(d||u)){t.next=17;break}return e.log("warn","need to set vtype, no preloader",u),l.autoPreload&&e.emit(s.KR.PRELOAD_NEXT),t.abrupt("return",!1);case 17:if(h=e._getLoaderInst(f)){t.next=23;break}if(p=e._getLoader(f)){t.next=22;break}return t.abrupt("return",!1);case 22:h=new p((0,n.Lc)(e),e._config);case 23:return e._currentPreloadInst=h,e._currentPreloadInst.setData(u),e._emitEvtByStart(u),t.prev=26,e.log("log","loaderInst.start",f,e.getStartDefinition(),u),t.next=30,h.start(u,e.getStartDefinition());case 30:(g=t.sent)&&g.remove&&(v=o.indexOf(c))>-1&&o.splice(v,1),t.next=37;break;case 34:t.prev=34,t.t0=t.catch(26),e.log("error","preload data error!",t.t0);case 37:return t.prev=37,null===(y=e._currentPreloadInst)||void 0===y||y.setData(null),e._currentPreloadInst=null,e._config.autoPreload&&e.emit(s.KR.PRELOAD_NEXT),t.finish(37);case 42:return t.abrupt("return",!0);case 43:case"end":return t.stop()}},t,null,[[26,34,37,42]])})),e._stats=new c.Z((0,n.Lc)(e)),e}return(0,n.qH)(y,[{key:"VTYPES",get:function(){return i.l0}},{key:"player",get:function(){return this._player}},{key:"stepwise",get:function(){return this._stepwise}},{key:"realTimeSpeed",get:function(){return this._stats.realTimeSpeed}},{key:"currentPreloadInst",get:function(){return this._currentPreloadInst}},{key:"cacheInst",get:function(){return this._cacheInst}},{key:"preloadDataList",get:function(){return this._preloadDataList}},{key:"log",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];h&&(t=console)[e].apply(t,["[PreloaderManager]"].concat(n))}},{key:"register",value:function(e){try{if("undefined"==typeof window){this.log("preloader in ssr");return}var t=y.getDefaultConfig();this._config=Object.assign({},t,e.config),this._options=e;var r=this._config,n=r.preloadMaxCacheCount,i=r.preloadCacheType;this._stepwise=!!this._config.stepwise,this._cacheInst=new l.Z(n,i),this._selector=e.BitrateSelector,this.on(s.KR.PRELOAD_NEXT,this.onPreloadNext);for(var a=e.loaders,o=0;o<a.length;o++)this.registerLoader(a[o].vtype,a[o])}catch(e){this.log("register error",e)}}},{key:"registerLoader",value:function(e,t){e&&(this._loaders[e]&&this.log("warn","vtype:".concat(e," Preloader already exist")),this._loaders[e]=t,this._loaderInsts[e]=new t(this,this._config))}},{key:"_checkIfCanPreload",value:function(){if(null===this._currentPreloadInst&&this._preloadDataList.length>0){var e=this.findPreloadItem(this._preloadDataList),t=null==e?void 0:e.data;if(this._wipPreloadTask=e,e&&null!=t&&t.payload){if(!this._getPreloaderKey(t))return this.log("warn","need to set vtype"),this.stopCheckTask(),!1;var r=this._config.checkIfCanPreload;if(r&&"function"==typeof r)return r(t);if(this._config.autoCheckPreload)return this._autoCheckPreload(t,e);else this.stopCheckTask()}}return!1}},{key:"_autoCheckPreload",value:function(e,t){return this._media?(0,d.xF)(this._media,this._config,this.log):(this.log("warn","need set video"),!1)}},{key:"_getPreloaderKey",value:function(e){return e.vtype?e.vtype.toUpperCase():""}},{key:"_sort",value:function(e){e.sort(function(e,t){return void 0===e.order&&void 0===t.order||"number"==typeof e.order&&"number"==typeof t.order&&e.order<t.order?-1:1})}},{key:"_addPlayingVid",value:function(e,t){var r=this._playingVids,n=(0,d.PK)(this._playingVids,"playerId",e);n>-1?r[n].vid=t:r.push({vid:t,playerId:e})}},{key:"selectBeforeStart",value:function(e){var t=e.targetDefinition,r=e.defaultDefinition;if(t)return(0,n.Zj)({},t);var i=this.getUserSelectDefinition(),a=this.selectBitrate(null==e?void 0:e.payload,r,i),o=(null==a?void 0:a.vtype)||e.vtype,s=(0,n.Zj)((0,n.Zj)({},a),{},{vtype:o});return e.targetDefinition=s,this.log("log","selectBeforeStart",null==e?void 0:e.vid,o,null==a?void 0:a.definition,null==e?void 0:e.payload,a),s}},{key:"selectBitrate",value:function(e,t,r){if(e.length<1)return null;var i,a,o,s=null;if(this._selector)s=this._selector.getSuitableBitrate(e,r),this.log("log","BitRateAdapter result",null===(i=s)||void 0===i?void 0:i.vtype,null===(a=s)||void 0===a?void 0:a.definition,null===(o=s)||void 0===o?void 0:o.bitrate);else{for(var l=-1,c=-1,u=0;u<e.length;u++){var d=e[u];r&&d.definition===r?l=u:t&&d.definition===t&&(c=u)}s=e[l>=0?l:c>=0?c:0]}return(0,n.Zj)({},s)}},{key:"startCheckTask",value:function(){var e=this,t=this._preloadDataList,r=this._currentPreloadInst,n=this._config.autoCheck;if(this._taskIntervalId&&(clearTimeout(this._taskIntervalId),this._taskIntervalId=0),null!=r&&r.taskInProgress&&(0,d.fQ)(this._media,this._config,this.log)){this.cancelPreloadingTask();return}if(0!==t.length)this._checkIfCanPreload()&&this.onPreloadNext(),this._taskIntervalId=setTimeout(function(){e.startCheckTask()},n.interval)}},{key:"cancelPreloadingTask",value:function(){var e,t=this._preloadDataList,r=this._wipPreloadTask,n=this._config.endPreloadTaskStrategy;this.cancel(),r&&(this.stepwise?"number"==typeof(null===(e=r.data)||void 0===e?void 0:e.stepIdx)&&r.data.stepIdx>-1&&r.data.stepIdx--:0!==n&&t.unshift(r),this._emitEvtByCancel(r.data),this._wipPreloadTask=void 0)}},{key:"stopCheckTask",value:function(){this._taskIntervalId&&(clearTimeout(this._taskIntervalId),this._taskIntervalId=-1)}},{key:"getPreloadMetaByVid",value:function(e){for(var t=this.getAllCachedDataKeys(),r=[],n="",i=0;i<t.length;i++){var a=t[i],o=y.parseKey(a);if(o.vid===e)n=o.vtype,r.push(a)}if(0===r.length)return null;var s=this._getLoaderInst(n);return s?s.parseKey(r):null}},{key:"preloadNext",value:function(){this.onPreloadNext()}},{key:"_filterMixPayload",value:function(e,t){var r=t.vtype;if(r&&Array.isArray(e.payload)){var n=e.vtype===r;e.vtype=r,e.payload=e.payload.filter(function(e){return e.vtype===r||n})}}},{key:"_emitEvtByStart",value:function(e){var t=this._player;if(e&&t)try{this.emit(s.KR.PRELOAD_START,this._getEventPayload(e,t))}catch(e){this.log("warn","preload emit start error",null==e?void 0:e.stack)}}},{key:"_emitEvtByCancel",value:function(e){var t=this._player;if(e&&t)try{this.emit(s.KR.PRELOAD_CANCEL,this._getEventPayload(e,t))}catch(e){this.log("warn","preload emit cancel error",null==e?void 0:e.stack)}}},{key:"_getEventPayload",value:function(e,t){var r=t.config.vid,n=this._config,i=n.minBufferLength,a=n.startPreloadControl,o=n.startPreloadMinBuffer,s=n.startPreloadMinPosTime,l=n.endPreloadMinBuffer,c=n.endPreloadControl,u=(0,d.lh)(t.video.buffered,t.currentTime),f=u[1]?u[1]-t.currentTime:0;return{vid:r,pid:e.vid,buffer:u,bufferHead:f,currentTime:t.currentTime,minBufferLength:i,startPreloadControl:a,startPreloadMinBuffer:o,startPreloadMinPosTime:s,endPreloadControl:c,endPreloadMinBuffer:l}}},{key:"addPreloadList",value:(t=(0,n.x)((0,n.l5)().mark(function e(t){var r,i,a;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._sort(t),r=(0,n.sf)(t),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=10;break}return a=i.value,e.next=8,this._addData(a);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:this._checkAutoTask();case 19:case"end":return e.stop()}},e,this,[[2,12,15,18]])})),function(e){return t.apply(this,arguments)})},{key:"addPlayingId",value:function(e,t){for(var r=this._preloadDataList,n=-1,i=0;i<r.length;i++)if(e===r[i].data.vid){n=i;break}if(n>-1){var a=r.splice(n,1);this.log("log","cancelPreloadByVid remove from list",a.length>0&&a[0].data.vid)}var o=this._currentPreloadInst,s=o?o.getData():null;this.log("log","_currentPreloadInst",s),s&&s.vid===e&&this.cancel(),t&&this._addPlayingVid(t,e)}},{key:"removePlayingId",value:function(e){var t=this._playingVids,r=(0,d.PK)(t,"playerId",e);if(r>-1){var n=t.splice(r,1);this.log("log","removePlayingId",n.length>0&&n[0].playerId)}}},{key:"addPreload",value:(r=(0,n.x)((0,n.l5)().mark(function e(t){return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._addData(t);case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:this._sort(this._preloadDataList),this._checkAutoTask();case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_addData",value:(a=(0,n.x)((0,n.l5)().mark(function e(t){var r,i,a,o,s,l,c,u,f,h=this;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.vtype){e.next=3;break}return this.log("warn","vtype is null, can\xb7t select loader"),e.abrupt("return",!1);case 3:if(r=t.data,i=this._getLoader(r.vtype)){e.next=8;break}return this.log("warn","the loader for ".concat(r.vtype," not registered")),e.abrupt("return",!1);case 8:if(a=this._playingVids,!((o=(0,d.PK)(a,"vid",t.data.vid))>=0)){e.next=14;break}return s=a[o],this.log("log","vid:".concat(s.vid," is already instantiated and loaded, playerId is ").concat(s.playerId)),e.abrupt("return");case 14:return l=this._getUniqueKey(t),e.next=17,this.getItem(t.data,!0);case 17:if(!(c=e.sent)||!i.isUniqueCache(c)){e.next=22;break}return this.log("log","".concat(l," already exist in cache")),e.abrupt("return",!1);case 22:if(!this._currentPreloadInst||!(u=this._currentPreloadInst.getData())||this._getUniqueKey({data:u,order:0})!==l){e.next=29;break}return this.log("log","currentKey repeat"),e.abrupt("return");case 29:if(f=this._preloadDataList.filter(function(e){return h._getUniqueKey(e)===l}),this.log("log","addedItems",l,f),0!==f.length){e.next=35;break}return this._stepwise&&void 0===t.data.steps&&(t.data.steps=[0]),this._preloadDataList.push(t),e.abrupt("return",!0);case 35:return this.log("log","".concat(l," already exist in preloadList")),e.abrupt("return",!1);case 37:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"_getUniqueKey",value:function(e){return e.data.vtype?y.generateUniqueCacheKey(e.data):e.data.vid}},{key:"_checkAutoTask",value:function(){var e=this,t=this._config,r=t.autoCheck,n=t.autoPreload;Promise.resolve().then(function(){n&&e.emit(s.KR.PRELOAD_NEXT),null!=r&&r.enable&&!e._taskIntervalId&&e.startCheckTask()})}},{key:"setItem",value:function(e,t,r,i){var a=y.generateUniqueCacheKey(e);if(!r){var o=this._getLoader(e.vtype);if(!o)return this.log("warn","no ".concat(e.vtype," preloader, register")),Promise.resolve(!1);var s=o.generateUniqueKey(e);t=(0,n._x)({},s,t)}return this._cacheInst.setItem(a,t,i)}},{key:"getItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=y.generateUniqueCacheKey(e),i=this._getLoader(e.vtype);if(!i)return this.log("warn","no ".concat(e.vtype," preloader, register")),Promise.resolve(!1);var a=t?"":i.generateUniqueKey(e);return this._cacheInst.getItem(n,r,a)}},{key:"getItemSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=y.generateUniqueCacheKey(e),i=this._getLoader(e.vtype);if(!i)return this.log("warn","no ".concat(e.vtype," preloader, register")),!1;var a=t?"":i.generateUniqueKey(e);return this._cacheInst.getItemSync(n,r,a)}},{key:"supportSync",value:function(){return this._cacheInst.supportSync()}},{key:"removeItem",value:function(e,t){var r=y.generateUniqueCacheKey(e);return this._cacheInst.removeItem(r,t)}},{key:"getPreLoadData",value:(o=(0,n.x)((0,n.l5)().mark(function e(t){var r,i,a;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.vtype,!(i=this._getLoaderInst(r))){e.next=7;break}return e.next=5,i.getPreLoadData(t);case 5:return a=e.sent,e.abrupt("return",a);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getPreLoadDataSync",value:function(e){var t=e.vtype,r=this._getLoaderInst(t);return r?r.getPreLoadDataSync(e):null}},{key:"removeAll",value:function(){var e=this;this.getAllCachedDataKeys().forEach(function(t){var r=e.getPreloadMetaByVid(t.split("#")[0]);r&&e.removeItem(r,null)})}},{key:"removeAllPreloadTask",value:function(){this.cancel(),this._preloadDataList=[],this._playingVids=[]}},{key:"disable",value:function(){this._isOpen=!1,this.stopCheckTask()}},{key:"enable",value:function(){this._isOpen=!0,this._config.autoCheck.enable&&!this._taskIntervalId&&this._preloadDataList.length>0&&this.startCheckTask()}},{key:"setUserSelectDefinition",value:function(e){this._userDefinition=e}},{key:"getUserSelectDefinition",value:function(){return this._userDefinition||null}},{key:"getStartDefinition",value:function(){return this._startDefinition}},{key:"setStartDefinition",value:function(e){this._startDefinition=e}},{key:"destroy",value:(p=(0,n.x)((0,n.l5)().mark(function e(){var t,r,i,a;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stats.destroy(),t=Object.keys(this._loaderInsts),r=0;case 3:if(!(r<t.length)){e.next=12;break}if(i=t[r],!(a=this._getLoaderInst(i))){e.next=9;break}return e.next=9,a.destroy();case 9:r++,e.next=3;break;case 12:this.removeAllListeners(),this._loaderInsts={},this._loaders={},this._playingVids=[],this.detachPlayer();case 17:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"cancel",value:(g=(0,n.x)((0,n.l5)().mark(function e(){var t;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._currentPreloadInst){e.next=4;break}return e.next=3,this._currentPreloadInst.cancel();case 3:null===(t=this._currentPreloadInst)||void 0===t||t.setData(null);case 4:this._currentPreloadInst=null;case 5:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"removeByPlayInst",value:function(e,t){for(var r=this._preloadDataList.length-1;r>-1;r--){var n=this._preloadDataList[r];if(n.data.vid===e&&n.playerId===t){this._preloadDataList.splice(r,1);break}}}},{key:"getAllCachedDataKeys",value:function(){var e;return(null===(e=this._cacheInst)||void 0===e?void 0:e.getAllCachedDataKeys())||[]}},{key:"getDataUniqueKey",value:function(e){var t=this._getLoader(e.vtype);return!!t&&t.generateUniqueKey(e)}},{key:"hasItemSameVid",value:function(e){var t=this._getLoader(e.vtype),r=this._getLoaderInst(e.vtype);if(t&&r){var n=t.generateUniqueKey(e);return r.hasItemSameVid(n)}return!1}},{key:"_getLoader",value:function(e){e=e||"";var t=this._loaders[e]||this._loaders[e.toLocaleLowerCase()];return t?t:(this.log("warn","no ".concat(e," preloader, register")),null)}},{key:"_getLoaderInst",value:function(e){e=e||"";var t=this._loaderInsts[e]||this._loaderInsts[e.toLocaleLowerCase()];return t?t:(this.log("warn","no ".concat(e," preloader, register")),null)}},{key:"getPreloadMemoryInfo",value:function(){return this._cacheInst.getMemoryInfo()}},{key:"attachPlayer",value:function(e){this._player=e,this._media=e.video||e.media}},{key:"detachPlayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(!e||this._player===e)&&(this._player=null,this._media=null)}},{key:"setPreloadBandwidth",value:function(e,t){this._stats.setPreloadBandwidth(e,t)}},{key:"getPreloadBandwidth",value:function(e){return this._stats.getPreloadBandwidth(e)}},{key:"getLoadInfoAndDelete",value:function(e){return this._stats.getLoadInfoAndDelete(e)}},{key:"getPreloadUnuseInfo",value:function(){return this._stats.getPreloadUnuseInfo()}},{key:"setUsePreloadInfo",value:function(e,t){this._stats.setUsePreloadInfo(e,t)}},{key:"bwEventEmit",value:function(e){var t=e.vid,r=e.loadType,i=e.size,a=e.speed,o=e.cacheKey,s=e.vtype,l=e.duration,c=e.bitrate,u=(0,n.Kd)(e,f);this._stats.bwEventEmit((0,n.Zj)({vid:t,loadType:r,size:i,speed:a,cacheKey:o,vtype:s,duration:l,bitrate:c},u))}},{key:"findPreloadItem",value:function(e){var t,r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(this._stepwise){var n=e.reduce(function(e,t){return void 0===t.data.stepIdx||"number"==typeof t.data.stepIdx&&"number"==typeof e.data.stepIdx&&t.data.stepIdx<e.data.stepIdx?t:e}),i=e.filter(function(e){return e.data.stepIdx===n.data.stepIdx});if(i.length>1&&this._sort(i),t=i[0],!r){if("number"!=typeof t.data.stepIdx&&(t.data.stepIdx=-1),t.data.stepIdx++,Array.isArray(t.data.steps)&&t.data.stepIdx>=t.data.steps.length-1){var a=e.indexOf(t);e.splice(a,1)}t.data.stepIdx===1/0&&(t=void 0)}}else t=r?e[0]:e.shift();return t}},{key:"updateConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?this._config=Object.assign({},y.getDefaultConfig(),e):Object.assign(this._config,e);var r=this._config.autoCheck;r&&!r.enable&&this.stopCheckTask(),r&&r.enable&&this.startCheckTask()}},{key:"preProcessUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._config,n=r.preProcessUrl,i=r.preProcessUrlOptions;return"function"==typeof n?n(e,Object.assign({},i,t)):{url:e}}}],[{key:"getDefaultConfig",value:function(){return(0,u._)()}},{key:"generateUniqueCacheKey",value:function(e){var t=e.vid,r=e.codecType,n=e.vtype;return"".concat(t,"#").concat(r,"#").concat(n.toUpperCase())}},{key:"parseKey",value:function(e){if(!e)throw Error("key ".concat(e," is empty"));var t=e.split("#");if(t.length<5)throw Error("key ".concat(e," is not right format"));var r=t[0],n=t[1],i=t[2],a=t[3];return{vid:r,mediaType:n,codecType:i,vtype:a,definition:t[4]}}},{key:"debugger",set:function(e){h=!!e}}]),y}(o())},936131:function(e,t,r){r.d(t,{Yz:function(){return u}});var n=r(84498);r(864614),r(238658),r(227470),r(999921),r(415691);var i=r(623176),a=r(860513),o=r(473491),s={errorCode:o.WE[o.wb.NETWORK_FORBIDDEN],errorType:"network",errorMessage:"",httpCode:o.WE[o.wb.NETWORK_FORBIDDEN],mediaError:{code:o.WE[o.wb.NETWORK_FORBIDDEN],message:""}},l=function(){try{return parseInt(performance.now().toString(),10)}catch(e){return new Date().getTime()}},c=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e||"String"!==(t=e,Object.prototype.toString.call(t).match(/([^\s.*]+)(?=]$)/g)[0]))return 0;var n=0;try{var i=RegExp("(\\?|&)x-tos-expires=([^&]*)(&|$)"),a=e.match(i);if(null!==a)n=parseInt(a[2],10);else{var o=e.split("/");o.length>5&&8===o[4].length&&(n=parseInt(o[4],16))}if(n>0){var s=parseInt(String(r&&"number"==typeof r?new Date().getTime()/1e3+r:new Date().getTime()/1e3),10);return n<s?1:2}return 0}catch(e){return 0}},u=function(e){(0,n.XW)(r,e);var t=(0,n.WY)(r);function r(e){var i;return(0,n.PA)(this,r),(i=t.call(this,e))._handleExpiryCheck=function(){var e=(0,n.Lc)(i),t=e.config;if(!(e.player._customExpiryCheck||!t.enableExpiryCheck||l()-i._lastCheckTime<1e3)){if(t.useCdnExpiryTime){i.handleUrlExpiryCheckByCdnPath(),i._lastCheckTime=l();return}}},i._lastCheckTime=l(),i.emitExpireTimestamp=null,i}return(0,n.qH)(r,[{key:"beforePlayerInit",value:function(){var e=this.config,t=this.player;e.enableExpiryCheck&&!t._customExpiryCheck&&(this.on(i.PLAY,this._handleExpiryCheck),this.on(i.TIME_UPDATE,this._handleExpiryCheck),this.on(i.LOAD_START,this._handleExpiryCheck),this.on(i.LOADED_DATA,this._handleExpiryCheck),this.on(i.SEEKING,this._handleExpiryCheck),this.on(i.WAITING,this._handleExpiryCheck))}},{key:"handleUrlExpiryCheckByCdnPath",value:function(){var e,t=this.config,r=this.player;if(!r||!t)return;var n=(null===(e=r.curDefinition)||void 0===e?void 0:e.url)||r.config.url,i=Array.isArray(n)?n[0]:n;if(!i)return;var a="string"==typeof i?i:i.src;if(!!a)1===c(a,t.expiryOffset)&&this._emitExpireEvent(s)}},{key:"_emitExpireEvent",value:function(e){var t=this.player,r=new Date().getTime()/1e3;return this.emitExpireTimestamp?!!(r-this.emitExpireTimestamp>300)&&(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e),!0):(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e),!0)}},{key:"destroy",value:function(){this.config.enableExpiryCheck&&!this.player._customExpiryCheck&&(this.off(i.PLAY,this._handleExpiryCheck),this.off(i.TIME_UPDATE,this._handleExpiryCheck),this.off(i.LOAD_START,this._handleExpiryCheck),this.off(i.LOADED_DATA,this._handleExpiryCheck),this.off(i.SEEKING,this._handleExpiryCheck),this.off(i.WAITING,this._handleExpiryCheck))}}],[{key:"pluginName",get:function(){return"ExpiryCheck"}},{key:"defaultConfig",get:function(){return{enableExpiryCheck:!1,useCdnExpiryTime:!1,expiryOffset:30}}}]),r}(a.ZP)},369239:function(e,t,r){r.d(t,{$w:function(){return a},PA:function(){return o},XW:function(){return d},_x:function(){return c},l5:function(){return h},qH:function(){return l},x:function(){return i}});function n(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,a){var o=e.apply(t,r);function s(e){n(o,i,a,s,l,"next",e)}function l(e){n(o,i,a,s,l,"throw",e)}s(void 0)})}}function a(e,t,r){return t=u(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,f()?Reflect.construct(t,r||[],u(e).constructor):t.apply(e,r))}function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,g(n.key),n)}}function l(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t,r){return(t=g(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(f=function(){return!!e})()}function h(){h=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(t,r,n,a){var o=Object.create((r&&r.prototype instanceof y?r:y).prototype);return i(o,"_invoke",{value:function(t,r,n){var i=f;return function(a,o){if(i===p)throw Error("Generator is already running");if(i===g){if("throw"===a)throw o;return{value:e,done:!0}}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var l=function t(r,n){var i=n.method,a=r.iterator[i];if(a===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),v;var o=d(a,r.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var s=o.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,v)}(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var c=d(t,r,n);if("normal"===c.type){if(i=n.done?g:"suspendedYield",c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=g,n.method="throw",n.arg=c.arg)}}}(t,n,new C(a||[]))}),o}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var f="suspendedStart",p="executing",g="completed",v={};function y(){}function m(){}function _(){}var b={};c(b,o,function(){return this});var x=Object.getPrototypeOf,k=x&&x(x(S([])));k&&k!==r&&n.call(k,o)&&(b=k);var L=_.prototype=y.prototype=Object.create(b);function w(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function P(e,t){var r;i(this,"_invoke",{value:function(i,a){function o(){return new t(function(r,o){!function r(i,a,o,s){var l=d(e[i],e,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&n.call(u,"__await")?t.resolve(u.__await).then(function(e){r("next",e,o,s)},function(e){r("throw",e,o,s)}):t.resolve(u).then(function(e){c.value=e,o(c)},function(e){return r("throw",e,o,s)})}s(l.arg)}(i,a,r,o)})}return r=r?r.then(o,o):o()}})}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function S(t){if(t||""===t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw TypeError(typeof t+" is not iterable")}return m.prototype=_,i(L,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:m,configurable:!0}),m.displayName=c(_,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,c(e,l,"GeneratorFunction")),e.prototype=Object.create(L),e},t.awrap=function(e){return{__await:e}},w(P.prototype),c(P.prototype,s,function(){return this}),t.AsyncIterator=P,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new P(u(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then(function(e){return e.done?e.value:o.next()})},w(L),c(L,l,"Generator"),c(L,o,function(){return this}),c(L,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=S,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;I(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:S(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function g(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}},804893:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(6214),i=function(){function e(){(0,n.PA)(this,e)}return(0,n.qH)(e,null,[{key:"install",value:function(){if(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame,!window.requestAnimationFrame){var e=Date.now();window.requestAnimationFrame=function(t){var r=Date.now(),n=Math.max(16.7-(r-e),0),i=setTimeout(t,n);return e=r+n,i}}!window.cancelAnimationFrame&&(window.cancelAnimationFrame=function(e){clearTimeout(e)})}}]),e}()},133422:function(e,t,r){r.d(t,{j:function(){return u}});var n=r(809345),i=r(712407),a=r(292263),o=r(473886),s=r(429571),l=r(159322),c=r.n(l),u=function(e){(0,n.XW)(l,e);var t,r=(0,n.WY)(l);function l(){var e;return(0,n.PA)(this,l),e=r.call(this),(0,n._x)((0,n.Lc)(e),"_abortController",null),(0,n._x)((0,n.Lc)(e),"_timeoutTimer",null),(0,n._x)((0,n.Lc)(e),"_reader",null),(0,n._x)((0,n.Lc)(e),"_response",null),(0,n._x)((0,n.Lc)(e),"_aborted",!1),(0,n._x)((0,n.Lc)(e),"_index",-1),(0,n._x)((0,n.Lc)(e),"_range",null),(0,n._x)((0,n.Lc)(e),"_receivedLength",0),(0,n._x)((0,n.Lc)(e),"_running",!1),(0,n._x)((0,n.Lc)(e),"_logger",null),(0,n._x)((0,n.Lc)(e),"_vid",""),(0,n._x)((0,n.Lc)(e),"_onProcessMinLen",0),(0,n._x)((0,n.Lc)(e),"_onCancel",null),(0,n._x)((0,n.Lc)(e),"_priOptions",null),(0,n._x)((0,n.Lc)(e),"_processMaxGapTime",1/0),e}return(0,n.qH)(l,[{key:"load",value:function(e){var t,r=this,l=e.url,c=e.vid,u=e.timeout,d=e.responseType,f=e.onProgress,h=e.index,p=e.onTimeout,g=e.onCancel,v=e.range,y=e.transformResponse,m=e.request,_=e.params,b=e.logger,x=e.method,k=e.headers,L=e.body,w=e.mode,P=e.credentials,O=e.cache,I=e.redirect,C=e.referrer,S=e.referrerPolicy,T=e.onProcessMinLen,D=e.processMaxGapTime,E=e.priOptions;this._logger=b,this._aborted=!1,this._onProcessMinLen=T,this._onCancel=g,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._receivedLength=0,this._index=h,this._range=v||[0,0],this._vid=c||l,this._priOptions=E||{},this._processMaxGapTime=D;var A={method:x,headers:k,body:L,mode:w,credentials:P,cache:O,redirect:I,referrer:C,referrerPolicy:S,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},R=!1;clearTimeout(this._timeoutTimer),l=(0,a.G7)(l,_);var j=(0,a.Gu)(v);j&&(k=m?m.headers:A.headers=A.headers||(Headers?new Headers:{}),Headers&&k instanceof Headers?k.append("Range",j):k.Range=j),u&&(this._timeoutTimer=setTimeout((0,n.x)((0,n.l5)().mark(function e(){var t;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return R=!0,e.next=3,r.cancel();case 3:p&&((t=new i.C(l,A,null,"timeout")).isTimeout=!0,p(t,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions}));case 4:case"end":return e.stop()}},e)})),u));var N=Date.now();return this._logger.debug("[fetch load start], index,",h,",range,",v),new Promise(function(e,t){var c;fetch(m||l,m?void 0:A).then((c=(0,n.x)((0,n.l5)().mark(function c(u){var p,g,m,_;return(0,n.l5)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=u,!(r._aborted||!r._running)){n.next=4;break}return n.abrupt("return");case 4:if(y&&(u=y(u,l)||u),u.ok){n.next=7;break}throw new i.C(l,A,u,"bad network response");case 7:if(p=Date.now(),d!==o.U.TEXT){n.next=15;break}return n.next=11,u.text();case 11:case 18:g=n.sent,r._running=!1,n.next=37;break;case 15:if(d!==o.U.JSON){n.next=22;break}return n.next=18,u.json();case 22:if(!f){n.next=29;break}return r.resolve=e,r.reject=t,r._loadChunk(u,f,N,p),n.abrupt("return");case 29:return n.next=31,u.arrayBuffer();case 31:g=new Uint8Array(g=n.sent),r._running=!1,m=Date.now()-N,_=(0,a.pl)(g.byteLength,m),r.emit(s.K.REAL_TIME_SPEED,{speed:_,len:g.byteLength,time:m,vid:r._vid,index:r._index,range:r._range,priOptions:r._priOptions});case 37:r._logger.debug("[fetch load end], index,",h,",range,",v),e((0,a.rO)(g,!0,u,u.headers.get("Content-Length"),u.headers.get("age"),N,p,h,v,r._vid,r._priOptions));case 39:case"end":return n.stop()}},c)})),function(e){return c.apply(this,arguments)})).catch(function(e){var n;clearTimeout(r._timeoutTimer),r._running=!1,(!r._aborted||R)&&((e=e instanceof i.C?e:new i.C(l,A,null,null===(n=e)||void 0===n?void 0:n.message)).startTime=N,e.endTime=Date.now(),e.isTimeout=R,e.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},t(e))})})}},{key:"cancel",value:(t=(0,n.x)((0,n.l5)().mark(function e(){return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(e){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,r,o){var l,c,u,d,f=this;if(!e.body||!e.body.getReader){this._running=!1;var h=new i.C(e.url,"",e,"onProgress of bad response.body.getReader");h.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(h);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(2097152),this._writeIdx=0);var p=this._reader=e.body.getReader(),g=Date.now();var v=(l=(0,n.x)((0,n.l5)().mark(function l(){var h,y,m,_,b,x,k,L,w;return(0,n.l5)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return u=Date.now(),n.prev=1,n.next=4,p.read();case 4:c=n.sent,d=Date.now(),n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),d=Date.now(),!f._aborted&&(f._running=!1,n.t0.options={index:f._index,range:f._range,vid:f._vid,priOptions:f._priOptions},f.reject(n.t0)),n.abrupt("return");case 13:if(m=(y=(null===(h=f._range)||void 0===h?void 0:h.length)>0?f._range[0]:0)+f._receivedLength,!f._aborted){n.next=19;break}return f._running=!1,t(void 0,!1,{range:[m,m],vid:f._vid,index:f._index,startTime:u,endTime:d,st:r,firstByteTime:o,priOptions:f._priOptions},e),n.abrupt("return");case 19:if(_=c.value?c.value.byteLength:0,f._receivedLength+=_,f._onProcessMinLen>0?f._writeIdx+_>=f._onProcessMinLen||c.done?((b=new Uint8Array(f._writeIdx+_)).set(f._cache.subarray(0,f._writeIdx),0),_>0&&b.set(c.value,f._writeIdx),f._writeIdx=0,f._logger.debug("【fetchLoader,onProgress enough】,done,",c.done,",len,",b.byteLength,", writeIdx,",f._writeIdx)):_>0&&f._writeIdx+_<2097152?(f._cache.set(c.value,f._writeIdx),f._writeIdx+=_,f._logger.debug("【fetchLoader,onProgress cache】,len,",_,", writeIdx,",f._writeIdx)):_>0&&(x=new Uint8Array(f._writeIdx+_+2048),f._logger.debug("【fetchLoader,onProgress extra start】,size,",f._writeIdx+_+2048,", datalen,",_,", writeIdx,",f._writeIdx),x.set(f._cache.subarray(0,f._writeIdx),0),_>0&&x.set(c.value,f._writeIdx),f._writeIdx+=_,delete f._cache,f._cache=x,f._logger.debug("【fetchLoader,onProgress extra end】,len,",_,", writeIdx,",f._writeIdx)):b=c.value,!(b&&b.byteLength>0||c.done)){n.next=28;break}f._logger.debug("【fetchLoader,onProgress call】,task,",f._range,", start,",m,", end,",y+f._receivedLength,", done,",c.done,r),t(b,c.done,{range:[f._range[0]+f._receivedLength-(b?b.byteLength:0),f._range[0]+f._receivedLength],vid:f._vid,index:f._index,startTime:u,endTime:d,st:r,firstByteTime:o,priOptions:f._priOptions},e),g=Date.now(),n.next=37;break;case 28:if(!(Date.now()-g>=f._processMaxGapTime)){n.next=37;break}return f._logger.debug("[onProgress timeout],task: ".concat(JSON.stringify(f._range)," done: ").concat(c.done," processMaxGapTime: ").concat(f._processMaxGapTime)),(k=new i.C(e.url,null,e,"process timeout")).options={index:f._index,range:f._range,vid:f._vid,priOptions:f._priOptions},f.running=!1,n.next=35,f.cancel();case 35:return f.reject(k),n.abrupt("return");case 37:c.done?(L=Date.now()-r,w=(0,a.pl)(f._receivedLength,L),f.emit(s.K.REAL_TIME_SPEED,{speed:w,len:f._receivedLength,time:L,vid:f._vid,index:f._index,range:f._range,priOptions:f._priOptions}),f._running=!1,f._logger.debug("[fetchLoader onProgress end],task,",f._range,",done,",c.done),f.resolve((0,a.rO)(c,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),r,o,f._index,f._range,f._vid,f._priOptions))):v();case 38:case"end":return n.stop()}},l,null,[[1,8]])})),function(){return l.apply(this,arguments)});v()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return"undefined"!=typeof fetch}}]),l}(c())},698974:function(e,t,r){r.d(t,{Q:function(){return n}});function n(){var e,t,r=new Promise(function(r,n){e=r,t=n});return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}},757367:function(e,t,r){r.d(t,{j:function(){return u}});var n=r(932393),i=r(786019),a=r(810430),o=r(43024),s=r(611451),l=r(159322),c=r.n(l),u=function(e){(0,n.XW)(l,e);var t,r=(0,n.WY)(l);function l(){var e;return(0,n.PA)(this,l),e=r.call(this),(0,n._x)((0,n.Lc)(e),"_abortController",null),(0,n._x)((0,n.Lc)(e),"_timeoutTimer",null),(0,n._x)((0,n.Lc)(e),"_reader",null),(0,n._x)((0,n.Lc)(e),"_response",null),(0,n._x)((0,n.Lc)(e),"_aborted",!1),(0,n._x)((0,n.Lc)(e),"_index",-1),(0,n._x)((0,n.Lc)(e),"_range",null),(0,n._x)((0,n.Lc)(e),"_receivedLength",0),(0,n._x)((0,n.Lc)(e),"_running",!1),(0,n._x)((0,n.Lc)(e),"_logger",null),(0,n._x)((0,n.Lc)(e),"_vid",""),(0,n._x)((0,n.Lc)(e),"_onProcessMinLen",0),(0,n._x)((0,n.Lc)(e),"_onCancel",null),(0,n._x)((0,n.Lc)(e),"_priOptions",null),e}return(0,n.qH)(l,[{key:"load",value:function(e){var t,r=this,l=e.url,c=e.vid,u=e.timeout,d=e.responseType,f=e.onProgress,h=e.index,p=e.onTimeout,g=e.onCancel,v=e.range,y=e.transformResponse,m=e.request,_=e.params,b=e.logger,x=e.method,k=e.headers,L=e.body,w=e.mode,P=e.credentials,O=e.cache,I=e.redirect,C=e.referrer,S=e.referrerPolicy,T=e.onProcessMinLen,D=e.priOptions;this._logger=b,this._aborted=!1,this._onProcessMinLen=T,this._onCancel=g,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._index=h,this._range=v||[0,0],this._vid=c||l,this._priOptions=D||{};var E={method:x,headers:k,body:L,mode:w,credentials:P,cache:O,redirect:I,referrer:C,referrerPolicy:S,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},A=!1;clearTimeout(this._timeoutTimer),l=(0,a.G7)(l,_);var R=(0,a.Gu)(v);R&&(k=m?m.headers:E.headers=E.headers||(Headers?new Headers:{}),Headers&&k instanceof Headers?k.append("Range",R):k.Range=R),u&&(this._timeoutTimer=setTimeout(function(){if(A=!0,r.cancel(),p){var e=new i.C(l,E,null,"timeout");e.isTimeout=!0,p(e,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions})}},u));var j=Date.now();return this._logger.debug("[fetch load start], index,",h,",range,",v),new Promise(function(e,t){var c;fetch(m||l,m?void 0:E).then((c=(0,n.x)((0,n.l5)().mark(function c(u){var p,g,m,_;return(0,n.l5)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=u,!(r._aborted||!r._running)){n.next=4;break}return n.abrupt("return");case 4:if(y&&(u=y(u,l)||u),u.ok){n.next=7;break}throw new i.C(l,E,u,"bad network response");case 7:if(p=Date.now(),d!==o.U.TEXT){n.next=15;break}return n.next=11,u.text();case 11:case 18:g=n.sent,r._running=!1,n.next=37;break;case 15:if(d!==o.U.JSON){n.next=22;break}return n.next=18,u.json();case 22:if(!f){n.next=29;break}return r.resolve=e,r.reject=t,r._loadChunk(u,f,j,p),n.abrupt("return");case 29:return n.next=31,u.arrayBuffer();case 31:g=new Uint8Array(g=n.sent),r._running=!1,m=Date.now()-j,_=(0,a.pl)(g.byteLength,m),r.emit(s.K.REAL_TIME_SPEED,{speed:_,len:g.byteLength,time:m,vid:r._vid,index:r._index,range:r._range,priOptions:r._priOptions});case 37:r._logger.debug("[fetch load end], index,",h,",range,",v),e((0,a.rO)(g,!0,u,u.headers.get("Content-Length"),u.headers.get("age"),j,p,h,v,r._vid,r._priOptions));case 39:case"end":return n.stop()}},c)})),function(e){return c.apply(this,arguments)})).catch(function(e){var n;clearTimeout(r._timeoutTimer),r._running=!1,(!r._aborted||A)&&((e=e instanceof i.C?e:new i.C(l,E,null,null===(n=e)||void 0===n?void 0:n.message)).startTime=j,e.endTime=Date.now(),e.isTimeout=A,e.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},t(e))})})}},{key:"cancel",value:(t=(0,n.x)((0,n.l5)().mark(function e(){return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(e){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,r,o){var l,c,u,d,f=this;if(!e.body||!e.body.getReader){this._running=!1;var h=new i.C(e.url,"",e,"onProgress of bad response.body.getReader");h.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(h);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(2097152),this._writeIdx=0);var p=this._reader=e.body.getReader();var g=(l=(0,n.x)((0,n.l5)().mark(function i(){var l,h,v,y,m,_,b,x;return(0,n.l5)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return u=Date.now(),n.prev=1,n.next=4,p.read();case 4:c=n.sent,d=Date.now(),n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),d=Date.now(),!f._aborted&&(f._running=!1,n.t0.options={index:f._index,range:f._range,vid:f._vid,priOptions:f._priOptions},f.reject(n.t0)),n.abrupt("return");case 13:if(v=(h=(null===(l=f._range)||void 0===l?void 0:l.length)>0?f._range[0]:0)+f._receivedLength,!f._aborted){n.next=19;break}return f._running=!1,t(void 0,!1,{range:[v,v],vid:f._vid,index:f._index,startTime:u,endTime:d,st:r,firstByteTime:o,priOptions:f._priOptions},e),n.abrupt("return");case 19:y=c.value?c.value.byteLength:0,f._receivedLength+=y,f._logger.debug("【fetchLoader,onProgress call】,task,",f._range,", start,",v,", end,",h+f._receivedLength,", done,",c.done),f._onProcessMinLen>0?f._writeIdx+y>=f._onProcessMinLen||c.done?((m=new Uint8Array(f._writeIdx+y)).set(f._cache.slice(0,f._writeIdx),0),y>0&&m.set(c.value,f._writeIdx),f._writeIdx=0,f._logger.debug("【fetchLoader,onProgress enough】,done,",c.done,",len,",m.byteLength,", writeIdx,",f._writeIdx)):y>0&&f._writeIdx+y<2097152?(f._cache.set(c.value,f._writeIdx),f._writeIdx+=y,f._logger.debug("【fetchLoader,onProgress cache】,len,",y,", writeIdx,",f._writeIdx)):y>0&&(_=new Uint8Array(f._writeIdx+y+2048),f._logger.debug("【fetchLoader,onProgress extra start】,size,",f._writeIdx+y+2048,", datalen,",y,", writeIdx,",f._writeIdx),_.set(f._cache.slice(0,f._writeIdx),0),y>0&&_.set(c.value,f._writeIdx),f._writeIdx+=y,delete f._cache,f._cache=_,f._logger.debug("【fetchLoader,onProgress extra end】,len,",y,", writeIdx,",f._writeIdx)):m=c.value,(m&&m.byteLength>0||c.done)&&t(m,c.done,{range:[f._range[0]+f._receivedLength-(m?m.byteLength:0),f._range[0]+f._receivedLength],vid:f._vid,index:f._index,startTime:u,endTime:d,st:r,firstByteTime:o,priOptions:f._priOptions},e),c.done?(b=Date.now()-r,x=(0,a.pl)(f._receivedLength,b),f.emit(s.K.REAL_TIME_SPEED,{speed:x,len:f._receivedLength,time:b,vid:f._vid,index:f._index,range:f._range,priOptions:f._priOptions}),f._running=!1,f._logger.debug("[fetchLoader onProgress end],task,",f._range,",done,",c.done),f.resolve((0,a.rO)(c,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),r,o,f._index,f._range,f._vid,f._priOptions))):g();case 25:case"end":return n.stop()}},i,null,[[1,8]])})),function(){return l.apply(this,arguments)});g()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return"undefined"!=typeof fetch}}]),l}(c())}}]);