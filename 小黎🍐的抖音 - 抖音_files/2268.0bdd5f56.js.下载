"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["2268"],{299897:function(e,t,l){l.d(t,{T:function(){return v}}),l(612222);var n=l(259202),i=l(611542),o=l(852281),a=l(39587),r=l(373439),u=l(980376),d=l(713017),s=l(374490),c=l(311610);let v=e=>{var t,l;let{setIsReusePlayer:v,roomData:m,abtestData:f,reuseId:g,isReusePlayer:_}=e,p=i.useRef(null),h=(0,i.useRef)(),{isFeedH265:y}=(0,c.Z)({abtestData:f,tab:"followLiveHeadPreCreated"}),[w,x]=i.useState(!1),k=(0,s.Bq)({room:m,abtestData:f,isFeedH265:y&&!w}),I=i.useCallback(()=>{y&&!w&&x(!0)},[y,w,x]),C=!(0,d.G6)()&&Object.values((null==m?void 0:null===(t=m.stream_url)||void 0===t?void 0:t.pull_datas)||{}).length>0,S=(null==m?void 0:null===(l=m.paid_live_data)||void 0===l?void 0:l.paid_type)===1,b=!w&&(null==m?void 0:m.redirectUrl)?null==m?void 0:m.redirectUrl:null==k?void 0:k.url,L=Number(null==m?void 0:m.live_room_mode)===r.ke.AUDIO;return S||C||!b||L?(0,n.jsx)(n.Fragment,{}):(0,n.jsx)("div",{ref:p,style:{position:"absolute",width:0,height:0,pointerEvents:"none"},children:(0,n.jsx)(o.wn,{abTestData:f,reuseId:g,container:p,afterDomAppend:e=>{var t,l;let{isReuse:n}=e,i=null==h?void 0:null===(t=h.current)||void 0===t?void 0:t.getPlayer();n&&i&&(v(!0),null===(l=u.Z.instManager)||void 0===l||l.setActive(null==i?void 0:i.playerId,!1),null==i||i.pause())},children:(0,n.jsx)(a.Nu,{isPause:!0,autoplay:!1,onLoadedData:()=>{var e,t;let l=null==h?void 0:null===(e=h.current)||void 0===e?void 0:e.getPlayer();l&&(v(!0),null===(t=u.Z.instManager)||void 0===t||t.setActive(null==l?void 0:l.playerId,!1))},onError:I,onPlay:()=>{var e;let t=null==h?void 0:null===(e=h.current)||void 0===e?void 0:e.getPlayer();null==t||t.pause(),setTimeout(()=>{null==t||t.pause()},1e3)},ref:h,url:b,loadTimeout:6e3,volume:0,children:(0,n.jsx)(n.Fragment,{})})})})}},881246:function(e,t,l){l.d(t,{x:function(){return O}});var n=l("590921");l("612222"),l("347885");var i=l("259202"),o=l("611542"),a=l("623176"),r=l("781111"),u=l("837305"),d=l("196254"),s=l("124797"),c=l("167618"),v=l("528557"),m=l("245086"),f=l("713017"),g=l("819769"),_=l("356789"),p=l("354795"),h=new p.h({voiceBubbleShow:{eventName:"voice_bubble_show",params:{enter_from:"",mute_type:""}},voiceBarShow:{eventName:"voice_bar_show",params:{enter_from:""}},clickVoiceBubble:{eventName:"click_voice_bubble",params:{is_open:1,mute_type:""}}}),y=l("874155"),w={User:"user",Browser:"browser"};let x={isAlwaysPrevent:!1,slideTime:0,isTipShow:!1},k={isAlwaysPrevent:!1,slideTime:5,isTipShow:!0},I=u.LocalStorageKeys.forceMuteInfo,C=g.gI.ForceMuted,S=()=>{let e=(0,v.$o)(I),t=!!((null==e?void 0:e.user)||(null==e?void 0:e.browser));return!t&&(0,v.bv)(I),t?e:null},b=e=>(0,v.qQ)(I,(0,n._)({},(0,v.$o)(I),e)),L=(e,t)=>g.Le.setConfig(C,(0,y._)((0,n._)({},g.Le.getConfig(C)),{[e]:t})),N=e=>{var t;return null===(t=g.Le.getConfig(C))||void 0===t?void 0:t[e]},E=e=>g.Le.setConfig(C,(0,n._)({},x,e)),T=(e,t)=>g.Le.setConfig(C,(0,n._)((0,y._)((0,n._)({},k),{currentMuteType:e,slideTime:5}),t)),P=e=>{let t=S(),{showTime:l,closeTime:n}=(null==t?void 0:t[e])||{},i=null!=n?n:l;return i&&Date.now()-i<=864e5*("user"===e?7:3)},j=e=>e.muted||0===e.volume,R=e=>{let{onFail:t,onSuccess:l,player:n}=e;!j(n)&&(L("isMuted",!0),n.muted=!0),setTimeout(()=>{!j(n)&&(L("isMuted",!0),n.muted=!0),n.paused&&n.play(),setTimeout(()=>{n.paused?(n.muted=!1,null==t||t()):j(n)&&(null==l||l())},500)},100)};var M=l("773627"),D=l("401310"),A=l("935708"),Z=l("375456"),W=l("797210"),F=l("135621"),U=l("325432");let B=e=>{var t,l;let{isShowGuide:n=!1,isActive:p,awemeInfo:y,abtestData:x,scene:k}=e,{awemeId:I}=y,C=(0,D.n)(),[S,j]=(0,o.useState)(!1),M=(0,o.useRef)(!1),A=N("isTipShow"),[B,O]=(0,o.useState)(null!=A&&A),{attemptOpen:z,executeClose:H}=(0,d.B)({popName:"浏览器限制-声音提醒",onOpen:()=>{O(!0)},onClose:()=>{O(!1)}}),V=(0,o.useMemo)(()=>(!C||Z.s.getPlayerScene(C.playerId)===s.lT.Modal||!(Z.s.getPlayersByScene(s.lT.Modal).length>0))&&C&&p&&!n&&!N("isAlwaysPrevent"),[p,n,C]),K=(0,o.useCallback)(e=>{if(V){if(!N("isTipShow"))R({player:C,onSuccess:()=>{z({afterCallback:()=>{T(e),h.sendLog("voiceBubbleShow",{enter_from:(0,m.yW)(),mute_type:N("currentMuteType")}),b({[e]:{showTime:Date.now()}})}})},onFail:()=>{E({isAlwaysPrevent:!0})}}),L("currentMuteType",e),e===w.Browser&&(0,v.qQ)(u.LocalStorageKeys.browserMute,!0)}},[C,V]),$=(0,o.useCallback)(()=>{let e=N("currentMuteType");if(!!e&&!!N("isTipShow"))H(),L("isTipShow",!1),b({[e]:{closeTime:Date.now()}})},[]),Y=(0,o.useRef)(!1);(0,o.useEffect)(()=>{if(C&&p){let e=()=>{Y.current=!0};return C.on("autoplay_was_prevented",e),()=>{C.off("autoplay_was_prevented",e)}}},[C,p]),(0,o.useEffect)(()=>{let e=()=>{if(!(!C.paused&&!C.muted&&C.volume>0||(0,f.G6)()||M.current)){if(M.current=!0,P(w.Browser)){R({player:C}),(0,v.qQ)(u.LocalStorageKeys.browserMute,!0);return}K(w.Browser)}};return C&&(Y.current||C.inlinePlayerAutoPlayWasPrevented)&&(e(),Y.current=!1,C.inlinePlayerAutoPlayWasPrevented=!1),null==C||C.on("autoplay_was_prevented",e),()=>null==C?void 0:C.off("autoplay_was_prevented",e)},[C,K]),(0,o.useEffect)(()=>{C&&C.muted&&(0,v.$o)(u.LocalStorageKeys.browserMute)&&!P(w.Browser)&&K(w.Browser)},[C,K]),(0,o.useEffect)(()=>{if("user"!==N("currentMuteType"))((c.Q.getItem({sKey:u.CookieKeys.VolumeInfo})||{}).isUserMute||(0,v.$o)(u.LocalStorageKeys.userMute))&&!P(w.User)&&K(w.User)},[K]),(0,o.useEffect)(()=>{var e;let{isInMiniModal:t}=null!==(e=g.Le.getConfig(g.gI.IsInLookMiniModal))&&void 0!==e?e:{};if(t){H();return}let l=N("isTipShow");p&&(l?z({afterCallback:()=>{let e=N("slideTime")-1;L("slideTime",e),e<=0&&$()}}):H())},[I,p,$]),(0,o.useEffect)(()=>{if(C){let e=e=>{((null==e?void 0:e.action)==="change_muted"||(null==e?void 0:e.action)==="change_volume")&&((0,v.qQ)(u.LocalStorageKeys.browserMute,!1),(B||N("isTipShow"))&&$(),setTimeout(()=>{!0===C.muted||0===C.volume?((0,v.qQ)(u.LocalStorageKeys.userMute,!0),b({[w.User]:{closeTime:Date.now()}})):(0,v.qQ)(u.LocalStorageKeys.userMute,!1)}))};return C.on(a.USER_ACTION,e),()=>{C.off(a.USER_ACTION,e)}}},[C,B,$]),(0,o.useEffect)(()=>{if(C){let e=e=>{("volumeDown"===e.action||"volumeUp"===e.action)&&((0,v.qQ)(u.LocalStorageKeys.browserMute,!1),(B||N("isTipShow"))&&$(),setTimeout(()=>{0===C.volume?((0,v.qQ)(u.LocalStorageKeys.userMute,!0),b({[w.User]:{closeTime:Date.now()}})):(0,v.qQ)(u.LocalStorageKeys.userMute,!1)}))};return C.on(W.B.CustomShortCut,e),()=>{C.off(W.B.CustomShortCut,e)}}},[C,B,$]);if((0,o.useEffect)(()=>{!p&&S&&j(!1)},[p,S]),(0,o.useEffect)(()=>{if(!!I)_.emit(_.EVENT.silentStatusChange,{awemeId:I,isAuto:!0,status:B&&(null==C?void 0:C.muted)})},[B,I,null==C?void 0:C.muted]),!B||!(null==C?void 0:C.muted))return null;let G=null==C?void 0:null===(l=C.getPlugin)||void 0===l?void 0:null===(t=l.call(C,"SoundGuideTooltipPlugin"))||void 0===t?void 0:t.root,q=N("currentMuteType");return["browser","user"].includes(q)&&G?(0,r.createPortal)((0,i.jsx)(U.V,{onClose:()=>{$(),(0,v.qQ)(u.LocalStorageKeys.browserMute,!1),(0,v.qQ)(u.LocalStorageKeys.userMute,!0),b({[w.User]:{closeTime:Date.now()}}),h.sendLog("clickVoiceBubble",{is_open:0,mute_type:N("currentMuteType")})},onOpen:()=>{let{volume:e}=(0,F.J)(x);C&&(C.muted?C.muted=!1:C.volume=e),$(),C.emit("volumechange"),null==C||C.emit(a.USER_ACTION,{action:"change_muted"}),(0,v.qQ)(u.LocalStorageKeys.browserMute,!1),(0,v.qQ)(u.LocalStorageKeys.userMute,!1),h.sendLog("clickVoiceBubble",{is_open:1,mute_type:N("currentMuteType")})},description:"browser"===q?"因浏览器限制，当前为静音":"当前为静音，是否要打开声音？"}),G):null},O=e=>{let t=(0,A.N)();return(0,i.jsxs)(M.k,{componentName:"AutoSilentPlugin",Slardar:t,children:[(0,i.jsx)(U.I,(0,n._)({},e)),(0,i.jsx)(B,(0,n._)({},e))]})}},260231:function(e,t,l){l.d(t,{R:function(){return W},d:function(){return F}});var n=l(590921);l(612222),l(632852);var i=l(259202),o=l(611542),a=l(825211),r=l.n(a),u=l(552432),d=l.n(u),s=l(432097),c=l(275438),v=l(606660),m=l(593554),f=l(688497),g=l(71880),_=l(489542),p=l(804929),h=l(245086),y=l(356789),w=l(819769),x=l(224934),k=l(895184),I=l(632124),C=l(520515),S=l(720284),b=l(500606),L=l(554898),N=l(528386),E=l(181242),T=l(169625),P=l(299683),j=l(166494),R=l(478263),M=l(826297),D=l(130854),A=l(456713);let Z=e=>{let{danmaku:t,useDanmakuItem:l}=e,{emojiListMapped:n}=(0,P.b)(),{like:a,isDanmuAuthor:u,isAwemeAuthor:d,deleteHandler:s,reportHandler:c,likeHandler:v}=l(t),{danmakuId:m,text:f}=t,[g,_]=(0,o.useState)(null);return(0,o.useEffect)(()=>{n&&_((0,R.v)({danmakuId:m,text:f,emojiListMapped:n}))},[n,f,m]),(0,i.jsxs)("li",{className:b.default.danmakuLi,children:[(0,i.jsx)("div",{className:b.default.timeLi,children:(0,p.$y)(t.offsetTime)}),(0,i.jsx)("div",{className:b.default.textLi,children:g}),(0,i.jsxs)("div",{className:b.default.interaction,children:[(0,i.jsx)("div",{className:r()(b.default.icon,b.default.likeIcon,{[b.default.isLike]:a}),onClick:v,children:(0,i.jsx)("svg",{className:b.default.iconLike,width:"14",height:"13",viewBox:"0 0 14 13",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",fill:"currentColor",d:"M9.88448 0.398438C8.76117 0.398438 7.74021 0.852731 7.11838 1.71269C6.26503 0.852731 5.24305 0.398438 4.12177 0.398438C1.98145 0.398438 0.203125 2.19879 0.203125 4.34121C0.203125 4.48708 0.210222 4.5534 0.203125 4.56025C0.214278 5.05421 0.454581 5.94437 0.647185 6.31825C1.94356 9.04193 6.0401 11.9265 6.23271 12.1134C6.42531 12.3004 6.61792 12.4873 7.00313 12.4873C7.38833 12.4873 7.58094 12.3004 7.77354 12.1134C7.96615 11.9265 11.5463 9.30121 13.1116 6.75067C13.1796 6.57644 13.2242 6.49033 13.3421 6.31259C13.4168 6.12907 13.4919 5.96279 13.5726 5.8745C13.7149 5.3828 13.795 5.01066 13.8031 4.56025C13.797 4.54746 13.8031 4.48609 13.8031 4.34121C13.8031 2.19978 12.0238 0.398438 9.88448 0.398438Z",fillOpacity:"0.8"})})}),!u&&(0,i.jsx)("div",{className:r()(b.default.icon,b.default.report),onClick:c,children:(0,i.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",fill:"currentColor",d:"M8.13316 1.23494L13.8226 11.7956C14.3266 12.7751 13.6965 14 12.6888 14H1.3112C0.303482 14 -0.326644 12.7751 0.177387 11.7956L5.86554 1.23494C6.36957 0.25502 7.62913 0.25502 8.13316 1.23494ZM7.00041 12.3C6.30991 12.3 5.75 11.7407 5.75 11.05C5.75 10.3593 6.30991 9.8 7.00041 9.8C7.69009 9.8 8.25 10.3593 8.25 11.05C8.25 11.7407 7.69009 12.3 7.00041 12.3ZM7 4.2C6.44772 4.2 6 4.64772 6 5.2V7.7C6 8.25228 6.44772 8.7 7 8.7C7.55228 8.7 8 8.25228 8 7.7V5.2C8 4.64772 7.55228 4.2 7 4.2Z",fillOpacity:"0.8"})})}),(d||u)&&(0,i.jsx)("div",{className:r()(b.default.icon,b.default.deleteIcon),onClick:s,children:(0,i.jsx)("svg",{width:"12",height:"14",viewBox:"0 0 12 14",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",fill:"currentColor",d:"M8.39844 0.199219H3.59844L3.19844 0.999219H1.39844C0.846153 0.999219 0.398438 1.44693 0.398438 1.99922V3.39922H11.5984V1.99922C11.5984 1.44693 11.1507 0.999219 10.5984 0.999219H8.79844L8.39844 0.199219ZM1.19844 4.99922H10.7984L10.4418 12.8446C10.4176 13.3787 9.97749 13.7992 9.44286 13.7992H2.55402C2.01939 13.7992 1.57932 13.3787 1.55505 12.8446L1.19844 4.99922Z"})})})]})]})},W=e=>{let{player:t,loginDispatch:l,isLogin:a,awemeInfo:u,userUid:s,className:c,userInfo:f,targetMountEl:p,onClick:w,abtestData:x}=e,[k,I]=(0,o.useState)(!1),[S,E]=(0,o.useState)([]),{logParams:T}=(0,j.Y)();return(0,i.jsxs)("div",{className:r()(b.default.container,c),children:[(0,i.jsxs)("div",{className:r()(b.default.danmukuList),onClick:()=>{!p&&(document.body.style.overflow="hidden"),m.YY.replaceCurrentTask({id:"danmuList"}),M.Z.sendLog("clickDanmakuList",(0,n._)({enter_from:(0,h.mo)(),enter_from_merge:(0,h.yW)(),group_id:null==u?void 0:u.awemeId},T)),I(!0),setTimeout(()=>{y.emit(y.EVENT.videoStopPlayNext)},100),null==w||w()},children:[(0,i.jsx)("div",{children:"弹幕列表"}),(0,i.jsx)(A.z,{svg:(0,i.jsx)(C.Z,{style:{fontSize:"12px"}})})]}),k&&(0,i.jsx)(F,{awemeId:null==u?void 0:u.awemeId,setIsShowModal:I,useDanmakuItem:e=>{let{awemeId:i}=u,r=null==u?void 0:u.authorInfo.uid,c=(null==e?void 0:e.userId)===s,m=s===(null==u?void 0:u.authorInfo.uid),{danmakuId:p,diggType:w}=e,[k,I]=(0,o.useState)(!!w),C=(0,o.useRef)(!!w),[S,b]=(0,o.useState)(a);(0,o.useEffect)(()=>{C.current=k},[k]),(0,o.useEffect)(()=>{let e=()=>{b(!0)};return t&&t.on(D.Ks.updateLogin,e),()=>{t.off(D.Ks.updateLogin,e)}},[t,i]);let P=(0,o.useCallback)(d()(async()=>{if(S){I(e=>!e),E(e=>{let t=e.findIndex(e=>e.danmakuId===p);return e[t].diggType=e[t].diggType?0:1,[...e]});let{statusCode:e}=await (0,_.ob)({danmakuId:p,awemeId:i,type:C.current?0:1});0===e&&M.Z.sendLog(C.current?"cancelLikeDanmaku":"likeDanmaku",(0,n._)({enter_from:(0,h.mo)(),enter_from_merge:(0,h.yW)(),group_id:i,author_id:r,danmaku_id:p,enter_method:"list"},T))}else(0,L.default)({success:async()=>{"recommend"===(0,h.yW)()&&(null==x?void 0:x.recommendLoginResume)===v.RecommendLoginResume.V2?y.emit(y.EVENT.RecommendLoginResume):l({type:"updateUserInfo"}),t.emit(D.Ks.updateLogin);let{statusCode:e}=await (0,_.ob)({danmakuId:p,awemeId:i,type:1});0===e&&(I(e=>!e),E(e=>{let t=e.findIndex(e=>e.danmakuId===p);return e[t].diggType=e[t].diggType?0:1,[...e]}))},headerText:"登录后可为弹幕点赞",enterMethod:"like_danmaku"})},500),[p,S,i,T]),j=(0,o.useCallback)(()=>{var e,t;(0,g.mJ)({title:"举报弹幕",type:"danmaku",object_id:p,owner_id:null==f?void 0:null===(e=f.info)||void 0===e?void 0:e.uid,owner_sec_id:(null==f?void 0:null===(t=f.info)||void 0===t?void 0:t.secUid)||"",onClose:()=>{y.emit(y.EVENT.videoRemoveStopPlayNext)},logParams:{enter_method:"list"},loginDispatch:l,userInfo:null==f?void 0:f.info,pipeline_id:"",enter_from:(0,h.yW)(),isOrigin:!0})},[p,f,t]),R=(0,o.useCallback)(async()=>{if(null==t?void 0:t.danmaku){var e,l;N.F.info({text:"已删除弹幕",elTarget:(null===(e=document)||void 0===e?void 0:e.fullscreenElement)?null===(l=document)||void 0===l?void 0:l.fullscreenElement:document.body}),E(e=>{let t=e.findIndex(e=>e.danmakuId===p);return e.splice(t,1),[...e]})}let{statusCode:o}=await (0,_.YO)({userType:c?1:2,danmakuId:p});0===o&&M.Z.sendLog("deleteDanmaku",(0,n._)({enter_from:(0,h.mo)(),enter_from_merge:(0,h.yW)(),group_id:i,author_id:r,danmaku_id:p,enter_method:"list"},T))},[p,i,t,r,c,T]);return{like:k,isAwemeAuthor:m,isDanmuAuthor:c,likeHandler:P,reportHandler:j,deleteHandler:R}},targetMountEl:p,danmakuList:S,setDanmakuList:E})]})},F=e=>{let{awemeId:t,targetMountEl:l,setIsShowModal:a,useDanmakuItem:u,danmakuList:d,setDanmakuList:v}=e,[g,p]=(0,o.useState)(!1),[C,L]=(0,o.useState)(!0),N=(0,o.useRef)(!0),P=(0,o.useRef)(0),{logParams:R}=(0,j.Y)(),D=(0,o.useCallback)(async()=>{if(g||!N.current)return;p(!0);let e=async()=>{let l=await (0,_.JV)({awemeId:t,offset:P.current,count:50}),n=new Promise(e=>{v(t=>{var n;if((null==l?void 0:null===(n=l.danmakuList)||void 0===n?void 0:n.length)>0){let n=[...t,...l.danmakuList];return e(n.length),n}return e(t.length),t})});if(null==l?void 0:l.hasMore)return P.current+=50,!!(await n>=50)||await e();return!1};L(await e()),p(!1)},[t,g,C]);(0,o.useEffect)(()=>{N.current=C},[C]),(0,o.useEffect)(()=>()=>{y.emit(y.EVENT.videoRemoveStopPlayNext)},[]);let W=(0,o.useCallback)(async()=>{v([]),await L(!0),P.current=0,await D()},[D]),F=(0,o.useCallback)(e=>{let{target:t}=e;t.scrollHeight,t.scrollTop,t.clientHeight,t.scrollHeight-t.scrollTop<t.clientHeight+200&&D()},[D]);(0,o.useEffect)(()=>y.listen(y.EVENT.hideModal,()=>a(!1)),[]),(0,o.useEffect)(()=>(W(),w.Le.setConfig(w.gI.IsShowDanmakuListModal,!0),(0,x.o)({pauseCustomShortcut:!0,pauseGlobalShortcut:!0,pausePlayControlShortcut:!0},"DanmakuList"),()=>{w.Le.setConfig(w.gI.IsShowDanmakuListModal,!1),(0,x.m)("DanmakuList")}),[]);let U=(0,f.x)((()=>{M.Z.sendLog("danmakuListShow",(0,n._)({enter_from:(0,h.mo)(),enter_from_merge:(0,h.yW)(),group_id:t},R))}).bind(null));return(0,i.jsxs)(s.u_,{ref:e=>{e&&(e.onwheel=e=>e.preventDefault())},modalContentClass:r()(b.default.modal,{[b.default.mountEl]:!!l}),bodyStyle:{height:"100%"},afterClose:()=>{document.body.style.overflow="",y.emit(y.EVENT.videoRemoveStopPlayNext),a(!1),m.YY.finishTask("danmuList")},getPopupContainer:(0,k.r)()?()=>(0,I.W)()||l:void 0,visible:!0,hasCancel:!1,footer:null,closeOnEsc:!1,centered:!0,closable:!1,zIndex:9999,children:[(0,i.jsxs)("div",{className:b.default.header,ref:U,children:[(0,i.jsx)("div",{children:"弹幕列表"}),(0,i.jsx)(A.z,{svg:(0,i.jsx)(S.Z,{style:{fontSize:"37px",marginRight:"-11px",opacity:"0.8"}}),onClick:()=>{document.body.style.overflow="",y.emit(y.EVENT.videoRemoveStopPlayNext),a(!1),m.YY.finishTask("danmuList")}})]}),(0,i.jsx)(c.i,{className:b.default.divider}),(0,i.jsxs)("div",{className:b.default.content,children:[(0,i.jsxs)("div",{className:b.default.danmakuHeader,children:[(0,i.jsx)("div",{className:b.default.time,children:"时间"}),(0,i.jsx)("div",{className:b.default.text,children:"弹幕内容"})]}),(null==d?void 0:d.length)>0&&(0,i.jsxs)("ul",{ref:e=>{e&&(e.onwheel=e=>e.stopPropagation())},className:b.default.danmakuList,onScroll:F,onWheel:e=>e.stopPropagation(),children:[d.map(e=>(0,i.jsx)(Z,{danmaku:e,useDanmakuItem:u},e.danmakuId)),g&&(0,i.jsx)(E.gb,{className:r()(b.default.defaultLoading),text:"加载中"}),!C&&(0,i.jsx)("li",{className:b.default.noMore,children:"暂时没有更多了"})]}),(null==d?void 0:d.length)<=0&&g&&(0,i.jsx)(E.gb,{className:r()(b.default.centerLoading),text:"加载中"}),(null==d?void 0:d.length)<=0&&!g&&(0,i.jsx)(T.gi,{className:b.default.error,title:"",desc:"暂时没有更多了"})]})]})}},130854:function(e,t,l){l.d(t,{AY:function(){return g},IK:function(){return i},JO:function(){return s},Ks:function(){return v},Kt:function(){return u},NY:function(){return f},Rz:function(){return d},SW:function(){return n},WK:function(){return m},sZ:function(){return c},th:function(){return r},tj:function(){return o},uR:function(){return a}});let n=32,i="scroll",o=0,a=.5,r=12e3,u=20,d=40,s=1,c=5e3,v={updateLogin:"updateLogin",bulletHover:"bullet_hover",ratechange:"ratechange",clearCache:"clearCache",reportIdChange:"reportIdChange"},m=[{desc:"一行",value:.1,key:1,log:.1},{desc:"两行",value:.2,key:5,log:.2},{desc:"25%",value:.25,key:2,log:.4},{desc:"50%",value:.5,key:3,log:.5},{desc:"80%",value:.8,key:4,log:.8}],f=[{desc:"超小",value:16,key:5,log:-1},{desc:"小号",value:20,key:1,log:0},{desc:"适中",value:24,key:2,log:1},{desc:"大号",value:28,key:3,log:2},{desc:"超大",value:32,key:4,log:3}],g=[{desc:"较慢",value:18e3,key:1,log:0},{desc:"适中",value:14400,key:2,log:1},{desc:"较快",value:10800,key:3,log:2}]},166494:function(e,t,l){l.d(t,{G:function(){return i},Y:function(){return o}});var n=l(611542);let i=(0,n.createContext)({logParams:{}}),o=()=>(0,n.useContext)(i)},299683:function(e,t,l){l.d(t,{b:function(){return u}}),l(612222);var n=l(611542),i=l(296484);let o=(0,i.kv)(),a=e=>Object.values(e).filter(e=>(null==e?void 0:e.hide)!==1),r=a(o),u=()=>{let[e,t]=(0,n.useState)(r);(0,n.useEffect)(()=>{let e=!1;return(async()=>{let l;let{statusCode:n,data:o=[]}=await (0,i.zk)();0===n?(l=a(o),!e&&t(l)):l=r})(),()=>{e=!0}},[]);let l=(0,n.useMemo)(()=>{let t=new Map;return null==e||e.forEach(e=>{t.set(e.name,e.img)}),t},[e]);return{emojiList:e,emojiListMapped:l}}},571413:function(e,t,l){l.r(t),l.d(t,{DanmakuInner:function(){return e4},Danmaku:function(){return e9},DanmakuPlugin:function(){return e5},DanmakuBar:function(){return e3}});var n=l("590921");l("612222");var i=l("259202"),o=l("611542"),a=l("185791"),r=l("753451"),u=l("825211"),d=l.n(u),s=l("582099"),c=l("688497"),v=l("305452"),m=l("819769"),f=l("245086"),g=l("299683");l("632852");var _=l("623176"),p=l("781111"),h=l("356789"),y=l("874155"),w=l("900395"),x=l("271167"),k=l("552432"),I=l.n(k),C=l("606660"),S=l("71880"),b=l("489542"),L=l("554898"),N=l("528386"),E=l("130854"),T=l("826297");let P={danMuText:"danMuText",likeIcon:"likeIcon",reportIcon:"reportIcon",deleteIcon:"deleteIcon"},j={danmuId:"data-danmu-id",isLike:"data-is-like",isDanmuAuthor:"data-is-danmu-author"},R=e=>{let{awemeInfo:t,userInfo:l,player:i,loginDispatch:a,logParams:r,abtestData:u}=e,[d,s]=(0,o.useState)(!!(null==l?void 0:l.isLogin)),c=(0,o.useRef)(""),v=(0,o.useRef)(!1),m=(0,o.useRef)(null),g=(0,o.useRef)(!1);(0,o.useEffect)(()=>{let e=()=>{s(!0)};if(i)return i.on(E.Ks.updateLogin,e),()=>{i.off(E.Ks.updateLogin,e)}},[i,t]),(0,o.useEffect)(()=>{s(!!(null==l?void 0:l.isLogin))},[l]);let _=(0,o.useCallback)(I()(async()=>{if(d){v.current=!v.current,m.current.setAttribute(j.isLike,v.current);let{statusCode:l}=await (0,b.ob)({danmakuId:c.current,awemeId:null==t?void 0:t.awemeId,type:v.current?1:0});if(0===l){var e;T.Z.sendLog(v.current?"likeDanmaku":"cancelLikeDanmaku",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)(),group_id:null==t?void 0:t.awemeId,author_id:null==t?void 0:null===(e=t.authorInfo)||void 0===e?void 0:e.uid,danmaku_id:c.current,enter_method:"video"},r))}}else setTimeout(()=>{i.danmaku.freezeComment(c.current)},100),(0,L.default)({success:async()=>{"recommend"===(0,f.yW)()&&(null==u?void 0:u.recommendLoginResume)===C.RecommendLoginResume.V2?h.emit(h.EVENT.RecommendLoginResume):a({type:"updateUserInfo"}),i.emit(E.Ks.updateLogin);let{statusCode:e}=await (0,b.ob)({danmakuId:c.current,awemeId:null==t?void 0:t.awemeId,type:1});i.danmaku.restartComment(c.current),0===e&&(v.current=!v.current,m.current.setAttribute(j.isLike,v.current))},headerText:"登录后可为弹幕点赞",enterMethod:"like_danmaku",onClose:()=>{i.danmaku.restartComment(c.current)}})},500),[d,t,i,r,u]),p=(0,o.useCallback)(()=>{var e,t;i.emit(E.Ks.reportIdChange,c.current),i.danmaku.freezeComment(c.current),h.emit(h.EVENT.videoStopPlayNext);(0,S.mJ)({title:"举报弹幕",type:"danmaku",object_id:c.current,owner_id:null==l?void 0:null===(e=l.info)||void 0===e?void 0:e.uid,owner_sec_id:(null==l?void 0:null===(t=l.info)||void 0===t?void 0:t.secUid)||"",onClose:()=>{h.emit(h.EVENT.videoRemoveStopPlayNext),i.danmaku.restartComment(c.current),i.emit(E.Ks.reportIdChange,null)},logParams:{enter_method:"video"},loginDispatch:a,userInfo:null==l?void 0:l.info,pipeline_id:"",enter_from:(0,f.yW)(),isOrigin:!0,toast:e=>N.F.info(e,null==i?void 0:i.root),abtestData:u})},[l,i,a,u]),y=(0,o.useCallback)(async()=>{(null==i?void 0:i.danmaku)&&(null==i||i.danmaku.removeComment(c.current),N.F.info("已删除弹幕",(null==i?void 0:i.root)||document.body));let{statusCode:e}=await (0,b.YO)({userType:g.current?1:2,danmakuId:c.current});if(0===e){var l;T.Z.sendLog("deleteDanmaku",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)(),group_id:null==t?void 0:t.awemeId,author_id:null==t?void 0:null===(l=t.authorInfo)||void 0===l?void 0:l.uid,danmaku_id:c.current,enter_method:"video"},r))}},[t,i,r]);return(0,o.useCallback)(e=>{if(e.currentTarget){let o=e.target;for(;!(null==o?void 0:o.getAttribute(j.danmuId))&&o!==e.currentTarget;)o=o.parentNode;if(o!==e.currentTarget&&(m.current=o,o)){var t,l,n,i;c.current=o.getAttribute(j.danmuId),v.current="true"===o.getAttribute(j.isLike),g.current="true"===o.getAttribute(j.isDanmuAuthor),((null===(t=o.querySelector(`.${P.danMuText}`))||void 0===t?void 0:t.contains(e.target))||(null===(l=o.querySelector(`.${P.likeIcon}`))||void 0===l?void 0:l.contains(e.target)))&&_(),(null===(n=o.querySelector(`.${P.reportIcon}`))||void 0===n?void 0:n.contains(e.target))&&p(),(null===(i=o.querySelector(`.${P.deleteIcon}`))||void 0===i?void 0:i.contains(e.target))&&y()}}},[_,p,y])};var M=l("456713");let D=()=>(0,i.jsxs)("div",{className:x.default.svgCollect,children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("symbol",{id:"svg-like",width:"14",height:"13",viewBox:"0 0 14 13",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.88448 0.398438C8.76117 0.398438 7.74021 0.852731 7.11838 1.71269C6.26503 0.852731 5.24305 0.398438 4.12177 0.398438C1.98145 0.398438 0.203125 2.19879 0.203125 4.34121C0.203125 4.48708 0.210222 4.5534 0.203125 4.56025C0.214278 5.05421 0.454581 5.94437 0.647185 6.31825C1.94356 9.04193 6.0401 11.9265 6.23271 12.1134C6.42531 12.3004 6.61792 12.4873 7.00313 12.4873C7.38833 12.4873 7.58094 12.3004 7.77354 12.1134C7.96615 11.9265 11.5463 9.30121 13.1116 6.75067C13.1796 6.57644 13.2242 6.49033 13.3421 6.31259C13.4168 6.12907 13.4919 5.96279 13.5726 5.8745C13.7149 5.3828 13.795 5.01066 13.8031 4.56025C13.797 4.54746 13.8031 4.48609 13.8031 4.34121C13.8031 2.19978 12.0238 0.398438 9.88448 0.398438Z"})}),(0,i.jsx)("symbol",{id:"svg-report",width:"14",height:"14",viewBox:"0 0 14 14",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.13316 1.23494L13.8226 11.7956C14.3266 12.7751 13.6965 14 12.6888 14H1.3112C0.303482 14 -0.326644 12.7751 0.177387 11.7956L5.86554 1.23494C6.36957 0.25502 7.62913 0.25502 8.13316 1.23494ZM7.00041 12.3C6.30991 12.3 5.75 11.7407 5.75 11.05C5.75 10.3593 6.30991 9.8 7.00041 9.8C7.69009 9.8 8.25 10.3593 8.25 11.05C8.25 11.7407 7.69009 12.3 7.00041 12.3ZM7 4.2C6.44772 4.2 6 4.64772 6 5.2V7.7C6 8.25228 6.44772 8.7 7 8.7C7.55228 8.7 8 8.25228 8 7.7V5.2C8 4.64772 7.55228 4.2 7 4.2Z"})}),(0,i.jsx)("symbol",{id:"svg-delete",width:"12",height:"14",viewBox:"0 0 12 14",children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.39844 0.199219H3.59844L3.19844 0.999219H1.39844C0.846153 0.999219 0.398438 1.44693 0.398438 1.99922V3.39922H11.5984V1.99922C11.5984 1.44693 11.1507 0.999219 10.5984 0.999219H8.79844L8.39844 0.199219ZM1.19844 4.99922H10.7984L10.4418 12.8446C10.4176 13.3787 9.97749 13.7992 9.44286 13.7992H2.55402C2.01939 13.7992 1.57932 13.3787 1.55505 12.8446L1.19844 4.99922Z"})})]}),(0,i.jsx)(M.z,{svg:(0,i.jsx)(w.Z,{})})]}),A=e=>{let{text:t,danmakuId:l,awemeId:o,player:a,isDanmuAuthor:r=!1,isAwemeAuthor:u=!1,isLike:s=!1,isAnchor:v=!1,authorId:m="",firstDanmakuShowRef:g,offsetTime:_,videoScale:p,itemDurationMs:h,logParams:y={}}=e,k=(0,c.x)(()=>{if(!a.isEnded){var e;a.danmakuShowCount=(null!==(e=a.danmakuShowCount)&&void 0!==e?e:0)+1}!g.current&&_&&(T.Z.sendLog("firstDanmakuShow",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)(),group_id:o,author_id:m,danmaku_id:l,video_time:_,video_pct:Math.floor(a.currentTime/a.duration*100),video_scale:p,item_duration_ms:h},y)),g.current=!0)});return(0,i.jsxs)("div",{className:d()(x.default.danmakuItem,x.default.item,{[x.default.isAuthor]:r,[x.default.hovered]:v}),ref:k,[j.danmuId]:l,[j.isDanmuAuthor]:r,[j.isLike]:s,children:[(0,i.jsx)("div",{className:d()(x.default.danMuText,P.danMuText),children:t}),(0,i.jsx)("div",{className:d()(x.default.isLikeIcon),children:(0,i.jsx)(M.z,{svg:(0,i.jsx)(w.Z,{})})}),(0,i.jsx)("div",{className:x.default.line}),(0,i.jsxs)("div",{className:x.default.interactive,children:[(0,i.jsx)("div",{className:d()(x.default.icon,x.default.likeIcon,P.likeIcon),children:(0,i.jsx)("svg",{className:x.default.iconLike,width:"14",height:"13",viewBox:"0 0 14 13",children:(0,i.jsx)("use",{href:"#svg-like"})})}),!r&&(0,i.jsx)("div",{className:d()(x.default.icon,x.default.report,P.reportIcon),children:(0,i.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",children:(0,i.jsx)("use",{href:"#svg-report"})})}),(u||r)&&(0,i.jsx)("div",{className:d()(x.default.icon,x.default.deleteIcon,P.deleteIcon),children:(0,i.jsx)("svg",{width:"12",height:"14",viewBox:"0 0 12 14",children:(0,i.jsx)("use",{href:"#svg-delete"})})})]})]},l)},Z=e=>{let t=document.createElement("div");return t.id=e.danmakuId,p.render((0,o.createElement)(A,(0,y._)((0,n._)({},e),{key:e.danmakuId})),t),t};var W=l("67108"),F=l.n(W),U=l("896291"),B=l.n(U),O=l("291494"),z=l.n(O),H=l("540786"),V=l.n(H),K=l("256333"),$=l.n(K),Y=l("200343"),G=l.n(Y),q=l("713017");let Q={fontSize:1,speed:1,region:0,opacity:80*E.JO,isOpen:!1},X={fontSize:2,speed:1,region:2,opacity:80*E.JO,isOpen:!1},J=()=>{var e;let t=m.Le.getConfig(m.gI.AbtestData)||{};return(null===(e=navigator)||void 0===e?void 0:e.hardwareConcurrency)>4&&(null==t?void 0:t.danmakuConfig)?X:Q},ee=m.gI.DanmakuSetting,et=new Map([["fontSize",["danmakuSizeSetting","size_value"]],["region",["danmakuAreaSetting","area_value"]],["opacity",["danmakuOpacitySetting","opacity_value"]],["speed",["danmakuSpeedSetting","speed_value"]]]),el=(e,t,l)=>{if("opacity"===e)return[t,l];if("region"===e)return[E.WK[t].log,E.WK[l].log];if("fontSize"===e)return[E.NY[t].log,E.NY[l].log];else if("speed"===e)return[E.AY[t].log,E.AY[l].log];else return[t-1,l-1]},en=(e,t,l,i,o)=>{let a=(0,f.mo)(),r=(0,f.yW)(),{awemeId:u,authorUserId:d}=l||{};if(V()(e).length>=et.size){let{speed:e,region:l,fontSize:s,opacity:c}=$()(t)?J():t;T.Z.sendLog("clickDanmakuDefaultSetting",(0,y._)((0,n._)({enter_from:a,enter_from_merge:r,group_id:u,author_id:String(d),pre_speed_value:E.AY[e].log,pre_area_value:E.WK[l].log,pre_size_value:E.NY[s].log,pre_opacity_value:c},i),{rate:(null==o?void 0:o())||0}));return}if(1===V()(e).length&&z()(e,"isOpen")){var s,c,v;T.Z.sendLog("danmakuSwitch",(0,y._)((0,n._)({enter_from:a,enter_from_merge:r,action:e.isOpen?"1":"0",group_id:u,author_id:String(d),video_scale:(null==l?void 0:null===(s=l.video)||void 0===s?void 0:s.width)/(null==l?void 0:null===(c=l.video)||void 0===c?void 0:c.height),item_duration_ms:(null==l?void 0:null===(v=l.video)||void 0===v?void 0:v.duration)||0},i),{rate:(null==o?void 0:o())||0}));return}B()(e,(e,l)=>{if("isOpen"===l)return;let[s,c]=el(l,Number(e),t[l]),[v,m]=et.get(l);v&&T.Z.sendLog(v,(0,y._)((0,n._)({enter_from:a,enter_from_merge:r,group_id:u,author_id:String(d),[m]:s,pre_value:c},i),{rate:(null==o?void 0:o())||0}))})},ei=()=>m.Le.getConfig(ee),eo=e=>{var t,l;return Number(null!==(l=null===(t=ei())||void 0===t?void 0:t[e])&&void 0!==l?l:J()[e])},ea=()=>{var e;return(null===(e=ei())||void 0===e?void 0:e.opacity)/100||E.JO},er=()=>{var e,t;return(null===(e=E.NY[null===(t=ei())||void 0===t?void 0:t.fontSize])||void 0===e?void 0:e.value)||E.Kt},eu=()=>{var e,t;return(null===(e=E.AY[null===(t=ei())||void 0===t?void 0:t.speed])||void 0===e?void 0:e.value)||E.th},ed=(e,t)=>t.findIndex(t=>t.key===e),es=async()=>{let e=m.Le.getConfig(ee);if(e)return e;let t=J();try{var l,i,o;let e=await (0,b.Ri)({hardware_concurrency:null===(l=navigator)||void 0===l?void 0:l.hardwareConcurrency});if((null==e?void 0:e.statusCode)===0){let l=null==e?void 0:null===(i=e.confList)||void 0===i?void 0:i[0],a=G()(l,(e,t)=>"isOn"===t||0!==e);a.region=ed(a.region,E.WK),a.fontSize=ed(a.fontSize,E.NY),a.speed=ed(a.speed,E.AY);let r=(0,n._)({},t,a);document.body.style.setProperty("--danmaku-img-height",`${E.NY[r.fontSize].value}px`);let u=(null===(o=navigator)||void 0===o?void 0:o.hardwareConcurrency)>4;return(null==l?void 0:l.fromDefault)&&!u&&(r.isOpen=!1),m.Le.setConfig(ee,r),r}document.body.style.setProperty("--danmaku-img-height",`${E.NY[t.fontSize].value}px`)}catch(e){}return document.body.style.setProperty("--danmaku-img-height",`${E.NY[t.fontSize].value}px`),t},ec=F()(async e=>{let{conf:t,oldConf:l,isSendLog:i=!0,awemeInfo:o,isLogin:a,logParams:r,getRate:u}=e,d=(0,n._)({},m.Le.getConfig(ee)||l),s=(0,n._)({},d,t);if(document.body.style.setProperty("--danmaku-img-height",`${E.NY[s.fontSize].value}px`),m.Le.setConfig(ee,s),a){let e=(0,y._)((0,n._)({},s),{region:E.WK[s.region].key,fontSize:E.NY[s.fontSize].key,speed:E.AY[s.speed].key});0===(await (0,b.RB)(e)).statusCode&&i&&en(t,d,o,r,u)}},100,{trailing:!0}),ev=e=>{let{danmu:t,awemeInfo:l,player:i,isLogin:o,logParams:a}=e,r=(0,n._)({},m.Le.getConfig(ee)),{opacity:u,speed:d,fontSize:s,region:c}=J();m.Le.setConfig(ee,null),null==t||t.setOpacity(u/100);let v=E.NY[s].value;null==t||t.setFontSize(String(v),v+20,{reflow:!1});let f=(0,n._)({start:E.tj,end:E.WK[c].value},1===c||0===c?{lines:c+1}:{});null==t||t.setArea(f),null==t||t.setAllDuration(E.IK,E.AY[d].value/(null==i?void 0:i.playbackRate)),ec({conf:{region:c,speed:d,fontSize:s,opacity:u,isOpen:r.isOpen},awemeInfo:l,oldConf:r,isLogin:o,logParams:a})},em=[{key:"opacity",desc:"不透明度",showDots:!1,max:100,getLabelFunc:e=>`${e}%`,defaultVal:80*E.JO,onChange:async e=>{let{val:t,danmu:l,awemeInfo:n,isLogin:i,logParams:o}=e,a=Math.max(t/100,.2);ec({conf:{opacity:Math.max(t,20)},awemeInfo:n,isLogin:i,logParams:o}),null==l||l.setOpacity(a)}},{key:"region",desc:"显示区域",showDots:!0,max:4,getLabelFunc:e=>{var t;return null===(t=E.WK[e])||void 0===t?void 0:t.desc},defaultVal:1,onChange:async e=>{let{val:t,danmu:l,awemeInfo:i,isLogin:o,player:a,logParams:r}=e,u=(0,n._)({start:E.tj,end:E.WK[t].value},1===t||0===t?{lines:t+1}:{});ec({conf:{region:t},awemeInfo:i,isLogin:o,logParams:(0,n._)({browser_height:(0,q.P6)(),browser_width:(0,q.wi)(),browser_ratio:(0,q.P6)()/(0,q.wi)()},r),getRate:()=>{var e,t,l,n;return((null==a?void 0:null===(l=a.danmaku)||void 0===l?void 0:null===(t=l.state)||void 0===t?void 0:null===(e=t.displayArea)||void 0===e?void 0:e.height)||0)/(null==a?void 0:null===(n=a.video)||void 0===n?void 0:n.clientHeight)}}),null==l||l.setArea(u)}},{key:"fontSize",desc:"字体大小",showDots:!0,max:4,getLabelFunc:e=>E.NY[e].desc,defaultVal:2,onChange:async e=>{let{val:t,danmu:l,awemeInfo:i,isLogin:o,player:a,logParams:r}=e,u=E.NY[t].value;ec({conf:{fontSize:t},awemeInfo:i,isLogin:o,logParams:(0,n._)({browser_height:(0,q.P6)(),browser_width:(0,q.wi)(),browser_ratio:(0,q.P6)()/(0,q.wi)()},r),getRate:()=>{var e,t,l,n;return((null==a?void 0:null===(l=a.danmaku)||void 0===l?void 0:null===(t=l.state)||void 0===t?void 0:null===(e=t.displayArea)||void 0===e?void 0:e.height)||0)/(null==a?void 0:null===(n=a.video)||void 0===n?void 0:n.clientHeight)}}),null==l||l.setFontSize(String(u),u+20)}},{key:"speed",desc:"移动速度",showDots:!0,max:2,getLabelFunc:e=>{var t;return null===(t=E.AY[e])||void 0===t?void 0:t.desc},defaultVal:2,onChange:async e=>{let{val:t,danmu:l,awemeInfo:n,player:i,isLogin:o,logParams:a}=e,r=E.AY[t].value;ec({conf:{speed:t},awemeInfo:n,isLogin:o,logParams:a}),null==l||l.setAllDuration(E.IK,r/(null==i?void 0:i.playbackRate))}}];var ef=l("478263");let eg=null,e_=e=>{let{player:t,isActive:i,awemeInfo:a,userInfo:r,ref:u,danmakuInfo:d,initialStatus:s,setDanmakuInited:c,emojiListMapped:v,logParams:g}=e,[y,w]=(0,o.useState)(!!eg),x=(0,o.useRef)(null),k=(0,o.useRef)(0);(0,o.useEffect)(()=>{(async()=>{if(!y){var e;eg=null===(e=await l.e("7102").then(l.t.bind(l,989298,23)))||void 0===e?void 0:e.default,w(!0)}})()},[]);let I=e=>{k.current=e};return(0,o.useEffect)(()=>(null==t||t.on(E.Ks.reportIdChange,I),()=>{null==t||t.off(E.Ks.reportIdChange,I),k.current=null}),[t,a]),(0,o.useEffect)(()=>{if(t&&i&&!t.danmaku&&s&&y&&u.current){var e,l;let i=null===(e=ei())||void 0===e?void 0:e.region,{awemeId:o,authorInfo:s}=a||{},y={needResizeObserver:!0,disableCopyDOM:!0,mouseControl:!0,mouseControlPause:!0,container:u.current,live:!1,player:t,direction:"r2l",channelSize:er()+20||E.Rz,area:{start:E.tj,end:(null===(l=E.WK[i])||void 0===l?void 0:l.value)||E.uR,lines:0===i||1===i?i+1:void 0},defaultOff:!0,dropStaleComments:!0,hooks:{bulletCreateEl(e){var l,i,u,d,c,v;let m=(0,ef.v)({danmakuId:e.danmakuId,text:e.text,emojiListMapped:null==t?void 0:null===(l=t.danmaku)||void 0===l?void 0:l.emojiListMapped});return Z((0,n._)({player:t,text:m,danmakuId:e.id,awemeId:o,isAwemeAuthor:(null==s?void 0:s.uid)===(null==r?void 0:null===(i=r.info)||void 0===i?void 0:i.uid),authorId:null==s?void 0:s.uid,isDanmuAuthor:(null==e?void 0:e.user_id)===(null==r?void 0:null===(u=r.info)||void 0===u?void 0:u.uid),logParams:g,videoScale:(null==a?void 0:null===(d=a.video)||void 0===d?void 0:d.width)/(null==a?void 0:null===(c=a.video)||void 0===c?void 0:c.height),itemDurationMs:(null==a?void 0:null===(v=a.video)||void 0===v?void 0:v.duration)||0},e._))},bulletDetached(e,t){p.unmountComponentAtNode(t)}}},w=new eg(y);w.setOpacity(ea()),t.paused?t.needStart=!0:w.start(),t.danmaku=w||{},t.danmaku.emojiListMapped=v,c(!0);let I=()=>{if(k.current){k.current=0,x.current=null;return}let e=x.current;(null==e?void 0:e.el)&&(null==e||e.el.removeEventListener("mouseleave",I),null==e||e.el.removeEventListener("click_timestamp",I)),(null==e?void 0:e.id)&&(null==e?void 0:e.el)&&(w.restartComment(null==e?void 0:e.id),e.el.style.setProperty("z-index","9")),x.current=null},C=e=>{var l;let{bullet:i}=e;if(i!==x.current&&null!==i.el)T.Z.sendLog("pickDanmaku",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)(),group_id:null==a?void 0:a.awemeId,author_id:null==a?void 0:null===(l=a.authorInfo)||void 0===l?void 0:l.uid,danmaku_id:i.id},g)),x.current=i,t.danmaku.freezeComment(i.id),i.el.addEventListener("mouseleave",I),i.el.addEventListener("click_timestamp",I),i.el.style.setProperty("z-index","11")};w.on(E.Ks.bulletHover,C);let S=w.resize;w.resize=()=>{var e;if(!!(null==t?void 0:null===(e=t.root)||void 0===e?void 0:e.offsetWidth))w&&S.call(w)};let b=()=>null==w?void 0:w.resize(),L=()=>{var e,l,n;null==t||null===(e=t.danmaku)||void 0===e||e.clear(),null==t||null===(l=t.danmaku)||void 0===l||l.stop(),((null===(n=m.Le.getConfig(m.gI.DanmakuSetting))||void 0===n?void 0:n.isOpen)||d)&&(t.paused?t.needStart=!0:null==w||w.start())},N=()=>{I(),null==t||t.emit(E.Ks.clearCache),null==w||w.stop()},P=()=>{"paused"!==w.status&&(null==w||w.pause())},j=()=>{var e,l,n;((null===(e=m.Le.getConfig(m.gI.DanmakuSetting))||void 0===e?void 0:e.isOpen)||d)&&(t.needStart||(null==t?void 0:null===(l=t.danmaku)||void 0===l?void 0:l.main._status)==="closed"?(t.danmaku.start(),t.needStart=!1):null==w||null===(n=w.play)||void 0===n||n.call(w))},R=()=>{let e=eu();t.playbackRate&&(null==w||w.setAllDuration(E.IK,e/t.playbackRate))},M=()=>{d&&(null==d?void 0:d.status)!==0&&setTimeout(()=>{if(d.pausedStatus&&!t.paused||!d.pausedStatus){var e;null==t||null===(e=t.danmaku)||void 0===e||e.start()}},500)};t.on(_.FULLSCREEN_CHANGE,b),t.on(_.CSS_FULLSCREEN_CHANGE,b),t.on(_.MINI_STATE_CHANGE,b),t.on(_.SEEKED,L),t.on(_.SEEKING,N),t.on(_.PAUSE,P),t.on(_.PLAY,j),t.on(_.CANPLAY,M),t.on("ratechange",R);let D=h.listen(h.EVENT.videoPause,P);return(null==d?void 0:d.danmakuOffset)&&(null==d?void 0:d.status)!==0&&(eu(),t.currentTime=Math.max((null==d?void 0:d.danmakuOffset)/1e3-1,0),setTimeout(()=>{var e;null==t||null===(e=t.danmaku)||void 0===e||e.start()},500)),()=>{null==t||t.off(_.FULLSCREEN_CHANGE,b),null==t||t.off(_.CSS_FULLSCREEN_CHANGE,b),null==t||t.off(_.MINI_STATE_CHANGE,b),t.off(_.SEEKED,L),null==t||t.off(_.SEEKING,N),null==t||t.off(_.PAUSE,P),t.off(_.PLAY,j),null==t||t.off(_.CANPLAY,M),null==t||t.off(E.Ks.ratechange,R),null==w||w.off(E.Ks.bulletHover,C),null==w||w.destroy(),w=null,t.danmaku=null,D()}}},[t,i,null==a?void 0:a.awemeId,s,y]),null},ep={isLoading:!1,hasUsed:!1,fetchTimes:0,data:[]},eh=e=>{let{player:t,isActive:l,awemeInfo:i,danmakuInited:a,danmakuInfo:r,firstDanmakuShowRef:u,danmuTimeGap:d,logParams:s}=e,{awemeId:c}=i||{},v=(0,o.useRef)({}),g=(0,o.useRef)(0),p=(0,o.useRef)(!1),h=(0,o.useRef)(()=>{}),y=(0,o.useRef)(0),w=(0,o.useRef)(0),x=(0,o.useCallback)((e,t)=>{let l=d||E.SW;if(!t)return[0,l];let n=Math.floor(t/l)*l;return[n,n+l<e?n+l:e]},[d]),k=()=>{(async()=>{var e,l,o,a,r,u;let d=null!==(r=null==t?void 0:t.sendDanmakuCountSelf)&&void 0!==r?r:0,c=await es(),v=g.current+d,m=(null!==(u=null==t?void 0:t.danmakuShowCount)&&void 0!==u?u:0)+d;T.Z.sendLog("danmakuPlayResult",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)(),group_id:null==i?void 0:i.awemeId,author_id:null==i?void 0:null===(e=i.authorInfo)||void 0===e?void 0:e.uid,danmaku_count:v,danmaku_pub_count:v,danmaku_play_count:m>v?v:m,speed_value:E.AY[c.speed].log,area_value:E.WK[c.region].log,size_value:E.NY[c.fontSize].log,opacity_value:c.opacity,speed_video:null==t?void 0:t.playbackRate,play_time:w.current,browser_height:(0,q.P6)(),browser_width:(0,q.wi)(),browser_ratio:(0,q.P6)()/(0,q.wi)(),rate:y.current,video_scale:(null==i?void 0:null===(l=i.video)||void 0===l?void 0:l.width)/(null==i?void 0:null===(o=i.video)||void 0===o?void 0:o.height),item_duration_ms:(null==i?void 0:null===(a=i.video)||void 0===a?void 0:a.duration)||0},s)),t.sendDanmakuCountSelf=0})()},C=()=>{v.current={}};h.current=()=>{C(),!p.current&&(p.current=!0,k())},(0,o.useEffect)(()=>{v.current={};let e=()=>h.current();return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e),h.current()}},[c]),(0,o.useEffect)(()=>{t.isEnded=!1,t.danmakuShowCount=0},[c,l]),(0,o.useEffect)(()=>{if(t){let e=()=>{w.current=Math.ceil(1e3*((null==t?void 0:t.currentTime)||(null==t?void 0:t.duration)))};return null==t||t.on(E.Ks.clearCache,C),null==t||t.on(_.TIME_UPDATE,e),()=>{null==t||t.off(E.Ks.clearCache,C),null==t||t.off(_.TIME_UPDATE,e)}}},[t,c]),(0,o.useEffect)(()=>{if(t&&l&&t.danmaku&&a){let e=I()(async()=>{var e,l,o,a,d,s,f;if(!((null===(e=m.Le.getConfig(m.gI.DanmakuSetting))||void 0===e?void 0:e.isOpen)||r))return;let[_,p]=x(t.duration,t.currentTime);v.current.awemeId=v.current.awemeId||{},!v.current.awemeId[_]&&(v.current.awemeId[_]=(0,n._)({},ep));let h=v.current.awemeId[_];if((null==h?void 0:h.isLoading)||(null==h?void 0:h.hasUsed))return;h.fetchTimes++,h.isLoading=!0;let w=await (0,b.N6)({awemeId:c,startTime:Math.round(1e3*_),endTime:Math.round(1e3*p),authenticationToken:null==i?void 0:i.authenticationToken,duration:Math.ceil((null==t?void 0:t.duration)*1e3)});if(h.isLoading=!1,0!==w.statusCode)return;h.hasUsed=!0;let{danmakuList:k=[],total:I}=w;!t.isEnded&&(g.current=I),y.current=((null==t?void 0:null===(a=t.danmaku)||void 0===a?void 0:null===(o=a.state)||void 0===o?void 0:null===(l=o.displayArea)||void 0===l?void 0:l.height)||0)/(null==t?void 0:null===(d=t.video)||void 0===d?void 0:d.clientHeight);let C=`${er()}px`,S=null==k?void 0:k.map(e=>({start:(null==r?void 0:r.danmakuId)===e.danmakuId?void 0:e.offsetTime,realTime:(null==r?void 0:r.danmakuId)===e.danmakuId,duration:eu()/t.playbackRate,id:e.danmakuId,user_id:e.userId,score:null==e?void 0:e.score,elLazyInit:!0,text:null==e?void 0:e.text,style:{fontSize:C,height:C,lineHeight:C,color:"#FFFFFF",marginTop:"0"},prior:(null==r?void 0:r.danmakuId)===e.danmakuId,_:{isAnchor:(null==r?void 0:r.danmakuId)===e.danmakuId,isLike:1===e.diggType,firstDanmakuShowRef:u,offsetTime:e.offsetTime}}));S.length>0&&(null==t||null===(f=t.danmaku)||void 0===f||null===(s=f.updateComments)||void 0===s||s.call(f,S,!1))},2e3,{leading:!0,trailing:!1}),o=()=>{!t.paused&&l&&t.danmaku&&a&&e()},d=()=>{t.isEnded=!0};return t.on(_.CANPLAY,e),t.on(_.TIME_UPDATE,o),t.on(_.ENDED,d),()=>{t.off(_.CANPLAY,e),t.off(_.TIME_UPDATE,o),t.off(_.ENDED,d)}}},[t,l,c,a,x])};var ey=l("166494"),ew=l("432097"),ex=l("448110"),ek=l("63702"),eI=l("149427"),eC=l("315183"),eS=l("797210");let eb=e=>{let{player:t,initialStatus:l,setInitialStatus:a,awemeInfo:r,isConfGot:u,isLogin:s,isDanmuIcon:c,isNeverHover:v=!1,abtestData:m}=e,[g,p]=(0,o.useState)(l),y=(0,o.useRef)(),w=(0,o.useRef)(!1),{logParams:x}=(0,ey.Y)(),k=(0,o.useCallback)(e=>{if(w.current=!0,t){if(null==t||t.emit(_.USER_ACTION,{action:"danmaku_switch",status:g?"close":"open"}),!l){a(!0),p(!0),ec({conf:{isOpen:!0},awemeInfo:r,isLogin:s,logParams:(0,n._)({click_method:!0===e?"hot_key":"click"},x)}),!0===e&&N.F.info("打开弹幕",null==t?void 0:t.root);return}!0===e&&N.F.info(`${g?"关闭":"打开"}弹幕`,null==t?void 0:t.root),ec({conf:{isOpen:!g},awemeInfo:r,isLogin:s,logParams:(0,n._)({click_method:!0===e?"hot_key":"click"},x)}),p(e=>(a(!e),!e)),null==t||t.emit(E.Ks.clearCache)}},[t,l,r,s,g,x]);(0,o.useEffect)(()=>{if(!l){w.current=!1;return}if(null==t?void 0:t.danmaku){var e,n,i,o;g?t.paused?t.needStart=!0:null==t||null===(n=t.danmaku)||void 0===n||null===(e=n.start)||void 0===e||e.call(n):(t.needStart=!1,null==t||null===(o=t.danmaku)||void 0===o||null===(i=o.stop)||void 0===i||i.call(o))}w.current=!1},[g]),(0,o.useEffect)(()=>{p(l)},[l]);let I=()=>{p(!0),ec({conf:{isOpen:!0},awemeInfo:r,isLogin:s,logParams:x})};(0,o.useEffect)(()=>{null==t||t.on("DANMAKU_SWITCH_OPEN",I);let e=h.listen(h.EVENT.syncInteraction,()=>{var e;return p(null===(e=ei())||void 0===e?void 0:e.isOpen)});return()=>{null==t||t.off("DANMAKU_SWITCH_OPEN",I),null==e||e()}},[]),(0,o.useEffect)(()=>{let e=F()(()=>{k(!0)},500,{trailing:!0});if(t&&(c||!c&&!v))return null==t||t.on(eS.B.ChangeDanmaku,e),()=>{null==t||t.off(eS.B.ChangeDanmaku,e)}},[t,k,v,c]);let C=(0,o.useMemo)(()=>u?g?(0,i.jsx)(ex.Z,{}):(0,i.jsx)(ek.Z,{}):(0,i.jsx)(eI.Z,{style:{color:"#ffffff"}}),[u,g]),S=(0,o.useCallback)(()=>{T.Z.sendLog("hover_danmaku_switch",{enter_from:(0,f.mo)()})},[]);return v?null:c?(0,i.jsxs)("div",{className:d()(eC.default.switchBox,eC.default.danmakuhover),onMouseLeave:S,children:[(0,i.jsx)("div",{className:eC.default.switchLabel,children:"弹幕开关"}),(0,i.jsx)(ew.rs,{checked:g,onChange:k})]}):(0,i.jsx)("div",{className:eC.default.container,onMouseLeave:S,children:(0,i.jsx)(ew.u,{getPopupContainer:()=>y.current||document.body,spacing:10,content:(0,i.jsxs)(i.Fragment,{children:[`${g?"关闭":"打开"}弹幕`,(0,i.jsx)("span",{className:eC.default.tipKey,children:"B"})]}),showArrow:!1,position:"top",children:(0,i.jsx)("span",{className:d()(eC.default.svgBox,eC.default.danmakuhover),ref:y,children:(0,i.jsx)(M.z,{svg:C,onClick:k})})})})};var eL=l("275438"),eN=l("729507"),eE=l("674193"),eT=l("77055"),eP=l("473258"),ej=l("699233"),eR=l("260231");let eM=(e,t)=>{let l={};for(let n=e;n<=t;n++)l[n]=String(n);return l},eD=e=>{let{label:t,max:l,showDots:n,getLabelFunc:a,defaultValue:r,onChange:u,resetVal:d,min:s,player:c}=e,[v,m]=(0,o.useState)(r||1);(0,o.useEffect)(()=>{m(r)},[d,r]);let f=(0,o.useCallback)(e=>{if("number"==typeof e)u(e),m(t=>(t!==e&&(null==c||c.emit(_.USER_ACTION,{action:"danmaku_setting"})),e))},[u]);return(0,i.jsxs)("div",{className:eP.default.listItem,children:[(0,i.jsx)("span",{className:eP.default.label,children:t}),(0,i.jsx)(ew.iR,{step:1,marks:n?eM(s,l):void 0,min:s||0,max:l,showMarkLabel:!1,tooltipVisible:!1,value:v,onChange:f}),(0,i.jsx)("span",{className:eP.default.value,children:a(v)})]})},eA=e=>{let{player:t,awemeInfo:l,isLogin:a,loginDispatch:r,userUid:u,userInfo:s,isDanmuIcon:c,panelClassName:v,inputRef:g,initialStatus:_,setInitialStatus:p,isConfGot:y,children:w,danmuListTargetEl:x,abtestData:k}=e,[I,C]=(0,o.useState)(!1),[S,b]=(0,o.useState)(!0),[L,N]=(0,o.useState)(!1),E=(0,o.useRef)(),P=(0,o.useRef)(),{logParams:j}=(0,ey.Y)(),R=()=>{T.Z.sendLog("enterDanmakuSetting",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)()},j))};return(0,o.useEffect)(()=>{let e=h.listen(h.EVENT.syncInteraction,()=>C(e=>!e));return()=>{null==e||e()}},[]),(0,o.useEffect)(()=>{let e=e=>{null==e||e.stopPropagation()},t=P.current;return null==t||t.addEventListener("pointerdown",e),null==t||t.addEventListener("touchstart",e),()=>{null==t||t.removeEventListener("pointerdown",e),null==t||t.removeEventListener("touchstart",e)}},[]),(0,i.jsxs)("div",{ref:P,className:d()(eP.default.container,{[eP.default.show]:L}),onMouseEnter:()=>{if(R(),b(!1),c&&ei()){var e;p(null===(e=ei())||void 0===e?void 0:e.isOpen)}h.emit(h.EVENT.videoStopPlayNext),setTimeout(()=>{var e;c&&(null===(e=g.current)||void 0===e||e.focus())},100),clearTimeout(E.current),!m.Le.getConfig(m.gI.IsShowDanmakuListModal)&&N(!0)},onMouseLeave:()=>{var e;T.Z.sendLog("hover_danmaku_setting",{enter_from:(0,f.mo)()}),c&&(null===(e=g.current)||void 0===e||e.blur()),h.emit(h.EVENT.videoRemoveStopPlayNext),E.current=setTimeout(()=>{N(!1)},500)},children:[S?(0,i.jsx)(eb,{player:t,initialStatus:_,setInitialStatus:p,awemeInfo:l,isConfGot:y,isLogin:null==s?void 0:s.isLogin,isDanmuIcon:c,isNeverHover:S}):(0,i.jsx)("div",{className:eP.default.panelWithBottom,children:(0,i.jsxs)("div",{className:d()(eP.default.panel,"semi-always-dark",v),children:[(0,i.jsxs)("div",{className:eP.default.header,children:[(0,i.jsx)("div",{className:eP.default.title,children:"弹幕设置"}),(0,i.jsxs)("div",{className:eP.default.reset,onClick:()=>{ev({danmu:null==t?void 0:t.danmaku,awemeInfo:l,player:t,isLogin:a,logParams:j}),C(e=>!e)},children:[(0,i.jsx)(ej.Z,{src:eN.Z,width:13,height:12,viewBox:"0 0 14 13"}),(0,i.jsx)("span",{children:"恢复默认"})]})]}),(0,i.jsx)(eL.i,{className:eP.default.divider}),(0,i.jsx)("div",{className:eP.default.list,children:em.map(e=>{var n;return(0,i.jsx)(eD,{label:e.desc,showDots:e.showDots,max:e.max,min:"opacity"===e.key?20:0,getLabelFunc:e.getLabelFunc,defaultValue:null!==(n=eo(e.key))&&void 0!==n?n:e.defaultVal,onChange:n=>{e.onChange({danmu:null==t?void 0:t.danmaku,val:n,awemeInfo:l,player:t,isLogin:a,logParams:j})},resetVal:I,player:t},e.key)})}),!c&&(0,i.jsx)(eL.i,{className:eP.default.dividerSmall}),(0,i.jsx)(eR.R,{userUid:u,awemeInfo:l,player:t,loginDispatch:r,isLogin:a,className:c?eP.default.danmuIconStyle:"",userInfo:s,targetMountEl:x,onClick:()=>N(!1),abtestData:k}),w]})}),!!c&&(0,i.jsx)(M.z,{className:d()(eP.default.iconSetting,eP.default.newdanmuku),svg:(0,i.jsx)(eE.Z,{})}),!c&&(0,i.jsx)(M.z,{className:d()(eP.default.iconSetting,eP.default.newdanmuku),svg:(0,i.jsx)(eT.Z,{})})]})};l("999921"),l("227470"),l("347885"),l("572521");var eZ=l("51877"),eW=l.n(eZ),eF=l("529122"),eU=l.n(eF),eB=l("106649"),eO=l("765008"),ez=l("603051"),eH=l("919117");let eV=(e,t)=>{let l=t-1,n=!1,i=t,o=!1;for(;l>=0;){if("["===e[l]){n=!0;break}if("]"===e[l])break;l--}for(;i<=e.length-1;){if("]"===e[i]){o=!0;break}if("["===e[i])break;i++}return n&&o?[l,i+1]:[-1,-1]},eK=(e,t)=>{let l=(e.match(/\[[\u4e00-\u9fa5]+\]/g)||[]).filter(e=>t.includes(e));return l[l.length-1]||""},e$=e=>{var t,l;let{awemeInfo:a,userInfo:r,player:u,loginDispatch:s,setInitialStatus:c,firstDanmakuShowRef:v,isDanmuIcon:m,inputRef:p,abtestData:y}=e,[w,x]=(0,o.useState)(0),[k,I]=(0,o.useState)(""),S=(0,o.useRef)(null),P=(0,o.useRef)(0),j=(0,o.useRef)(0),R=(0,o.useRef)(!1),M=(0,o.useRef)(0),D=(0,o.useRef)(!1),A=(0,o.useRef)(0),Z=(0,o.useRef)(null),W=(0,o.useRef)(!1),{emojiList:F}=(0,g.b)(),{logParams:U}=(0,ey.Y)(),B=(0,o.useMemo)(()=>Object.keys(F).map(e=>F[e].name),[F]),O=(0,o.useMemo)(()=>{var e,t;return(null==a?void 0:null===(e=a.danmakuControl)||void 0===e?void 0:e.isPostDenied)?`作者仅允许${({1:"粉丝",2:"好友",3:"自己"})[null==a?void 0:null===(t=a.danmakuControl)||void 0===t?void 0:t.postPrivilegeLevel]}发弹幕`:eB.a.t("send_a_friendly_bullet_comment",{},"发一条友好的弹幕吧")},[a]),z=(0,o.useCallback)(async e=>{var t,l,i,o,d,m,g,_,y;if(null==a?void 0:null===(t=a.danmakuControl)||void 0===t?void 0:t.isPostDenied)return;if(/^\s*$/.test(k)){N.F.info("表达你的态度再发弹幕",null==u?void 0:u.root);return}if(R.current)return;if(Date.now()-M.current<E.sZ){N.F.info("发送频率过快, 等待5秒后可再次发送",null==u?void 0:u.root);return}R.current=!0;let w=Math.floor((null==u?void 0:u.currentTime)*1e3),x=await (0,b.FW)({item_id:null==a?void 0:a.awemeId,text:k,user_id:null==r?void 0:null===(l=r.info)||void 0===l?void 0:l.uid,offset_time:w});R.current=!1,M.current=Date.now();let{statusCode:C,danmakuId:S,isVerifyPassportError:L}=x;if(L){N.F.info("身份验证失败",null==u?void 0:u.root);return}let D=S||eU()("postComment");T.Z.sendLog("danmakuPubDone",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)(),click_method:e,group_id:null==a?void 0:a.awemeId,author_id:null==a?void 0:null===(i=a.authorInfo)||void 0===i?void 0:i.uid,danmaku_id:null!=S?S:0,video_time:Math.floor(1e3*u.currentTime||0),video_pct:1e3*u.currentTime/(null==a?void 0:null===(o=a.video)||void 0===o?void 0:o.duration),danmaku_pub_duration:Date.now()-P.current,danmaku_input_duration:Date.now()-j.current,is_author:(null==r?void 0:null===(d=r.info)||void 0===d?void 0:d.uid)===(null==a?void 0:null===(m=a.authorInfo)||void 0===m?void 0:m.uid)?1:0,emoji_id:eK(k,B),video_scale:(null==a?void 0:null===(g=a.video)||void 0===g?void 0:g.width)/(null==a?void 0:null===(_=a.video)||void 0===_?void 0:_.height),item_duration_ms:(null==a?void 0:null===(y=a.video)||void 0===y?void 0:y.duration)||0},U)),c(!0),null==u||u.emit("DANMAKU_SWITCH_OPEN");let A=`${er()}px`;setTimeout(()=>{var e,t,l,n,i,o;null==u||null===(t=u.danmaku)||void 0===t||t.sendComment({prior:!0,user_id:null==r?void 0:null===(e=r.info)||void 0===e?void 0:e.uid,id:D,duration:eu()/u.playbackRate,realTime:!0,elLazyInit:!0,text:k,style:{color:"#FFFFFF",fontSize:A,height:A,lineHeight:A,marginTop:"20px"},_:{isLogin:null==r?void 0:r.isLogin,isDanmuAuthor:!0,loginDispatch:s,firstDanmakuShowRef:v,offsetTime:0===C?w:0,userInfo:r}}),u.paused&&(null===(i=u.danmaku)||void 0===i||i.pause()),u.sendDanmakuCountSelf=(null!==(o=null==u?void 0:u.sendDanmakuCountSelf)&&void 0!==o?o:0)+1,null===(n=p.current)||void 0===n||null===(l=n.blur)||void 0===l||l.call(n),h.emit(h.EVENT.videoRemoveStopPlayNext),I("")},200)},[u,k,r,a,B]),H=(0,o.useCallback)(e=>{let{selectionStart:t}=p.current,l=t,[n,i]=eV(k,t);if(B.includes(k.slice(n,i))){if(k.length-(i-n+1)+e.name.length>40){x(2),p.current.focus();return}I(t=>t.slice(0,n)+e.name+t.slice(i)),l=n}else{if(k.length+e.name.length>40){x(2),p.current.focus();return}I(l=>l.slice(0,t)+e.name+l.slice(t))}x(2),setTimeout(()=>{p.current.setSelectionRange(l+e.name.length,l+e.name.length),p.current.focus()})},[k,B]),V=(0,o.useCallback)(e=>{I(e.target.value)},[]);return(0,o.useEffect)(()=>{0===k.length?(P.current=0,(0,q.vU)()&&(W.current=!0,setTimeout(()=>W.current=!1))):(0===P.current&&(P.current=Date.now()),!m&&h.emit(h.EVENT.videoStopPlayNext))},[k,m,u]),(0,o.useEffect)(()=>()=>{h.emit(h.EVENT.videoRemoveStopPlayNext)},[]),(0,o.useEffect)(()=>{var e,t;return null===(t=p.current)||void 0===t||null===(e=t.addEventListener)||void 0===e||e.call(t,"selectstart",ef.U),()=>{var e,t;null===(t=p.current)||void 0===t||null===(e=t.removeEventListener)||void 0===e||e.call(t,"selectstart",ef.U)}},[]),(0,o.useEffect)(()=>{if(w){let e=S.current;return null==e||e.addEventListener("wheel",ef.U),()=>{null==e||e.removeEventListener("wheel",ef.U)}}},[w]),(0,o.useEffect)(()=>{if(1===w){var e;T.Z.sendLog("emojiTabShow",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)(),enter_method:"danmaku"},U));let t=p.current;return t.addEventListener("click",ef.U),eW()(u,"config.closeDelayBlur",!0),null==u||null===(e=u.focus)||void 0===e||e.call(u,{autoHide:!1}),()=>{var e;eW()(u,"config.closeDelayBlur",!1),null==u||null===(e=u.focus)||void 0===e||e.call(u),t.removeEventListener("click",ef.U)}}},[w]),(0,i.jsxs)("div",{className:eH.default.container,"data-bytereplay-mask":"strict",children:[w?(0,i.jsx)("div",{className:d()(eH.default.emojiBox,{[eH.default.emojiBoxHide]:2===w,[eH.default.danmuIcon]:m}),ref:S,onMouseEnter:()=>{clearTimeout(A.current)},onMouseLeave:()=>{A.current=setTimeout(()=>x(2),700)},children:(0,i.jsx)("div",{className:eH.default.emojiList,onClick:e=>e.nativeEvent.stopImmediatePropagation(),children:F.map(e=>(0,i.jsx)("img",{src:e.img,onClick:t=>{t.preventDefault(),T.Z.sendLog("clickEmoji",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)(),enter_method:"danmaku",click_method:"emoji"},U)),H(e),null==u||u.emit(_.USER_ACTION,{action:"danmaku_emoji_click"})}},e.name))})}):null,(null==r?void 0:r.isLogin)?(0,i.jsx)("input",{ref:p,className:eH.default.editor,type:"text",disabled:(null==a?void 0:null===(t=a.danmakuControl)||void 0===t?void 0:t.isPostDenied)||!1,maxLength:40,value:k,onChange:V,placeholder:k?"":O,spellCheck:!1,onFocus:()=>{var e,t;j.current=Date.now(),T.Z.sendLog("inputDanmaku",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)()},U)),eW()(u,"config.closeDelayBlur",!0),null==u||null===(e=u.focus)||void 0===e||e.call(u,{autoHide:!1}),null==u||null===(t=u.emit)||void 0===t||t.call(u,_.USER_ACTION,{action:"danmaku_input_focus"}),!m&&h.emit(h.EVENT.videoStopPlayNext)},onBlur:()=>{if(!m){var e;eW()(u,"config.closeDelayBlur",!1),null==u||null===(e=u.focus)||void 0===e||e.call(u),(null==k?void 0:k.length)===0&&h.emit(h.EVENT.videoRemoveStopPlayNext)}},onCompositionStart:()=>{D.current=!0},onCompositionEnd:e=>{setTimeout(()=>D.current=!1,10)},onKeyDown:e=>{var t,l;((null===(t=e.target)||void 0===t?void 0:t.value)||"ArrowUp"!==e.code&&"ArrowDown"!==e.code||!(null===(l=e.target)||void 0===l?void 0:l.value)&&("ArrowUp"===e.code||"ArrowDown"===e.code))&&(null==e||e.stopPropagation());let{key:n}=e,i=e.ctrlKey||e.metaKey;return"Enter"!==n||i||D.current?null:z("hot_key")}}):(0,i.jsxs)("div",{className:eH.default.loginBox,onClick:()=>{(0,L.default)({enterMethod:"danmaku",headerText:"登录后可发布弹幕互动",success:()=>{"recommend"===(0,f.yW)()&&(null==y?void 0:y.recommendLoginResume)===C.RecommendLoginResume.V2?h.emit(h.EVENT.RecommendLoginResume):s({type:"updateUserInfo"})}})},children:[(0,i.jsx)("span",{children:eB.a.t("log_in",{},"登录")}),eB.a.t("to_post_comment",{},"后可发布弹幕")]}),(0,i.jsx)(eO.Z,{className:d()([eH.default.emojiIcon],{[eH.default.isActive]:1===w,[eH.default.disable]:(null==r?void 0:r.isLogin)===!1||(null==a?void 0:null===(l=a.danmakuControl)||void 0===l?void 0:l.isPostDenied)===!0}),onMouseEnter:e=>{var t;if((null==r?void 0:r.isLogin)!==!1&&(null==a?void 0:null===(t=a.danmakuControl)||void 0===t?void 0:t.isPostDenied)!==!0&&!W.current)clearTimeout(A.current),x(1)},onMouseLeave:()=>{T.Z.sendLog("hover_emoji_tab",{enter_from:(0,f.mo)()}),A.current=setTimeout(()=>{x(e=>0===e?0:2)},700)}}),k?(0,i.jsx)(ez.Z,{className:eH.default.sendIcon,onClick:()=>z("click"),ref:Z,onMouseLeave:()=>{T.Z.sendLog("hover_danmaku_input",{enter_from:(0,f.mo)()})}}):null]})};var eY=l("749606"),eG=l("401310"),eq=l("935708"),eQ=l("234766"),eX=l("157459"),eJ=l("773627"),e0=l("135524"),e1=l("775583"),e2=l("153385");l("784710");let e3=e=>{var t,l;let a=m.Le.getConfig(m.gI.DanmuTimeGap),{isActive:r,awemeInfo:u,userInfo:s,player:v,bulletRef:_,loginDispatch:p,danmakuInfo:h,abtestData:y,isDanmuIcon:w,danmuListTargetEl:x,logParams:k={}}=e,[I,C]=(0,o.useState)(!!h),[S,b]=(0,o.useState)(!1),[L,E]=(0,o.useState)(!1),[P,j]=(0,o.useState)(!!h),R=(0,o.useRef)(!1),M=(0,o.useRef)(null);(0,o.useEffect)(()=>{(null==h?void 0:h.status)===0&&N.F.info("此弹幕已删除")},[]);let D=(0,c.x)(()=>b(!0));(0,o.useEffect)(()=>{let e=!1;return(async()=>{let t=await es();if(!e&&!h&&(C(t.isOpen),j(!0),S)){var l,i;T.Z.sendLog("danmakuPubShow",(0,n._)({enter_from:(0,f.mo)(),enter_from_merge:(0,f.yW)(),group_id:null==u?void 0:u.awemeId,author_id:null==u?void 0:null===(l=u.authorInfo)||void 0===l?void 0:l.uid,danmaku_switch_status:t.isOpen?1:0,is_post:!(null==s?void 0:s.isLogin)||(null==u?void 0:null===(i=u.danmakuControl)||void 0===i?void 0:i.isPostDenied)?0:1},k))}})(),()=>{e=!0}},[u,h,S]);let{emojiListMapped:A}=(0,g.b)();return e_({ref:_,isActive:r,player:v,awemeInfo:u,danmakuInfo:h,initialStatus:I,setDanmakuInited:E,userInfo:s,emojiListMapped:A,logParams:k}),eh({isActive:r,player:v,awemeInfo:u,danmakuInfo:h,danmakuInited:L,firstDanmakuShowRef:R,danmuTimeGap:a,logParams:k}),w?(0,i.jsx)(ey.G.Provider,{value:{logParams:k},children:(0,i.jsx)("div",{className:d()("isDark",eY.default.danmakuIconBar),ref:D,onWheel:e=>e.stopPropagation(),children:(0,i.jsx)(eA,{player:v,awemeInfo:u,isLogin:null==s?void 0:s.isLogin,loginDispatch:p,userUid:null==s?void 0:null===(l=s.info)||void 0===l?void 0:l.uid,isDanmuIcon:w,panelClassName:eY.default.panelStyle,userInfo:s,inputRef:M,initialStatus:I,setInitialStatus:C,isConfGot:P,danmuListTargetEl:x,abtestData:y,children:w?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eX.i,{className:eY.default.dividerSmall}),(0,i.jsx)(eb,{player:v,initialStatus:I,setInitialStatus:C,awemeInfo:u,isConfGot:P,isLogin:null==s?void 0:s.isLogin,isDanmuIcon:w}),(0,i.jsx)("div",{className:eY.default.inputBox,children:(0,i.jsx)(e$,{awemeInfo:u,userInfo:s,player:v,loginDispatch:p,setInitialStatus:C,firstDanmakuShowRef:R,isDanmuIcon:w,inputRef:M,abtestData:y})})]}):null})})}):(0,i.jsx)(ey.G.Provider,{value:{logParams:k},children:(0,i.jsxs)("div",{className:d()("isDark",eY.default.danmakuBar),ref:D,onWheel:e=>e.stopPropagation(),children:[(0,i.jsx)(eb,{player:v,initialStatus:I,setInitialStatus:C,awemeInfo:u,isConfGot:P,isLogin:null==s?void 0:s.isLogin,abtestData:y}),(0,i.jsx)(eA,{player:v,awemeInfo:u,isLogin:null==s?void 0:s.isLogin,loginDispatch:p,userUid:null==s?void 0:null===(t=s.info)||void 0===t?void 0:t.uid,setInitialStatus:C,userInfo:s,inputRef:M,danmuListTargetEl:x,abtestData:y}),(0,i.jsx)("div",{className:eY.default.line}),(0,i.jsx)(e$,{awemeInfo:u,userInfo:s,player:v,loginDispatch:p,setInitialStatus:C,firstDanmakuShowRef:R,inputRef:M,abtestData:y})]})})};class e5 extends a.ZP{static get pluginName(){return"DanmakuPlugin"}static get defaultConfig(){return{position:r.POSITIONS.CONTROLS_LEFT,index:9,className:"xgplayer-danmaku"}}afterCreate(){this.renderRoot()}destroy(){(0,eQ.v)(this)}renderRoot(){(0,eQ.s)(this,(0,i.jsx)(e3,(0,n._)({},this.config)))}updateConfig(e){this.config=e,this.renderRoot()}render(){return`<div data-state="normal" class="${eY.default.danmakuContainer} danmakuContainer" data-e2e='danmaku-container' style=""></div>`}}let e4=e=>{let{isActive:t,awemeInfo:l,userInfo:n,loginDispatch:a,danmakuInfo:r,abtestData:u,isDanmuIcon:c,danmuListTargetEl:m,logParams:f}=e,g=(0,eG.n)(),_=(0,o.useRef)(null);(0,v.o)(()=>{var e;if(g&&t&&(null==l?void 0:null===(e=l.danmakuControl)||void 0===e?void 0:e.enableDanmaku))return g.registerPlugin(e5,{player:g,bulletRef:_,isActive:t,userInfo:n,loginDispatch:a,awemeInfo:l,danmakuInfo:r,abtestData:u,isDanmuIcon:c,danmuListTargetEl:m,logParams:f}),()=>{var e,t;(null==g?void 0:null===(e=g.getPlugin)||void 0===e?void 0:e.call(g,"DanmakuPlugin"))&&(null==g||null===(t=g.unRegisterPlugin)||void 0===t||t.call(g,"DanmakuPlugin",!0))}},[g,t,l]),(0,s.Z)(()=>{var e;if(g&&t&&(null==l?void 0:null===(e=l.danmakuControl)||void 0===e?void 0:e.enableDanmaku)){let e=g.getPlugin("DanmakuPlugin");e&&e.updateConfig({player:g,bulletRef:_,isActive:t,userInfo:n,loginDispatch:a,awemeInfo:l,danmakuInfo:r,abtestData:u,isDanmuIcon:c,logParams:f,danmuListTargetEl:m})}},[n,u,c,f,m]);let p=R({awemeInfo:l,userInfo:n,loginDispatch:a,player:g,logParams:f,abtestData:u});return t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(D,{}),(0,i.jsx)("div",{onClick:p,ref:_,className:d()(eY.default.container,eY.default.interaction)})]}):null},e9=e=>{let{abtestData:t,awemeInfo:l}=e,a=(0,eq.N)(),{hasDanmakuInput:r}=function(e,t,l){let[n,i]=(0,o.useState)(!1),a=(0,o.useMemo)(()=>{var l,n;return(null==e?void 0:null===(l=e.danmaku)||void 0===l?void 0:l.douyin_danmaku)&&(null==t?void 0:null===(n=t.danmakuControl)||void 0===n?void 0:n.enableDanmaku)&&(null==t?void 0:t.awemeType)!==e0.e.Note},[t,e]);return(0,o.useEffect)(()=>{if(l){var e,n;let o=e=>{if((null==e?void 0:e.eventType)==="firstFrame"||l.currentTime||(0,e2.r)()){var n,r;if(null===(n=l.off)||void 0===n||n.call(l,_.XGLOG,o),null===(r=l.off)||void 0===r||r.call(l,_.TIME_UPDATE,o),(0,e1.Kf)(t)){i(!1);return}i(a)}};return null===(e=l.on)||void 0===e||e.call(l,_.XGLOG,o),null===(n=l.on)||void 0===n||n.call(l,_.TIME_UPDATE,o),()=>{var e,t;null===(e=l.off)||void 0===e||e.call(l,_.XGLOG,o),null===(t=l.off)||void 0===t||t.call(l,_.TIME_UPDATE,o)}}},[l,a]),{hasDanmakuInput:n}}(t,l,(0,eG.n)());return r?(0,i.jsx)(eJ.k,{componentName:"Danmaku",Slardar:a,children:(0,i.jsx)(e4,(0,n._)({},e))}):null}},826297:function(e,t,l){var n=l(354795);t.Z=new n.h({hover_danmaku_switch:{eventName:"hover_danmaku_switch",params:{enter_from:""}},hover_danmaku_setting:{eventName:"hover_danmaku_setting",params:{enter_from:""}},hover_emoji_tab:{eventName:"hover_emoji_tab",params:{enter_from:""}},hover_danmaku_input:{eventName:"hover_danmaku_input",params:{enter_from:""}},danmakuPubShow:{eventName:"danmaku_pub_show",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",danmaku_switch_status:0,is_post:0}},inputDanmaku:{eventName:"input_danmaku",params:{enter_from:"",enter_from_merge:""}},emojiTabShow:{eventName:"emoji_tab_show",params:{enter_from:"",enter_method:"",enter_from_merge:""}},clickEmoji:{eventName:"click_emoji",params:{enter_from:"",enter_method:"",click_method:"",enter_from_merge:""}},danmakuPubDone:{eventName:"danmaku_pub_done",params:{enter_from:"",click_method:"",group_id:"",author_id:"",danmaku_id:"",video_time:0,video_pct:0,danmaku_pub_duration:0,danmaku_input_duration:0,is_author:0,emoji_id:"",video_scale:0,item_duration_ms:0,enter_from_merge:""}},firstDanmakuShow:{eventName:"first_danmaku_show",params:{enter_from:"",group_id:"",author_id:"",danmaku_id:"",video_time:0,video_pct:0,video_scale:0,item_duration_ms:0,enter_from_merge:""}},danmakuPlayResult:{eventName:"danmaku_play_result",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",danmaku_count:0,danmaku_pub_count:0,danmaku_play_count:0,speed_value:0,area_value:0,size_value:0,opacity_value:0,speed_video:0,play_time:0,browser_height:0,browser_width:0,browser_ratio:0,rate:0,video_scale:0,item_duration_ms:0}},danmakuSwitch:{eventName:"danmaku_switch",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",action:"",click_method:"",video_scale:0,item_duration_ms:0}},enterDanmakuSetting:{eventName:"enter_danmaku_setting",params:{enter_from:"",enter_from_merge:""}},danmakuOpacitySetting:{eventName:"danmaku_opacity_setting",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",opacity_value:80,pre_value:80}},danmakuSizeSetting:{eventName:"danmaku_size_setting",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",size_value:1,pre_value:1,browser_height:0,browser_width:0,browser_ratio:0,rate:0}},danmakuSpeedSetting:{eventName:"danmaku_speed_setting",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",speed_value:1,pre_value:1}},danmakuAreaSetting:{eventName:"danmaku_area_setting",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",area_value:.25,pre_value:.25,browser_height:0,browser_width:0,browser_ratio:0,rate:0}},clickDanmakuDefaultSetting:{eventName:"click_danmaku_default_setting",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",pre_speed_value:1,pre_area_value:.25,pre_size_value:1,pre_opacity_value:80}},pickDanmaku:{eventName:"pick_danmaku",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",danmaku_id:""}},likeDanmaku:{eventName:"like_danmaku",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",danmaku_id:"",enter_method:""}},cancelLikeDanmaku:{eventName:"cancel_like_danmaku",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",danmaku_id:"",enter_method:""}},deleteDanmaku:{eventName:"delete_danmaku",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",danmaku_id:"",enter_method:""}},clickDanmakuList:{eventName:"click_danmaku_list",params:{enter_from:"",enter_from_merge:"",group_id:""}},danmakuListShow:{eventName:"danmaku_list_show",params:{enter_from:"",enter_from_merge:"",group_id:""}}})},478263:function(e,t,l){l.d(t,{U:function(){return o},v:function(){return i}}),l(930798);var n=l(259202);l(611542);let i=e=>{let{text:t,emojiListMapped:l,danmakuId:i}=e;if(!l)return t;let o=[],a=-1,r=0,u=0;for(let e=0;e<t.length;e++)if("]"===t[e]&&"["===t[a]){let d=t.substring(a,e+1);l.has(d)&&(a-r>0&&(u+=1,o.push((0,n.jsx)("span",{children:t.substring(r,a)},`${i}_${u}`))),u+=1,o.push((0,n.jsx)("img",{src:l.get(d)},`img_${i}_${u}`)),r=e+1)}else"["===t[e]&&(a=e);return r<t.length&&(u+=1,o.push((0,n.jsx)("span",{children:t.substring(r)},`${i}_${u}`))),(0,n.jsx)(n.Fragment,{children:o})},o=e=>null==e?void 0:e.stopPropagation()},35515:function(e,t,l){l.r(t),l.d(t,{InteractionInner:function(){return tA},InteractionNew:function(){return tF},Interaction:function(){return tW}});var n=l("590921"),i=l("874155");l("612222"),l("347885");var o=l("259202"),a=l("611542"),r=l("825211"),u=l.n(r),d=l("623176"),s=l("432097"),c=l("954884"),v=l("549516"),m=l("135524"),f=l("697878"),g=l("775583"),_=l("475142"),p=l("606660"),h=l("124797"),y=l("356789"),w=l("713017"),x=l("819769"),k=l("98319"),I=l("227750"),C=l("717379"),S=l("872027"),b=l("837305"),L=l("528557");l("459167"),l("227470");var N=l("67108"),E=l.n(N),T=l("532910"),P=l("912496"),j=l("895184"),R=l("245086"),M=l("898263"),D=l("843554"),A=l("354795"),Z=new A.h({clickCommentButton:{eventName:"click_comment_button",params:{author_id:"",group_id:"",log_pb:"",enter_from:"",previous_page:"",is_full_screen:"0",tab_name:"",click_method:"",from_follow_list:"0",trending_topic:"",first_tag_name:"",top:0,aweme_type:-1,item_duration_ms:0}},follow:{eventName:"follow",params:{author_id:"",group_id:"",log_pb:"",enter_from:"",previous_page:"",is_full_screen:"0",tab_name:"",click_method:"",relation:"",trending_topic:"",first_tag_name:"",top:0,aweme_type:-1,is_pure:""}},followCancel:{eventName:"follow_cancel",params:{author_id:"",group_id:"",log_pb:"",enter_from:"",previous_page:"",is_full_screen:"0",tab_name:"",trending_topic:"",first_tag_name:"",top:0}},shareVideo:{eventName:"share_video",params:{author_id:"",group_id:"",log_pb:"",enter_from:"",previous_page:"",type:"",is_full_screen:"0",from_follow_list:"0",aweme_type:"",pic_cnt:0,tab_name:"",is_pure:"",click_method:""}}});let W=e=>{var t,l,n,i,o,a,r,u,d,s,c,v,m,f,g,_,p,h,y;return{author_id:null==e?void 0:null===(t=e.authorInfo)||void 0===t?void 0:t.uid,group_id:null==e?void 0:e.awemeId,log_pb:null==e?void 0:e.logPb,compilation_id:null==e?void 0:null===(l=e.mixInfo)||void 0===l?void 0:l.mixId,impressionData:null==e?void 0:e.impressionData,awemeId:null==e?void 0:e.awemeId,vduration:null==e?void 0:null===(n=e.video)||void 0===n?void 0:n.duration,isH265:(null==e?void 0:null===(a=e.video)||void 0===a?void 0:null===(o=a.bitRateList)||void 0===o?void 0:null===(i=o[0])||void 0===i?void 0:i.isH265)||(null==e?void 0:null===(r=e.video)||void 0===r?void 0:r.isH265),qualityType:(null==e?void 0:null===(s=e.video)||void 0===s?void 0:null===(d=s.bitRateList)||void 0===d?void 0:null===(u=d[0])||void 0===u?void 0:u.qualityType)||(null==e?void 0:null===(c=e.video)||void 0===c?void 0:c.qualityType),bitRate:(null==e?void 0:null===(f=e.video)||void 0===f?void 0:null===(m=f.bitRateList)||void 0===m?void 0:null===(v=m[0])||void 0===v?void 0:v.bitRate)||(null==e?void 0:null===(g=e.video)||void 0===g?void 0:g.bitRate),videoFormat:null==e?void 0:null===(_=e.video)||void 0===_?void 0:_.videoFormat,gearName:(null==e?void 0:null===(y=e.video)||void 0===y?void 0:null===(h=y.bitRateList)||void 0===h?void 0:null===(p=h[0])||void 0===p?void 0:p.gearName)||""}};l("526789");var F=l("910924"),U=l("688497"),B=l("432218"),O=l("306157"),z=l("106649"),H=l("529866"),V=l("944845"),K=l("945723");l("632852"),l("41873");var $=l("980376"),Y=l("532788"),G=l("477509"),q=l("147083"),Q=l("578139"),X=l("830272");let J=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],l=(0,a.useRef)(),[n,i]=(0,a.useState)(""),[o,r]=(0,a.useState)(),u=(0,a.useRef)(e);return u.current=e,(0,a.useEffect)(()=>{l.current=void 0,r(void 0),i("")},t),{data:o,status:n,getData:()=>(!l.current&&(l.current=u.current().then(e=>(i(t=>t?t:(r(e),"success")),e)).catch(e=>{throw i(e=>e||"error"),e})),l.current),setData(e){l.current=Promise.resolve(e),i("success"),r(e)}}},ee=e=>{let{awemeId:t,description:l,getAwemeInfo:n,handleClick:i}=e,r=(0,a.useRef)(!1),d=async()=>{try{if(r.current)return;let e=l.awemeInfo||await n();i({clickMethod:"related_video_icon",awemeInfo:e}),G.i.sendLog("relatedVideoCardClick",{enter_from:(0,R.yW)(),group_id:l.awemeId,from_group_id:t})}catch(e){q.F.info("暂无相关推荐")}finally{r.current=!1}},s=(0,U.Y)(()=>{G.i.sendLog("relatedVideoCardShow",{enter_from:(0,R.yW)(),group_id:l.awemeId,title_content:l.title,duration:l.duration})});return(0,a.useEffect)(()=>{!l.awemeInfo&&n()},[!l.awemeInfo]),(0,o.jsx)("div",{ref:s,className:u()(Q.default.outerContainer,Q.default.noMarginBottom,"isDark","dark"),onMouseEnter:()=>{G.i.sendLog("relatedVideoCardHover",{enter_from:(0,R.yW)(),group_id:l.awemeId,title_content:l.title,duration:l.duration})},onClick:d,children:(0,o.jsxs)("div",{className:u()(Q.default.mixContainer,Q.default.noMarginBottom),children:[(0,o.jsxs)("div",{className:Q.default.coverContainer,children:[(0,o.jsx)(X.Q,{src:l.cover,skeletonClass:Q.default.defaultImg,className:u()(Q.default.cover,Q.default.relatedCover),iconHeight:80,width:80,iconWidth:60,height:60}),(0,o.jsx)("div",{className:Q.default.duration,children:$.Z.Util.format(l.duration/1e3)})]}),(0,o.jsx)("div",{className:u()(Q.default.textContainer),style:{maxWidth:164},children:(0,o.jsxs)("p",{className:u()(Q.default.relatedTitle,Q.default.noMarginBottom),children:[(0,o.jsx)("strong",{children:"相关推荐："}),((e,t)=>{let l=e.length>t?`${e.slice(0,t)}...`:e;return(0,o.jsx)(Y.default,{noWrapper:!0,options:{className:Q.default.twemojiText,base:"//p3-pc-weboff.byteimg.com/tos-cn-i-9r5gewecjs/twemoji/"},children:(0,o.jsx)("span",{children:l})})})(l.title,20)]})})]})})};var et=l("8138"),el=l("699233"),en=l("390030");let ei=function(e,t){var l,i,o,a,r,u,d,s,c,v,m;let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e)return{};let g=0;return g=(null===(l=e.seriesInfo)||void 0===l?void 0:l.seriesId)?(null===(s=e.seriesInfo)||void 0===s?void 0:s.totalEpisode)===(null===(c=e.seriesInfo)||void 0===c?void 0:c.currentEpisode)?0:1:(null===(v=e.mixInfo)||void 0===v?void 0:v.totalEpisode)===(null===(m=e.mixInfo)||void 0===m?void 0:m.currentEpisode)?0:1,(0,n._)({playlet_id:null===(i=e.seriesInfo)||void 0===i?void 0:i.seriesId,compilation_id:null===(o=e.mixInfo)||void 0===o?void 0:o.mixId,group_id:e.awemeId,enter_from:(0,R.yW)(),enter_from_merge:(0,R.vM)(),bar_type:"related_video",entrance_cnt:f.length,is_update:g,item_duration_ms:(null==e?void 0:null===(a=e.video)||void 0===a?void 0:a.duration)||0,bar_tag_name:null==e?void 0:null===(d=e.webRawData)||void 0===d?void 0:null===(u=d.CTR)||void 0===u?void 0:null===(r=u.recommendScore)||void 0===r?void 0:r.relateAiTag},t||{})},eo=()=>{let e=x.Le.getConfig(x.gI.PlayerCardInfo);return(null==e?void 0:e.isActive)&&e.expandCardType===F.L.Related},ea=e=>{let{onRelatedClick:t,player:l,awemeInfo:r,getAwemeInfo:d,ableMiniType:s=!0,reportExtraParams:c={},videoTags:v=[],abtestData:m}=e;(0,a.useEffect)(()=>{if(l){let e=async e=>{let{e:l,clickMethod:o="hot_key"}=e;en.Z.sendLog("bottomBarClick",(0,i._)((0,n._)({},ei(r,c,v)),{action:eo()?"close":"open"})),null==t||t(l,{awemeInfo:(0,i._)((0,n._)({},r),{relatedRecommend:(0,i._)((0,n._)({},r.relatedRecommend),{popoverAwemeInfo:await d()})}),clickMethod:o})};return null==l||l.on("onRelated",e),()=>{null==l||l.off("onRelated",e)}}},[l,t,r,c,v]);let f=(0,a.useRef)(null),g=()=>{var e,t;let l=null===(t=f.current)||void 0===t?void 0:null===(e=t.getLottieInstance)||void 0===e?void 0:e.call(t);return{enter:()=>{var e;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[0,15],!0)},leave:()=>{var e;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[16,25],!0)}}},_=(0,U.x)(()=>{en.Z.sendLog("bottomBarShow",ei(r,c,v))}),p=(null==m?void 0:m.reduceLottie)||(0,w.b_)(),[h,y]=(0,a.useState)(!p);return(0,a.useEffect)(()=>{if(p&&h){var e,t;null===(e=(t=g()).enter)||void 0===e||e.call(t)}},[h,p]),(0,o.jsxs)("div",{ref:_,className:u()(K.default.related,{[K.default.ableMiniType]:s}),onClick:async e=>{en.Z.sendLog("bottomBarClick",(0,i._)((0,n._)({},ei(r,c,v)),{action:eo()?"close":"open"})),en.Z.sendLog("relatedVideoClick",{enter_from:c.enter_from,enter_from_merge:c.enter_from_merge,group_id:null==r?void 0:r.awemeId,author_id:null==r?void 0:r.authorUserId}),t(e,{awemeInfo:(0,i._)((0,n._)({},r),{relatedRecommend:(0,i._)((0,n._)({},r.relatedRecommend),{popoverAwemeInfo:await d()})}),clickMethod:"icon"})},onMouseEnter:()=>{if(h){var e,t;null===(e=(t=g()).enter)||void 0===e||e.call(t)}else!(0,w.b_)()&&y(!0)},onMouseLeave:()=>{if(en.Z.sendLog("hover_related_video_icon",{enter_from:(0,R.mo)()}),h){var e,t;null===(e=(t=g()).leave)||void 0===e||e.call(t)}},children:[h?(0,o.jsx)(et.default,{className:K.default.icon,ref:f,data:B,loop:!1,autoplay:!1}):(0,o.jsx)(el.Z,{src:O.Z,viewBox:"0 0 36 36",className:K.default.icon}),(0,o.jsx)("div",{className:K.default.desc,children:z.a.t("related",{},"看相关")})]})};var er=e=>{var t,l,r,d,c;let{from:v,isInnerFeed:m,isHoverShow:f,shortcut:g,player:_,onRelatedClick:p,ableMiniType:h,reportExtraParams:w={},awemeInfo:x,videoTags:k,abtestData:I}=e,C=!m&&(null==x?void 0:null===(r=x.webRawData)||void 0===r?void 0:null===(l=r.CTR)||void 0===l?void 0:null===(t=l.recommendScore)||void 0===t?void 0:t.showRelateVideo)>0&&"undefined"!=typeof window&&"/"===window.location.pathname,b=(0,a.useRef)(null),{status:L,data:N,setData:E,getData:T}=J(()=>(0,H.WW)({count:1,awemeId:x.awemeId}),[x.awemeId]),{getData:P}=J(async()=>{if(null==N?void 0:N.awemeInfo)return N.awemeInfo;if(null==N?void 0:N.awemeId){let{detail:e,statusCode:t}=await (0,V.m_)({awemeId:N.awemeId});if(t)throw Error();return(0,i._)((0,n._)({},e),{debugInfo:N.debugInfo})}},[N]),j=!C||!!L;(0,a.useEffect)(()=>{if(!!C)return y.listen(y.EVENT.RelatedAwemeListUpdate,e=>{let{videoFeed:t,awemeList:l}=e;if(t===F.t.Related){let e=l.findIndex(e=>{let{awemeId:t}=e;return t===x.awemeId});if(e>-1&&l[e+1]){let{awemeId:t,video:n,desc:i}=l[e+1];E({awemeId:t,title:i,duration:n.duration,cover:n.cover,debugInfo:null,awemeInfo:l[e+1]})}}})},[x.awemeId,C]);let R=C&&"success"===L,M=R?(0,o.jsx)(ee,{awemeId:x.awemeId,getAwemeInfo:P,description:N,handleClick:e=>{p(null,e)}}):(0,o.jsxs)("div",{className:u()(S.default.shortcutTip,S.default.shortcutTipPopover),children:["相关推荐",(null===(d=g.related)||void 0===d?void 0:d.badgeText)&&(0,o.jsx)("span",{className:S.default.tipKey,children:null===(c=g.related)||void 0===c?void 0:c.badgeText})]});return(0,o.jsx)(s.J2,{showArrow:!0,position:"left",rePosKey:Number(j),className:u()(S.default.shortcutTipWrap,S.default.shortcutTipWrapPopover,R&&S.default.shortcutTipWrapPopoverCard),style:f&&j?{}:{display:"none"},content:j&&M,getPopupContainer:()=>b.current||document.body,children:(0,o.jsx)("div",{ref:b,style:{position:"relative"},onMouseEnter:()=>{C&&T()},children:(0,o.jsx)(ea,{player:_,onRelatedClick:p,getAwemeInfo:P,ableMiniType:h,reportExtraParams:w,awemeInfo:x,videoTags:k,abtestData:I})})},Number(m))},eu=l("848284"),ed=l("773627"),es=l("277931"),ec=l("807567"),ev=l("487013");l("586529"),l("510766"),l("312602");var em=l("346689"),ef=l("299897"),eg=l("343787"),e_=l("942157"),ep=l("744611"),eh=l("233313"),ey=l("781114"),ew=l("715500"),ex=l("283132"),ek=l("89738"),eI=l("644038"),eC=l("660326");let eS=e=>{var t,l,n,i,o,a;let{uid:r,roomId:u,logId:d,episodeExtra:s,streamType:c,paidLiveData:v}=e;ek.Z.sendLog("livesdkRecLivePlay",{enter_from_merge:(0,eh.r)()||"web_video_detail",enter_method:"web_video_head",anchor_id:r,room_id:u,game_name:"",live_type:"game",game_live_source:"game_web",url:location.href,url_path:location.pathname,is_paidlive:Number(null==v?void 0:v.paid_type),watch_paidlive_status:(null==v?void 0:v.view_right)?"regular":(null==v?void 0:v.duration)>=180?"try_end":"try",request_id:d,stream_type:null!==(a=ex.LIVE_STREAM_TYPE[c])&&void 0!==a?a:"other",is_vs:s?1:0,vs_episode_id:s?null===(t=s.episode_extra)||void 0===t?void 0:t.episode_id_str:"",vs_ep_group_id:s?null===(l=s.episode_extra)||void 0===l?void 0:l.item_id:"",vs_season_id:s?null===(n=s.episode_extra)||void 0===n?void 0:n.season_id_str:"",vs_episode_stage:s?(null===(o=s.episode_extra)||void 0===o?void 0:null===(i=o.mod)||void 0===i?void 0:i.episode_stage)===e_.W.FirstLive?"premiere":"live":""})};function eb(e){var t,l,i,r,d;let[s,c]=(0,a.useState)(!1),{awemeInfo:v={},logId:m,className:f,ableMiniType:p,isEcomLive:y=!1,isActive:x,useAuto:k}=e,I=(0,a.useMemo)(()=>{var e,t;return null==v?void 0:null===(t=v.authorInfo)||void 0===t?void 0:null===(e=t.roomData)||void 0===e?void 0:e.paid_live_data},[null==v?void 0:null===(t=v.authorInfo)||void 0===t?void 0:t.roomData]),{avatarUri:C,roomData:S,roomId:b,uid:L}=null==v?void 0:v.authorInfo,{awemeId:N}=v,[E,T]=(0,a.useState)({show:!1,hover:!1}),P=(0,a.useMemo)(()=>({enter_from_merge:(0,eh.r)(),enter_method_temai:"web_video_head",enter_method:"web_video_head",action_type:"click",room_id:b,group_id:N,request_id:m,is_livehead_preview_mini_window_show:"0",mini_window_show_type:E.show?E.hover?"mouse_hover":"automatic":""}),[E,N,b,m]),j=v.rawAdData&&(0,_.hj)(v)?(0,g.Rx)(v):null,R=(0,g.nT)(v),M=null==S?void 0:null===(l=S.owner)||void 0===l?void 0:l.web_rid,D=`f_lh_${M}`,A=(0,em.j)(),Z=(0,a.useMemo)(()=>j?(0,_.at)({rawAdData:j,extraParams:P}):(0,ey.cc)((0,n._)({web_rid:M},P)),[j,M,P]),W=a.useMemo(()=>({is_paidlive:Number(null==I?void 0:I.paid_type),watch_paidlive_status:(null==I?void 0:I.view_right)?"regular":(null==I?void 0:I.duration)>=180?"try_end":"try"}),[I]);return(0,o.jsxs)("div",{className:u()(eI.default.avatarWrap,f,{[eI.default.ableMiniType]:p}),children:[x?(0,o.jsx)(ef.T,{roomData:S,setIsReusePlayer:c,abtestData:A,reuseId:D,isReusePlayer:s}):(0,o.jsx)(o.Fragment,{}),(0,o.jsx)(eC.nh,{isShow:x,adType:R,type:"default",src:C,uid:L,cid:null==j?void 0:j.creative_id,isEcomLive:y,paidLiveParams:W,onClick:t=>{var l,n,i,o,a,r;eS({uid:L,roomId:b,logId:m,episodeExtra:null==S?void 0:S.episode_extra,streamType:null==S?void 0:null===(l=S.stream_url)||void 0===l?void 0:l.stream_orientation,paidLiveData:I}),null==e||null===(i=e.player)||void 0===i||null===(n=i.pause)||void 0===n||n.call(i),j&&(0,ep.E)("realtime_click",{tag:(0,ew.f)(),value:null==j?void 0:j.creative_id,log_extra:null==j?void 0:j.log_extra,refer:"profile"});let{from:u}=e;if(u===h.lT.Recommend||u===h.lT.Follow){let[l,n]=Z.split("?"),i="";try{i=new URL(l).pathname.slice(1)}catch(e){}if(i){null==t||null===(o=t.preventDefault)||void 0===o||o.call(t),null==e||null===(r=e.player)||void 0===r||null===(a=r.exitFullscreen)||void 0===a||a.call(r);let l="";u===h.lT.Recommend&&(l=`/root/live/${i}`),u===h.lT.Follow&&(l=`/follow/live/${i}`);let d=`${l}?${n}`;(0,eg.X)({href:d,reusePlayer:s?1:0,webRid:i,abtestData:A,reuseId:D,roomId:b,from:u})}}},liveRoomUrl:Z,liveRoomParam:{logId:m,episodeExtra:null==S?void 0:S.episode_extra,streamType:null==S?void 0:null===(i=S.stream_url)||void 0===i?void 0:i.stream_orientation},isFirstLive:(null==S?void 0:null===(d=S.episode_extra)||void 0===d?void 0:null===(r=d.mod)||void 0===r?void 0:r.episode_stage)===2,groupId:N,disableBorderAnim:(0,w.b_)()||(0,w.Sb)(),awemeInfo:e.awemeInfo,isLogin:e.isLogin,from:e.from,forceSmall:!0,onShowChange:T,logParams:P,showWindow:e.showWindow,player:e.player,useAuto:k,fixed:e.fixed})]})}function eL(e){let{logInfo:t,player:l,onAvatarClick:r,isOpenKeyHotEvent:u}=e,d=(0,a.useRef)("");try{var s;d.current=null===(s=JSON.parse(null==t?void 0:t.log_pb))||void 0===s?void 0:s.impr_id}catch(e){d.current=""}return(0,a.useEffect)(()=>{if(l){let e=e=>{u&&(null==r||r(e,{clickMethod:"hot_key"}))};return null==l||l.on("onAvatar",e),()=>{null==l||l.off("onAvatar",e)}}},[l,r]),(0,o.jsx)(eb,(0,i._)((0,n._)({},e),{logId:d.current}))}var eN=l("160551"),eE=l("999785"),eT=l("932624"),eP=new A.h({hover_comment_icon:{eventName:"hover_comment_icon",params:{enter_from:""}},clickCommentButton:{eventName:"click_comment_button",params:{author_id:"",group_id:"",log_pb:"",enter_from:"",previous_page:"",is_full_screen:"0",tab_name:"",click_method:"",from_follow_list:"0",relation:"",aweme_type:"",pic_cnt:0,item_duration_ms:0}}}),ej=l("860263"),eR=l("401310"),eM=l("375456"),eD=l("456713");let eA=e=>{let{count:t,className:l,textClassName:i,toggleComment:r,reportExtraParams:s,awemeInfo:c,ableMiniType:v,onLottieComplete:f,abtestData:_}=e,p=(0,a.useMemo)(()=>{var e,t,l,n,i,o,a,r,u,d,s,v,m,f,g,_,p,h,y;return{author_id:null==c?void 0:null===(e=c.authorInfo)||void 0===e?void 0:e.uid,group_id:null==c?void 0:c.awemeId,log_pb:null==c?void 0:c.logPb,compilation_id:null==c?void 0:null===(t=c.mixInfo)||void 0===t?void 0:t.mixId,impressionData:null==c?void 0:c.impressionData,awemeId:null==c?void 0:c.awemeId,vduration:null==c?void 0:null===(l=c.video)||void 0===l?void 0:l.duration,isH265:(null==c?void 0:null===(o=c.video)||void 0===o?void 0:null===(i=o.bitRateList)||void 0===i?void 0:null===(n=i[0])||void 0===n?void 0:n.isH265)||(null==c?void 0:null===(a=c.video)||void 0===a?void 0:a.isH265),qualityType:(null==c?void 0:null===(d=c.video)||void 0===d?void 0:null===(u=d.bitRateList)||void 0===u?void 0:null===(r=u[0])||void 0===r?void 0:r.qualityType)||(null==c?void 0:null===(s=c.video)||void 0===s?void 0:s.qualityType),bitRate:(null==c?void 0:null===(f=c.video)||void 0===f?void 0:null===(m=f.bitRateList)||void 0===m?void 0:null===(v=m[0])||void 0===v?void 0:v.bitRate)||(null==c?void 0:null===(g=c.video)||void 0===g?void 0:g.bitRate),videoFormat:null==c?void 0:null===(_=c.video)||void 0===_?void 0:_.videoFormat,gearName:(null==c?void 0:null===(y=c.video)||void 0===y?void 0:null===(h=y.bitRateList)||void 0===h?void 0:null===(p=h[0])||void 0===p?void 0:p.gearName)||""}},[c]),h=(0,eR.n)(),[y,k]=(0,a.useState)(!1),I=(0,a.useRef)(null),C=null==_?void 0:_.reduceLottie,S=()=>{var e,t;let l=null===(t=I.current)||void 0===t?void 0:null===(e=t.getLottieInstance)||void 0===e?void 0:e.call(t);return{enter:()=>{var e;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[0,33],!0)},leave:()=>{var e;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[59,83],!0)}}},b=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!(0,w.b_)()){let e=b.current,t=()=>{var e,t;null===(e=(t=S()).enter)||void 0===e||e.call(t)},l=()=>{var e,t;null===(e=(t=S()).leave)||void 0===e||e.call(t)};return null==e||e.addEventListener("mouseenter",t),null==e||e.addEventListener("mouseleave",l),()=>{null==e||e.removeEventListener("mouseenter",t),null==e||e.removeEventListener("mouseleave",l)}}},[]);let L=(0,a.useCallback)(e=>{var t,l,i,o,a;let{clickMethod:u="click_icon"}=e;null==h||h.emit("shortcutTopic");let v=r({clickMethod:u});if("click_icon"===u&&v&&(null==h||h.emit(d.USER_ACTION,{action:"open_comment"})),eP.sendLog("clickCommentButton",(0,n._)({urlParamList:["previous_page","fir_previous_page"],enter_from:(0,R.mo)(),author_id:null==c?void 0:null===(t=c.authorInfo)||void 0===t?void 0:t.uid,group_id:null==c?void 0:c.awemeId,log_pb:null==p?void 0:p.log_pb,is_full_screen:(0,j.r)()?"1":"0",is_full_webscreen:eM.s.getIsPageFullscreen()?"1":"0",tab_name:T.getTabName()||(0,M.Rs)("tab_name")||"",click_method:u,click_from:u,from_follow_list:(null===(l=x.Le.getConfig(x.gI.FromFollowList))||void 0===l?void 0:l.tag)?"1":"0",aweme_type:`${(null==c?void 0:c.isSlides)?m.e.Slides:null==c?void 0:c.awemeType}`,pic_cnt:null!==(a=null==c?void 0:null===(i=c.images)||void 0===i?void 0:i.length)&&void 0!==a?a:0,action:v?"open":"close",item_duration_ms:(null==c?void 0:null===(o=c.video)||void 0===o?void 0:o.duration)||0},s||{},(0,eN.t)())),(0,g.Jt)(c)){let e=(0,g.Rx)(c);(0,ep.E)("click_comment",{tag:(0,ew.f)(),value:e.creative_id,log_extra:e.log_extra}),(0,ep.E)("othershow",{tag:(0,ew.f)(),value:e.creative_id,log_extra:e.log_extra,refer:"comment"})}},[h,r,c,s,p]),N=(0,a.useCallback)(()=>{C&&k(!0)},[C]),E=(0,a.useCallback)(()=>{eP.sendLog("hover_comment_icon",{enter_from:(0,R.mo)()})},[]);return(0,a.useEffect)(()=>{if(h)return null==h||h.on("showComment",L),()=>{null==h||h.off("showComment",L)}},[h,L]),(0,o.jsxs)("div",{className:u()(ej.default.container,l,{[ej.default.ableMiniType]:v,[ej.default.animation4]:!0}),"data-e2e":"feed-comment-icon",onClick:()=>L({clickMethod:"click_icon"}),onMouseEnter:N,onMouseLeave:E,ref:b,children:[(0,o.jsx)("div",{className:ej.default.iconWrap,children:(0,w.b_)()||C&&!y?(0,o.jsx)(eD.z,{svg:(0,o.jsx)(eE.Z,{}),className:ej.default.commentIcon}):(0,o.jsx)(et.default,{ref:I,data:eT,loop:!1,autoplay:!1,onComplete:()=>{null==f||f()},onInit:()=>{if(C){var e,t;null===(e=(t=S()).enter)||void 0===e||e.call(t)}}})}),!!t&&(0,o.jsx)("div",{className:u()(ej.default.count,i,ej.default.lessFontWeight),children:t})]})};l("930798");var eZ=l("673919"),eW=l("736909"),eF=l("79902"),eU=l("593810"),eB=l("900395"),eO=l("940324"),ez=l("628559"),eH=l("172958"),eV=l("141849"),eK=l("404264"),e$=l("946313");function eY(e){var t,l,n;let{awemeInfo:i,isLogin:r,loginUserInfo:s,loginDispatch:c,fullScreenTarget:v,loginPanelTarget:m,reportExtraParams:f={},ableMiniType:g=!1,onLottieComplete:_,recordPreferVideoSwitch:h=!1,refIsDigged:k={},setIsDigged:I,onDiggSuccessCb:C,abtestData:S}=e,b=(0,eR.n)(),L=(0,a.useRef)(!0),N=(0,a.useRef)(!1),T=(0,a.useRef)(!1),P=(0,a.useRef)(null),M=(0,a.useRef)(!1),D=(0,a.useRef)(),[A,Z]=(0,a.useState)(0),[W,F]=(0,a.useState)(()=>{let e=(null==S?void 0:S.changeCandle)||"";return(null==e?void 0:e.includes(null==i?void 0:i.awemeId))?2:(0,w.b_)()?1:0}),U=null==S?void 0:S.reduceLottie,{count:B,diggStatus:O}=(0,ez.P)({selfUid:null==s?void 0:null===(t=s.info)||void 0===t?void 0:t.uid,awemeId:null==i?void 0:i.awemeId,defaultCount:null==i?void 0:null===(l=i.stats)||void 0===l?void 0:l.diggCount,defaultDiggStatus:(null==i?void 0:i.userDigged)?eZ.gZ.Digged:eZ.gZ.UnDigg});k.current=O,(0,a.useEffect)(()=>{I(O)},[O]);let{resetUsedKeyDownTime:z,resetDiggTime:H,checkIsCancelDigg:V}=(0,eH._)({diggState:O===eZ.gZ.Digged}),{digg:K,unDigg:$,hoverDigg:Y}=(0,eV.ic)({selfUid:null==s?void 0:null===(n=s.info)||void 0===n?void 0:n.uid,isLogin:r,awemeInfo:i,onLoginSuccess:async()=>{if("recommend"===(0,R.yW)()&&(null==S?void 0:S.recommendLoginResume)===p.RecommendLoginResume.V2?y.emit(y.EVENT.RecommendLoginResume):await (null==c?void 0:c({type:"updateUserInfo"})),"video_detail"===(0,R.vM)()){var e,t;await (0,eK.a8)({secUid:null==i?void 0:null===(e=i.authorInfo)||void 0===e?void 0:e.secUid,uid:null==i?void 0:null===(t=i.authorInfo)||void 0===t?void 0:t.uid})}},reportExtraParams:f,accountParentEl:(0,j.r)()&&v,defaultDiggStatus:(null==i?void 0:i.userDigged)?eZ.gZ.Digged:eZ.gZ.UnDigg,success:C,loginPanelTarget:m,scene:eM.s.getPlayerScene(null==b?void 0:b.playerId),teaEvtParams:{is_small_window:0}}),G=(0,a.useCallback)(e=>{if(T.current=!0,h){var t;let e=x.Le.getConfig(x.gI.AwemePcRecRawData)||{videoPrefer:{fsn:[],like:[],halfMin:[],min:[]}},l=e.videoPrefer.like;l.filter((e,t)=>t%2==0).includes(null==i?void 0:i.groupId)||l.push(null==i?void 0:i.groupId,null==i?void 0:null===(t=i.authorInfo)||void 0===t?void 0:t.uid),x.Le.setConfig(x.gI.AwemePcRecRawData,e),(0,x.xL)(i,b,"lk")}O===eZ.gZ.Digged?$({clickMethod:e}):K({clickMethod:e}),b.emit(d.USER_ACTION,{action:"digg",status:O===eZ.gZ.Digged?"close":"open"}),(0,eW.VY)({info:{[eU.BW.Favorite]:O!==eZ.gZ.Digged},awemeId:null==i?void 0:i.awemeId,abData:0})},[O,K,$,h,W]);D.current=G,(0,a.useEffect)(()=>{let e=(null==S?void 0:S.changeCandle)||"";(null==e?void 0:e.includes(null==i?void 0:i.awemeId))?F(2):(0,w.b_)()?F(1):F(0)},[S,i]),(0,a.useEffect)(()=>{O&&H()},[O]),(0,a.useEffect)(()=>{if(b){let e=E()(e=>{var t;null===(t=D.current)||void 0===t||t.call(D,e)},1e3,{leading:!0,trailing:!1}),t=t=>{let{clickMethod:l}=t;if(U&&Z(2),!O){e(l);return}if(!O||"hot_key"===l)V()&&e(l),z()};return null==b||b.on("onStar",t),()=>{null==b||b.off("onStar",t)}}},[b,null==i?void 0:i.awemeId,O]);let q=()=>{var e,t;let l=null===(t=P.current)||void 0===t?void 0:null===(e=t.getLottieInstance)||void 0===e?void 0:e.call(t),n=()=>{var e,t;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[0,1],!0),null==l||null===(t=l.goToAndStop)||void 0===t||t.call(l,88,!0)},i=()=>{var e,t;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[0,1],!0),null==l||null===(t=l.goToAndStop)||void 0===t||t.call(l,0,!0)};return{setLikedStatus:n,setUnLikedStatus:i,like:()=>{var e;N.current=!0,T.current=!1,null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[39,88],!0)},dislike:()=>{var e;N.current=!0,T.current=!1,null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[124,162],!0)},enter:()=>{var e,t;O?null==l||null===(t=l.playSegments)||void 0===t||t.call(l,[96,120],!0):null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[0,32],!0)},leave:()=>{var e,t;O?null==l||null===(t=l.playSegments)||void 0===t||t.call(l,[64,88],!0):null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[162,186],!0)},end:()=>{N.current=!1,!M.current&&(O?n():i())}}},Q=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(0===W){let e=Q.current,t=()=>{var e,t;M.current=!0,null===(e=(t=q()).enter)||void 0===e||e.call(t)},l=()=>{var e,t;M.current=!1,null===(e=(t=q()).leave)||void 0===e||e.call(t)};return null==e||e.addEventListener("mouseenter",t),null==e||e.addEventListener("mouseleave",l),()=>{null==e||e.removeEventListener("mouseenter",t),null==e||e.removeEventListener("mouseleave",l)}}},[q,W]),(0,a.useEffect)(()=>{if(L.current){O?q().setLikedStatus():q().setUnLikedStatus(),L.current=!1;return}T.current?O?q().like():q().dislike():(O?q().setLikedStatus():q().setUnLikedStatus(),T.current=!1)},[O,W]),(0,o.jsxs)("div",{className:u()(eO.default.digg,eO.default.animation4,{[eO.default.isDigged]:O,[eO.default.ableMiniType]:g}),onClick:()=>{null==b||b.emit("shortcutTopic"),G()},ref:Q,"data-e2e-state":O?"video-player-is-digged":"video-player-no-digged","data-e2e":"video-player-digg",onMouseEnter:()=>{U&&Z(1)},onMouseLeave:Y,children:[(0,o.jsxs)("div",{className:eO.default.lottieWraper,children:[2===W?(0,o.jsx)("div",{className:u()(eO.default.heart,{[eO.default.candle]:O})}):null,1===W?(0,o.jsx)(eD.z,{svg:(0,o.jsx)(eB.Z,{}),className:u()(eO.default.diggSvg,{[eO.default.isDigg]:O})}):null,0===W?0===A&&U?(0,o.jsx)(eD.z,{svg:(0,o.jsx)(eB.Z,{}),className:u()(eO.default.diggSvg,{[eO.default.isDigg]:O})}):(0,o.jsx)(et.default,{ref:P,className:eO.default.diggLottie,data:eF,loop:!1,autoplay:!1,onComplete:()=>{null==_||_(),q().end()},onInit:()=>{if(1===A){var e,t;null===(e=(t=q()).enter)||void 0===e||e.call(t)}}}):null]}),(0,o.jsx)("div",{className:u()(eO.default.count,eO.default.diggIcon,eO.default.lessFontWeight),children:(0,e$.A)({count:B,displayWord:"赞"})})]})}var eG=l("425793"),eq=l("475137"),eQ=l("153254"),eX=new A.h({hover_favorite_video_icon:{eventName:"hover_favorite_video_icon",params:{enter_from:""}},clickFavoriteVideo:{eventName:"click_favorite_video",params:{click_from:"icon",previous_page:"",author_id:"",group_id:"",log_pb:"",enter_from:"",is_full_screen:"0",click_method:"",aweme_type:"",pic_cnt:""}},clickCancelFavoriteVideo:{eventName:"click_cancel_favorite_video",params:{click_from:"icon",previous_page:"",author_id:"",group_id:"",log_pb:"",enter_from:"",is_full_screen:"0"}}}),eJ=l("628531"),e0=l("528386"),e1=l("554898"),e2=l("727907"),e3=l("424220"),e5=l("719250");function e4(e){var t,l,i;let{awemeInfo:r,isLogin:s,loginUserInfo:c,loginDispatch:v,fullScreenTarget:f,toast:g,ableMiniType:_=!1,reportExtraParams:h={},onLottieComplete:k,refIsCollected:I={},abtestData:C,loginPanelTarget:S,from:b,recordPreferVideoSwitch:L}=e,N=(0,a.useRef)(!0),E=(0,a.useRef)(!1),P=(0,a.useRef)(!1),D=(0,a.useRef)(null),A=(0,a.useRef)(null),Z=(0,a.useRef)(!1),W=(0,eR.n)(),F=null==C?void 0:C.reduceLottie,[U,B]=(0,a.useState)(0),O=e=>{if(g){g(e);return}e0.F.info(e)},z=(0,j.r)()&&f,H=eM.s.getPlayerScene(null==W?void 0:W.playerId),V={is_small_window:0},K=async()=>{if("recommend"===(0,R.yW)()&&(null==C?void 0:C.recommendLoginResume)===p.RecommendLoginResume.V2?y.emit(y.EVENT.RecommendLoginResume):null==v||v({type:"updateUserInfo"}),"video_detail"===(0,R.vM)()){var e,t;await (0,eK.a8)({secUid:null==r?void 0:null===(e=r.authorInfo)||void 0===e?void 0:e.secUid,uid:null==r?void 0:null===(t=r.authorInfo)||void 0===t?void 0:t.uid})}},{unCollect:$,collect:Y}=(0,e3.pD)({selfUid:null==c?void 0:null===(t=c.info)||void 0===t?void 0:t.uid,awemeInfo:r,defaultCollectStatus:(null==r?void 0:r.userCollected)?eZ.c.Collected:eZ.c.Uncollected,isLogin:s,accountParentEl:z,loginPanelTarget:S,reportExtraParams:h,scene:H,onLoginSuccess:K,success:e=>{let{action:t,successMsg:l}=e;"collect"===t&&O(l||eZ.a$.CollectSuccess),null==W||W.emit(d.USER_ACTION,{action:"collect",status:"collect"===t?"on":"off"})},fail:e=>{switch(e.statusCode){case eG.ERROR_CODE.ERROR_USER_UNLOGIN:return;case eG.ERROR_CODE.ERROR_COLLECT_TOO_FAST:O(eZ.a$.TooFast);return;case eG.ERROR_CODE.ERROR_COLLECT_RESTRICTED:O(eZ.a$.CollectBan);return;default:O(eZ.a$.CollectFail);return}},teaEvtParams:V}),G=(0,a.useCallback)(function(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];$(...t),(0,eW.VY)({info:{[eU.BW.Collect]:!1},awemeId:null==r?void 0:r.awemeId,abData:0})},[$]),q=(0,a.useCallback)(function(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];L&&(0,x.xL)(r,W,"fav"),Y(...t),(0,eW.VY)({info:{[eU.BW.Collect]:!0},awemeId:null==r?void 0:r.awemeId,abData:0})},[Y,C]),{collectStatus:Q,count:X}=(0,e5.u)({selfUid:null==c?void 0:null===(l=c.info)||void 0===l?void 0:l.uid,awemeId:null==r?void 0:r.awemeId,defaultCollectStatus:(null==r?void 0:r.userCollected)?eZ.c.Collected:eZ.c.Uncollected,defaultCount:null==r?void 0:null===(i=r.stats)||void 0===i?void 0:i.collectCount}),J=(0,a.useRef)(s);J.current=s;let ee=e=>{var t,l;if(J.current){e();return}(0,e1.disturbShowAccount)({success:async()=>{await K(),J.current?e():setTimeout(()=>{ee(e)},1e3)},headerText:"登录后即可收藏",enterMethod:"favorite_video_entry",next:`https://${null===(l=window)||void 0===l?void 0:null===(t=l.location)||void 0===t?void 0:t.host}`,teaEvtParams:V},z,S,H)},el=()=>{var e,t;let l=null===(t=D.current)||void 0===t?void 0:null===(e=t.getLottieInstance)||void 0===e?void 0:e.call(t),n=()=>{var e,t;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[0,1],!0),null==l||null===(t=l.goToAndStop)||void 0===t||t.call(l,115,!0)},i=()=>{var e,t;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[0,1],!0),null==l||null===(t=l.goToAndStop)||void 0===t||t.call(l,0,!0)};return{toLottieStart:i,toLottieEnd:n,addCollect:()=>{var e;E.current=!0,P.current=!1,null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[58,92],!0)},cancelCollect:()=>{var e;E.current=!0,P.current=!1,null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[151,170],!0)},enter:()=>{var e,t;Q?null==l||null===(t=l.playSegments)||void 0===t||t.call(l,[121,145],!0):null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[10,43],!0)},leave:()=>{var e,t;Q?null==l||null===(t=l.playSegments)||void 0===t||t.call(l,[92,115],!0):null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[195,207],!0)},end:()=>{E.current=!1,!Z.current&&(Q?n():i())}}},en=e=>{let{clickMethod:t="icon"}=e||{};if(F&&B(2),!E.current||(0,w.b_)()){var l,i,o,a;P.current=!0,Q===eZ.c.Collected?eX.sendLog("clickCancelFavoriteVideo",(0,n._)({click_from:"icon",urlParamList:["previous_page"],author_id:null==r?void 0:null===(l=r.authorInfo)||void 0===l?void 0:l.uid,group_id:null==r?void 0:r.awemeId,log_pb:null==r?void 0:r.logPb,enter_from:(0,R.mo)(),is_full_screen:(0,j.r)()?"1":"0",tab_name:T.getTabName()||(0,M.Rs)("tab_name")||""},h)):eX.sendLog("clickFavoriteVideo",(0,n._)({click_from:"icon",urlParamList:["previous_page"],author_id:null==r?void 0:null===(i=r.authorInfo)||void 0===i?void 0:i.uid,group_id:null==r?void 0:r.awemeId,log_pb:null==r?void 0:r.logPb,enter_from:(0,R.mo)(),is_full_screen:(0,j.r)()?"1":"0",click_method:t,tab_name:T.getTabName()||(0,M.Rs)("tab_name")||"",aweme_type:`${(null==r?void 0:r.isSlides)?m.e.Slides:null==r?void 0:r.awemeType}`,pic_cnt:`${null!==(a=null==r?void 0:null===(o=r.images)||void 0===o?void 0:o.length)&&void 0!==a?a:0}`},h)),null==W||W.emit("shortcutTopic"),Q===eZ.c.Collected?G({clickMethod:t}):q({clickMethod:t})}},ei=(0,a.useCallback)(()=>{F&&B(1)},[F]),eo=(0,a.useCallback)(()=>{eX.sendLog("hover_favorite_video_icon",{enter_from:(0,R.mo)()})},[]);return(0,a.useEffect)(()=>{let e=A.current,t=()=>{var e,t;Z.current=!0,null===(e=(t=el()).enter)||void 0===e||e.call(t)},l=()=>{var e,t;Z.current=!1,null===(e=(t=el()).leave)||void 0===e||e.call(t)};return null==e||e.addEventListener("mouseenter",t),null==e||e.addEventListener("mouseleave",l),()=>{null==e||e.removeEventListener("mouseenter",t),null==e||e.removeEventListener("mouseleave",l)}},[el]),(0,a.useEffect)(()=>(null==W||W.on("onCollect",en),()=>{null==W||W.off("onCollect",en)}),[W,en]),(0,a.useEffect)(()=>{if(N.current){Q===eZ.c.Collected?el().toLottieEnd():el().toLottieStart(),N.current=!1;return}P.current?Q===eZ.c.Collected?el().addCollect():el().cancelCollect():(Q===eZ.c.Collected?el().toLottieEnd():el().toLottieStart(),P.current=!1)},[Q]),(0,a.useEffect)(()=>{I.current=Q},[I,Q]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:u()(eJ.default.collect,{[eJ.default.ableMiniType]:_,[eJ.default.animation4]:!0}),onClick:()=>en(),onMouseEnter:ei,onMouseLeave:eo,ref:A,"data-e2e-state":Q?"video-player-is-collected":"video-player-no-collect","data-e2e":"video-player-collect",children:[(0,o.jsx)("div",{className:eJ.default.lottieWraper,children:(0,w.b_)()||F&&0===U?(0,o.jsx)(eD.z,{svg:(0,o.jsx)(eQ.Z,{}),className:u()(eJ.default.collectionSvg,{[eJ.default.active]:Q})}):(0,o.jsx)(et.default,{ref:D,className:eJ.default.collectLottie,data:eq,loop:!1,autoplay:!1,onComplete:()=>{null==k||k(),el().end()},onInit:()=>{if(F&&1===U){var e,t;null===(e=(t=el()).enter)||void 0===e||e.call(t)}}})}),(0,o.jsx)("div",{className:u()(eJ.default.count,eJ.default.lessFontWeight),children:(0,e$.A)({count:X,displayWord:"收藏"})})]}),(0,o.jsx)(e2.Z,{userInfo:c,referenceElement:A.current,awemeInfo:r,abTestData:C,collected:eZ.c.Collected===Q,collectMethod:q,unCollectMethod:G,afterLogin:ee,from:b})]})}var e9=l("71880"),e7=l("315100"),e8=l("824041"),e6=l("51876"),te=l("688918"),tt=l("224934"),tl=l("318086"),tn=l("208043"),ti=new A.h({hover_more_active_icon:{eventName:"hover_more_active_icon",params:{enter_from:""}},dislike:{eventName:"dislike",params:{author_id:"",group_id:"",log_pb:"",enter_from:"",previous_page:"",enter_method:"",is_full_screen:"0",tab_name:"",click_method:"",from_follow_list:"0",aweme_type:"",is_insert_wallpaper:0,is_show_outside:0,item_duration_ms:0}},report:{eventName:"report",params:{author_id:"",group_id:"",log_pb:"",enter_from:"",previous_page:"",enter_method:"",is_full_screen:"0"}},creatorDataEntranceClick:{eventName:"creator_data_entrance_click",params:{}},creatorDataEntranceShow:{eventName:"creator_data_entrance_show",params:{}},continuedAppBroadcastClick:{eventName:"continued_app_broadcast_click",params:{enter_from:""}},moreFeatureShow:{eventName:"more_features_show",params:{enter_from:""}}}),to=l("247311"),ta=l("259678"),tr=l("735244"),tu=l("232008"),td=l("889682"),ts=l("373666"),tc=l("580494"),tv=l("783227"),tm=l("90417"),tf=l("483236"),tg=l("745158");let t_=e=>{let{followStatus:t,handleClickNotInteresting:l,handleClickReport:n,handleClickDelete:i,handleClickUnfollow:o,handleClickPhoneResume:r,showList:s,awemeInfo:c,loginUserInfo:v,dataAnalysisStatus:m,handleClickAnalysis:f,abtestData:_,isPermanentDislikeBtn:p=!1,userInfo:h,handleClickASR:y,isAsrOn:w,player:x}=e;return(0,a.useMemo)(()=>{var e,a,k,I,C,S,b;return[{icon:tr.Z,isSemiIcon:!0,desc:"不感兴趣",key:"notInterestingIcon",onClick:()=>l(),hidden:p||"undefined"!=typeof window&&(null===(k=window)||void 0===k?void 0:null===(a=k.location)||void 0===a?void 0:null===(e=a.pathname)||void 0===e?void 0:e.indexOf("/video"))!==-1||!(null==s?void 0:s.notInterestingIcon)||(null==c?void 0:null===(I=c.authorInfo)||void 0===I?void 0:I.uid)===(null==v?void 0:null===(C=v.info)||void 0===C?void 0:C.uid)},{icon:tu.Z,isSemiIcon:!0,desc:"手机续播",key:"phoneResume",onClick:r,hidden:!(null==s?void 0:s.phoneResume)},{icon:ta.Z,desc:"取消关注",key:"unfollow",onClick:o,hidden:t===eZ.$u.UnFollow||!(null==s?void 0:s.unfollow)},{icon:td.Z,isSemiIcon:!0,desc:"举报",key:"report",onClick:n,hidden:!(null==s?void 0:s.report)||(null==c?void 0:null===(S=c.authorInfo)||void 0===S?void 0:S.uid)===(null==h?void 0:h.uid)||(0,g.Kf)(c)},{icon:tf.Z,desc:"删除",key:"deleteSelfPost",onClick:i,hidden:!(null==s?void 0:s.deleteSelfPost)||!(null==h?void 0:h.uid)||h.uid!==(null==c?void 0:null===(b=c.authorInfo)||void 0===b?void 0:b.uid),className:to.default.deleteIcon},{icon:tc.Z,desc:"数据分析",key:"dataAnalysis",onClick:f,hidden:!(null==s?void 0:s.dataAnalysis),className:u()(to.default.analysisIcon,{[to.default.disableItem]:m!==tN.Enable})},{icon:w?tm.Z:tv.Z,desc:"支持转文稿",key:"showASRIcon",onClick:y,hidden:!(null==s?void 0:s.asrState),className:w?to.default.asrIconOn:to.default.asrIconOff},{icon:ts.Z,isSemiIcon:!0,desc:"快捷键列表",key:"shortcutList",onClick:()=>{(0,tg.n)({abtestData:_,logParams:{clickMethod:"more_button"}}),null==x||x.emit(d.USER_ACTION,{action:"show_short_cut_list"})},hidden:!(null==s?void 0:s.shortcutList),className:to.default.shortcutList}].filter(e=>!e.hidden)},[p,t,l,n,o,r,s,c,v,m,f,_,h,y,w,x])};var tp=l("797770"),th=l("804929"),ty=l("953525"),tw=l("472547"),tx=l("194396"),tk=l("92591"),tI=l("535338");function tC(e){let{width:t,awemeInfo:l,loginDispatch:n,isLogin:i,isShow:r,fullScreenTarget:u,loginPanelTarget:s,toast:c,player:v,abtestData:m}=e,{musicName:f,mid:g}=(null==l?void 0:l.music)||{},[_,h]=(0,a.useState)(null),[w,x]=(0,a.useState)(0),[k,I]=(0,a.useState)(null),C=(0,a.useCallback)(async()=>{let e=await (0,tp.XL)({musicId:g});if(0===e.statusCode){var t,l,n;h((null===(t=e.musicInfo)||void 0===t?void 0:t.collectStat)||eZ.c.Uncollected),x(null!==(n=null==e?void 0:null===(l=e.musicInfo)||void 0===l?void 0:l.userCount)&&void 0!==n?n:0)}},[g]);(0,a.useEffect)(()=>{r&&(null==k?void 0:k.awemeId)!==l.awemeId&&(C(),I(l))},[l,r]);let{collect:S,unCollect:b}=(0,tx.S)({musicId:g,onLoginSuccess:()=>{"recommend"===(0,R.yW)()&&(null==m?void 0:m.recommendLoginResume)===p.RecommendLoginResume.V2?y.emit(y.EVENT.RecommendLoginResume):null==n||n({type:"updateUserInfo"})},awemeInfo:l,isLogin:i,accountParentEl:(0,j.r)()&&u,loginPanelTarget:s,toast:c}),{collectStatus:L}=(0,tk.v)({musicId:g,isLogin:i,defaultCollectStatus:null===_?eZ.c.Uncollected:_});return(0,o.jsxs)("div",{className:tw.default.musicDetail,style:{maxWidth:t?`${t}px`:"unset"},"data-e2e":"more-music-detail",children:[(0,o.jsx)("div",{className:tw.default.musicText,children:(0,o.jsxs)("div",{className:tw.default.text,children:[(0,o.jsxs)("div",{className:tw.default.musicName,children:[(0,o.jsx)(el.Z,{src:ty.Z,width:36,height:36,viewBox:"0 0 36 36"}),f]}),(0,o.jsxs)("div",{className:tw.default.useCount,children:[(0,th.qe)(w),"人使用"]})]})}),(0,o.jsx)(tI.Z,{collapseStatus:L===eZ.c.Collected,isFetching:null===_,handleClick:()=>{L===eZ.c.Collected?b():(S(),null==v||v.emit(d.USER_ACTION,{action:"collect_music"}))}})]})}var tS=l("797210"),tb=l("530147"),tL=l("847958"),tN={Enable:0,0:"Enable",OutDate:1,1:"OutDate",Private:2,2:"Private"};let tE={notInterestingIcon:!0,unfollow:!0,report:!0,shortcutList:!1,dataAnalysis:!1,phoneResume:!1};function tT(e){var t,l,r,s,c,v,f,_,p,h,w;let{player:k,awemeInfo:C,loginUserInfo:S,loginDispatch:b,deleteCurrentSwiper:L,singleBox:N,setSingleBox:E,logInfo:T,isFollowClickedRef:P,toast:M,videoReportModalContainer:D,reportExtraParams:A={},ableMiniType:Z=!1,showList:W,abtestData:F,actionUnFollow:B,showMusicDetail:O=!0,isLogin:z,onDislike:H,isPermanentDislikeBtn:V=!1,loginPanelTarget:K,fullScreenTarget:$,isInnerFeed:Y=!1,recordPreferVideoSwitch:G}=e,{type:q,changeType:Q}=(0,ec.P)({delayDisappear:50,delayShow:null!==(w=null==F?void 0:F.interactionDelay)&&void 0!==w?w:I.o}),[X,J]=(0,a.useState)(W.asrState===e7.Kw.On),ee=null==F?void 0:F.reduceLottie;(0,a.useEffect)(()=>{W.asrState===e7.Kw.On&&J(!0)},[W]);let et=(0,a.useRef)(null),en=(0,a.useRef)(null),ei=(0,tL.I7)(null==C?void 0:C.awemeType,z),eo=(0,a.useMemo)(()=>W?(0,i._)((0,n._)({},tE,W),{phoneResume:ei}):tE,[W,ei]),ea=(0,a.useMemo)(()=>{var e;return((null==C?void 0:C.createTime)+2592e3)*1e3<Date.now()?1:(null==C?void 0:null===(e=C.status)||void 0===e?void 0:e.privateStatus)!==0?2:0},[null==C?void 0:C.createTime,null==C?void 0:null===(t=C.status)||void 0===t?void 0:t.privateStatus]),{followStatus:er}=(0,es.r)({selfUid:null==S?void 0:null===(l=S.info)||void 0===l?void 0:l.uid,actionUid:null==C?void 0:null===(r=C.authorInfo)||void 0===r?void 0:r.uid,defaultFollowerStatus:null==C?void 0:null===(s=C.authorInfo)||void 0===s?void 0:s.followerStatus,defaultFollowStatus:null==C?void 0:null===(c=C.authorInfo)||void 0===c?void 0:c.followStatus}),eu=(0,a.useCallback)(()=>{P.current=!0,(0,te.V)(er)&&(B(),Q("",!0))},[er,Q,B,Y]),ed=(0,a.useCallback)(async function(){let{clickMethod:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clickMethod:"icon"};if(!!(null==eo?void 0:eo.notInterestingIcon))G&&(0,x.xL)(C,k,"dislike"),await H({clickMethod:e,reportExtraParams:A}),Q("",!0),k.emit(d.USER_ACTION,{action:"dislike"}),(0,eW.VY)({info:{[eU.BW.Dislike]:!0},awemeId:null==C?void 0:C.awemeId,abData:0})},[Q,eo,H,A,k,null==C?void 0:C.awemeId]),ev=(0,a.useCallback)(async()=>{k.emit(d.SHOW_DEBUG,{action:"show"})},[C,Q,T,S,b,k]),em=(0,a.useCallback)(async()=>{var e,t,l,n;if((0,g.Jt)(C)&&(0,g.Gu)(C)){null==k||k.emit(tS.B.AdReport);return}null==k||k.emit(d.USER_ACTION,{action:"report"}),ti.sendLog("report",{urlParamList:["previous_page"],enter_from:(0,R.mo)(),author_id:null==C?void 0:null===(e=C.authorInfo)||void 0===e?void 0:e.uid,group_id:null==C?void 0:C.awemeId,log_pb:null==T?void 0:T.log_pb,is_full_screen:(0,j.r)()?"1":"0"}),y.emit(y.EVENT.videoPause);if(C.awemeType===m.e.XgVideo){y.emit(y.EVENT.videoPause),window.open((0,ey.Tl)({videoid:null==C?void 0:C.awemeId,param:"envoke_tipoff",value:"1"}),(0,tl.f)()?"_self":void 0),null==L||L();return}(0,e9.mJ)({title:(null==C?void 0:C.awemeType)===m.e.Note?"举报图集":"举报视频",pipeline_id:(null==C?void 0:C.awemeType)===m.e.Note?"161":"157",object_id:null==C?void 0:C.awemeId,onClose:()=>{(0,tt.m)("reportModal"),y.emit(y.EVENT.videoRemoveStopPlayNext)},onShow:()=>{y.emit(y.EVENT.videoStopPlayNext),(0,tt.o)({pauseCustomShortcut:!0,pauseGlobalShortcut:!0,pausePlayControlShortcut:!0},"reportModal")},userInfo:null==S?void 0:S.info,loginDispatch:b,owner_id:null==C?void 0:null===(t=C.authorInfo)||void 0===t?void 0:t.uid,owner_sec_id:(null==C?void 0:null===(l=C.authorInfo)||void 0===l?void 0:l.secUid)||"",enter_from:(0,R.yW)(),onReport:()=>{(0,eW.VY)({info:{[eU.BW.Report]:!0},awemeId:null==C?void 0:C.awemeId,abData:0})},abtestData:F},null!=D?D:(0,j.r)()&&(null==k?void 0:null===(n=k.config)||void 0===n?void 0:n.fullscreenTarget)),Q("")},[C,Q,T,D,S,b,k]),ef=a.useCallback(()=>{switch(ea){case 1:M("发布超过30天的作品暂不支持分析");break;case 2:M("私密作品暂不支持分析");break;default:ti.sendLog("creatorDataEntranceClick"),window.open((0,ey.hj)(null==C?void 0:C.awemeId),(0,tl.f)()?"_self":"_blank")}},[null==C?void 0:C.awemeId,ea,M]),eg=a.useCallback(async()=>{try{var e;null==k||k.emit(d.USER_ACTION,{action:"phone_resume"}),ti.sendLog("continuedAppBroadcastClick",{enter_from:(0,R.vM)()});let{statusCode:t}=await (0,e8.wU)({item_id:C.awemeId,item_type:C.awemeType,record_type:2,play_progress:Math.floor(null!==(e=null==k?void 0:k.currentTime)&&void 0!==e?e:0),to_client:1});0===t?(y.emit(y.EVENT.videoPause),M("打开手机抖音继续观看")):M("网络错误，请稍后再试")}catch(e){M("网络错误，请稍后再试")}finally{Q("",!0)}},[C,Q,null==k?void 0:k.currentTime,M,k]),e_=a.useCallback(()=>{J(e=>{var t;return e0.F.infoInModalVideo(e?"操作成功，此视频将不会在后台转为文稿":"已开启视频转文稿功能"),(0,e7.fG)({userId:null==S?void 0:null===(t=S.info)||void 0===t?void 0:t.uid,itemId:null==C?void 0:C.awemeId,status:e?e7.Kw.Off:e7.Kw.On}),!e})},[C,S]),ep=a.useCallback(async()=>{let e=null==C?void 0:C.awemeId;if(!!e)y.emit(y.EVENT.videoPause),(0,tb.Z)({title:"你的作品将被永久删除，无法找回，确认删除？",cancelBtnText:"暂不删除",confirmBtnText:"确认删除",onConfirm:()=>new Promise(t=>{(0,e6.FD)({awemeIds:`${e}`}).then(e=>{if(e.isSuccess){var l;null==L||L(),e0.F.info("删除成功");let e=null!==(l=x.Le.getConfig(x.gI.DeletePostList))&&void 0!==l?l:[];x.Le.setConfig(x.gI.DeletePostList,[...e,C]),t()}else e0.F.info("作品因风险因素未能删除成功"),t()})}),onCancel:()=>{}})},[C,L]);(0,a.useEffect)(()=>{"more"!==N&&Q("",!0)},[N]);let eh=new Map([["notInterestingIcon","video-player-no-like"],["report","video-player-report"],["shortcutList","video-player-shoret-cut"]]),ew=t_({followStatus:er,handleClickNotInteresting:ed,handleClickReport:em,handleClickDelete:ep,handleClickUnfollow:eu,handleClickPhoneResume:eg,showList:eo,awemeInfo:C,loginUserInfo:S,dataAnalysisStatus:ea,handleClickAnalysis:ef,abtestData:F,isPermanentDislikeBtn:V,userInfo:null==S?void 0:S.info,handleClickASR:e_,isAsrOn:X,player:k});(0,a.useEffect)(()=>{var e,t;let l=(null==C?void 0:null===(e=C.authorInfo)||void 0===e?void 0:e.uid)!==(null==S?void 0:null===(t=S.info)||void 0===t?void 0:t.uid)&&(null==eo?void 0:eo.notInterestingIcon);return l&&(null==k||k.on(tS.B.Dislike,ed)),null==k||k.on("showReportModal",em),null==k||k.on("videoInfo",ev),()=>{l&&(null==k||k.off(tS.B.Dislike,ed)),null==k||k.off("showReportModal",em),null==k||k.off("videoInfo",ev)}},[k,ed,C,eo,em,ev,S]);let ex=(0,a.useCallback)(()=>{ti.sendLog("moreFeatureShow",{enter_from:(0,R.vM)()}),(null==eo?void 0:eo.dataAnalysis)&&ti.sendLog("creatorDataEntranceShow")},[null==eo?void 0:eo.dataAnalysis]),ek=null==C?void 0:null===(f=C.status)||void 0===f?void 0:null===(v=f.videoMute)||void 0===v?void 0:v.isMute,eI=O&&(null==C?void 0:null===(_=C.music)||void 0===_?void 0:_.status)&&(null==C?void 0:null===(p=C.music)||void 0===p?void 0:p.playUrl.uri)&&!ek,eC=(0,U.x)(ex),eS=(0,a.useCallback)(()=>{var e;E("more"),Q("more"),y.emit(null==y?void 0:null===(e=y.EVENT)||void 0===e?void 0:e.clarityRel,{hoverSelected:!0})},[]),eb=(0,a.useCallback)(()=>{var e;ti.sendLog("hover_more_active_icon",{enter_from:(0,R.mo)()}),Q(""),y.emit(null==y?void 0:null===(e=y.EVENT)||void 0===e?void 0:e.clarityRel,{hoverSelected:!1})},[]);return(0,o.jsxs)("div",{className:u()(to.default.more,{[to.default.ableMiniType]:Z}),onMouseEnter:eS,onMouseLeave:eb,ref:et,"data-e2e":"video-play-more",children:[(0,o.jsx)(el.Z,{src:tn.Z,viewBox:"0 0 36 36",height:36,width:36,needRenderInSSR:!0,className:to.default.svgWraper}),(0,o.jsx)("div",{ref:eC,className:to.default.moreBox,style:{display:"more"!==q?"none":"flex",width:(null==ew?void 0:ew.length)<=3&&eI?"240px":`${72*(null==ew?void 0:ew.length)+24}px`},onMouseEnter:()=>{Q("more")},onMouseLeave:()=>{Q("",!0)},children:(ee||(null==F?void 0:F.longtask))&&"more"!==q?null:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:to.default.moreList,ref:en,children:ew.map(e=>{var t;return(0,o.jsxs)("div",{className:u()(to.default.itemWrap,e.className),onClick:e.onClick,"data-e2e":null!==(t=eh.get(e.key))&&void 0!==t?t:"",children:[(0,o.jsx)("div",{className:to.default.itemIcon,children:e.isSemiIcon?(0,o.jsx)(e.icon,{className:to.default.semiIcon}):(0,o.jsx)(el.Z,{src:e.icon,height:36,width:36,viewBox:"0 0 36 36"})}),(0,o.jsx)("div",{className:to.default.itenDesc,children:e.desc})]},e.key)})}),eI&&(0,o.jsx)(tC,{width:null==en?void 0:null===(h=en.current)||void 0===h?void 0:h.clientWidth,awemeInfo:C,isLogin:z,loginDispatch:b,isShow:"more"===q,fullScreenTarget:$,loginPanelTarget:K,toast:M,player:k,abtestData:F})]})})]})}var tP=l("720820"),tj=l("935708"),tR=l("616831"),tM=l("34639"),tD=l("750681");let tA=(0,l("493492").X)(e=>{var t,l,r,N,A,F,U,B,O,z,H,V,K,$,Y,G,q,Q,X,J,ee,et,el,en,ei,eo,ea,ed,em;let{toggleComment:ef,awemeInfo:eg,loginUserInfo:e_,loginDispatch:ep,deleteCurrentSwiper:eh,fullScreenTarget:ey,onAvatarClick:ew,onRelatedClick:ex,abtestData:ek,videoToast:eI,videoReportModalContainer:eC,moreBoxShowList:eS,reportExtraParams:eb={},recordPreferVideoSwitch:eN,shortcutKeyDisable:eE,canShowAvatarFollowBtn:eT=!0,canShowAvatarImBtn:eP=!1,canShowAvatarAdBtn:ej=!1,canShowAvatar:eM=!0,canShowCollection:eD=!0,canShowAvatarTip:eZ=!0,className:eW,actionFollow:eF,actionUnFollow:eU,showMusicDetail:eB,avatarTipText:eO,from:ez,LiveSliderCard:eH,isActive:eV,isPermanentDislikeBtn:eK,onDislike:eG,toast:eq,isInnerFeed:eQ=!1,videoTags:eX,isSearchPlayer:eJ,scene:e0,onFollowBtnClick:e1,onShareToFriend:e2,isDetail:e3}=e,{pathname:e5}=(0,c.a)(),{isLogin:e9}=e_,{isiPad:e7,isMobile:e8}=(0,v.X)(),e6=(0,a.useMemo)(()=>(null==eg?void 0:eg.awemeType)===m.e.XgVideo,[eg]),[te,tt]=(0,a.useState)(""),[tl,tn]=(0,a.useState)(0),ti=(0,a.useRef)(!1),to=(0,a.useRef)(null),ta=(0,a.useRef)(""),tr=(0,a.useRef)(!1),tu=(0,a.useRef)(!1),td=(0,a.useRef)(null),ts=(0,a.useRef)(null),tc=(0,a.useRef)(null),tv=(0,a.useRef)(null),tm=(0,a.useRef)(null);(0,a.useRef)();let tf=(0,a.useRef)(null),tg=(0,eR.n)();(0,a.useRef)(tg).current=tg;let[t_,tp]=(0,a.useState)("icon"),[th,ty]=(0,a.useState)(!1),[tw,tx]=(0,a.useState)(!1),[tk,tI]=(0,a.useState)(!0),tC=W(eg);(0,a.useMemo)(()=>!e_.isLogin&&tk,[ek,e_,tk]);let{inImmersive:tS}=(0,tR.O)({player:tg,isActive:!0}),{globalCommentCount:tb}=(0,a.useContext)(k.v)||{},{followStatus:tL,text:tN}=(0,es.r)({selfUid:null==e_?void 0:null===(t=e_.info)||void 0===t?void 0:t.uid,actionUid:null==eg?void 0:null===(l=eg.authorInfo)||void 0===l?void 0:l.uid,defaultFollowerStatus:null==eg?void 0:null===(r=eg.authorInfo)||void 0===r?void 0:r.followerStatus,defaultFollowStatus:null==eg?void 0:null===(N=eg.authorInfo)||void 0===N?void 0:N.followStatus}),{type:tE,changeType:tj}=(0,ec.P)({delayDisappear:50,delayShow:null!==(eo=null==ek?void 0:ek.interactionDelay)&&void 0!==eo?eo:I.o});(0,a.useEffect)(()=>void("share_btn"!==te&&tj("",!0)),[te]);let tD=(0,a.useMemo)(()=>["related"],[]),tA=f.getShortcut({disable:eE,exclude:tD});!function(e){let{player:t,awemeInfo:l,inImmersive:i,fullScreenTarget:o,videoToast:r,reportExtraParams:u}=e,d=(0,a.useRef)(l),s=(0,a.useRef)("");(0,a.useEffect)(()=>{var e;s.current="",(null===(e=d.current)||void 0===e?void 0:e.awemeId)!==(null==l?void 0:l.awemeId)&&(null==l?void 0:l.awemeId)&&(d.current=l)},[l]);let c=(0,a.useCallback)(async()=>{let{shareLinkDesc:e,shareUrl:t}=(null==l?void 0:l.shareInfo)||{},n=t&&`${t}&from=web_code_link`,i=await (0,D.Rc)(n);s.current=e&&e.replace("%s",i)},[null==l?void 0:l.shareInfo]),v=(0,a.useCallback)(E()(async e=>{var t,a,d,v,f,g;if((null==l?void 0:null===(t=l.status)||void 0===t?void 0:t.allowShare)===!1){r("该视频已被限制分享");return}!s.current&&await c(),(0,P.J)(s.current,{target:(0,j.r)()&&o?o:null}),Z.sendLog("shareVideo",(0,n._)({urlParamList:["previous_page"],author_id:null==l?void 0:null===(a=l.authorInfo)||void 0===a?void 0:a.uid,group_id:null==l?void 0:l.awemeId,enter_from:(0,R.mo)(),log_pb:null==l?void 0:l.logPb,type:"copy_link",is_full_screen:(0,j.r)()?"1":"0",click_method:null!==(f=null==e?void 0:e.clickMethod)&&void 0!==f?f:"hot_key",tab_name:T.getTabName()||(0,M.Rs)("tab_name")||"",from_follow_list:(null===(d=x.Le.getConfig(x.gI.FromFollowList))||void 0===d?void 0:d.tag)?"1":"0",aweme_type:`${(null==l?void 0:l.isSlides)?m.e.Slides:null==l?void 0:l.awemeType}`,pic_cnt:null!==(g=null==l?void 0:null===(v=l.images)||void 0===v?void 0:v.length)&&void 0!==g?g:0,is_pure:i?"1":"0"},u)),r("已复制分享链接")},500),[c,r,i,l,o]);(0,a.useEffect)(()=>(null==t||t.on("showShareCode",v),()=>{null==t||t.off("showShareCode",v)}),[t,v])}({player:tg,inImmersive:tS,awemeInfo:eg,fullScreenTarget:ey,videoToast:eI,reportExtraParams:eb}),!function(e){let{player:t}=e,l=(0,a.useCallback)(e=>{let t={isUse:!1,expireTime:Number(Date.now())+2592e5,useHistory:{3:!0}},l=(0,L.$o)(b.LocalStorageKeys.ShortcutKeyTopicInfo);if(e){!l&&(l=t),l.isUse=e,(0,L.qQ)(b.LocalStorageKeys.ShortcutKeyTopicInfo,l);return}if(l){let e=((null==l?void 0:l.expireTime)||0)-Number(Date.now()),t=Math.ceil(e/864e5);if(l.isUse||!(e>0)||l.useHistory[t])return;l.useHistory[t]=!0,(0,L.qQ)(b.LocalStorageKeys.ShortcutKeyTopicInfo,l)}else(0,L.qQ)(b.LocalStorageKeys.ShortcutKeyTopicInfo,t)},[]);(0,a.useEffect)(()=>(null==t||t.on("shortcutTopic",l),()=>{null==t||t.off("shortcutTopic",l)}),[t,l])}({player:tg}),(0,a.useEffect)(()=>{let e=y.listen(y.EVENT.showDisturbLoginPanel,e=>{tI(!e)});return()=>{null==e||e()}},[]);let{Provider:tZ,closeSmallWindow:tW}=(0,C.ds)(),{}=(0,C.ds)(),tF=!e8&&!e7&&!e6&&!th&&!tw&&eZ&&!(0,g.Jt)(eg),[tU,tB]=(0,a.useState)(0),tO=(0,a.useCallback)(()=>{var e,t,l,n,i;if((null==eg?void 0:null===(e=eg.awemeControl)||void 0===e?void 0:e.canShare)!==!1){tp("icon"),tt("share_btn");let e=eK?260:180;tB((null!==(i=null==tg?void 0:null===(n=tg.root)||void 0===n?void 0:null===(l=n.getBoundingClientRect)||void 0===l?void 0:null===(t=l.call(n))||void 0===t?void 0:t.height)&&void 0!==i?i:e)-e),tj("share_btn")}},[eg,eK,tg,tj]),tz=(0,g.BD)(eg),tH=(0,_.hj)(eg)&&(null==eg?void 0:null===(A=eg.authorInfo)||void 0===A?void 0:A.roomId)&&((null==tz?void 0:null===(F=tz.lynx_raw_data)||void 0===F?void 0:F.open_url)||(null==tz?void 0:tz.open_url)),tV=(0,a.useRef)(!1),tK=(0,a.useMemo)(()=>{var e,t,l;return null==eg?void 0:null===(l=eg.authorInfo)||void 0===l?void 0:null===(t=l.roomData)||void 0===t?void 0:null===(e=t.paid_live_data)||void 0===e?void 0:e.paid_type},[null==eg?void 0:null===(U=eg.authorInfo)||void 0===U?void 0:U.roomData]),{seasonIds:t$}=(0,tM.b)(),tY=(0,a.useMemo)(()=>{var e,t,l,n;return null==t$?void 0:null===(n=t$.includes)||void 0===n?void 0:n.call(t$,null==eg?void 0:null===(l=eg.authorInfo)||void 0===l?void 0:null===(t=l.roomData)||void 0===t?void 0:null===(e=t.episode_extra)||void 0===e?void 0:e.season_id_str)},[null==eg?void 0:null===(B=eg.authorInfo)||void 0===B?void 0:B.roomData]),tG=(0,a.useMemo)(()=>((null==ek?void 0:ek.liveModalFullplayer)===p.LiveModalFullplayer.DynamicBg||(null==ek?void 0:ek.liveModalFullplayer)===p.LiveModalFullplayer.EntranceStrengthen||(null==ek?void 0:ek.liveModalFullplayer)===p.LiveModalFullplayer.WithoutAction||(null==ek?void 0:ek.liveModalFullplayer)===p.LiveModalFullplayer.Normal)&&(ez===h.lT.Follow||ez===h.lT.Recommend)&&!eQ&&!tY&&!tK,[ez,null==ek?void 0:ek.liveModalFullplayer,eQ,tY,tK]);(0,a.useCallback)(()=>{null==tW||tW()},[]);let tq=(0,a.useCallback)(e=>{var t;if(null===(t=ts.current)||void 0===t?!void 0:!t.contains(e.target))!(null==tV?void 0:tV.current)&&tj("")},[tj]),tQ=(0,a.useCallback)(e=>{var t;if(null===(t=ts.current)||void 0===t?!void 0:!t.contains(e.target))tO()},[tO]),tX=(0,a.useCallback)(e=>{var t;if(null===(t=ts.current)||void 0===t?!void 0:!t.contains(e.target))tO()},[tO]),tJ=(0,g.Kf)(eg),[t0,t1]=(0,a.useState)(!1);return(0,a.useEffect)(()=>y.listen(y.EVENT.LiveHeadLiveEnd,e=>{var t;let{anchorId:l}=e;l===(null==eg?void 0:null===(t=eg.authorInfo)||void 0===t?void 0:t.uid)&&t1(!0)}),[eg]),(0,o.jsxs)("div",{className:u()(S.default.videoInteractionWrapper,eW,{[S.default.qq]:(0,w.GP)(),[S.default.disableFilter]:!1}),ref:to,children:[eM&&(0,o.jsx)(o.Fragment,{children:((null==eg?void 0:null===(H=eg.authorInfo)||void 0===H?void 0:null===(z=H.roomData)||void 0===z?void 0:null===(O=z.owner)||void 0===O?void 0:O.web_rid)||tH)&&!t0?(0,o.jsx)("div",{className:S.default.avatarBox,children:(0,o.jsx)(eL,{isActive:eV,player:tg,statusText:tN,loginUserInfo:e_,awemeInfo:eg,logInfo:tC,isLogin:e9,loginDispatch:ep,fullScreenTarget:ey,isFollowClickedRef:ti,onAvatarClick:ew,shortcut:tA,reportExtraParams:eb,ableMiniType:!0,isOpenKeyHotEvent:!0,isFirstLive:(null==eg?void 0:null===(Y=eg.authorInfo)||void 0===Y?void 0:null===($=Y.roomData)||void 0===$?void 0:null===(K=$.episode_extra)||void 0===K?void 0:null===(V=K.mod)||void 0===V?void 0:V.episode_stage)===2,abtestData:ek,openLiveModal:tG,liveModalType:ez===h.lT.Recommend?"recommend":"follow",isEcomLive:(null==eg?void 0:null===(X=eg.authorInfo)||void 0===X?void 0:null===(Q=X.roomData)||void 0===Q?void 0:null===(q=Q.ecom_data)||void 0===q?void 0:null===(G=q.room_cart_v2)||void 0===G?void 0:G.show_cart)===1||tH,from:ez,showWindow:!tJ&&eV,useAuto:!(null===(J=x.Le.getConfig(x.gI.IsInLookMiniModal))||void 0===J?void 0:J.isInMiniModal),scene:e0,fixed:!1})}):(0,o.jsx)(s.u,{position:"left",style:tF&&tk?{}:{display:"none"},content:(0,o.jsx)("div",{className:S.default.shortcutTip,children:(0,o.jsxs)(o.Fragment,{children:[null!=eO?eO:"进入作者主页",(null===(ee=tA.avatar)||void 0===ee?void 0:ee.badgeText)&&(0,o.jsx)("span",{className:S.default.tipKey,children:tA.avatar.badgeText})]})}),getPopupContainer:()=>tc.current||document.body,children:(0,o.jsx)("div",{ref:tc,"data-click-from":"click_icon",style:{position:"relative"},children:(0,o.jsx)(ev.Z,{player:tg,loginUserInfo:e_,actionFollow:eF,actionUnFollow:eU,awemeInfo:eg,isLogin:e9,loginDispatch:ep,fullScreenTarget:ey,isFollowClickedRef:ti,onAvatarClick:ew,shortcut:tA,reportExtraParams:eb,ableMiniType:!0,isShowTip:!0,isShowKeyHotTip:!0,followStatus:tL,followBtnMouseEnter:()=>ty(!0),followBtnMouseLeave:()=>ty(!1),imBtnMouseEnter:()=>tx(!0),imBtnMouseLeave:()=>tx(!1),showImBtn:eP,showFollowBtn:eT,showAdBtn:ej,loginPanelTarget:td.current,toast:eq,abtestData:ek,onFollowBtnClick:e1,onAvatarRef:e=>{tf.current=e}})})})}),(0,o.jsx)(s.u,{position:"left",className:S.default.shortcutTipWrap,style:e8||e7||!tk?{display:"none"}:{},clickTriggerToHide:!0,content:(0,o.jsxs)("div",{className:S.default.shortcutTip,children:[tl?"取消点赞":"点赞",(null===(et=tA.like)||void 0===et?void 0:et.badgeText)&&(0,o.jsx)("span",{className:S.default.tipKey,children:null===(el=tA.like)||void 0===el?void 0:el.badgeText})]}),getPopupContainer:()=>tv.current||document.body,children:(0,o.jsx)("div",{ref:tv,style:{position:"relative"},children:(0,o.jsx)(eY,{loginPanelTarget:td.current,toast:eI,awemeInfo:eg,isLogin:e9,loginUserInfo:e_,loginDispatch:ep,fullScreenTarget:ey,reportExtraParams:(0,i._)((0,n._)({},eb),{relation:null!==(ea=null==eb?void 0:eb.relation)&&void 0!==ea?ea:String(tL)}),ableMiniType:!0,onLottieComplete:()=>"digg"===ta.current,onDiggSuccessCb:e=>{if((null==e?void 0:e.action)!=="digg")return},recordPreferVideoSwitch:eN,refIsDigged:tr,setIsDigged:tn,abtestData:ek})})}),(0,o.jsx)(s.u,{position:"left",className:S.default.shortcutTipWrap,style:e8||e7||!tk?{display:"none"}:{},content:(0,o.jsxs)("div",{className:S.default.shortcutTip,children:["评论",(null===(en=tA.comment)||void 0===en?void 0:en.badgeText)&&(0,o.jsx)("span",{className:S.default.tipKey,children:tA.comment.badgeText})]}),getPopupContainer:()=>tm.current||document.body,children:(0,o.jsx)("div",{ref:tm,style:{position:"relative"},children:(0,o.jsx)(eA,{count:(0,e$.A)({count:Number(tb||0),displayWord:"抢首评"}),type:"comment",toggleComment:ef,awemeInfo:eg,reportExtraParams:(0,i._)((0,n._)({},eb),{relation:null!==(ed=null==eb?void 0:eb.relation)&&void 0!==ed?ed:String(tL)}),ableMiniType:!0,onLottieComplete:()=>"comment"===ta.current,abtestData:ek,loginDispatch:ep})})}),eD&&(0,o.jsx)(e4,{loginPanelTarget:td.current,awemeInfo:eg,isLogin:e9,loginUserInfo:e_,loginDispatch:ep,fullScreenTarget:ey,toast:eI,shortcut:tA,ableMiniType:!0,reportExtraParams:(0,i._)((0,n._)({},eb),{relation:null!==(em=null==eb?void 0:eb.relation)&&void 0!==em?em:String(tL)}),onLottieComplete:()=>"collection"===ta.current,refIsCollected:tu,abtestData:ek,from:ez,recordPreferVideoSwitch:eN}),(0,o.jsxs)("div",{className:S.default.shareWrap,onMouseLeave:tq,onMouseEnter:tQ,onClick:tX,children:[(0,o.jsx)(tP.Z,{shortcut:tA,scene:"video",ableMiniType:!0,canAnimation:!1,disableShare:(null==eg?void 0:null===(ei=eg.awemeControl)||void 0===ei?void 0:ei.canShare)===!1,abtestData:ek,awemeInfo:eg}),(0,o.jsx)(eu.ZP,{toast:eI,shareShowMethod:t_,awemelogPb:null==eg?void 0:eg.logPb,awemeInfo:eg,className:u()(S.default.shareBox,S.default.shareCode,{[S.default.relate]:ex}),loginUserInfo:e_,fullScreenTarget:ey,loginDispatch:ep,hidden:"share_btn"!==tE,abtestData:ek,handleClose:()=>tj(""),shortcutObj:tA,onMouseEnter:()=>void 0,onMouseLeave:()=>void 0,reportExtraParams:(0,n._)({is_pure:tS?"1":"0"},eb),shareeListHeight:tU,onFriendSearching:e=>{tV.current=e},isSearchPlayer:eJ,handleShareToFriend:e2,handleShareSuccess:()=>null==tg?void 0:tg.emit(d.USER_ACTION,{action:"share"})})]}),ex&&(0,o.jsx)(er,{from:ez,isHoverShow:tk,isInnerFeed:eQ,awemeInfo:eg,shortcut:tA,player:tg,onRelatedClick:ex,ableMiniType:!0,reportExtraParams:eb,videoTags:eX,abtestData:ek}),(0,o.jsx)(tT,{loginPanelTarget:td.current,player:tg,singleBox:te,setSingleBox:tt,awemeInfo:eg,loginUserInfo:e_,isLogin:e9,logInfo:tC,loginDispatch:ep,deleteCurrentSwiper:eh,onDislike:eG,fullScreenTarget:ey,isFollowClickedRef:ti,toast:eI,videoReportModalContainer:eC,ableMiniType:!0,showList:eS,abtestData:ek,actionUnFollow:eU,showMusicDetail:eB,isPermanentDislikeBtn:eK,isInnerFeed:eQ,recordPreferVideoSwitch:eN,reportExtraParams:eb}),(0,o.jsx)("div",{className:"disturb-login-panel",ref:td})]})}),tZ=(0,tD.K)(tA),tW=e=>{let t=(0,tj.N)();return(0,o.jsx)(ed.k,{componentName:"Interaction",Slardar:t,children:(0,o.jsx)(tA,(0,n._)({},e))})},tF=e=>{let t=(0,tj.N)();return(0,o.jsx)(ed.k,{componentName:"InteractionNew",Slardar:t,children:(0,o.jsx)(tZ,(0,n._)({},e))})}},455875:function(e,t,l){l.r(t),l.d(t,{MiniWinMask:function(){return H},MiniWinMaskInner:function(){return z}});var n=l("590921"),i=l("874155"),o=l("250751");l("612222"),l("347885");var a=l("259202"),r=l("611542"),u=l("825211"),d=l.n(u),s=l("623176"),c=l("13351"),v=l("442183"),m=l("801002"),f=l("245086"),g=l("819769"),_=l("124797"),p=l("803461"),h=l("194086"),y=l("2742"),w=l("354795"),x=new w.h({pauseVideo:{eventName:"pause_video",params:{enter_from:"",mute_remind:"none",click_method:"click",is_small_window:"0"}},smallWindowLoginNotify:{eventName:"small_window_login_notify",params:{enter_from:"",enter_method:""}}}),k=l("432097"),I=l("45107"),C=l("445659"),S=l("356789"),b=l("500416"),L=l("796205"),N=l("908591"),E=l("240679"),T=l("773382"),P=l("708655"),j=l("494090"),R=new w.h({smallWindowOps:{eventName:"small_window_ops",params:{action:"",enter_from:""}}}),M=l("436281"),D=l("401310"),A=l("456713");let Z=r.memo(e=>{let{className:t,isActive:l,abtestData:n,mouseHandler:i,electronWarpRef:o}=e,u=(0,c.FJ)().awemePcClient,[_,p]=(0,r.useState)(g.Le.getConfig(g.gI.IsClientTopMode)),[h,y]=(0,r.useState)(g.Le.getConfig(g.gI.IsMiniWinHideMode)),w=(0,r.useRef)(null),x=(0,r.useRef)(null),Z=(0,r.useRef)(null),W=(0,c.DT)(),F=!(0,m.dz)()&&(0,I.y)(u,">=","3.7.1"),U=(0,m.dz)()&&(0,I.y)(u,">=","3.7.1"),B=!(0,m.O)()&&(F||U)&&(0,I.y)(u,">=","3.7.0"),O=(0,v.x)(),z=(0,D.n)(),H=(0,r.useCallback)(()=>{C.dw("changeMiniWindowHideMode",{data:!1}),y(!1),g.Le.setConfig(g.gI.IsMiniWinHideMode,!1)},[]),V=r.useCallback(e=>{H(),C.dw("WINDOW_MIN"),e.stopPropagation(),R.sendLog("smallWindowOps",{action:"minimize",enter_from:(0,f.mo)()}),null==z||z.emit(s.USER_ACTION,{action:"click_window_minimize"})},[z]),K=r.useCallback(e=>{S.emit(S.EVENT.changeMinWindows,{event:"close",isMiniWin:!1,clickMethod:"click_bar"}),e.stopPropagation()},[]),$=r.useCallback(e=>{C.dw("SET_ALWAYS_ON_TOP",{data:!_}),p(e=>(g.Le.setConfig(g.gI.IsClientTopMode,!e),!e)),e.stopPropagation(),null==i||i(),R.sendLog("smallWindowOps",{action:_?"cancel_pin":"pin",enter_from:(0,f.mo)()}),null==z||z.emit(s.USER_ACTION,{action:_?"click_window_cancel_pin":"click_window_pin"})},[_,z]),Y=(0,r.useCallback)(e=>{C.dw("changeMiniWindowHideMode",{data:!h}),y(!h),g.Le.setConfig(g.gI.IsMiniWinHideMode,!h),e.stopPropagation(),R.sendLog("smallWindowOps",{action:h?"cancel_invisible":"invisible",enter_from:(0,f.mo)()}),null==z||z.emit(s.USER_ACTION,{action:h?"click_window_cancel_invisible":"click_window_invisible"})},[h]);return(0,r.useEffect)(()=>{setTimeout(()=>{C.dw("IS_ALWAYS_ON_TOP").then(e=>{let{data:t}=e;p(t)}),C.dw("isMiniWindowHideMode").then(e=>{y(null==e?void 0:e.data)})},100)},[l]),(0,a.jsxs)("div",{className:d()(M.default.windowBar,t),children:[(0,a.jsx)("div",{ref:o,className:d()(M.default.electronWarp)}),(0,a.jsxs)("div",{className:M.default.miniWindowBtn,children:[B?(0,a.jsx)(k.u,{content:h?"已开启「隐身」，点击关闭":"已关闭「隐身」，点击开启",position:"bottom",getPopupContainer:()=>Z.current||document.body,children:(0,a.jsx)("div",{className:M.default.toolItem,onClick:Y,ref:Z,children:h?(0,a.jsx)(A.z,{className:M.default.icon,svg:(0,a.jsx)(b.Z,{})}):(0,a.jsx)(A.z,{className:M.default.icon,svg:(0,a.jsx)(L.Z,{})})})}):null,(0,a.jsx)(k.u,{content:(0,a.jsxs)("div",{className:d()(M.default.tipContent),children:["返回大窗播放",W&&(0,a.jsx)("span",{className:M.default.tag,children:"U"})]}),getPopupContainer:()=>x.current||document.body,position:"bottom",children:(0,a.jsx)("div",{ref:x,className:d()(M.default.toolItem,M.default.autoMargin),onClick:e=>{R.sendLog("smallWindowOps",{action:"zoom",enter_from:(0,f.mo)()}),null==z||z.emit(s.USER_ACTION,{action:"click_window_zoom"}),K(e)},children:(0,a.jsx)(A.z,{className:d()(M.default.icon,M.default.dropShadow),svg:(0,a.jsx)(N.Z,{})})})}),(0,a.jsx)(k.u,{content:_?"取消置顶":"窗口置顶",position:"bottom",getPopupContainer:()=>w.current||document.body,children:(0,a.jsx)("div",{ref:w,className:M.default.toolItem,onClick:$,children:_?(0,a.jsx)(A.z,{className:M.default.icon,svg:(0,a.jsx)(E.Z,{})}):(0,a.jsx)(A.z,{className:M.default.icon,svg:(0,a.jsx)(T.Z,{})})})}),(0,a.jsx)("div",{className:M.default.toolItem,onClick:V,children:(0,a.jsx)(A.z,{className:M.default.icon,svg:(0,a.jsx)(P.Z,{})})}),(0,a.jsx)("div",{className:M.default.toolItem,onClick:e=>{R.sendLog("smallWindowOps",{action:"close",enter_from:(0,f.mo)()}),null==z||z.emit(s.USER_ACTION,{action:"click_window_close"}),O?(H(),C.dw("WINDOW_CLOSE")):K(e)},children:(0,a.jsx)(A.z,{className:d()(M.default.icon,M.default.dropShadow),svg:(0,a.jsx)(j.Z,{})})})]})]})});var W=l("773627"),F=l("58259"),U=l("497749"),B=l("935708"),O=l("375456");let z=e=>{var{abtestData:t,enablePlaySwitch:l=!0}=e,u=(0,o._)(e,["abtestData","enablePlaySwitch"]);let w=(0,D.n)(),[k,I]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),[b,L]=(0,r.useState)(!1),N=(0,r.useRef)(null),E=(0,r.useRef)(null),T=(0,r.useRef)(null),P=(0,c.DT)(),j=(0,v.x)();(0,r.useEffect)(()=>{let e=()=>{Array.from(document.getElementsByClassName("isMiniWindow")).forEach(e=>{var t,l;null===(t=e.classList)||void 0===t||t.add("isMiniWindowHover"),(null==e?void 0:null===(l=e.id)||void 0===l?void 0:l.includes("slideMode"))&&e.setAttribute("data-mini","isMiniWindowHover")})},t=()=>{document.getElementsByClassName("isMiniWindowHover").length<=0&&e()},l=()=>{let e=document.getElementsByClassName("isMiniWindowHover");e.length>0&&Array.from(e).forEach(e=>{var t,l;null===(t=e.classList)||void 0===t||t.remove("isMiniWindowHover"),(null==e?void 0:null===(l=e.id)||void 0===l?void 0:l.includes("slideMode"))&&e.removeAttribute("data-mini")})},n=t=>{(!(0,m.Q5)()||document.hasFocus())&&e()},i=e=>{let t=document.getElementsByClassName("isMiniWindow"),l={minXY:(0,m.Q5)()?0:5,maxX:(0,m.Q5)()?window.innerWidth:window.innerWidth-5,maxY:(0,m.Q5)()?window.innerHeight:window.innerHeight-5};((null==e?void 0:e.clientY)<l.minXY||(null==e?void 0:e.clientY)>=(null==l?void 0:l.maxY)||(null==e?void 0:e.clientX)<l.minXY||(null==e?void 0:e.clientX)>=l.maxX)&&Array.from(t).forEach(e=>{var t,l;null===(t=e.classList)||void 0===t||t.remove("isMiniWindowHover"),(null==e?void 0:null===(l=e.id)||void 0===l?void 0:l.includes("slideMode"))&&e.removeAttribute("data-mini")})};return document.addEventListener("mouseover",n),document.addEventListener("mouseleave",i),window.addEventListener("blur",l),window.addEventListener("focus",t),()=>{document.removeEventListener("mouseover",n),document.removeEventListener("mouseleave",i),window.removeEventListener("blur",l),window.removeEventListener("focus",t)}},[]);let R=(0,r.useCallback)(()=>{x.sendLog("pauseVideo",{mute_remind:"none",enter_from:(0,f.mo)(),is_small_window:"1",click_method:"click"})},[]),M=(0,r.useCallback)(()=>{O.s.getPlayerScene(null==w?void 0:w.playerId)===_.lT.Search&&(null==w||w.emitUserAction(s.USER_ACTION,"switch_play_pause",{action:"switch_play_pause",paused:null==w?void 0:w.paused,pluginName:"click"}))},[null==w?void 0:w.playerId]),W=(0,r.useCallback)(()=>{var e,t;M(),(null==w?void 0:w.paused)?null==w||null===(e=w.play)||void 0===e||e.call(w):(null==w||null===(t=w.pause)||void 0===t||t.call(w),R())},[w,R]);return(0,r.useEffect)(()=>{let e=()=>{I(!(null==w?void 0:w.paused))};return w&&(w.on("play",e),w.on("pause",e)),()=>{w&&(w.off("play",e),w.off("pause",e))}},[w,R]),(0,r.useEffect)(()=>{w&&I(!(null==w?void 0:w.paused))},[w]),(0,r.useEffect)(()=>(g.Le.getConfig(g.gI.PlaySwitchMethods),g.Le.setConfig(g.gI.PlaySwitchMethods,""),()=>{E.current&&(clearTimeout(E.current),E.current=null)}),[]),(0,a.jsxs)("div",{ref:T,className:d()(y.default.wrap,{[y.default.newWrap]:j}),onMouseLeave:e=>{(null==e?void 0:e.target)!==N.current&&S(!1)},children:[(0,a.jsxs)("div",{className:d()(y.default.fullbox),onMouseOver:e=>{(null==e?void 0:e.target)!==N.current&&S(!0)},onMouseLeave:e=>{!P&&(null==e?void 0:e.target)!==N.current&&S(!1)},onClick:W,children:[k?(0,a.jsx)(A.z,{svg:(0,a.jsx)(p.Z,{}),className:d()(y.default.svg,{[y.default.hide]:j||b||!C})}):(0,a.jsx)(A.z,{svg:(0,a.jsx)(h.Z,{}),className:d()(y.default.svg,{[y.default.hide]:!j&&(b||!C)})}),(0,a.jsx)(Z,{className:d()({[y.default.hide]:!j&&(b||!C),[y.default.miniWindowOptimize]:j}),abtestData:t,electronWarpRef:N}),j&&(0,a.jsx)(F.N,{awemeInfo:null==u?void 0:u.awemeInfo,hitMiniWindowOptimize:j})]}),(0,a.jsx)(U.I,(0,i._)((0,n._)({},u),{playSwitchCb:()=>g.Le.setConfig(g.gI.PlaySwitchMethods,"click_button"),className:d()(y.default.playSwitchContainer,{[y.default.hide]:!l||!j&&(b||!C),[y.default.miniWindowOptimize]:j})}))]})},H=e=>{let t=(0,B.N)();return(0,a.jsx)(W.k,{componentName:"MiniWinMask",Slardar:t,children:(0,a.jsx)(z,(0,n._)({},e))})}},978521:function(e,t,l){l.r(t),l.d(t,{PictureMode:function(){return eh},PictureModeInner:function(){return ep}});var n=l("590921");l("612222");var i=l("259202"),o=l("611542"),a=l("773627");l("998360");var r=l("825211"),u=l.n(r),d=l("661854"),s=l("623176"),c=l("135524"),v=l("837305"),m=l("600743"),f=l("528557"),g=l("127304"),_=l("309551"),p=l("325266"),h=l("552432"),y=l.n(h),w=l("532910"),x=l("895184"),k=l("356789"),I=l("819769"),C=l("245086"),S=l("898263"),b=l("845789"),L=l("377857"),N=l("421079"),E=l("185791");l("613518");let T=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played transition",styleKey:"playedColor"}];class P{updateDuration(e){this.duration=parseInt(1e3*e);let t=0,{fragments:l}=this;this.fragments=l.map(e=>(e.start=t,e.end=t+e.percent*this.duration,e.duration=e.percent*this.duration,t+=e.percent*this.duration,e))}updateProgress(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"played",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},{progressList:l,fragments:n}=this,{newIndex:i,curIndex:o,millisecond:a}=t;i!==o&&l.map((t,l)=>{l<i?t[e].style.width="100%":l>i&&(t[e].style.width=0)});let r=n[i],u=0===a?0:(a-r.start)/r.duration;l[i]&&(l[i][e].style.width=u<0?0:`${100*u}%`)}reset(){let{progressList:e,fragments:t}=this;e.map((e,t)=>{d.ZP.removeClass(e.played,"transition"),setTimeout(()=>d.ZP.addClass(e.played,"transition"),100)}),this.update({played:0},this.duration)}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(1e3*t,10)!==this.duration){if(!t&&0!==t)return;this.updateDuration(t)}let{playedIndex:l,cachedIndex:n}=this;if("Undefined"!==d.ZP.typeOf(e.played)){let t=this.findIndex(1e3*e.played,l);this.updateProgress("played",{newIndex:t,curIndex:l,millisecond:parseInt(1e3*e.played,10)}),this.playedIndex=t}if("Undefined"!==d.ZP.typeOf(e.cached)){let t=this.findIndex(1e3*e.cached,n);this.updateProgress("cached",{newIndex:t,curIndex:n,millisecond:parseInt(1e3*e.cached,10)}),this.cachedIndex=t}}findIndex(e,t){let{fragments:l}=this;if(1===l.length||0===e)return 0;let n=t;for(let t=0;t<this.fragments.length;t++){let l=this.fragments[t];if(n=t,e>l.start&&e<=l.end)break}return n}findHightLight(){let{children:e}=this.root;for(let t=0;t<e.length;t++)if(d.ZP.hasClass(e[t],this.focusClass))return{dom:e[t],pos:e[t].getBoundingClientRect()}}findFragment(e){let{children:t}=this.root;return e<0||e>=t.length?null:{dom:t[e],pos:t[e].getBoundingClientRect()}}unHightLight(){let{children:e}=this.root;for(let t=0;t<e.length;t++)d.ZP.removeClass(e[t],this.focusClass)}setHightLight(e){let{children:t}=this.root;if(e<t.length)return d.ZP.addClass(t[e],this.focusClass),{dom:t[e],pos:t[e].getBoundingClientRect()}}destroy(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}render(){let{progressColor:e}=this.style;return this.root=d.ZP.createDom("xg-inners","",{},"progress-list"),this.fragments&&(this.progressList=this.fragments.map((t,l)=>{let n=d.ZP.createDom("xg-inner","",{style:e?`background:${e}; flex: ${t.percent}`:`flex: ${t.percent}`},`${t.isFocus?"inner-focus":""} xgplayer-progress-inner picture-inner`);return n.addEventListener("click",()=>this.onInnerClick(l)),this.root.appendChild(n),T.map(e=>{n.appendChild(d.ZP.createDom(e.tag,"",{style:e.styleKey?`background: ${this.style[e.styleKey]}; width:0;`:"width:0;"},e.className))}),{cached:n.children[0],played:n.children[1]}})),this.root}constructor(e){this.fragments=e.fragments||[],this.onInnerClick=e.onInnerClick,this.focusClass="inner-focus",this.style=e.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0}}l("843982");class j extends E.ZP{static get pluginName(){return"pictureProgress"}static get defaultConfig(){return{position:E.kd.CONTROLS_CENTER,index:0,disable:!1,isDragingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],miniMoveStep:5,miniStartStep:2,onMoveStart:()=>{},onMoveEnd:()=>{}}}get duration(){return this.playerConfig&&this.playerConfig.customDuration||this.player.duration}get timeOffset(){return this.playerConfig.timeOffset||0}beforeCreate(e){"boolean"==typeof e.player.config.progress&&(e.config.disable=!e.player.config.progress)}createInner(){try{this.innerList=new P({fragments:this.config.fragments,style:this.playerConfig.commonStyle||{},onInnerClick:this.config.onInnerClick}),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map(e=>{this[e]=this.innerList[e].bind(this.innerList)})}catch(e){}}afterCreate(){if(!this.config.disable&&!this.playerConfig.isLive)this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1},this.outer=this.find("xg-outer"),this.createInner(),this.bind("pointerdown",this.onStopPropagation),this.bind("touchstart",this.onStopPropagation)}focus(){this.player.controls.pauseAutoHide(),d.ZP.addClass(this.root,"active")}blur(){this.player.controls.recoverAutoHide(),d.ZP.removeClass(this.root,"active")}onStopPropagation(e){e.stopPropagation()}onMouseDown(e){let{player:t,pos:l,config:n,playerConfig:i}=this,o=d.ZP.getEventPos(e,t.zoom),{width:a,height:r,top:u,left:s}=this.root.getBoundingClientRect(),c=(o.clientX-s)/a;this.updatePercent(c)}updateTime(e){let{player:t,duration:l}=this;e>l?e=l:e<0&&(e=0);let n=t.plugins.time;n&&n.updateTime(e)}updatePercent(e){e=e>1?1:e<0?0:e,this.percent=e,this.innerList.update({played:e*this.duration},this.duration)}getPercent(){return this.percent}destroy(){this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null,this.unbind("mousedown",this.onMouseDown),this.unbind("pointerdown",this.onStopPropagation),this.unbind("touchstart",this.onStopPropagation)}render(){if(this.config.disable||this.playerConfig.isLive)return;let e=this.player.controls?this.player.controls.config.mode:"";return`
    <xg-progress class="xgplayer-progress ${"bottom"===e?"xgplayer-progress-bottom":""}">
      <xg-outer class="xgplayer-progress-outer picture">
      </xg-outer>
    </xg-progress>
    `}constructor(e){super(e),this.percent=0,this._state={now:-1,direc:0,time:0}}}var R=l("559459");let M=e=>{let{player:t,timeDuration:l=3e3}=e,[n,i]=(0,o.useState)(!1),a=(0,o.useRef)(),r=(0,o.useCallback)(()=>{a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{i(!0),a.current=null},l)},[l]);return(0,o.useEffect)(()=>{if(null==t?void 0:t.root){var e,l,n;let o=()=>{a.current&&clearTimeout(a.current),i(!1)},u=()=>{i(!1),r()},d=()=>{i(!1),r()};return null==t||null===(e=t.root)||void 0===e||e.addEventListener("mouseenter",u),null==t||null===(l=t.root)||void 0===l||l.addEventListener("mousemove",d),null==t||null===(n=t.root)||void 0===n||n.addEventListener("mouseleave",o),()=>{var e,l,n;null==t||null===(e=t.root)||void 0===e||e.removeEventListener("mouseenter",u),null==t||null===(l=t.root)||void 0===l||l.removeEventListener("mousemove",d),null==t||null===(n=t.root)||void 0===n||n.removeEventListener("mouseleave",o)}}},[null==t?void 0:t.root,r,i]),(0,o.useEffect)(()=>()=>{a.current&&clearTimeout(a.current),a.current=null},[]),n};var D=l("699233"),A=l("354795");let Z={multiPhotoSlide:{eventName:"multi_photo_slide",params:{aweme_type:c.e.Note,enter_from:"",enter_method:"",author_id:"",group_id:"",pic_cnt:0,is_zoom:!1}},enterGraphicDetail:{eventName:"enter_graphic_detail",params:{enter_from:"",author_id:"",group_id:"",pic_cnt:0}},videoPlayFinish:{eventName:"video_play_finish",params:{author_id:"",group_id:"",log_pb:"",is_visible:"1",enter_from:"",compilation_id:"",playlet_id:"",previous_page:"",tab_name:"",from_follow_list:"0",is_mute:"0",is_force:"0",trending_topic:"",open_from_page:"",multi_window_order:""}},finishTuji:{eventName:"finish_tuji",params:{author_id:"",group_id:"",log_pb:"",is_visible:"1",enter_from:"",compilation_id:"",playlet_id:"",previous_page:"",tab_name:"",from_follow_list:"0",is_mute:"0",is_force:"0",trending_topic:""}}};var W=new A.h(Z),F=l("401310"),U=l("710046");let B=e=>{var t;let{isActive:l,awemeInfo:a,swiper:r,onPlayFinish:v,playNextFunc:m,ablePlayNext:f,playPrevFunc:h,ablePlayPrev:E,logParams:T,arrowButtonSize:P=56,isClientMiniWin:A,disableShortCut:Z=!1,isShowSideBar:B=!1,inSearch:O,leftStyle:z,rightStyle:H}=e,V=(0,F.n)(),[K,$]=(0,o.useState)(!0),[Y,G]=(0,o.useState)([!0,!0]),[q,Q]=(0,o.useState)(!1),X=(0,o.useRef)(Date.now()),J=(0,o.useRef)(0),ee=(0,o.useRef)(T),et=(0,o.useRef)(!0),el=(0,o.useRef)(null),en=e=>{$(e),et.current=e},ei=M({player:V});ee.current=T;let eo=(0,o.useCallback)(e=>{var t;let l=null==V?void 0:V.getPlugin("pictureProgress");null==l||null===(t=l.updatePercent)||void 0===t||t.call(l,e),J.current=e},[V]),ea=(0,o.useCallback)(e=>{var t,l;W.sendLog("multiPhotoSlide",(0,n._)({enter_from:null===(t=ee.current)||void 0===t?void 0:t.enter_from,enter_method:"click_pic",author_id:null==a?void 0:null===(l=a.authorInfo)||void 0===l?void 0:l.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},ee.current)),G([0===r.activeIndex,r.activeIndex===(null==a?void 0:a.images.length)-1]),en(!1),eo((e+1)/a.images.length),null==r||r.slideTo(e,0)},[r,eo,a]),er=(0,o.useCallback)(e=>{if(r.activeIndex>0){var t,l;W.sendLog("multiPhotoSlide",(0,n._)({enter_from:null===(t=ee.current)||void 0===t?void 0:t.enter_from,enter_method:(null==e?void 0:e.type)==="click"?"click_button":"keyboard",author_id:null==a?void 0:null===(l=a.authorInfo)||void 0===l?void 0:l.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},ee.current)),en(!1),eo(r.activeIndex/a.images.length),r.slidePrev(),G([0===r.activeIndex,r.activeIndex===(null==a?void 0:a.images.length)-1])}},[r,eo,a]),eu=(0,o.useCallback)(e=>{if(r.activeIndex<r.slides.length-1){var t;W.sendLog("multiPhotoSlide",(0,n._)({enter_from:null==T?void 0:T.enter_from,enter_method:(null==e?void 0:e.type)==="click"?"click_button":"keyboard",author_id:null==a?void 0:null===(t=a.authorInfo)||void 0===t?void 0:t.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},ee.current)),en(!1),eo((r.activeIndex+2)/a.images.length),r.slideNext(),G([0===r.activeIndex,r.activeIndex===(null==a?void 0:a.images.length)-1])}},[r,eo,a]);return(0,R.X)({preClick:er,nextClick:eu,disableShortCut:Z}),(0,o.useEffect)(()=>{let e=k.listen(k.EVENT.showDisturbLoginPanel,e=>{Q(e)});return()=>{null==e||e()}},[]),(0,o.useEffect)(()=>{if(V&&(null==a?void 0:a.awemeType)===c.e.Note){let e=e=>{if(e){var t;W.sendLog("enterGraphicDetail",{enter_from:null==T?void 0:T.enter_from,author_id:null==a?void 0:null===(t=a.authorInfo)||void 0===t?void 0:t.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length})}};return V.on(s.FULLSCREEN_CHANGE,e),()=>{V.off(s.FULLSCREEN_CHANGE,e)}}},[a,V]),(0,o.useEffect)(()=>{if(V&&(null==a?void 0:a.awemeType)===c.e.Note){let e=V.getPlugin("AutoPlaySettingPlugin")||V.getPlugin("SearchAutoPlaySettingPlugin");if(e)return e.playeNextWeightNum+=1,()=>{e.playeNextWeightNum-=1}}},[a,V]),(0,o.useEffect)(()=>{if(V&&(null==a?void 0:a.awemeType)===c.e.Note){let e=V.getPlugin("InnerAutoPlayPlugin");if(e)return e.config.innerAutoPlayWeight+=1,()=>{e.config.innerAutoPlayWeight-=1}}},[a,V]),(0,o.useEffect)(()=>{if(V)return J.current=0,V.registerPlugin(j,{fragments:a.images.map(e=>({percent:1/a.images.length})),onInnerClick:ea}),V.getPlugin(_.Z.pluginName)&&V.unRegisterPlugin(_.Z.pluginName,!0),V.getPlugin(p.Z.pluginName)&&V.unRegisterPlugin(p.Z.pluginName,!0),()=>{V.getPlugin(j.pluginName)&&V.unRegisterPlugin(j.pluginName,!0),V.registerPlugin(_.Z,{}),V.registerPlugin(p.Z,{})}},[V,ea]),(0,o.useEffect)(()=>{if(r){let e=!1,t=()=>{e=!1,setTimeout(()=>ea(r.activeIndex))},l=()=>{en(!1),eo((r.activeIndex+1)/a.images.length),e||r.once("touchEnd",t),e=!0};try{r.on("touchMove",l)}catch(e){}return()=>{try{null==r||r.off("touchMove",l)}catch(e){}}}},[r,eo,ea]),(0,o.useEffect)(()=>{if(l&&V){var e,t,i,o,u;if(K){X.current=Date.now()-3e3*J.current*a.images.length;let l=V.getPlugin("pictureProgress");0===J.current?null==l||null===(e=l.innerList)||void 0===e||e.reset():null==l||null===(i=l.innerList)||void 0===i||null===(t=i.progressList)||void 0===t||t.map((e,t)=>{d.ZP.addClass(null==e?void 0:e.played,"transition")});let o=y()(()=>{V.cumulateTime>=5e3&&(el.current(),V.off(s.TIME_UPDATE,o))},500,{leading:!0,trailing:!0}),u=()=>{var e,t,i,u,d;if((Date.now()-X.current)/(3e3*a.images.length)>=1){V.off(s.TIME_UPDATE,o),V.on(s.TIME_UPDATE,o),eo(1),J.current=0,X.current=Date.now(),null==l||null===(e=l.innerList)||void 0===e||e.reset();let n=V.getPlugin("AutoPlaySettingPlugin")||V.getPlugin("SearchAutoPlaySettingPlugin"),a=V.getPlugin("InnerAutoPlayPlugin");n&&(null==n?void 0:null===(t=n.config)||void 0===t?void 0:t.nextAutoPlay)&&(null==n?void 0:n.playeNextWeightNum)<=1&&f&&(null==n?void 0:n.stopFlag)===0&&!q?null==m||m():a&&(null===(i=I.Le.getConfig(I.gI.InnerAutoPlay))||void 0===i?void 0:i.modeIndex)===U.KM.Nomal&&a.config.innerAutoPlayWeight>=0&&f&&(null==a?void 0:a.stopFlag)===0&&!q?null==m||m({from:"auto"}):a&&(null===(u=I.Le.getConfig(I.gI.InnerAutoPlay))||void 0===u?void 0:u.modeIndex)===U.KM.Reverse&&a.config.innerAutoPlayWeight>=0&&E&&(null==a?void 0:a.stopFlag)===0&&!q&&(null==h||h({from:"auto"}))}else eo((Date.now()-X.current)/(3e3*a.images.length));let c=Math.floor((Date.now()-X.current)/3e3);if((null==r?void 0:r.activeIndex)!==c){if(null==r?void 0:r.destroyed)return;W.sendLog("multiPhotoSlide",(0,n._)({enter_from:null==T?void 0:T.enter_from,enter_method:"auto",author_id:null==a?void 0:null===(d=a.authorInfo)||void 0===d?void 0:d.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},ee.current)),null==r||r.slideTo(c,r.activeIndex===a.images.length-1?0:250),G([(null==r?void 0:r.activeIndex)===0,(null==r?void 0:r.activeIndex)===(null==a?void 0:a.images.length)-1])}},c=()=>{X.current=Date.now()-3e3*J.current*a.images.length};return V.on(s.TIME_UPDATE,u),V.on(s.PLAY,c),()=>{V.off(s.TIME_UPDATE,u),V.off(s.PLAY,c),V.off(s.TIME_UPDATE,o)}}{let e=V.getPlugin("pictureProgress");null==e||null===(u=e.innerList)||void 0===u||null===(o=u.progressList)||void 0===o||o.map((e,t)=>{d.ZP.removeClass(null==e?void 0:e.played,"transition")});let t=()=>{en(!0)};(null==V?void 0:V.paused)&&V.once(s.PLAY,t);let l=()=>{V.once(s.PLAY,t)},n=()=>{V.off(s.PLAY,t)};return V.on(s.PAUSE,l),V.on(s.ENDED,n),()=>{var i,o;V.off(s.PAUSE,l),V.off(s.ENDED,n),V.off(s.PLAY,t),null==e||null===(o=e.innerList)||void 0===o||null===(i=o.progressList)||void 0===i||i.map((e,t)=>{d.ZP.addClass(null==e?void 0:e.played,"transition")})}}}J.current=0},[l,V,K,eo,r,m,f,q]),(0,o.useEffect)(()=>{if(r){let e=()=>{if(r.activeIndex===(null==a?void 0:a.images.length)-1){var t,l,i,o,u,d,s,m;W.sendLog("videoPlayFinish",(0,n._)({urlParamList:["enter_method","trending_topic","previous_page"],enter_from:(0,C.mo)(),author_id:null==a?void 0:null===(t=a.authorInfo)||void 0===t?void 0:t.uid,group_id:null==a?void 0:a.awemeId,log_pb:null==a?void 0:a.logPb,compilation_id:null==a?void 0:null===(l=a.mixInfo)||void 0===l?void 0:l.mixId,playlet_id:null==a?void 0:null===(i=a.seriesInfo)||void 0===i?void 0:i.seriesId,tab_name:w.getTabName()||(0,S.Rs)("tab_name")||"",is_visible:String("visible"===document.visibilityState?1:0),is_author_card_expand:(null===(o=I.Le.getConfig("isCollapseAuthorCard"))||void 0===o?void 0:o.isCollapseAuthorCard)?0:1,from_follow_list:(null===(u=I.Le.getConfig("fromFollowList"))||void 0===u?void 0:u.tag)?"1":"0",is_mute:(null==V?void 0:V.muted)?"1":"0",is_force:(null===(d=I.Le.getConfig(I.gI.ForceMuted))||void 0===d?void 0:d.currentMuteType)==="browser"?"1":"0",trending_topic:"",aweme_type:(null==a?void 0:a.isSlides)?c.e.Slides:null==a?void 0:a.awemeType,pic_cnt:null==a?void 0:null===(s=a.images)||void 0===s?void 0:s.length,is_small_window:"0",column_type:(null==T?void 0:T.column_type)||(null==T?void 0:null===(m=T.search_params)||void 0===m?void 0:m.column_type)},T,(0,b.Wc)()));try{r.off("slideChange",e)}catch(e){}null==v||v()}};try{r.slideTo(0,0),G([0===r.activeIndex,r.activeIndex===(null==a?void 0:a.images.length)-1]),r.on("slideChange",e)}catch(e){}return()=>{try{r.off("slideChange",e)}catch(e){}}}},[r,a]),(0,o.useEffect)(()=>{if(r){el.current=()=>{var e,t,l,i,o,r,u;W.sendLog("finishTuji",(0,n._)({urlParamList:["enter_method","trending_topic","previous_page"],enter_from:(0,C.mo)(),author_id:null==a?void 0:null===(e=a.authorInfo)||void 0===e?void 0:e.uid,group_id:null==a?void 0:a.awemeId,log_pb:null==a?void 0:a.logPb,compilation_id:null==a?void 0:null===(t=a.mixInfo)||void 0===t?void 0:t.mixId,playlet_id:null==a?void 0:null===(l=a.seriesInfo)||void 0===l?void 0:l.seriesId,tab_name:w.getTabName()||(0,S.Rs)("tab_name")||"",is_visible:String("visible"===document.visibilityState?1:0),is_author_card_expand:(null===(i=I.Le.getConfig("isCollapseAuthorCard"))||void 0===i?void 0:i.isCollapseAuthorCard)?0:1,from_follow_list:(null===(o=I.Le.getConfig("fromFollowList"))||void 0===o?void 0:o.tag)?"1":"0",is_mute:(null==V?void 0:V.muted)?"1":"0",is_force:(null===(r=I.Le.getConfig(I.gI.ForceMuted))||void 0===r?void 0:r.currentMuteType)==="browser"?"1":"0",trending_topic:"",aweme_type:null==a?void 0:a.awemeType,pic_cnt:null==a?void 0:null===(u=a.images)||void 0===u?void 0:u.length,is_small_window:"0"},T)),el.current=()=>{}};let e=()=>{r.activeIndex===(null==a?void 0:a.images.length)-1&&el.current&&!et.current&&el.current()};return r.on("slideChange",e),()=>{r.off("slideChange",e)}}},[r,a]),!A&&(null==a?void 0:null===(t=a.images)||void 0===t?void 0:t.length)>1?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:u()(g.default.leftArrow,g.default.arrow,{[g.default.disabled]:Y[0],[g.default.inSideBar]:B,[g.default.inSearch]:O,[g.default.hide]:ei,[z]:z}),style:{width:`${P}px`,height:`${P}px`},children:(0,i.jsx)(D.Z,{src:L.Z,width:P,height:P,viewBox:"0 0 56 56",onClick:er})}),(0,i.jsx)("div",{className:u()(g.default.rightArrow,g.default.arrow,{[g.default.disabled]:Y[1],[g.default.inSideBar]:B,[g.default.inSearch]:O,[g.default.hide]:ei,[H]:H}),style:{width:`${P}px`,height:`${P}px`},children:(0,i.jsx)(D.Z,{src:N.Z,width:P,height:P,viewBox:"0 0 56 56",onClick:eu})})]}):null};var O=l("874155");l("555266");let z=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played transition",styleKey:"playedColor"}];class H{updateProgress(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"played",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},{progressList:l,fragments:n}=this,{newIndex:i,curIndex:o,millisecond:a}=t;i!==o&&l.map((t,l)=>{l<i?t[e].style.width="100%":l>i&&(t[e].style.width=0)});let r=n[i],u=0===a?0:(a-r.start)/r.duration;l[i]&&(l[i][e].style.width=u<0?0:`${100*u}%`)}reset(){let{progressList:e,fragments:t}=this;this.update({played:0})}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},{playedIndex:t,cachedIndex:l}=this;if("Undefined"!==d.ZP.typeOf(e.played)){let l=this.findIndex(e.played,t);if(l!==t){var n,i;d.ZP.removeClass(null===(n=this.progressList[t])||void 0===n?void 0:n.played,"transition"),d.ZP.addClass(null===(i=this.progressList[l])||void 0===i?void 0:i.played,"transition")}this.updateProgress("played",{newIndex:l,curIndex:t,millisecond:e.played}),this.playedIndex=l}if("Undefined"!==d.ZP.typeOf(e.cached)){let t=this.findIndex(e.cached,l);this.updateProgress("cached",{newIndex:t,curIndex:l,millisecond:parseInt(e.cached,10)}),this.cachedIndex=t}}findIndex(e,t){let{fragments:l}=this;if(1===l.length||0===e)return 0;let n=t;for(let t=0;t<this.fragments.length;t++){let l=this.fragments[t];if(n=t,e>=l.start&&e<=l.end)break}return n}findHightLight(){let{children:e}=this.root;for(let t=0;t<e.length;t++)if(d.ZP.hasClass(e[t],this.focusClass))return{dom:e[t],pos:e[t].getBoundingClientRect()}}findFragment(e){let{children:t}=this.root;return e<0||e>=t.length?null:{dom:t[e],pos:t[e].getBoundingClientRect()}}unHightLight(){let{children:e}=this.root;for(let t=0;t<e.length;t++)d.ZP.removeClass(e[t],this.focusClass)}setHightLight(e){let{children:t}=this.root;if(e<t.length)return d.ZP.addClass(t[e],this.focusClass),{dom:t[e],pos:t[e].getBoundingClientRect()}}destroy(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}render(){let{progressColor:e}=this.style;return this.root=d.ZP.createDom("xg-inners","",{},"progress-list"),this.fragments&&(this.progressList=this.fragments.map((t,l)=>{let n=d.ZP.createDom("xg-inner","",{style:e?`background:${e}; flex: ${t.percent}`:`flex: ${t.percent}`},`${t.isFocus?"inner-focus":""} xgplayer-progress-inner picture-inner`);return n.addEventListener("click",()=>this.onInnerClick(l)),this.root.appendChild(n),z.map(e=>{n.appendChild(d.ZP.createDom(e.tag,"",{style:e.styleKey?`background: ${this.style[e.styleKey]}; width:0;`:"width:0;"},e.className))}),{cached:n.children[0],played:n.children[1]}})),this.root}constructor(e){this.fragments=e.fragments||[],this.onInnerClick=e.onInnerClick,this.focusClass="inner-focus",this.style=e.style||{playedColor:"",cachedColor:"",progressColor:""},this.cachedIndex=0,this.playedIndex=0}}l("384860");class V extends E.ZP{static get pluginName(){return"pictureProgress"}static get defaultConfig(){return{position:E.kd.CONTROLS_CENTER,index:0,disable:!1,isDragingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[],miniMoveStep:5,miniStartStep:2,onMoveStart:()=>{},onMoveEnd:()=>{}}}beforeCreate(e){"boolean"==typeof e.player.config.progress&&(e.config.disable=!e.player.config.progress)}createInner(){try{this.innerList=new H({duration:this.config.duration,fragments:this.config.fragments,style:this.playerConfig.commonStyle||{},onInnerClick:this.config.onInnerClick}),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map(e=>{this[e]=this.innerList[e].bind(this.innerList)})}catch(e){}}afterCreate(){if(!this.config.disable&&!this.playerConfig.isLive)this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1},this.outer=this.find("xg-outer"),this.createInner(),this.bind("pointerdown",this.onStopPropagation),this.bind("touchstart",this.onStopPropagation)}focus(){this.player.controls.pauseAutoHide(),d.ZP.addClass(this.root,"active")}blur(){this.player.controls.recoverAutoHide(),d.ZP.removeClass(this.root,"active")}onStopPropagation(e){e.stopPropagation()}updateIndex(e,t){let l="video"===this.config.fragments[e].type||t?this.config.fragments[e].start:this.config.fragments[e].end;this.innerList.update({played:l})}updateTime(e){this.innerList.update({played:e})}destroy(){this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null,this.unbind("pointerdown",this.onStopPropagation),this.unbind("touchstart",this.onStopPropagation)}render(){if(this.config.disable||this.playerConfig.isLive)return;let e=this.player.controls?this.player.controls.config.mode:"";return`
    <xg-progress class="xgplayer-progress ${"bottom"===e?"xgplayer-progress-bottom":""}">
      <xg-outer class="xgplayer-progress-outer picture">
      </xg-outer>
    </xg-progress>
    `}constructor(e){super(e),this._state={now:-1,direc:0,time:0}}}var K=l("344814"),$=l.n(K),Y=l("51877"),G=l.n(Y),q=l("799506"),Q=l("696871"),X=l("82311");let{ArrowLeft:J,ArrowRight:ee,A:et,D:el}=q.bf,en=e=>{let t=(0,F.n)(),{preClick:l,nextClick:i,disableShortCut:a=!1,active:r=!0}=e;return(0,o.useEffect)(()=>{if(!!r){if(t){if(a)return(0,Q.K)(t);let e={left:{keyCode:J.keyCode,action:l,disable:!1,noBodyTarget:!1},right:{keyCode:ee.keyCode,action:i,disable:!1,noBodyTarget:!1},leftA:{keyCode:et.keyCode,action:l,disable:!1,noBodyTarget:!1},rightD:{keyCode:el.keyCode,action:i,disable:!1,noBodyTarget:!1}},o={left:$()(t,"plugins.keyboard.keyCodeMap.left"),right:$()(t,"plugins.keyboard.keyCodeMap.right"),leftA:$()(t,"plugins.keyboard.keyCodeMap.leftA"),rightD:$()(t,"plugins.keyboard.keyCodeMap.rightD")};return G()(t,"plugins.keyboard.keyCodeMap",(0,n._)({},$()(t,"plugins.keyboard.keyCodeMap")||{},e)),()=>{t.plugins.keyboard&&((0,X.v)({currentCodeMap:t.plugins.keyboard.keyCodeMap,additionalCodeMap:e}),G()(t,"plugins.keyboard.keyCodeMap",(0,n._)({},$()(t,"plugins.keyboard.keyCodeMap")||{},o)))}}}},[t,l,i,a,r]),null},ei=e=>{let{player:t,timeDuration:l=3e3}=e,[n,i]=(0,o.useState)(!1),a=(0,o.useRef)(),r=(0,o.useCallback)(()=>{a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{i(!0),a.current=null},l)},[l]);return(0,o.useEffect)(()=>{if(null==t?void 0:t.root){var e,l,n;let o=()=>{a.current&&clearTimeout(a.current),i(!1)},u=()=>{i(!1),r()},d=()=>{i(!1),r()};return null==t||null===(e=t.root)||void 0===e||e.addEventListener("mouseenter",u),null==t||null===(l=t.root)||void 0===l||l.addEventListener("mousemove",d),null==t||null===(n=t.root)||void 0===n||n.addEventListener("mouseleave",o),()=>{var e,l,n;null==t||null===(e=t.root)||void 0===e||e.removeEventListener("mouseenter",u),null==t||null===(l=t.root)||void 0===l||l.removeEventListener("mousemove",d),null==t||null===(n=t.root)||void 0===n||n.removeEventListener("mouseleave",o)}}},[null==t?void 0:t.root,r,i]),(0,o.useEffect)(()=>()=>{a.current&&clearTimeout(a.current),a.current=null},[]),n},eo={singleTime:2e3,speed:250},ea=e=>{var t;let{isActive:l,awemeInfo:a,swiper:r,onPlayFinish:d,playNextFunc:v,ablePlayNext:m,playPrevFunc:f,ablePlayPrev:h,logParams:y,arrowButtonSize:E=56,isClientMiniWin:T,disableShortCut:P=!1,isShowSideBar:j=!1,inSearch:R,leftStyle:M,rightStyle:A}=e,Z=(0,F.n)(),[B,z]=(0,o.useState)(!0),[H,K]=(0,o.useState)([!0,!0]),[$,Y]=(0,o.useState)(!1),G=(0,o.useRef)(y),q=(0,o.useRef)(!0),Q=(0,o.useRef)(null),X=e=>{z(e),q.current=e},J=ei({player:Z}),ee=(0,o.useMemo)(()=>a.images.reduce((e,t)=>e+(t.video?t.video.duration:eo.singleTime),0),[a]),et=(0,o.useMemo)(()=>{if(a&&0===a.images.length)return[];let e=-1;return a.images.map(t=>{if(t.video){let l={type:"video",start:e+1,end:e+t.video.duration,duration:t.video.duration,percent:1/a.images.length};return e=l.end,l}{let t={type:"image",start:e+1,end:e+eo.singleTime,duration:eo.singleTime,percent:1/a.images.length};return e=t.end,t}})},[a]);G.current=y;let el=(0,o.useCallback)(e=>{var t;let l=null==Z?void 0:Z.getPlugin("pictureProgress");null==l||null===(t=l.updateIndex)||void 0===t||t.call(l,e,q.current)},[Z]),ea=(0,o.useCallback)(e=>{var t;let l=null==Z?void 0:Z.getPlugin("pictureProgress");null==l||null===(t=l.updateTime)||void 0===t||t.call(l,e)},[Z]),er=(0,o.useCallback)(e=>{var t,l;W.sendLog("multiPhotoSlide",(0,O._)((0,n._)({enter_from:null===(t=G.current)||void 0===t?void 0:t.enter_from,author_id:null==a?void 0:null===(l=a.authorInfo)||void 0===l?void 0:l.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},G.current),{enter_method:"click_pic",aweme_type:(null==a?void 0:a.isSlides)?151:null==a?void 0:a.awemeType})),r.slideTo(e,0),X(!1),el(e),K([0===r.activeIndex,r.activeIndex===(null==a?void 0:a.images.length)-1])},[r,el,a]),eu=(0,o.useCallback)(e=>{if(r.activeIndex>0){var t,l;W.sendLog("multiPhotoSlide",(0,O._)((0,n._)({enter_from:null===(t=G.current)||void 0===t?void 0:t.enter_from,author_id:null==a?void 0:null===(l=a.authorInfo)||void 0===l?void 0:l.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},G.current),{enter_method:(null==e?void 0:e.type)==="click"?"click_button":"keyboard",aweme_type:(null==a?void 0:a.isSlides)?151:null==a?void 0:a.awemeType})),X(!1),el(r.activeIndex-1),r.slidePrev(),K([0===r.activeIndex,r.activeIndex===(null==a?void 0:a.images.length)-1])}},[r,el,a]),ed=(0,o.useCallback)(e=>{if(r.activeIndex<r.slides.length-1){var t;W.sendLog("multiPhotoSlide",(0,O._)((0,n._)({enter_from:null==y?void 0:y.enter_from,author_id:null==a?void 0:null===(t=a.authorInfo)||void 0===t?void 0:t.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},G.current),{enter_method:(null==e?void 0:e.type)==="click"?"click_button":"keyboard",aweme_type:(null==a?void 0:a.isSlides)?151:null==a?void 0:a.awemeType})),X(!1),el(r.activeIndex+1),r.slideNext(),K([0===r.activeIndex,r.activeIndex===(null==a?void 0:a.images.length)-1])}},[r,el,a]);en({preClick:eu,nextClick:ed,disableShortCut:P}),(0,o.useEffect)(()=>{let e=k.listen(k.EVENT.showDisturbLoginPanel,e=>{Y(e)});return()=>{null==e||e()}},[]),(0,o.useEffect)(()=>{if(Z&&(null==a?void 0:a.awemeType)===c.e.Note){let e=e=>{if(e){var t;W.sendLog("enterGraphicDetail",{enter_from:null==y?void 0:y.enter_from,author_id:null==a?void 0:null===(t=a.authorInfo)||void 0===t?void 0:t.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length})}};return Z.on(s.FULLSCREEN_CHANGE,e),()=>{Z.off(s.FULLSCREEN_CHANGE,e)}}},[a,Z]),(0,o.useEffect)(()=>{if(Z&&(null==a?void 0:a.awemeType)===c.e.Note){let e=Z.getPlugin("AutoPlaySettingPlugin")||Z.getPlugin("SearchAutoPlaySettingPlugin");if(e)return e.playeNextWeightNum+=1,()=>{e.playeNextWeightNum-=1}}},[a,Z]),(0,o.useEffect)(()=>{if(Z&&(null==a?void 0:a.awemeType)===c.e.Note){let e=Z.getPlugin("InnerAutoPlayPlugin");if(e)return e.config.innerAutoPlayWeight+=1,()=>{e.config.innerAutoPlayWeight-=1}}},[a,Z]),(0,o.useEffect)(()=>{if(Z)return Z.registerPlugin(V,{fragments:et,duration:ee,onInnerClick:er}),Z.getPlugin(_.Z.pluginName)&&Z.unRegisterPlugin(_.Z.pluginName,!0),Z.getPlugin(p.Z.pluginName)&&Z.unRegisterPlugin(p.Z.pluginName,!0),()=>{Z.getPlugin(V.pluginName)&&Z.unRegisterPlugin(V.pluginName,!0),Z.registerPlugin(_.Z,{}),Z.registerPlugin(p.Z,{})}},[Z,er]),(0,o.useEffect)(()=>{if(r){let e=!1,t=()=>{e=!1,setTimeout(()=>er(r.activeIndex))},l=()=>{X(!1),el(r.activeIndex),e||r.once("touchEnd",t),e=!0};try{r.on("touchMove",l)}catch(e){}return()=>{try{null==r||r.off("touchMove",l)}catch(e){}}}},[r,el,er]);let es=(0,o.useCallback)(()=>{var e,t,l;let n=Z.getPlugin("AutoPlaySettingPlugin")||Z.getPlugin("SearchAutoPlaySettingPlugin"),i=Z.getPlugin("InnerAutoPlayPlugin");n&&(null==n?void 0:null===(e=n.config)||void 0===e?void 0:e.nextAutoPlay)&&(null==n?void 0:n.playeNextWeightNum)<=1&&m&&(null==n?void 0:n.stopFlag)===0&&!$?null==v||v():i&&(null===(t=I.Le.getConfig(I.gI.InnerAutoPlay))||void 0===t?void 0:t.modeIndex)===U.KM.Nomal&&i.config.innerAutoPlayWeight>=0&&m&&(null==i?void 0:i.stopFlag)===0&&!$?null==v||v({from:"auto"}):i&&(null===(l=I.Le.getConfig(I.gI.InnerAutoPlay))||void 0===l?void 0:l.modeIndex)===U.KM.Reverse&&i.config.innerAutoPlayWeight>=0&&h&&(null==i?void 0:i.stopFlag)===0&&!$&&(null==f||f({from:"auto"}))},[Z,h,m,f,v,$]);return(0,o.useEffect)(()=>{if(l&&Z&&r&&B&&"video"!==et[r.activeIndex].type){let e=1e3*Z.currentTime;e>100&&a.imageAlbumMusicInfo.beginTime>1e3&&(e-=a.imageAlbumMusicInfo.beginTime);let t=()=>{let t=((Z.currentTime+Z.duration)*1e3-e)%(1e3*Z.duration);if(a.imageAlbumMusicInfo.beginTime>1e3){let{beginTime:l,endTime:n}=a.imageAlbumMusicInfo,i=n-l;t=(1e3*Z.currentTime-l+i-e)%i}if(t>=eo.singleTime){var l,i,o;if(r.activeIndex===a.images.length-1){es(),el(0),K([!0,!1]),r.slideTo(0,0);let e=Z.getPlugin("pictureProgress");null==e||null===(i=e.innerList)||void 0===i||i.reset(),W.sendLog("multiPhotoSlide",(0,O._)((0,n._)({enter_from:null==y?void 0:y.enter_from,author_id:null==a?void 0:null===(o=a.authorInfo)||void 0===o?void 0:o.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},G.current),{enter_method:"auto",aweme_type:(null==a?void 0:a.isSlides)?151:null==a?void 0:a.awemeType})),Z.cumulateTime>=5e3&&Q.current();return}el(r.activeIndex+1),K([!1,r.activeIndex+1===(null==a?void 0:a.images.length)-1]),r.slideTo(r.activeIndex+1,eo.speed),W.sendLog("multiPhotoSlide",(0,O._)((0,n._)({enter_from:null==y?void 0:y.enter_from,author_id:null==a?void 0:null===(l=a.authorInfo)||void 0===l?void 0:l.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},G.current),{enter_method:"auto",aweme_type:(null==a?void 0:a.isSlides)?151:null==a?void 0:a.awemeType}));return}ea(et[r.activeIndex].start+t)};return Z.on(s.TIME_UPDATE,t),()=>{Z.off(s.TIME_UPDATE,t)}}},[null==r?void 0:r.activeIndex,Z,l,B,et,es]),(0,o.useEffect)(()=>{if(l&&Z&&r){let e=e=>{"switch_play_pause"===e.action&&e.paused&&X(!0)};return Z.on(s.USER_ACTION,e),()=>{Z.off(s.USER_ACTION,e)}}},[l,Z,r]),(0,o.useEffect)(()=>{if(l&&Z&&r){let e=k.listen(k.EVENT.notevideo,e=>{let{type:t,data:l,index:i,playerId:o}=e;if(Z.playerId===o){if("timeupdate"===t&&r.activeIndex===i&&ea(et[r.activeIndex].start+l),"end"===t){if(B){var u,d,s;if(r.activeIndex===a.images.length-1){es(),el(0),K([!0,!1]),r.slideTo(0,0);let e=Z.getPlugin("pictureProgress");null==e||null===(d=e.innerList)||void 0===d||d.reset(),W.sendLog("multiPhotoSlide",(0,O._)((0,n._)({enter_from:null==y?void 0:y.enter_from,author_id:null==a?void 0:null===(s=a.authorInfo)||void 0===s?void 0:s.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},G.current),{enter_method:"auto",aweme_type:(null==a?void 0:a.isSlides)?151:null==a?void 0:a.awemeType})),Z.cumulateTime>=5e3&&Q.current();return}el(r.activeIndex+1),K([!1,r.activeIndex+1===(null==a?void 0:a.images.length)-1]),r.slideTo(r.activeIndex+1,eo.speed),W.sendLog("multiPhotoSlide",(0,O._)((0,n._)({enter_from:null==y?void 0:y.enter_from,author_id:null==a?void 0:null===(u=a.authorInfo)||void 0===u?void 0:u.uid,group_id:null==a?void 0:a.awemeId,pic_cnt:a.images.length,is_zoom:(0,x.r)()},G.current),{enter_method:"auto",aweme_type:(null==a?void 0:a.isSlides)?151:null==a?void 0:a.awemeType}))}else k.emit(k.EVENT.notevideo,{type:"replay",playerId:Z.playerId,index:r.activeIndex})}}});return()=>e()}},[l,Z,r,B,es]),(0,o.useEffect)(()=>{if(r){let e=()=>{if(r.activeIndex===(null==a?void 0:a.images.length)-1){var t,l,i,o,u,s,v,m;W.sendLog("videoPlayFinish",(0,n._)({urlParamList:["enter_method","trending_topic","previous_page"],enter_from:(0,C.mo)(),author_id:null==a?void 0:null===(t=a.authorInfo)||void 0===t?void 0:t.uid,group_id:null==a?void 0:a.awemeId,log_pb:null==a?void 0:a.logPb,compilation_id:null==a?void 0:null===(l=a.mixInfo)||void 0===l?void 0:l.mixId,playlet_id:null==a?void 0:null===(i=a.seriesInfo)||void 0===i?void 0:i.seriesId,tab_name:w.getTabName()||(0,S.Rs)("tab_name")||"",is_visible:String("visible"===document.visibilityState?1:0),is_author_card_expand:(null===(o=I.Le.getConfig(I.gI.IsCollapseAuthorCard))||void 0===o?void 0:o.isCollapseAuthorCard)?0:1,from_follow_list:(null===(u=I.Le.getConfig(I.gI.FromFollowList))||void 0===u?void 0:u.tag)?"1":"0",is_mute:(null==Z?void 0:Z.muted)?"1":"0",is_force:(null===(s=I.Le.getConfig(I.gI.ForceMuted))||void 0===s?void 0:s.currentMuteType)==="browser"?"1":"0",trending_topic:"",aweme_type:(null==a?void 0:a.isSlides)?c.e.Slides:null==a?void 0:a.awemeType,pic_cnt:null==a?void 0:null===(v=a.images)||void 0===v?void 0:v.length,is_small_window:"0",column_type:(null==y?void 0:y.column_type)||(null==y?void 0:null===(m=y.search_params)||void 0===m?void 0:m.column_type)},y,(0,b.Wc)()));try{r.off("slideChange",e)}catch(e){}null==d||d()}};try{r.slideTo(0,0),K([0===r.activeIndex,r.activeIndex===(null==a?void 0:a.images.length)-1]),r.on("slideChange",e)}catch(e){}return()=>{try{r.off("slideChange",e)}catch(e){}}}},[r,a]),(0,o.useEffect)(()=>{if(r){Q.current=()=>{var e,t,l,i,o,r,u;W.sendLog("finishTuji",(0,n._)({urlParamList:["enter_method","trending_topic","previous_page"],enter_from:(0,C.mo)(),author_id:null==a?void 0:null===(e=a.authorInfo)||void 0===e?void 0:e.uid,group_id:null==a?void 0:a.awemeId,log_pb:null==a?void 0:a.logPb,compilation_id:null==a?void 0:null===(t=a.mixInfo)||void 0===t?void 0:t.mixId,playlet_id:null==a?void 0:null===(l=a.seriesInfo)||void 0===l?void 0:l.seriesId,tab_name:w.getTabName()||(0,S.Rs)("tab_name")||"",is_visible:String("visible"===document.visibilityState?1:0),is_author_card_expand:(null===(i=I.Le.getConfig(I.gI.IsCollapseAuthorCard))||void 0===i?void 0:i.isCollapseAuthorCard)?0:1,from_follow_list:(null===(o=I.Le.getConfig(I.gI.FromFollowList))||void 0===o?void 0:o.tag)?"1":"0",is_mute:(null==Z?void 0:Z.muted)?"1":"0",is_force:(null===(r=I.Le.getConfig(I.gI.ForceMuted))||void 0===r?void 0:r.currentMuteType)==="browser"?"1":"0",trending_topic:"",aweme_type:null==a?void 0:a.awemeType,pic_cnt:null==a?void 0:null===(u=a.images)||void 0===u?void 0:u.length,is_small_window:"0"},y)),Q.current=()=>{}};let e=()=>{r.activeIndex===(null==a?void 0:a.images.length)-1&&Q.current&&!q.current&&Q.current()};return r.on("slideChange",e),()=>{r.off("slideChange",e)}}},[r,a]),!T&&(null==a?void 0:null===(t=a.images)||void 0===t?void 0:t.length)>1?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:u()(g.default.leftArrow,g.default.arrow,{[g.default.disabled]:H[0],[g.default.inSideBar]:j,[g.default.inSearch]:R,[g.default.hide]:J,[M]:M}),style:{width:`${E}px`,height:`${E}px`},children:(0,i.jsx)(D.Z,{src:L.Z,width:E,height:E,viewBox:"0 0 56 56",onClick:eu})}),(0,i.jsx)("div",{className:u()(g.default.rightArrow,g.default.arrow,{[g.default.disabled]:H[1],[g.default.inSideBar]:j,[g.default.inSearch]:R,[g.default.hide]:J,[A]:A}),style:{width:`${E}px`,height:`${E}px`},children:(0,i.jsx)(D.Z,{src:N.Z,width:E,height:E,viewBox:"0 0 56 56",onClick:ed})})]}):null};var er=l("504717"),eu=l("713017"),ed=l.p+"media/generalBG.9f4484112e793191.png",es=l.p+"media/douyinDefault.330eae8fad2b7adc.png",ec=l("119810");let ev=e=>{let{imageInfo:t,className:l,imgPlaceHolderClassName:n,isMini:a,inSearch:r}=e,[d,s]=(0,o.useState)(!0),[c,v]=(0,o.useState)(!1),[f,g]=(0,o.useState)(null),[_,p]=(0,o.useState)(-1),h=(0,o.useRef)(0),y=(0,eu.G6)(),w=(0,eu.vU)();h.current=(null==t?void 0:t.width)/(null==t?void 0:t.height);let x=(0,o.useCallback)(()=>{f&&h.current&&(f.offsetWidth/h.current>f.offsetHeight-(a?0:33)?s(!0):s(!1))},[f,a]),k=(0,o.useCallback)(()=>{c||v(!0)},[c]);(0,o.useEffect)(()=>{if(f&&x){let e=m.Z.bind(f,x);return()=>{e&&e()}}},[f,x]),(0,o.useEffect)(()=>{f&&(a?f.setAttribute("normal",""):f.removeAttribute("normal"))},[f,a]);let I=(0,o.useMemo)(()=>{if(c)return null;if(-1!==_)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{src:null==t?void 0:t.urlList[_],className:u()({[ec.default.baseWidth]:!d,[ec.default.baseHeight]:d,[ec.default.isSafari]:y,[ec.default.inSearch]:r},ec.default.imgPlaceHolder,n),onError:k}),(0,i.jsxs)("div",{className:u()({[ec.default.backgroundImg]:!y,[ec.default.backgroundImgFirefox]:w,[ec.default.backgroundImgSarari]:y}),children:[(0,i.jsx)("img",{src:y?ed:(null==t?void 0:t.urlList[_])||ed}),!y&&(0,i.jsx)("div",{className:ec.default.backgroundMask})]})]});{let e=new Image;e.src=null==t?void 0:t.urlList[0];let l=setTimeout(()=>{null==t||t.urlList.map((e,t)=>{let l=new Image;l.src=e,l.onload=()=>p(t)})},2e3);return e.onload=()=>{p(0),clearTimeout(l)},(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{src:es,className:u()({[ec.default.baseWidth]:!d,[ec.default.baseHeight]:d,[ec.default.isSafari]:y,[ec.default.inSearch]:r},ec.default.imgPlaceHolder,n)}),(0,i.jsxs)("div",{className:u()({[ec.default.backgroundImg]:!y,[ec.default.backgroundImgFirefox]:w,[ec.default.backgroundImgSarari]:y}),children:[(0,i.jsx)("img",{src:y?ed:es}),!y&&(0,i.jsx)("div",{className:ec.default.backgroundMask})]})]})}},[c,_,k,d]);return(0,i.jsx)("div",{className:u()(l,ec.default.imgBackground,ec.default.playerShowInfo,{[ec.default.isFirefox]:w}),ref:g,children:I})};var em=l("935708"),ef=l("273647"),eg=l("569900"),e_=l("135621");let ep=e=>{let{isActive:t,awemeInfo:l,playNextFunc:n,playPrevFunc:a,ablePlayPrev:r,ablePlayNext:_,logParams:p,isMini:h,isClientMiniWin:y,onPlayFinish:w,customProps:x,abTestData:k,disableShortCut:I=!1,isShowSideBar:C=!1,inSearch:S}=e,b=(0,F.n)(),[L,N]=(0,o.useState)(null),[E,T]=(0,o.useState)(l),{arrowButtonSize:P=56,disableInactiveCursor:j=!1,leftStyle:R,rightStyle:M}=x||{},D=(0,o.useMemo)(()=>{var e;if((null==l?void 0:l.awemeType)!==c.e.Note)return[];if(t)return null==l?void 0:l.images;return(null==l?void 0:null===(e=l.images)||void 0===e?void 0:e.slice(0,1))||[]},[null==l?void 0:l.images,t,null==l?void 0:l.awemeType]),A=(0,o.useMemo)(()=>{var e,t;return!!(null==l?void 0:null===(t=l.images)||void 0===t?void 0:null===(e=t.find)||void 0===e?void 0:e.call(t,e=>e.video))},[null==l?void 0:l.images]);return((0,o.useEffect)(()=>()=>N(null),[]),(0,o.useEffect)(()=>{let e=null==b?void 0:b.innerContainer;if(e&&(null==l?void 0:l.awemeType)===c.e.Note)return d.ZP.addClass(e,"hideXgVideo"),()=>{d.ZP.removeClass(e,"hideXgVideo")}},[b,l]),(0,o.useEffect)(()=>{let{beginTime:e=0,endTime:t=Number.MAX_SAFE_INTEGER}=(null==l?void 0:l.imageAlbumMusicInfo)||{},n=()=>{(b.currentTime>=t/1e3||b.currentTime<e/1e3)&&(b.currentTime=e/1e3)};return(null==l?void 0:l.awemeType)===c.e.Note&&e>=0&&t>e&&(null==b||b.on(s.TIME_UPDATE,n)),()=>{null==b||b.off(s.TIME_UPDATE,n)}},[b,l]),(0,o.useEffect)(()=>{if(t&&L&&b){var e;L.update();let t=m.Z.bind(null==L?void 0:null===(e=L.$el)||void 0===e?void 0:e[0],()=>{L.update()});return()=>{t&&t()}}},[L,t,b]),(0,o.useEffect)(()=>{T(l)},[l]),(0,o.useEffect)(()=>{var e,n;if(t&&b&&(null==l?void 0:null===(e=l.imageAlbumMusicInfo)||void 0===e?void 0:e.volume)===0)return b.config.volume_raw=b.volume,b.volume=.01,()=>{b.volume=b.config.volume_raw,(0,f.qQ)(v.LocalStorageKeys.PLAYER_VOLUME,b.volume),(0,e_.c)({volume:b.config.volume_raw})};!t&&b&&(null==l?void 0:null===(n=l.imageAlbumMusicInfo)||void 0===n?void 0:n.volume)===0&&b.config.volume_raw&&((0,f.qQ)(v.LocalStorageKeys.PLAYER_VOLUME,b.volume),(0,e_.c)({volume:b.config.volume_raw}))},[t,b]),(null==l?void 0:l.awemeType)!==c.e.Note)?null:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ef.t,{direction:0,onSwiper:N,className:u()(g.default.swiperContainer,"focusPanel"),tabIndex:-1,data:D,slideKey:(e,t)=>`${null==e?void 0:e.uri}_${t}`,speed:250,children:(0,i.jsx)(eg.o,{className:g.default.pictureFeed,children:e=>{let{slideData:n,activeIndex:o,currentIndex:a}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{style:{width:"100%",height:"100%",zIndex:2,background:"transparent"},className:u()(g.default.mask,{[g.default.inactive]:o!==a&&j}),type:"button",onKeyDown:e=>null==e?void 0:e.preventDefault()}),(0,i.jsx)(ev,{imageInfo:n,isMini:h,className:g.default.itemImage,inSearch:S}),t&&n.video&&(0,i.jsx)(er.v,{albumMusic:l.imageAlbumMusicInfo,info:n,isMini:h,activeIndex:o,currentIndex:a,inSearch:S})]})}})}),E===l&&t&&!A&&(0,i.jsx)(B,{isActive:t,awemeInfo:l,swiper:L,onPlayFinish:w,playNextFunc:n,playPrevFunc:a,ablePlayNext:_,ablePlayPrev:r,logParams:p,arrowButtonSize:P,isClientMiniWin:y,disableShortCut:I,isShowSideBar:C,inSearch:S,leftStyle:R,rightStyle:M}),E===l&&t&&A&&(0,i.jsx)(ea,{isActive:t,awemeInfo:l,swiper:L,onPlayFinish:w,playNextFunc:n,playPrevFunc:a,ablePlayNext:_,ablePlayPrev:r,logParams:p,arrowButtonSize:P,isClientMiniWin:y,disableShortCut:I,isShowSideBar:C,inSearch:S,leftStyle:R,rightStyle:M})]})},eh=e=>{let t=(0,em.N)();return(0,i.jsx)(a.k,{componentName:"PictureMode",Slardar:t,children:(0,i.jsx)(ep,(0,n._)({},e))})}},713534:function(e,t,l){l.d(t,{B:function(){return C}});var n=l("590921"),i=l("874155");l("41873"),l("612222");var o=l("259202"),a=l("611542"),r=l("825211"),u=l.n(r),d=l("688497"),s=l("245086"),c=l("897082"),v=l("168354"),m=l("385899"),f=l("354795"),g=new f.h({videoAnchorShow:{eventName:"video_anchor_show",params:{group_id:"",author_id:"",enter_from:"",type:""}},videoAnchorClick:{eventName:"video_anchor_click",params:{group_id:"",author_id:"",enter_from:"",type:""}},vsVideoShow:{eventName:"vs_video_show",params:{enter_from_merge:"",enter_method:"",previous_page:"",action_type:"",is_vs:1,vs_season_id:"",vs_episode_id:"",room_id:"",vs_ep_group_id:"",vs_episode_stage:"",vs_episode_type:"",vs_episode_sub_type:"",vs_play_status:"",vs_is_portraid_content:""}}}),_=l("701007"),p=l("830272"),h=l("699233"),y=l("773627"),w=l("401310"),x=l("935708");function k(e){let{onClick:t,targetHref:l,className:a,cardHidden:r,style:s,alinkProps:c={},imgSrc:f,description:g,title:y,onShow:w,type:x="",player:k,target:I}=e,C=(0,d.x)(()=>w());return(0,o.jsxs)(_.a,(0,i._)((0,n._)({onClick:e=>{null==t||t(e),null==k||k.pause()},href:l,className:u()(m.default.outerContainer,a,{[m.default.hidden]:r}),style:s,refEl:C},c),{target:I,children:[(0,o.jsxs)("div",{className:m.default.image,children:[(0,o.jsx)(p.Q,{src:f,iconStyle:{width:"100%",height:"100%"}}),"variety"===x&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:m.default.miniTitle,children:"正片"}),(0,o.jsx)(h.Z,{className:m.default.playIcon,src:v.Z,width:32,height:32,viewBox:"0 0 39 39"})]})]}),(0,o.jsxs)("div",{className:m.default.information,children:[(0,o.jsx)("div",{className:m.default.description,children:g}),(0,o.jsx)("div",{className:m.default.title,children:y})]})]}))}function I(e){var t,l,r,u,d,v,m,f,_;let{awemeInfo:p,abtestData:h,isActive:y}=e,x=(0,w.n)(),I=(0,a.useRef)(""),[C,S]=(0,a.useState)(!1),b=(0,a.useCallback)(e=>{S(!e)},[]),{title:L,subtitle:N,roomLink:E,link:T,liveSource:P,type:j,vsContent:R}=(null==p?void 0:null===(t=p.webRawData)||void 0===t?void 0:t.anchorCardInfo)||{},M={dependOnPlayer:!0,title:N,description:L,targetHref:E,imgSrc:T,onShow:()=>null,onClick:()=>null,target:"_self"},D={group_id:null==p?void 0:p.awemeId,enter_from:(0,s.yW)(),type:""};switch(null==p?void 0:null===(r=p.webRawData)||void 0===r?void 0:null===(l=r.anchorCardInfo)||void 0===l?void 0:l.source){case"pc_movie_father":M.hidden=(null==h?void 0:h.showMovie)!==1,M.className="",M.target="_blank",M.targetHref+=`?previous_page=${(0,s.yW)()}`,D.type="movie",M.onShow=()=>{g.sendLog("videoAnchorShow",D)};break;case"variety":M.hidden=!E||(null==R?void 0:null===(u=R.user_statistics)||void 0===u?void 0:u.watch_ratio)>.9,D=(0,i._)((0,n._)({},D),{type:"vs",is_vs:1,author_id:null==R?void 0:null===(v=R.owner_user_id)||void 0===v?void 0:null===(d=v.c)||void 0===d?void 0:d.map(e=>`${e}`).join(""),vs_season_id:null==R?void 0:R.season_id_str,vs_episode_id:null==R?void 0:R.episode_id_str,room_id:"",vs_ep_group_id:null==R?void 0:R.item_id,vs_episode_stage:["unknown","live","premiere","record"][(null==R?void 0:null===(m=R.episode_type)||void 0===m?void 0:m.episode_stage)||0],vs_episode_type:["unknown","formal","special"][(null==R?void 0:null===(f=R.episode_type)||void 0===f?void 0:f.episode_type)||0],vs_episode_sub_type:["unknown","normal","latest","pilot_file"][(null==R?void 0:null===(_=R.episode_type)||void 0===_?void 0:_.episode_sub_type)||0],vs_play_status:"",vs_is_portraid_content:""}),M.alinkProps={target:"_blank"},M.target="_blank",M.type="variety",M.onShow=()=>{var e,t,l;g.sendLog("videoAnchorShow",D),g.sendLog("vsVideoShow",{enter_from_merge:(0,s.yW)(),enter_method:"video_anchor_module",previous_page:(0,c.z)("web_link"),action_type:"click",is_vs:1,vs_season_id:null==R?void 0:R.season_id_str,vs_episode_id:null==R?void 0:R.episode_id_str,room_id:"",vs_ep_group_id:null==R?void 0:R.item_id,vs_episode_stage:["unknown","live","premiere","record"][(null==R?void 0:null===(e=R.episode_type)||void 0===e?void 0:e.episode_stage)||0],vs_episode_type:["unknown","formal","special"][(null==R?void 0:null===(t=R.episode_type)||void 0===t?void 0:t.episode_type)||0],vs_episode_sub_type:["unknown","normal","latest","pilot_file"][(null==R?void 0:null===(l=R.episode_type)||void 0===l?void 0:l.episode_sub_type)||0],vs_play_status:"",vs_is_portraid_content:""})}}M.onClick=()=>{g.sendLog("videoAnchorClick",D)};let{imgSrc:A,hidden:Z=!0}=M;return(0,a.useEffect)(()=>{var e;return null==x||null===(e=x.on)||void 0===e||e.call(x,"titleIsFold",b),()=>{var e;null==x||null===(e=x.off)||void 0===e||e.call(x,"titleIsFold",b)}},[]),(0,a.useEffect)(()=>{I.current=A},[A]),(0,o.jsx)(o.Fragment,{children:Z||I.current!==A||!y?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(k,(0,i._)((0,n._)({},M),{cardHidden:C,player:x}))})}let C=e=>{let t=(0,x.N)();return(0,o.jsx)(y.k,{componentName:"ProgramCard",Slardar:t,children:(0,o.jsx)(I,(0,n._)({},e))})}},720820:function(e,t,l){l.d(t,{Z:function(){return p}}),l("612222");var n=l("259202"),i=l("611542"),o=l("825211"),a=l.n(o),r=l("245086"),u=l("713017"),d=l("462609"),s=l("243184"),c=l("940869"),v=l("354795"),m=new v.h({hover_share_icon:{eventName:"hover_share_icon",params:{enter_from:""}}}),f=l("8138"),g=l("946313"),_=l("456713");function p(e){var t,l;let{ableMiniType:o,disableShare:v=!1,type:p,canAnimation:h,awemeInfo:y,abtestData:w,scene:x,alienatedIcon:k}=e,[I,C]=(0,i.useState)(!1),S=null==w?void 0:w.reduceLottie,b=(0,i.useRef)(null),L=(0,i.useRef)(null),N=(0,i.useCallback)(()=>{S&&C(!0)},[S]),E=(0,i.useCallback)(()=>{m.sendLog("hover_share_icon",{enter_from:(0,r.mo)()})},[]),T=()=>{var e,t;let l=null===(t=L.current)||void 0===t?void 0:null===(e=t.getLottieInstance)||void 0===e?void 0:e.call(t);return{enter:()=>{var e;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[0,33],!0)},leave:()=>{var e;null==l||null===(e=l.playSegments)||void 0===e||e.call(l,[62,86],!0)}}};(0,i.useEffect)(()=>{if(v)return;let e=b.current,t=()=>{var e,t;null===(e=(t=T()).enter)||void 0===e||e.call(t)},l=()=>{var e,t;null===(e=(t=T()).leave)||void 0===e||e.call(t)};return null==e||e.addEventListener("mouseenter",t),null==e||e.addEventListener("mouseleave",l),()=>{null==e||e.removeEventListener("mouseenter",t),null==e||e.removeEventListener("mouseleave",l)}},[]);let P=(0,i.useMemo)(()=>{let e=(0,n.jsx)(_.z,{svg:(0,n.jsx)(s.Z,{}),className:c.default.shareSvg}),t=(0,n.jsx)(f.default,{ref:L,data:d,loop:!1,autoplay:!1});return(0,u.b_)()||"user"===x?e:S&&!I?e:t},[w,I]);return(0,n.jsxs)("div",{className:a()(c.default.share,c.default[p],{[c.default.ableMiniType]:o,[c.default.disable]:v,[c.default.inVideo]:"video"===x}),ref:b,"data-e2e":"video-player-share",onMouseEnter:N,onMouseLeave:E,children:[(0,n.jsx)("div",{className:c.default.animationWrap,children:(0,n.jsxs)("div",{className:a()(c.default.iconWrap,c.default[p]),children:[k,P]})}),"user"!==x&&(0,n.jsx)("div",{className:c.default.count,children:(0,g.A)({count:null!==(l=null==y?void 0:null===(t=y.stats)||void 0===t?void 0:t.shareCount)&&void 0!==l?l:0,displayWord:"分享"})})]})}},183062:function(e,t,l){l.r(t),l.d(t,{MenuListInner:function(){return F},MenuList:function(){return U}});var n=l("590921"),i=l("874155");l("612222"),l("482392"),l("347885");var o=l("259202"),a=l("611542"),r=l("825211"),u=l.n(r),d=l("866728"),s=l("623176"),c=l("690352"),v=l("697878"),m=l("135524"),f=l("877653"),g=l("510026"),_=l("288"),p=l("775583"),h=l("744611"),y=l("372866"),w=l("106649"),x=l("781114"),k=l("895184"),I=l("318086"),C=l("356789"),S=l("245086"),b=l("528557"),L=l("715500"),N=l("477509"),E=l("837305"),T=l("682795"),P=l("716255");let j=e=>{let{player:t,showContextMenu:l,awemeInfo:n,hideContextMenu:i,containerStatus:o}=e;(0,a.useEffect)(()=>{if(t){var e;let n=(0,P.H)(t),o=e=>{var n,i;(null==t?void 0:null===(i=t.video)||void 0===i?void 0:null===(n=i.parentElement)||void 0===n?void 0:n.contains(null==e?void 0:e.target))&&l(e)};return null===(e=t.root)||void 0===e||e.addEventListener("contextmenu",o,!0),null==n||n.addEventListener("contextmenu",l),document.addEventListener("click",i,!0),()=>{var e;null===(e=t.root)||void 0===e||e.removeEventListener("contextmenu",o,!0),document.removeEventListener("click",i,!0),null==n||n.removeEventListener("contextmenu",l)}}},[t,n,l]),(0,a.useEffect)(()=>{if(o)return o.addEventListener("contextmenu",l),()=>{o.removeEventListener("contextmenu",l)}},[o,l])};var R=l("143082"),M=l("401310"),D=l("935708"),A=l("701007"),Z=l("773627"),W=l("227959");d.Z.extend([{LANG:"zh",TEXT:{FULLSCREEN_TIPS:`${w.a.t("full_screen",{},"进入全屏")}<span class="shortcutKey">H</span>`,EXITFULLSCREEN_TIPS:`${w.a.t("full_screen_exit",{},"退出全屏")}<span class="shortcutKey">H</span>`}}]);let F=e=>{let{isActive:t=!1,shortcutDisable:l,shortcutInclude:r,shortcutExclude:d,awemeInfo:w,shortCutFiltered:P=[],showEnterDetail:D=!1,showAdMenu:Z=!1,modalEnterFrom:F,userInfo:U,abtestData:B,directJumpToUser:O}=e,z=(0,M.n)(),{awemeId:H}=w||{},[V,K]=(0,a.useState)(!1),[$,Y]=(0,a.useState)({x:0,y:0}),[G,q]=(0,a.useState)(null),Q=(0,a.useRef)(null),X=(0,a.useMemo)(()=>v.getShortcut({disable:l,include:r,exclude:d}),[l,r,d]),J=e=>{var t;if(!(e&&(null===(t=Q.current)||void 0===t?void 0:t.contains(e.target))))K(!1)},ee=(0,a.useCallback)(()=>{var e,t;let l=(null==w?void 0:w.awemeType)===m.e.XgVideo?(0,x.GN)(null==w?void 0:null===(e=w.authorInfo)||void 0===e?void 0:e.uid):(0,x.HC)(null==w?void 0:null===(t=w.authorInfo)||void 0===t?void 0:t.secUid,(0,c.stringify)({is_full_screen:(0,k.r)()?"1":"0",enter_method:"video_title",from_gid:w.groupId,vid:null==w?void 0:w.awemeId}));window.open(l,(0,I.f)()?"_self":"_blank","noopener")},[w]),et=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("feedback"===e&&C.emit(C.EVENT.showFeedback),"enterDetail"===e&&C.emit(C.EVENT.videoPause),"showComment"===e&&"video_detail"===(0,S.yW)()&&!(0,k.r)()&&C.emit(C.EVENT.commentFocus),"downloadVideo"===e&&(C.emit(C.EVENT.downloadVideo,w),N.i.sendLog("download",{enter_from:(0,S.mo)(),enter_from_merge:(0,S.vM)(),group_id:null==w?void 0:w.awemeId,click_from:"right_click"})),"createMultitaskingWindow"===e){let e=t;"string"==typeof e&&e.startsWith("//")?e=`https:${t}`:"string"==typeof e&&e.startsWith("/video")&&(e=`https://www.douyin.com${t}`),(0,b.qQ)(E.LocalStorageKeys.MultiWindowMenuListRedDot,1),(0,W.handleCreateMultitaskWindow)(B,e,"right_click_menu",!0)}O&&"onAvatar"===e?ee():null==z||z.emit(e,t),K(!1)},[z,w,ee,B,O]);(0,a.useEffect)(()=>{if(O&&z)return z.on("onAvatar",ee),()=>{z.off("onAvatar",ee)}},[ee,z,O]);let{menuList:el,adMenuList:en}=(0,R._)({shortcut:X,emitEvent:et,position:$,showEnterDetail:D,setIsShow:K,awemeInfo:w,userInfo:U,modalEnterFrom:F,abtestData:B}),ei=(0,a.useMemo)(()=>(Z?en:el).filter(e=>!P.includes(e.key)),[Z,en,el,P]),eo=e=>{switch(!0){case!!e.link:return(0,a.createElement)(A.a,(0,i._)((0,n._)({},e.link),{className:T.default.itemText,key:e.text}),e.text);case!!e.component:return e.component;default:return(0,o.jsxs)("div",{className:T.default.contextMenuItem,onClick:e.handler,children:[(0,o.jsx)("div",{className:T.default.itemText,children:e.text}),e.key&&(0,o.jsxs)("div",{className:T.default.itemTip,children:["（",e.key,"）"]}),e.useRedDot&&(0,R.H)(e.redDotKey)&&(0,o.jsx)("div",{className:u()(T.default.itemRedDotBox,{[T.default.itemMarginLeft]:!e.key}),children:(0,o.jsx)("div",{className:T.default.itemRedDot})})]},e.text)}};(0,a.useEffect)(()=>{J()},[H,t]),(0,a.useEffect)(()=>{null==z||z.on(s.FULLSCREEN_CHANGE,J);let e=C.listen(C.EVENT.pageFullScreen,()=>{J()});return()=>{null==z||z.off(s.FULLSCREEN_CHANGE,J),null==e||e()}},[z]);let ea=(0,a.useCallback)(e=>{e.preventDefault();let{width:t,height:l,left:n,right:i,top:o,bottom:a}=z.root.getBoundingClientRect();if(Q.current&&Q.current.contains(e.target))return;let r=Q.current?Q.current.clientWidth:224,u=Q.current?Q.current.clientHeight:26*ei.length+32-6,d=(null==e?void 0:e.clientX)+r>i?(null==e?void 0:e.clientX)-r-n:(null==e?void 0:e.clientX)-n;if(Y({x:d,y:(null==e?void 0:e.clientY)+u>a?(null==e?void 0:e.clientY)-u-o:(null==e?void 0:e.clientY)-o}),K(!0),(0,f.AI)(w)||(0,g.L)(w)||(0,_.u)(w)){let e=(0,p.Rx)(w);(0,h.E)("othershow",{tag:(0,L.f)(),value:e.creative_id,log_extra:e.log_extra,refer:"feedback"})}},[z,w,Q,ei]);return j({player:z,showContextMenu:ea,awemeInfo:w,hideContextMenu:J,containerStatus:G}),V?(0,o.jsx)("div",{className:T.default.container,ref:q,children:(0,o.jsx)("div",{className:u()(T.default.contextMenuContainer,{[T.default.isAd]:(0,f.AI)(w)||(0,y.o4)(w)||(0,g.L)(w)||(0,_.u)(w)}),style:{top:$.y,left:$.x},ref:Q,children:ei.map(e=>eo(e))})}):(0,o.jsx)("div",{})},U=e=>{let t=(0,D.N)();return(0,o.jsx)(Z.k,{componentName:"MenuList",Slardar:t,children:(0,o.jsx)(F,(0,n._)({},e))})}},604601:function(e,t,l){l.r(t),l.d(t,{SettingList:function(){return em},SettingListInner:function(){return ev},SettingPlugin:function(){return es}});var n=l("590921"),i=l("874155");l("612222"),l("677546"),l("227470");var o=l("259202"),a=l("611542"),r=l("753451"),u=l("185791"),d=l("825211"),s=l.n(d),c=l("837305"),v=l("829833"),m=l("245086"),f=l("945363"),g=l("819769"),_=l("713017"),p=l("356789"),h=l("296955"),y=l("237339"),w=l("432097"),x=l("426852"),k=l("995798"),I=l("137180"),C=l("797210");let S=e=>{let{autoPlayInit:t,player:l,isActive:n,logFn:i}=e,[r,u]=(0,a.useState)(t),d=(0,a.useCallback)(()=>{i("auto_play");let e={switchBy:I.l7.Shortcut,logParams:{enter_method:"play_setting_panel"}};null==l||l.emit(C.B.UpdateAutoPlaySwitch,e),(0,x.hB)()},[l,i]);return(0,a.useEffect)(()=>{let e=()=>{u(e=>!e)};if(l&&n)return null==l||l.on(C.B.UpdateAutoPlaySwitch,e),()=>{null==l||l.off(C.B.UpdateAutoPlaySwitch,e)}},[l,n]),(0,o.jsxs)("div",{className:k.default.switchBox,children:[(0,o.jsx)("div",{className:k.default.switchLabel,children:"连播"}),(0,o.jsx)(w.rs,{checked:r,onChange:d})]})},b=e=>{let{isOnInit:t,player:l,isActive:n,logFn:i}=e,[r,u]=(0,a.useState)(!!t),d=(0,a.useCallback)(()=>{null==l||l.emit(C.B.UpdateImmersiveSwitch,{logParams:{enter_method:"play_setting_panel"}}),(0,x.hB)(),i("pure_mode")},[l]);return(0,a.useEffect)(()=>{let e=()=>{u(e=>!e)};if(l&&n)return null==l||l.on(C.B.UpdateImmersiveSwitch,e),()=>{null==l||l.off(C.B.UpdateImmersiveSwitch,e)}},[l,n]),(0,o.jsxs)("div",{className:k.default.switchBox,children:[(0,o.jsx)("div",{className:k.default.switchLabel,children:"清屏"}),(0,o.jsx)(w.rs,{checked:r,onChange:d})]})};var L=l("928300"),N=l("456713");let E=e=>{let{onChange:t,logFn:l}=e;return(0,o.jsxs)("div",{className:k.default.switchBox,onClick:()=>{null==t||t(),null==l||l("auto_play")},children:[(0,o.jsx)("div",{className:k.default.switchLabel,children:"连播"}),(0,o.jsx)("div",{className:k.default.select,children:(0,o.jsx)(N.z,{svg:(0,o.jsx)(L.Z,{className:"noTransform"}),className:"noTransform",style:{fontSize:"12px",display:"flex",alignItems:"center"}})})]})};var T=l("354795"),P=new T.h({clickHoverLogin:{eventName:"click_hover_login",params:{enter_method:"",enter_from:"",params_for_special:""}}}),j=l("721027"),R=l("312750");let M=(e,t,l)=>{let n=R.SELECT_LIST_MAP[l].find(t=>Number(t)===Number(e));return t&&void 0!==n?`${n}x`:"倍速"},D=e=>{let{playbackRate:t,hasSelect:l,onChange:n,disable:i,logFn:r,player:u,disableSpeed:d,setIsShowPlayBackRatio:c,speedType:v}=e,[f,g]=(0,a.useState)(t);return(0,j.u)(u,C.B.ChangePlayRate,e=>{let{rate:t}=e;g(t)}),(0,a.useEffect)(()=>{g(t)},[t]),(0,o.jsxs)("div",{className:s()(k.default.switchBox,{[k.default.disable]:i}),onClick:()=>{if(!i){if(d){P.sendLog("clickHoverLogin",{enter_method:"speed_up",enter_from:(0,m.yW)(),params_for_special:"uc_login"}),p.emit(p.EVENT.loginBlockKeyBoard,{speed:!0,callback:()=>{null==n||n(),null==r||r("speed"),setTimeout(()=>{c(!1)},3e3)}});return}null==n||n(),null==r||r("speed")}},children:[(0,o.jsx)("div",{className:k.default.switchLabel,children:"倍速"}),(0,o.jsx)("div",{className:k.default.select,children:!d||i?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:i?"1.0x":M(f,l,v)}),(0,o.jsx)(N.z,{svg:(0,o.jsx)(L.Z,{className:"noTransform"}),className:"noTransform",style:{fontSize:"12px",display:"flex",alignItems:"center"}})]}):(0,o.jsx)(w.zx,{theme:"solid",className:k.default.loginBtn,children:"登录即享"})})]})};var A=l("877439");let Z=e=>{let{onChange:t,logFn:l}=e,{currentState:[n]}=(0,A.Jy)(e);return(0,o.jsxs)("div",{className:k.default.switchBox,onClick:()=>{null==t||t(),null==l||l("clarity")},children:[(0,o.jsx)("div",{className:k.default.switchLabel,children:"清晰度"}),(0,o.jsxs)("div",{className:k.default.select,children:[(0,o.jsx)("div",{children:n}),(0,o.jsx)(N.z,{svg:(0,o.jsx)(L.Z,{className:"noTransform"}),className:"noTransform",style:{fontSize:"12px",display:"flex",alignItems:"center"}})]})]})};var W=l("688497"),F=l("983107"),U=l("160551"),B=new T.h({clarityNotifyShow:{eventName:"clarity_notify_show",params:{group_id:"",clarity:"",is_auto:1,gear_name:""}},clarityNotifyClick:{eventName:"clarity_notify_click",params:{group_id:"",action:"",clarity:"",is_auto:1,gear_name:""}},clarityCellShow:{eventName:"clarity_cell_show",params:{group_id:"",clarity:"",is_auto:1,gear_name:""}},clarityCellClick:{eventName:"clarity_cell_click",params:{group_id:"",action:"",clarity:"",is_auto:1,gear_name:"",enter_from_merge:"",enter_from:"",item_duration_ms:0}},clarityBubbleShow:{eventName:"clarity_bubble_show",params:{group_id:"",clarity:"",is_auto:1,method:"",gear_name:""}}}),O=l("41115");let z=e=>{B.sendLog("clarityCellShow",(0,n._)({},e))},H=e=>{let{awemeInfo:t,onMouseLeave:l,player:r,userInfo:u,lists:d,indexSelected:c,setIndexSelected:v,setCurrentState:m}=e,f=(0,W.x)(z.bind(null,(0,i._)((0,n._)({group_id:null==t?void 0:t.awemeId},(0,U.t)()),{enter_method:"play_setting_panel"}))),g=(0,a.useCallback)(e=>{var t;null==r||r.emit(C.B.UpdateClarity,{item:e,logParams:{enter_method:"play_setting_panel"}}),v(e.key),null==m||m(e.label),null==l||l(),p.emit(null==p?void 0:null===(t=p.EVENT)||void 0===t?void 0:t.clarityRel,{exitInner:!0})},[r,l]);return(0,o.jsxs)("div",{ref:f,className:s()(O.default.panel,"clarityPanel",{[O.default.notLogin]:!(null==u?void 0:u.isLogin)}),children:[(0,o.jsxs)("div",{className:O.default.title,children:[(0,o.jsx)(N.z,{onClick:l,svg:(0,o.jsx)(F.Z,{}),style:{marginRight:"4px",fontSize:"12px",height:"12px"}}),(0,o.jsx)("span",{children:"清晰度"})]}),(0,o.jsx)("div",{className:O.default.virtual,children:null==d?void 0:d.map(e=>(0,o.jsx)("div",{className:s()(O.default.item,{[O.default.selected]:e.key===c}),onClick:()=>g(e),children:e.val},e.key))})]})};function V(e){let{player:t,ratio:l,awemeInfo:n,logParams:i,onMouseLeave:r,speedType:u}=e,[d,c]=(0,a.useState)(l),v=e=>{null==t||t.emit(C.B.UpdateRadio,{rate:e,click_method:"play_setting_panel"}),c(Number(e)),null==r||r()};return(0,j.u)(t,C.B.ChangePlayRate,()=>{null==r||r()}),(0,o.jsxs)("div",{className:O.default.panel,children:[(0,o.jsxs)("div",{className:O.default.title,children:[(0,o.jsx)(N.z,{onClick:r,svg:(0,o.jsx)(F.Z,{}),style:{marginRight:"4px",fontSize:"12px",height:"12px"}}),(0,o.jsx)("span",{children:"倍速"})]}),(0,o.jsx)("div",{className:O.default.virtual,children:R.SELECT_LIST_MAP[u].map(e=>(0,o.jsxs)("div",{className:s()(O.default.item,{[O.default.selected]:Number(d)===Number(e)}),onClick:()=>v(Number(e)),children:[e,"x"]},e))})]})}var K=l("673434"),$=l("710046"),Y=l("699233");function G(e){var t;let{player:l,onMouseLeave:n,isActive:i,aloneState:r,awemeInfo:u}=e,d=(0,a.useRef)(!0),[c,v]=(0,$.iu)({isSetLog:!0,awemeInfo:u,plugin:null==l?void 0:null===(t=l.getPlugin)||void 0===t?void 0:t.call(l,"InnerAutoPlayPlugin"),defaultModeRef:d,aloneState:r}),m=e=>{null==l||l.emit(C.B.UpdateAutoPlay,{index:e,logParams:{enter_method:"play_setting_panel"}}),v(e),null==n||n()};return(0,o.jsxs)("div",{className:K.default.panel,children:[(0,o.jsxs)("div",{className:K.default.title,children:[(0,o.jsx)(N.z,{onClick:n,svg:(0,o.jsx)(F.Z,{}),style:{marginRight:"4px",fontSize:"12px",height:"12px"}}),(0,o.jsx)("span",{children:"连播"})]}),(0,o.jsx)("div",{className:K.default.virtual,children:$.zQ.map((e,t)=>(0,o.jsxs)("div",{className:s()(K.default.innerItem,{[K.default.selected]:t===c}),onClick:()=>m(t),children:[(0,o.jsx)(Y.Z,{width:24,height:24,viewBox:"0 0 24 24",src:$.zf[t],onMouseEnter:()=>{}}),(0,o.jsx)("span",{children:e})]},e))})]})}var q=new T.h({playSettingPanelShow:{eventName:"play_setting_panel_show",params:{enter_from_merge:"",enter_from:""}},playSettingPanelClick:{eventName:"play_setting_panel_click",params:{enter_from_merge:"",enter_from:"",click_position:""}},playSettingIconShow:{eventName:"play_setting_icon_show",params:{enter_from_merge:"",enter_from:"",icon:""}}}),Q=l("91404"),X=l("458463"),J=l("401310"),ee=l("935708"),et=l("773627"),el=l("374999"),en=l("234766"),ei=l("351582"),eo=l("208960"),ea=l("769609");let er=new Map([[X.p.AutoPlayer,e=>(0,o.jsx)(S,(0,n._)({},e))],[X.p.Clear,e=>(0,o.jsx)(b,(0,n._)({},e))],[X.p.InnerAutoPlayer,e=>(0,o.jsx)(E,(0,n._)({},e))],[X.p.PlayBackRatio,e=>(0,o.jsx)(D,(0,n._)({},e))],[X.p.FakeScreen,e=>(0,o.jsx)(Z,(0,n._)({},e))],[X.p.WatchLater,e=>(0,o.jsx)(Q.nf,(0,i._)((0,n._)({},e),{isMini:!0}))]]),eu=()=>{q.sendLog("playSettingPanelShow",{enter_from_merge:(0,m.yW)(),enter_from:(0,m.vM)()})},ed=e=>{q.sendLog("playSettingPanelClick",{enter_from_merge:(0,m.yW)(),enter_from:(0,m.vM)(),click_position:e})},es=e=>{var t,l,r,u,d,m,w,x,k,C;let{hideList:S,awemeInfo:b,player:L,isActive:E,userInfo:T,dispatch:P,abtestData:j,isAdAweme:R,search33PxUnify:M}=e,[D,Z]=(0,a.useState)(!0),[W,F]=(0,a.useState)(!1),[U,B]=(0,a.useState)(!1),[O,z]=(0,a.useState)(!1),K=(0,a.useRef)(!1),$=(0,a.useRef)(null),Y=(0,a.useRef)(null),q=new Map([[X.p.AutoPlayer,{autoPlayInit:(null===(l=L.getPlugin(I.JI.pluginName))||void 0===l?void 0:null===(t=l.config)||void 0===t?void 0:t.nextAutoPlay)||!1,player:L,isActive:E,logFn:ed}],[X.p.Clear,{isOnInit:(null===(u=L.getPlugin(el.Yd.pluginName))||void 0===u?void 0:null===(r=u.config)||void 0===r?void 0:r.isOn)||!1,player:L,isActive:E,logFn:ed}],[X.p.InnerAutoPlayer,{onChange:()=>{Z(!0),z(!0)},logFn:ed}],[X.p.PlayBackRatio,{onChange:()=>{Z(!0),B(!0)},setIsShowPlayBackRatio:B,hasSelect:null!==(0,f.G)(c.SessionStorageKeys.PlayerPlaybackratio),playbackRate:(0,f.G)(c.SessionStorageKeys.PlayerPlaybackratio)||1,disable:R,logFn:ed,player:L,disableSpeed:g.Le.getConfig(g.gI.disableSpeed),speedType:(0,_.G6)()?v.$.Safari:v.$.Normal}],[X.p.FakeScreen,{onChange:()=>{Z(!0),F(!0)},userInfo:T,abtestData:j,awemeInfo:b,currentDefinition:null==L?void 0:null===(w=L.getPlugin)||void 0===w?void 0:null===(m=w.call(L,"bitrateselector"))||void 0===m?void 0:null===(d=m.curBitRate)||void 0===d?void 0:d.definition,userSelectDefinition:null==L?void 0:L.config.userSelectDefinition,userSelectUpdate:null==L?void 0:L.config.userSelectUpdate,logFn:ed,player:L}],[X.p.WatchLater,{player:L,isActive:E,logFn:ed,awemeInfo:b,loginDispatch:P,isLogin:null==T?void 0:T.isLogin}]]),Q=(0,a.useCallback)(e=>{var t,l,n;if(!e.target.closest(".semi-portal"))clearTimeout(Y.current),((null==e?void 0:e.target)===(null==$?void 0:$.current)||(null==$?void 0:null===(t=$.current)||void 0===t?void 0:t.contains(null==e?void 0:e.target))||(null==e?void 0:e.target)===(null==L?void 0:null===(n=L.root)||void 0===n?void 0:null===(l=n.querySelector)||void 0===l?void 0:l.call(n,".setting-icon")))&&(Z(!1),eu()),!K.current&&(p.emit(p.EVENT.videoStopPlayNext),K.current=!0)},[]);(0,a.useEffect)(()=>()=>p.emit(p.EVENT.videoRemoveStopPlayNext),[]);let J=(0,ei.zJ)(b),{indexSelectedState:[ee,et],lists:en,swichStatus:es,currentState:[ec,ev]}=(0,A.Jy)(e),em=-1!==S.findIndex(e=>e[0]===X.p.FakeScreen),ef=(0,a.useRef)(null);return(0,o.jsxs)("div",{className:y.default.container,onMouseEnter:Q,ref:$,onMouseLeave:()=>{Y.current=setTimeout(()=>{Z(!0)},300),F(!1),B(!1),z(!1),p.emit(p.EVENT.videoRemoveStopPlayNext),K.current=!1},children:[D?null:(0,o.jsx)("div",{className:s()(y.default.panel,"semi-always-dark",{[y.default.search]:M}),children:S.map(e=>{let t=er.get(e[0]),l=q.get(e[0]);return null==t?void 0:t((0,i._)((0,n._)({},l),{key:e[0]}))})}),W&&(0,o.jsx)(H,{awemeInfo:b,userInfo:T,onMouseLeave:()=>{Z(!1),F(!1),Z(!0)},dispatch:P,player:L,isActive:E,currentDefinition:null==L?void 0:null===(C=L.getPlugin)||void 0===C?void 0:null===(k=C.call(L,"bitrateselector"))||void 0===k?void 0:null===(x=k.curBitRate)||void 0===x?void 0:x.definition,userSelectDefinition:null==L?void 0:L.config.userSelectDefinition,abtestData:j,userSelectUpdate:null==L?void 0:L.config.userSelectUpdate,lists:en,indexSelected:ee,setIndexSelected:et,setCurrentState:ev}),U&&(0,o.jsx)(V,{player:L,ratio:(0,f.G)(c.SessionStorageKeys.PlayerPlaybackratio)||1,awemeInfo:b,logParams:{},onMouseLeave:()=>{Z(!1),B(!1),Z(!0)},speedType:(0,_.G6)()?v.$.Safari:v.$.Normal}),O&&!J&&(0,o.jsx)(G,{onMouseLeave:()=>{Z(!1),z(!1)},player:L,isActive:E,aloneState:2,awemeInfo:b}),(0,o.jsx)(eo.A,{visible:es!==ea.N.Off&&em,current:ec,swichStatus:es,getPopupContainer:()=>ef.current,children:(0,o.jsx)("div",{className:y.default.iconContainer,ref:ef,children:(0,o.jsx)(N.z,{svg:(0,o.jsx)(h.Z,{className:"noTransform"}),className:"setting-icon"})})})]})};class ec extends u.ZP{static get pluginName(){return"SettingListPlugin"}static get defaultConfig(){return{position:r.POSITIONS.CONTROLS_RIGHT,index:10,className:"xgplayer-setting-list"}}afterCreate(){this.renderRoot()}destroy(){(0,en.v)(this)}renderRoot(){this.root&&(0,en.s)(this,(0,o.jsx)(es,(0,n._)({},this.config)))}render(){return'<xg-icon class="xgplayer-setting-list" data-state="normal"></xg-icon>'}}let ev=e=>{let{awemeInfo:t,hideList:l,userInfo:o}=e,r=(0,J.n)();return(0,a.useEffect)(()=>{if(r)return r.registerPlugin(ec,(0,i._)((0,n._)({},e),{player:r})),()=>{r.getPlugin("SettingListPlugin")&&r.unRegisterPlugin("SettingListPlugin",!0)}},[r,t,l,o]),null},em=e=>{let t=(0,ee.N)();return(0,o.jsx)(et.k,{componentName:"SettingListPlugin",Slardar:t,children:(0,o.jsx)(ev,(0,n._)({},e))})}},168354:function(e,t,l){var n=l(590921),i=l(874155),o=l(259202),a=l(611542);let r=(0,a.forwardRef)((e,t)=>(0,o.jsx)("svg",(0,i._)((0,n._)({width:36,height:36,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),{children:(0,o.jsx)("path",{d:"M10 10.693c0-1.7 0-2.549.354-3.013A1.729 1.729 0 0 1 11.64 7c.582-.03 1.284.45 2.687 1.409l9.697 6.63c1.097.75 1.646 1.126 1.843 1.598.172.414.177.878.014 1.296-.187.476-.727.863-1.808 1.638l-9.697 6.945c-1.413 1.013-2.12 1.52-2.71 1.498a1.728 1.728 0 0 1-1.305-.67C10 26.877 10 26.007 10 24.268V10.693z",fill:"#0A0C20"})})));t.Z=r}}]);