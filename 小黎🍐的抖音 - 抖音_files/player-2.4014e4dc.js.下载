/*! For license information please see player-2.4014e4dc.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).xss={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,t,r){if(r||2==arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var n=/[^a-zA-Z0-9\\_:.-]/gim,i=/</g,o=/>/g,a=/&#([a-zA-Z0-9]*);?/gim,s=/&quot;/g,u=/&colon;?/gim,c=/&newline;?/gim,l=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,d=/u\s*r\s*l\s*\(.*/gi,f=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,h=/"/g,g=function(e){return e.replace(i,"&lt;").replace(o,"&gt;")},v={indexOf:function(e,t){var r,n;for(r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return -1},forEach:function(e,t,r){var n,i;for(n=0,i=e.length;n<i;n++)t.call(r,e[n],n,e)},some:function(e,t,r){var n,i;for(n=0,i=e.length;n<i;n++)if(t.call(r,e[n],n,e))return!0;return!1},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},includes:function(e,t){if("string"==typeof e)return -1!==e.indexOf(t);for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1},uniq:function(e){for(var t={},r=[],n=0;n<e.length;n++)t[e[n]]||(r.push(e[n]),t[e[n]]=!0);return r},from:function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t},keys:function(e){var t=[];for(var r in e)t.push(r);return t}};function p(e){return null==e}function _(e){var t;return'"'===(t=e)[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]?e.substr(1,e.length-2):e}function y(e){var t,r,n,i,o,a,s,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",l=0;for(e=function(e){e=e.replace(/rn/g,"n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t+=String.fromCharCode(n):n>127&&n<2048?t+=String.fromCharCode(n>>6|192)+String.fromCharCode(63&n|128):t+=String.fromCharCode(n>>12|224)+String.fromCharCode(n>>6&63|128)+String.fromCharCode(63&n|128)}return t}(e);l<e.length;)i=(t=e.charCodeAt(l++))>>2,o=(3&t)<<4|(r=e.charCodeAt(l++))>>4,a=(15&r)<<2|(n=e.charCodeAt(l++))>>6,s=63&n,isNaN(r)?a=s=64:isNaN(n)&&(s=64),c=c+u.charAt(i)+u.charAt(o)+u.charAt(a)+u.charAt(s);return c}function m(e){var t,r,n,i,o,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");c<e.length;)t=s.indexOf(e.charAt(c++))<<2|(i=s.indexOf(e.charAt(c++)))>>4,r=(15&i)<<4|(o=s.indexOf(e.charAt(c++)))>>2,n=(3&o)<<6|(a=s.indexOf(e.charAt(c++))),u+=String.fromCharCode(t),64!==o&&(u+=String.fromCharCode(r)),64!==a&&(u+=String.fromCharCode(n));return function(e){for(var t="",r=0,n=0,i=0,o=0;r<e.length;)(n=e.charCodeAt(r))<128?(t+=String.fromCharCode(n),r++):n>191&&n<224?(t+=String.fromCharCode((31&n)<<6|63&(o=e.charCodeAt(r+1))),r+=2):(o=e.charCodeAt(r+1),t+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&(i=e.charCodeAt(r+2))),r+=3);return t}(u)}function C(e,t,r){var n="",i=0,o=!1,a=!1,s=0,u=e.length,c="",l="";e:for(s=0;s<u;s++){var d=e.charAt(s);if(!1===o){if("<"===d){o=s;continue}}else if(!1===a){if("<"===d){n+=r(e.slice(i,s)),o=s,i=s;continue}if(">"===d||s===u-1){n+=r(e.slice(i,o)),c=function(e){var t,r=v.spaceIndex(e);return t=-1===r?e.slice(1,-1):e.slice(1,r+1),"/"===(t=v.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}(l=e.slice(o,s+1)),n+=t(o,n.length,c,l,"</"===l.slice(0,2)),i=s+1,o=!1;continue}if('"'===d||"'"===d)for(var f=1,h=e.charAt(s-f);""===h.trim()||"="===h;){if("="===h){a=d;continue e}h=e.charAt(s-++f)}}else if(d===a){a=!1;continue}}return i<u&&(n+=r(e.substr(i))),n}function b(e,t){var r=0,i=0,o=[],a=!1,s=e.length;function u(e,r){if(!((e=(e=v.trim(e)).replace(n,"").toLowerCase()).length<1)){var i=t(e,r||"");i&&o.push(i)}}for(var c=0;c<s;c++){var l=e.charAt(c),d=void 0;if(!1!==a||"="!==l){if(!1===a||c!==i){if(/\s|\n|\t/.test(l)){if(e=e.replace(/\s|\n|\t/g," "),!1===a){if(-1===(d=function(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"="===r?t:-1}return -1}(e,c))){u(v.trim(e.slice(r,c))),a=!1,r=c+1;continue}c=d-1;continue}if(-1===(d=function(e,t){for(;t>0;t--){var r=e[t];if(" "!==r)return"="===r?t:-1}return -1}(e,c-1))){u(a,_(v.trim(e.slice(r,c)))),a=!1,r=c+1;continue}}}else{if(-1===(d=e.indexOf(l,c+1)))break;u(a,v.trim(e.slice(i+1,d))),a=!1,r=(c=d)+1}}else a=e.slice(r,c),r=c+1,i='"'===e.charAt(r)||"'"===e.charAt(r)?r:function(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"'"===r||'"'===r?t:-1}return -1}(e,c+1)}return r<e.length&&(!1===a?u(e.slice(r)):u(a,_(v.trim(e.slice(r))))),v.trim(o.join(" "))}function A(e,t,r){if(r=function(e){return e=function(e){for(var t="",r=0,n=e.length;r<n;r++)t+=32>e.charCodeAt(r)?" ":e.charAt(r);return v.trim(t)}(e=(e=(e=e.replace(s,'"')).replace(a,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})).replace(u,":").replace(c," "))}(r),"href"===t||"src"===t){if("#"===(r=v.trim(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"data:image/"!==r.substr(0,11)&&"ftp://"!==r.substr(0,6)&&"./"!==r.substr(0,2)&&"../"!==r.substr(0,3)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===t){if(l.lastIndex=0,l.test(r))return""}else if("style"===t&&(f.lastIndex=0,f.test(r)||(d.lastIndex=0,d.test(r)&&(l.lastIndex=0,l.test(r)))))return"";return r=function(e){return e=g(e=e.replace(h,"&quot;"))}(r)}var k=function(e){return"string"==typeof e?e.replace(/'/g,'"').replace('=""',"").replace(/\s+/g,"").toLowerCase():""},S=function(){function e(e){var t=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{});t.stripIgnoreTag&&(t.onIgnoreTag,t.onIgnoreTag=function(){return""}),t.whiteList={},t.onTag=function(){},t.onTagAttr=function(){},t.onIgnoreTag=function(){},t.onIgnoreTagAttr=function(){},t.safeAttrValue=A,t.escapeHtml=g,this.options=Object.assign(t,e)}return e.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t,r,n,i,o,a,s=this.options,u=s.whiteList,c=s.onTag,l=s.onIgnoreTag,d=s.onTagAttr,f=s.onIgnoreTagAttr,h=s.safeAttrValue,g=s.escapeHtml;s.stripBlankChar&&(e=(t=(t=e.split("")).filter(function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)})).join("")),s.allowCommentTag||(e=function(e){for(var t="",r=0;r<e.length;){var n=e.indexOf("\x3c!--",r);if(-1===n){t+=e.slice(r);break}t+=e.slice(r,n);var i=e.indexOf("--\x3e",n);if(-1===i)break;r=i+3}return t}(e));var p=!1;s.stripIgnoreTagBody&&(r=s.stripIgnoreTagBody,"function"!=typeof(n=l)&&(n=function(){}),i=!Array.isArray(r),o=[],a=!1,l=(p={onIgnoreTag:function(e,t,s){var u;if(u=e,i||-1!==v.indexOf(r,u)){if(s.isClosing){var c="[/removed]",l=s.position+c.length;return o.push([!1!==a?a:s.position,l]),a=!1,c}return a||(a=s.position),"[removed]"}return n(e,t,s)},remove:function(e){var t="",r=0;return v.forEach(o,function(n){t+=e.slice(r,n[0]),r=n[1]}),t+=e.slice(r)}}).onIgnoreTag);var _=C(e,function(e,t,r,n,i){var o={sourcePosition:e,position:t,isClosing:i,isWhite:Object.prototype.hasOwnProperty.call(u,r)},a=c(r,n,o);if(null!=a)return a;if(o.isWhite){if(o.isClosing)return"</".concat(r,">");var s=function(e){var t=v.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=v.trim(e.slice(t+1,-1)))[e.length-1];return r&&(e=v.trim(e.slice(0,-1))),{html:e,closing:r}}(n),p=u[r],_=b(s.html,function(e,t){var n=-1!==v.indexOf(p,e),i=d(r,e,t,n);return null==i?n?(t=h(r,e,t,null))?"".concat(e,'="').concat(t,'"'):e:null==(i=f(r,e,t,n))?void 0:i:i});return n="<".concat(r),_&&(n+=" ".concat(_)),s.closing&&(n+=" /"),n+=">"}return null==(a=l(r,n,o))?g(n):a},g);return p&&(_=p.remove(_)),_},e}(),I=Function("\nvar _checkXSS = function (it) {\n  return it && it.Math == Math && it;\n};\nreturn _checkXSS(typeof globalThis === 'object' && globalThis) ||\n_checkXSS(typeof window === 'object' && window) ||\n_checkXSS(typeof self === 'object' && self) ||\n_checkXSS(typeof global === 'object' && global) ||\nFunction('return this')();\n")(),T=new(function(){function e(){var e=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var t,r,n="douyin_web";if(!v.includes(n,"bid"))return n;if(e.config&&e.config.bid)return e.config.bid;if(I&&I._xssBid)return I._xssBid;if(I&&I.slardar&&"function"==typeof I.slardar.config){var i=(I.slardar.config()||{}).bid;if(i)return i}if(I&&I.Slardar&&"function"==typeof I.Slardar.config){var o=(I.Slardar.config()||{}).bid;if(o)return o}return(null===(r=null===(t=null==I?void 0:I.Slardar)||void 0===t?void 0:t._baseParams)||void 0===r?void 0:r.bid)||"argus"},this.getConfigRegion=function(){var t;return v.includes("cn","region")?e.config&&e.config.region?e.config.region:((null===(t=null==I?void 0:I.gfdatav1)||void 0===t?void 0:t.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=function(){var t={cn:m("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boe:m("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),ttp:m("aHR0cHM6Ly9tb24udXMudGlrdG9rdi5jb20vbW9uaXRvcl9icm93c2VyL2NvbGxlY3QvYmF0Y2gvc2VjdXJpdHkvP2JpZD0="),va:m("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),maliva:m("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),sg:m("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boei18n:m("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9")}[e.getConfigRegion()];if(t)return t+e.getSlardarBid()}}return e.prototype.setConfig=function(e){this.config=e},e.prototype.upload=function(){var e=this,t=this.gerReportUrl();!this.lock&&t&&0!==this.batchData.length&&(this.lock=!0,setTimeout(function(){var r=e.batchData.slice(0,100);e.batchData=e.batchData.slice(100),I.fetch(t,{method:"post",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).catch(function(e){}),e.lock=!1,e.upload()},this.timeout))},e.prototype.generateKey=function(e){return e.collectKey?[e.collectMode,e.collectKey].join("___"):""},e.prototype.push=function(e){this.batchData.push(e),this.upload()},e.prototype.report=function(e){var t=this.generateKey(e);if(I.fetch&&e.collectKey){var r="object"==typeof window?window.location.href:"SSR";e.documentUrl=r;var n={age:Math.floor(Date.now()),type:"xss",url:r,body:e,"user-agent":""};"enforce"===e.disposition&&"SSR"!==r||(n.url=t),"SSR"===r&&(n.url="SSR___".concat(n.url),n.body.ssr=!0),this.push(n)}},e}()),E=function(e){for(var t=0,r=function(r){Array.isArray(e[r])?0===e[r].length?delete e[r]:(e[r]=v.from(v.uniq(e[r])),t+=e[r].length):0===v.keys(e[r]).length?delete e[r]:v.keys(e[r]).forEach(function(n){e[r][n]=v.from(v.uniq(e[r][n])),t+=e[r][n].length})},n=0,i=v.keys(e);n<i.length;n++)r(i[n]);return{count:t,ret:e}};function R(e,t){return T.setConfig(t),new S(t).process(e)}function w(e){var t,r=(t=/\s|\n|\t/.exec(e))?t.index:-1;if(-1===r)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=e.slice(r+1,-1).trim())[e.length-1];return n&&(e=e.slice(0,-1).trim()),{html:e,closing:n}}var L=function(e){return -1===(e=(e=(e=(e=e.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?e.trim().toLowerCase():e.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,function(e,t,r,n){return String.fromCharCode(t?parseInt(r,16):parseInt(n))}).replace(/(\t|\n|\r)/g,"").toLowerCase()};function D(e,t){if(void 0===e&&(e=""),"string"!=typeof e)return!0;if(e=L(e),v.includes(e,"base64")&&!function(e){if(""===e||""===e.trim())return!0;try{return!v.includes(e,"data:text/html;base64")}catch(e){return!0}}(e))return t&&t("data:text/html;base64"),!1;var r=["expression(","behavior:","view-source:"];if(v.some(r,function(t){return -1!==e.indexOf(t)}))return v.forEach(r,function(r){-1!==e.indexOf(r)&&t&&t(r)}),!1;var n=["data:application","data:javascript","data:text/html","data:texthtml"];if(v.some(n,function(t){return -1!==e.indexOf(t)}))return v.forEach(n,function(r){-1!==e.indexOf(r)&&t&&t(r)}),!1;if(e.indexOf("javascript:")>0)return t&&t("javascript:"),!1;if(/^javascript:/i.test(e)){var i=e.slice(11).replace(/\s/g,"").trim();return!!v.some(["void","void(0)","void0","false","undefined",";"],function(e){return e===i})||(t&&t("javascript:"),!1)}return!0}var x=function(e,t){var r,n,i="<%= isSaveValidUrl =>";if("string"!=typeof e||(n=Number("<%= urlLimit =>"),void 0!==r&&(n=r),"NaN"!==e.toString()&&-1!==n&&e.length>=n)||D(e,t))return e;try{if(!0===(i=JSON.parse(i))||"true"===i){var o=new URL(e);return o.origin+o.pathname}}catch(e){}return"#"};function P(e,t,n){if(void 0===e&&(e=""),void 0===t&&(t=[]),"string"!=typeof e)return!0;if(!D(e=L(e)))return!1;var i,o={url:(i=e.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[])[0],scheme:i[1],slash:i[2],host:i[3],port:i[4],path:i[5],query:i[6],hash:i[7]},a=o.scheme,s=o.host;return n?!!n(e):!(!a||!s)&&(!v.includes(["http","https","file"],a)||("object"==typeof window&&window&&(t=r(r([],t,!0),[location.host],!1)),v.some(t,function(e){return!!(e instanceof RegExp&&e.test(s))||e===s})))}var Z={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},O={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var e=E(this.collect),t=e.count,r=e.ret;return this.collect=null,{collectKey:0===t?null:JSON.stringify(r),collectMode:"white"}},onIgnoreTagAttr:function(e,t,n){return e&&v.indexOf(["href","src"],t)>-1?O.domainWhiteList&&Array.isArray(O.domainWhiteList)&&O.domainWhiteList.length>0&&!P(n,r([],O.domainWhiteList,!0))?"":"".concat(t,'="').concat(x(n,function(e){var t;null===(t=O.collect)||void 0===t||t.filterProtocol.push(e)}),'"'):e&&(v.indexOf(["style","class","id"],t)>-1||t.indexOf("data-")>-1)?"".concat(t,'="').concat(n,'"'):(O.collect.whiteList[e]=O.collect.whiteList[e]||[],void O.collect.whiteList[e].push(t))},onIgnoreTag:function(e,t){if("style"===e)return t;C(t,function(e,t,r,n){b(w(n).html.replace("/",""),function(e){O.collect.whiteList[r]=O.collect.whiteList[r]||[],O.collect.whiteList[r].push(e)})},g)},whiteList:Z,mergeWhiteList:function(e){for(var t,r={},n=0,i=v.keys(Z);n<i.length;n++)r[t=i[n]]=v.from(Z[t]);for(var o=0,a=v.keys(e);o<a.length;o++)r[t=a[o]]=t in Z?Z[t].concat(e[t]):v.from(e[t]);return r},setWhiteList:function(e){for(var t=0,r=v.keys(e);t<r.length;t++){var n=r[t];this.whiteList[n]=n in Z?Z[n].concat(e[n]):v.from(e[n])}}};try{var N={},B="merge";v.includes(B,"override")&&(O.whiteList=N.whiteList),v.includes(B,"merge")&&O.setWhiteList(N.whiteList)}catch(e){}var M=function(e,t){for(var r={},n=0,i=v.keys(e);n<i.length;n++){var o=i[n];Array.isArray(e[o])?r[o]=v.from(e[o]):r[o]=M({},e[o])}for(var a=0,s=v.keys(t);a<s.length;a++)(o=s[a])in e?Array.isArray(e[o])?r[o]=e[o].concat(t[o]):r[o]=M(e[o],t[o]):Array.isArray(t[o])?r[o]=v.from(t[o]):r[o]=M({},t[o]);return r},F={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var W={};W.blackAttrRegExps&&(W.blackAttrRegExps=W.blackAttrRegExps.map(function(e){return new RegExp(e.toString().slice(1,e.toString().length-1))}));var V="merge";v.includes(V,"override")&&(F=W),v.includes(V,"merge")&&(F=M(F,W))}catch(e){}var U={mode:"black",whiteList:{},blackConfig:F,collect:null,initCollect:function(){U.collect={blackList:{},blackTags:[],blackAttrs:[],blackAttrRegExps:[],filterAttrs:[],filterList:{},filterProtocol:[]}},removeCollect:function(){var e=E(U.collect),t=e.count,r=e.ret;return U.collect=null,{collectKey:0===t?null:JSON.stringify(r),collectMode:"black"}},onIgnoreTag:function(e,t){var r;if(!v.includes(F.blackTags,e))return C(t,function(e,t,r,n,i){if(-1!==r.indexOf("/"))return g(n);if(i)return"</".concat(r,">");var o=w(n),a=b(o.html,function(e,t){var n,i=0;if(F.blackList[r]&&v.includes(F.blackList[r],e)&&(U.collect.blackList[r]=U.collect.blackList[r]||[],U.collect.blackList[r].push(e),i++),F.blackAttrRegExps.length&&F.blackAttrRegExps.some(function(t){return t.test(e)})&&v.forEach(F.blackAttrRegExps,function(t){t.test(e)&&(U.collect.blackAttrRegExps.push("".concat(t.toString(),"->").concat(e)),i++)}),F.blackAttrs.length&&v.includes(F.blackAttrs,e)&&(F.blackAttrs.push(e),i++),!i){if(F.filterList&&F.filterList[r]&&v.includes(F.filterList[r],e)){var o=x(t,function(e){var t;null===(t=U.collect)||void 0===t||t.filterProtocol.push(e)});return o!==t&&(U.collect.filterList[r]=U.collect.filterList[r]||[],U.collect.filterList[r].push(e)),t?"".concat(e,"='").concat(o,"'"):e}return F.filterAttrs&&v.includes(F.filterAttrs,e)?((o=x(t,function(e){var t;null===(t=U.collect)||void 0===t||t.filterProtocol.push(e)}))!==t&&(null===(n=U.collect)||void 0===n||n.filterAttrs.push(e)),t?"".concat(e,"='").concat(o,"'"):e):t?"".concat(e,"='").concat(t,"'"):e}});return n="<".concat(r),a&&(n+=" ".concat(a)),o.closing&&(n+=" /"),n+=">"},g);null===(r=U.collect)||void 0===r||r.blackTags.push(e)}},j=function(e){var t=e.reportOnly,r=void 0===t||t,n=e.block;return r&&"all"===r?"report":("string"==typeof r&&("true"===r&&(r=!0),"false"===r&&(r=!1)),n?"enforce":r?"report":"enforce")},H=function(e){return function(r,n,i){if(!r||"string"!=typeof r)return r;var o=n;e===R&&(o=O).initCollect();var a=e(r,o);if(k(a)===k(r))return r;if(!i)return a;var s=i.logType,u=j(i),c=o.removeCollect();return T.report(t(t({type:s,disposition:u},c),{sourceText:y(r),filterText:y(a)})),"enforce"===u?a:r}},Y=H(function(e,t){return void 0===t&&(t={}),t&&t.whiteList||(t.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}),new S(t).process(e)}),G=H(R),X=function(e,t,r){var n=[],i=x(e,function(e){n.push(e)});if(i===e)return e;n=v.from(v.uniq(n));var o=t||r||{};if(!o)return i;var a=o.logType,s=j(r);return T.report({type:a,disposition:s,collectKey:n.join("___"),collectData:JSON.stringify(n),collectMode:"black",sourceText:y(e),filterText:y(i)}),"enforce"===s?i:e},K=I._xssProject||{},q=I.xssNamespace||{},Q="3.0.26",J={FilterXSS:S,version:Q,webpackPluginVersion:"<%= webpackPluginVersion =>",reportOnly:"<%= reportOnly =>",filterXSS:Y,_filterXSS:G,filterUrl:X,Config:O,BlackConfig:U,project:K,setProjectName:function(e){K[e]=this,I._xssProjectName=e}};q.douyin_web=J,I.xssNamespace=q,I.Math&&!I.Math.xssNamespace&&(I.Math.xssNamespace=q),K[Q]=J,I.globalThis=I,I.getFilterXss=function(){return void 0!==this._xssProjectName?this._xssProject[this._xssProjectName]:J},I.xss=J,I.isSafeUrl=P,I.isSafeDomain=P,I.isSafeProtocol=D,I._xssProject=K,I._xssProjectName&&(K[I._xssProjectName]=J);var z=J.setProjectName.bind(J);e.BlackConfig=U,e.Config=O,e.FilterXSS=S,e._filterXSS=G,e.filterUrl=X,e.filterXSS=Y,e.isSafeDomain=P,e.isSafeProtocol=D,e.isSafeUrl=P,e.project=K,e.setProjectName=z,e.setXssNamespace=function(e){var t=e.appId,r=e.bid,n=e.region;q[t]=J;O.bid=r,O.region=n,O.enabled=!0},e.xssNamespace=q,Object.defineProperty(e,"__esModule",{value:!0})});"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["3815"],{935672:function(e,t,r){r.d(t,{F5:function(){return l},Pj:function(){return a},Ru:function(){return i},Vh:function(){return d},Wp:function(){return c},f4:function(){return o},mH:function(){return u},pl:function(){return s}}),r(410121),r(864614),r(227470),r(210434);var n=r(244694),i={playBtnClick:function(e,t,r,n){!e.paused&&e.waitingMoreBuffer&&(e.waitingMoreBuffer=!1),n.call(e,t,r)}},o={waiting:function(e,t){var r=e.player,n=e.eventName;r.waitingMoreBuffer=!0,t(n,e)},play:function(e,t){var r=e.player,n=e.eventName;!r.waitingMoreBuffer&&t(n,e)},pause:function(e,t){var r=e.player,n=e.eventName;!r.waitingMoreBuffer&&t(n,e)},seeking:function(e,t){var r=e.player,n=e.eventName;r.isSeekingStart=!0,t(n,e)},progress:function(e,t){(0,n.cM)(">>>>progress");var r=e.player,i=e.eventName;if(r.waitingMoreBuffer){var o=r.getBufferedRange(r.buffered2);0===o[0]&&0===o[1]||(void 0===r.inWaitingStart||r.isSeekingStart?((0,n.cM)("progress startplay or seek ended"),o[1]-r.currentTime>=(r.config.canplayWaterLevel||1)||o[1]>r.duration-1?((0,n.cM)("progress out bufferWaterLevel"),r.play()):((0,n.cM)("progress not out bufferWaterLevel"),r.emit("waiting"))):((0,n.cM)("progress video waiting end"),o[1]-r.currentTime>=(r.config.bufferWaterLevel||5)||o[1]>r.duration-1?((0,n.cM)("progress out bufferWaterLevel"),r.play()):((0,n.cM)("progress not out bufferWaterLevel"),r.emit("waiting"))))}t(i,e)},playing:function(e,t){var r=e.player,i=e.eventName;(0,n.cM)("playing");var o=r.getBufferedRange(r.buffered2);if(0===o[0]&&0===o[1]){(0,n.cM)("playing currentTime no buffer, not out bufferWaterLevel"),r.waitingMoreBuffer=!0,r.pause(),t.call("waiting",e);return}void 0===r.inWaitingStart||r.isSeekingStart?((0,n.cM)("playing startplay or seek ended"),o[1]-r.currentTime>=(r.config.canplayWaterLevel||1)||o[1]>r.duration-1?((0,n.cM)("playing out bufferWaterLevel"),r.waitingMoreBuffer=!1,r.isSeekingStart=!1,t(i,e)):((0,n.cM)("playing not out bufferWaterLevel"),r.waitingMoreBuffer=!0,r.pause(),t.call("waiting",e))):((0,n.cM)("playing video waiting ended"),o[1]-r.currentTime>=(r.config.bufferWaterLevel||5)||o[1]>r.duration-1?((0,n.cM)("playing out bufferWaterLevel"),r.waitingMoreBuffer=!1,t(i,e)):((0,n.cM)("playing not out bufferWaterLevel"),r.waitingMoreBuffer=!0,r.pause(),t.call("waiting",e)))}};function a(e){return/^http(s)?:\/\/.+/.test(e)}function s(e,t){return Math.round(8e3*e/t/1024)}function u(e){var t,r;return!((null==e||null===(t=e.message)||void 0===t?void 0:t.indexOf("Failed to fetch"))>=0)&&(null==e||!e.isTimeout)&&(null==e||!e.response||!((null===(r=e.response)||void 0===r?void 0:r.status)>=400)||!(e.response.status<=599))&&!0}function c(e){var t,r;return!((null==e||null===(t=e.message)||void 0===t?void 0:t.indexOf("Failed to fetch"))>=0)&&(null==e||!e.response||!((null===(r=e.response)||void 0===r?void 0:r.status)>=400)||!(e.response.status<=599))&&!0}function l(e){return e.preLoadMeta||{}}function d(e,t){var r=e.vtype,n=e.codecType,i=e.definition,o=null;return t.forEach(function(e){(e.definition===i||e.definition===Number(i))&&e.codecType===n&&e.vtype===r&&(o=e)}),o}},183981:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(167846),i=r(159322),o=r.n(i),a=r(76314),s=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.PA)(this,t),(e=(0,n.$w)(this,t)).options=r,e.worker=new a.Z,e.worker.onmessage=function(t){e.emit(t.data.method,t.data)};var i=e.options,o=i.memoryOpt,s=i.openLog,u=i.supportHevc,c=i.codecType;return e.worker.postMessage({method:"init",id:r.id||0,args:{memoryOpt:o,openLog:s,supportHevc:u,codecType:c}}),e}return(0,n.XW)(t,e),(0,n.qH)(t,[{key:"updateValue",value:function(e){var t,r;null===(t=this.worker)||void 0===t||t.postMessage({method:"updateValue",id:(null===(r=this.options)||void 0===r?void 0:r.id)||0,args:{value:e}})}},{key:"transmux",value:function(e,t,r,n,i,o,a,s,u,c,l,d,f){var h,g=t.buffer;null===(h=this.worker)||void 0===h||h.postMessage({method:"transmux",id:e,buffer:g,args:{start:r,videoIdx:n,audioIdx:i,moov:o,useEME:a,kidValue:s,context:u,videoTrak:c,audioTrak:l,lastUnMuxData:d,pos:f}},d?[g,d.buffer]:[g])}},{key:"reset",value:function(){this.worker&&this.worker.postMessage({method:"reset"})}},{key:"destroy",value:function(){this.worker&&this.worker.postMessage({method:"destroy"}),this.worker&&this.worker.terminate()}}])}(o())},431413:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(884504),i=r(897948),o=(0,n.qH)(function e(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,n.PA)(this,e);o.playerVersion="3.5.28-alpha.19",this.errorType=t,this.errorCode=("number"==typeof r?r:void 0)||i.WE[t][r]||i.WE[t],this.ext=o});o.DUR_PARSE_ERROR=9201,o.SEG_PARSE_ERROR=9202,o.INIT_SEGMENT_ERROR=9203,o.MPD_INIT_ERROR=9204,o.SEGMENT_CONTENT_ERROR=9205,o.BACK_URL_FAIL=9206,o.MSE_OPEN_TIMEOUT=9207;let a=o},593270:function(e,t,r){r.r(t),r.d(t,{DashPreloader:function(){return b.Z},default:function(){return E},encryptUtils:function(){return c}});var n=r(884504);r(514312),r(11258),r(904644),r(379493),r(724356),r(947478),r(864614),r(238658),r(347885),r(210434);var i=r(623176),o=r(661854),a=r(860513),s=r(569898),u=r(479461),c=r(894538),l=r(203199),d=r(918334),f=r(336730),h=r(280161),g=r(469140),v=r(431413),p=r(74312),_=r(198901),y=r(140709),m=r(801379),C=r(897948),b=r(248176),A=r(660065),k=i.STATS_EVENTS,S={MP4:"mp4",DASH:"dash",VOID:"void"};function I(e){return{playerVersion:{get:function(){return"3.5.28-alpha.19"},configurable:!0},downloadSpeed:{get:function(){return y.Z.currentSpeed/8},configurable:!0},historyAvspeed:{get:function(){return y.Z.historyAvspeed/8},configurable:!0},abrInstance:{get:function(){return e.abrInstance},configurable:!0},menuCodeType:{get:function(){return e.menuCodeType},configurable:!0},playerType:{get:function(){return e.playerType},configurable:!0},supportMenus:{get:function(){return e.supportMenus},configurable:!0},domain:{get:function(){return e.domain},configurable:!0},loadURL:{get:function(){return e.loadURL},configurable:!0},performance:{get:function(){var t=e.stat;return t&&t.performance},configurable:!0},stat:{get:function(){return e.stat},configurable:!0},preLoadData:{get:function(){var t=e.stat;return t&&t.preLoadData?t.preLoadData:{byteLength:0,duration:0}},configurable:!0},ext:{get:function(){var t=Math.max(0,y.Z.historySpeed.length-10),r=y.Z.historySpeed.slice(t,t+10);return(0,n.Zj)((0,n.Zj)({},e.stat),{},{speed:r.map(function(e){return"".concat(e/8)}),vtype:"DASH",format:e._kernalType,performance:void 0,preLoadData:void 0})},configurable:!0},getLogCache:{get:function(){var e=(0,s.jl)();return e.getLogCache&&e.getLogCache()},configurable:!0},pcdnReq:{get:function(){var t;return e._kernalType===S.DASH?null===(t=e._kernal)||void 0===t?void 0:t.pcdnReq:null},configurable:!0},currentDefitionFromPlayer:{get:function(){return e.currentDefitionFromPlayer},configurable:!0},encryptedInfo:{get:function(){var t;return{encryptedType:(null===(t=e._kernal)||void 0===t?void 0:t.encryptedType)||0}},configurable:!0},pcdnVVStat:{get:function(){var t;return e._kernalType===S.DASH?null===(t=e._kernal)||void 0===t?void 0:t.pcdnVVStat():null},configurable:!0},beforeLoadStartCostTime:{get:function(){var t;if(e._kernalType!==S.DASH||!e._kernal)return 0;return null===(t=e._kernal)||void 0===t?void 0:t.beforeLoadStartCostTime},configurable:!0},startTimelines:{get:function(){if(e._startTimelines){var t=l.Z.nowTime();e._startTimelines.startuploadtime=t;var r=e._kernalType===S.DASH?e._startTimelines.reqtime:e._startTimelines.downgradetime;if(e._startTimelines.startdelta=t-r,e._startTimelines.firstframedp=e._hasFirstFramed?1:0,e._startTimelines.playerstate=e.player.state,!e._hasFirstFramed){var n,i,o=e.player.getBufferedRange();e._startTimelines.startbufferlength=o[1]-o[0],null===(i=e.player)||void 0===i||i.emit("xglog_cache")}}var a=null===(n=e.stat)||void 0===n?void 0:n.stage;return JSON.parse(JSON.stringify(Object.assign({},e._startTimelines,a)))},configurable:!0}}}var T=null,E=function(e){function t(){var e;(0,n.PA)(this,t);for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=(0,n.$w)(this,t,[].concat(i)),(0,n._x)(e,"_hasUsedBackUrl",!1),(0,n._x)(e,"_onPlayAbort",function(){var t=e.config,r=l.Z.nowTime(),n=!1;e._playTime>-1&&e._pauseTime>-1&&e._playTime<=e._pauseTime&&e._pauseTime<=r&&(n=!0),t.usePlayAbortRetry&&!e._hasPlayAbortRetry&&!n&&(e._hasPlayAbortRetry=!0,e.player.play(),s.ZP.log(t.vid,"playAbortRetry"))}),(0,n._x)(e,"_onPlayStarted",function(){e._startTimelines&&(e._startTimelines.playtime=l.Z.nowTime())}),(0,n._x)(e,"_onLoadStart",function(){-1===e._startTimelines.loadstarttype&&(e._startTimelines.loadstarttime=l.Z.nowTime(),e._startTimelines.loadstarttype=e._kernalType===S.DASH?1:2)}),(0,n._x)(e,"_onLoadData",function(){-1===e._startTimelines.loadeddatatype&&(e._startTimelines.loadeddatatime=l.Z.nowTime(),e._startTimelines.loadeddatatype=e._kernalType===S.DASH?1:2)}),(0,n._x)(e,"_onSourceError",function(t){if(!e._hasFirstFramed){if(!(null!==(r=t.message)&&void 0!==r&&r.includes("PCDN"))){var r,n,i,o,a="".concat(e.player.vtype,"-host:").concat(null==t?void 0:t.host,"-").concat(null==t?void 0:t.errorCode,"-").concat(null!==(n=null==t||null===(i=t.mediaError)||void 0===i?void 0:i.message)&&void 0!==n?n:null==t?void 0:t.message);e.setStartTimelines(d.l1.HTTP_ERROR,{message:a,httpCode:null==t?void 0:t.errorCode}),null===(o=e._startTimelines)||void 0===o||null===(o=o.httpError)||void 0===o||o.push({message:a,httpCode:null==t?void 0:t.errorCode,range:(null==t?void 0:t.range)&&JSON.stringify(null==t?void 0:t.range),mediaType:null==t?void 0:t.mediaType})}}}),(0,n._x)(e,"_onSeeking",function(){var t=e.player;e.waitLevelStartTime=t.currentTime}),(0,n._x)(e,"_onPlaying",function(){s.ZP.log("onPlaying,",JSON.stringify({curtime:e.player.currentTime,buffer:JSON.stringify(null===(n=e.player)||void 0===n||null===(n=n.buffered2)||void 0===n?void 0:n.bufferedList)})),e._waitAdjustTimeCnt>0&&e._waitInBufferTimer&&(e._waitAdjustTimeCnt-=1,s.ZP.log("[waitInBuffer resume play], waitAdjustTimeCnt,",e._waitAdjustTimeCnt)),clearTimeout(e._waitInBufferTimer),e._waitInBufferTimer=null;var t=e.player,r=e.config.resumePlayWaterLevel;if(e._kernalType===S.MP4){e.checkResumePlayTimer>0&&(clearTimeout(e.checkResumePlayTimer),e.checkResumePlayTimer=null,t.isBufferControlPaused&&(t.isBufferControlPaused=!1),t.paused&&t.play());return}if(!(t.duration>0)||!(t.duration-t.currentTime<=r)){if(e.waitLevelStartTime<0&&(e.waitLevelStartTime=t.currentTime),!e.playFlag&&(e.playFlag=!0),r>0&&t.currentTime-e.waitLevelStartTime>=u.Ef){var n,i,o=t.getBufferedRange(t.buffered2);o[1]>0&&o[1]-t.currentTime<r?(!t.paused&&(e.emit(u.of,{type:u.a1.WAITING}),t.pause(null===(i=u.Im)||void 0===i?void 0:i.BUFFER_CONTROLS),t.isBufferControlPaused=!0,s.ZP.log("[!!!!!buffer not rich, pause],currentTime, ",t.currentTime,", bufferEnd,",o[1])),clearTimeout(e.checkResumePlayTimer),e.checkResumePlayTimer=setTimeout(e._onPlaying,r/2*1e3)):t.isBufferControlPaused&&t.paused&&(s.ZP.log("[!!!!!buffer rich, play],, currentTime, ",t.currentTime,", bufferEnd,",o[1]),clearTimeout(e.checkResumePlayTimer),e.checkResumePlayTimer=null,t.isBufferControlPaused=!1,e.emit(u.of,{type:u.a1.PLAYING}),t.play())}}}),(0,n._x)(e,"_onWaiting",function(){var t,r=e.player,n=e.config;clearTimeout(e._waitInBufferTimer),e._waitInBufferTimer=null;var i=r.currentTime;s.ZP.log(",[onWaiting],curTime, ",i,",buffer,",JSON.stringify(null==r||null===(t=r.buffered2)||void 0===t?void 0:t.bufferedList),",dur,",r.duration);var o=r.bufferedPoint;o.end>0&&o.end-i>=2&&e._waitAdjustTimeCnt<n.waitJampBufferMaxCnt&&(e._waitInBufferTimer=setTimeout(function(){e._waitAdjustTimeCnt++,r.currentTime=r.currentTime+.5},n.waitingInBufferTimeOut))}),e}return(0,n.XW)(t,e),(0,n.qH)(t,[{key:"initDashPlayer",value:function(e){this._checkVideoSwitch(),this._hasTriggerBufferThreshold=!1,this._setArgsFromConfig(),this.lastBuffer="0,0",this._menuCodeType=null,this._setConfigDashType(),l.Z.promisePolyfill(),(window.location.href.indexOf("playerInstance=true")>-1||h.Xb.getItem("playerInstance"))&&(void 0===window.dashPlayerInstanceList&&(window.dashPlayerInstanceList=[]),window.dashPlayerInstanceList.push(e)),this._startBufferCheck(),this.changeKernal(!1),window.addEventListener("beforeunload",this.cacheSpeed)}},{key:"_checkVideoSwitch",value:function(){var e=this.player,t=this.playerConfig.mediaType;if(this.softVideo="xg-video"===t,!(e.video instanceof HTMLVideoElement)&&!this.softVideo){var r=o.ZP.createDom("video","",this.getVideoConfig(this.playerConfig));this.removeVideo=e.video,r.muted=e.video.muted,r.volume=e.video.volume,e.video=r,e.attachVideoEvents(e.video);var n=this.removeVideo.parentNode;n&&n.removeChild(this.removeVideo),this.removeVideo=null}}},{key:"getVideoConfig",value:function(e){var t=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:2,mediaType:e.mediaType||"video"},e.videoConfig,e.videoAttributes);return e.loop&&(t.loop="loop"),t}},{key:"bitRateAdapter",get:function(){var e=this.player,t=this.config;return e&&e.plugins?t.needAutoBitrate?e.plugins.bitrateselector:null:null}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NEXT",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;s.ZP.log("next currentTime: ".concat(e,", nextType: ").concat(t,", autoplay:").concat(n));var o=this.player,c=this.config;this._setStartTimelineData(),this._unbindPlayerProxyAttr(),a.ZP.defineGetterOrSetter(o,I(this)),this._pausedWhenExpiredRestart=!1,"MEDIA_EXPIRED"===t&&o.paused&&(this._pausedWhenExpiredRestart=!0),o.dashState=u.U2;var l=!1;if(!o.isSrcVoid&&(c.dashOpts||c.mp4Opts)&&!o.ended&&"MEDIA_EXPIRED"!==t&&"REPLAY"!==t&&o.duration&&o.currentTime<o.duration-u.Z6&&(o.emit("logger_next",t),l=!0),this._hasTriggerBufferThreshold=!1,o.emit("next",t),o.emit("playertypechange"),r)for(var d in r)c[d]=r[d];o.config.vid&&(c.vid=o.config.vid),c.duration>0&&(c.duration=0),o.config.duration&&(c.duration=o.config.duration),this._setDefinitionConfig(),this._setArgsFromConfig(),l&&this._setConfigDashType(),"NEXT"===t&&o.resetState&&o.resetState(),o.config.startTime=e,o.config.startTimeCache=e,r&&(o.config.DASHPlugin=r);var f=o.config.autoplay;this._pausedWhenExpiredRestart&&f&&(o.config.autoplay=!1,o.once("canplay",function(){setTimeout(function(){o.config.autoplay=f,o.pause()})})),this._syncParameters(),this.changeKernal(!0,!0,i),(n||o.config.autoplay)&&!this._pausedWhenExpiredRestart&&o.once("canplay",function(){if(o.video&&(o.config.autoplay||n)){var e=o.video.play();e&&e.catch(function(){})}}),this._pausedWhenExpiredRestart&&(this._pausedWhenExpiredRestart=!1)}},{key:"_replay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.player;this.config.replayReset?this.next(e,"REPLAY",void 0,!0):(t.currentTime=0,this._kernal&&this._kernal.replay&&this._kernal.replay())}},{key:"_setDefinitionConfig",value:function(){var e=this.player,t=this.config;if(e.config.definition){var r=e.config.definition,n=r.definitionText,i=r.defaultDefinition;n&&(t.definition=n),i&&(t.defaultDefinition=i)}}},{key:"startPlayHandler",value:function(e,t,r){var n=this.config;(n.dashOpts||n.mp4Opts)&&this._setStartTime(r,e,"NEXT"===t||"REPLAY"===t,!0)}},{key:"beforePlayerInit",value:function(){if(!this._hasExecuteBeforeInit)this._hasExecuteBeforeInit=!0}},{key:"afterCreate",value:function(){var e=this;this.steps=[];var t=this.player,r=this.config;t.isReady=!0,this._kernalType===S.DASH&&(t.vtype="DASH"),this._unbindPlayerProxyAttr(),a.ZP.defineGetterOrSetter(t,I(this)),this._syncParameters(),t.config.nullUrlStart=!0,this._setDefinitionConfig(),(0,s.jl)().logMaxSize=r.logMaxSize,this._proxyPlayer(),this.initDashPlayer(t),this._setStartTimelineData(),this.on("xglog",function(r){if("firstFrame"===r.eventType){s.ZP.log("[xgplayer-encrypt]>>>>firstFrame ",e.playerConfig.vid,r.fvt,"stat",t.stat),e._hasFirstFramed=!0,e.setStartTimelineAttr("ffcost",r.fvt);var n,i,o=t.vtype===d.l0.DASH?null===(n=e._startTimelines)||void 0===n?void 0:n.reqtime:null===(i=e._startTimelines)||void 0===i?void 0:i.downgradetime;e.setStartTimelineAttr("fcost",l.Z.nowTime()-o)}}),this._bindEvents(),this.setStartTimelines(d.l1.BEFEORE_START,{message:"after create"})}},{key:"setStartTimelines",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._hasFirstFramed&&this._startTimelines){this._startTimelines.startstage=e,this._startTimelines.startmessage="".concat(d.sm[e]||"","-").concat((null==t?void 0:t.message)||"");var r=this._startTimelines.httpCode;this._startTimelines.httpCode=-1!==r?r:(null==t?void 0:t.httpCode)||-1,e===d.l1.PLAYER_ERROR&&(this._startTimelines.playerError=(null==t?void 0:t.message)||"")}}},{key:"_setStartTimelineData",value:function(){this._startTimelines={startstage:-1,startmessage:"",httpCode:-1,httpError:[],reqtime:-1,downgradetime:-1,fcost:-1,ffcost:-1,startbufferlength:-1,playerError:"",startdelta:-1,loadstarttime:-1,loadeddatatime:-1,loadstarttype:-1,loadeddatatype:-1,playtime:-1,playerstate:-1},this._hasFirstFramed=!1}},{key:"setStartTimelineAttr",value:function(e,t){this._startTimelines&&(this._startTimelines[e]=t)}},{key:"info",value:function(e){var t=this.player;k&&t.emit(k.STATS_INFO,e),e.add&&this.steps.push(e)}},{key:"resetStat",value:function(){var e=this.player;k&&e.emit(k.STATS_RESET)}},{key:"_syncParameters",value:function(){var e,t=this.config,r=this.playerConfig,n=t.vid||r.vid;t.vid=r.vid=n,r.autoBitrateOpts=t.autoBitrateOpts,null===(e=this.player.preloader)||void 0===e||e.addPlayingId(r.vid,this.player.playerId)}},{key:"_proxyPlayer",value:function(){var e=this,t=this.player,r=this.config;this._originStartInit=t._startInit,t.getPreloadInfos=this.getPreloadInfos.bind(this),t.useHooks("replay",function(t){e._replay()}),t.useHooks("play",function(){var r;e._playTime=l.Z.nowTime(),s.ZP.log(null==t||null===(r=t.config)||void 0===r?void 0:r.vid,"play",e._playTime)}),t.useHooks("pause",function(){var r;e._pauseTime=l.Z.nowTime(),s.ZP.log(null==t||null===(r=t.config)||void 0===r?void 0:r.vid,"puase",e._pauseTime)}),"function"==typeof this.player.playNext&&(T=this.player.playNext),this.player.playNext=function(){e.playNext.apply(e,arguments)},"function"==typeof this.player.resetState&&(this._originResetState=this.player.resetState,this.player.resetState=function(){e._originResetState.call(e.player),s.ZP.log("resetState",r.resetStateUpdrade),r.resetStateUpdrade&&"dash_mp4_2"===t.vtype&&(e.config.defaultFormat="dash",t.hasStart=!0,e.changeKernal())})}},{key:"playNext",value:function(){for(var e=this.player,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=r[0],o=r[1],a=r[2],s=r[3];e.setConfig(i),this.next(o,a,i.DASHPlugin,s)}},{key:"_setKernalType",value:function(){var e=this.config;e.dashOpts||e.mp4Opts?e.dashOpts&&e.mp4Opts?this._kernalType=e.defaultFormat.toLowerCase():e.dashOpts?this._kernalType=S.DASH:this._kernalType=S.MP4:this._kernalType=S.VOID}},{key:"changeKernal",value:function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this.player;this.destroyKernal(),this._setKernalType();var i=this._kernalType;this._pauseTime=-1,this._playTime=-1,this._hasPlayAbortRetry=!1,i===S.VOID?(n.isSrcVoid=!0,n.emit("playOptsVoid"),this.setStartTimelines(d.l1.BEFEORE_START,{message:"init playOptsVoid"}),t&&n.emit("nextEnded")):(n.isSrcVoid=!1,this._setStartTime("destroy",n.config.startTime,!0,!1),i===S.MP4?(this._kernal=new _.Z(this),n.vtype="dash_mp4"):i===S.DASH&&(this._kernal=new g.Z(this),n.vtype="DASH"),r&&(n.vtype=r),"dash_mp4_2"===n.vtype&&(this._startTimelines.downgradetime=l.Z.nowTime()),this.setStartTimelines(d.l1.BEFEORE_START,{message:"init no start"})),e&&this._kernal&&(this._kernal.start(),t&&this._kernal.executeReady())}},{key:"destroyKernal",value:function(){if(this._kernal){var e;s.ZP.log(null===(e=this.config)||void 0===e?void 0:e.vid,"destroyKernal type ".concat(this._kernalType)),this._kernal.destroy(),this._kernal=null}}},{key:"originStartInit",get:function(){return this._originStartInit}},{key:"_setArgsFromConfig",value:function(){var e=this.config;this._bufferThreshold=e.bufferThreshold,this.playFlag=!1,this.waitLevelStartTime=-1,this._waitAdjustTimeCnt=0}},{key:"setCurrentDefitionInfos",value:function(e,t){var r,i=t?t.fps:void 0;this._currentDefinition={definition:e,fps:i,item:t},!(null!==(r=this.player.abrInstance)&&void 0!==r&&r.isCurrentInAbr)&&(this.player.curDefinition=(0,n.Zj)({},t))}},{key:"handleUrlExpire",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.config,i=this.player,o=i.paused,a=new Date().getTime()/1e3>=e.urlExpireTimestamp&&e.urlExpireTimestamp>0;if(a&&(r||!o)&&n.getServerTime)i.serverTimeDiffPromise=i.serverTimeDiffPromise||n.getServerTime().catch(function(){return 0}),i.serverTimeDiffPromise.then(function(r){if(r&&(i.serverTimeDiff=new Date().getTime()/1e3-r),new Date().getTime()/1e3>=e.urlExpireTimestamp+i.serverTimeDiff){e.urlExpireTimestamp=u.Lc;var n=new v.Z(C.wb.NETWORK_FORBIDDEN);t.emitExpireEvent(n)}});else if(a){var s=new v.Z(C.wb.NETWORK_FORBIDDEN);this.emitExpireEvent(s)}}},{key:"emitExpireEvent",value:function(e){var t=this.player,r=new Date().getTime()/1e3;this.emitExpireTimestamp?r-this.emitExpireTimestamp>u.vp&&(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e),this.info({msg:"MEDIA_EXPIRED"})):(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e),this.info({msg:"MEDIA_EXPIRED"}))}},{key:"_getCurDashType",value:function(){var e=h.Xb.getItem(u.WV),t=u.sp;return e===t.BACK?e:t.MAIN}},{key:"_setCurDashType",value:function(){this._initDashType=this._getCurDashType()}},{key:"_setConfigDashType",value:function(){this._setCurDashType();var e,t=null===(e=this.playerConfig)||void 0===e?void 0:e.vodLogOpts;t&&(t.currentDashType=this._initDashType)}},{key:"setCodeInfo",value:function(e){var t,r=null===(t=this.playerConfig)||void 0===t?void 0:t.vodLogOpts;"h265"===e&&(e="hevc");var n=p.$V[e],i=p.$V[p.d0.AVC],o=i.logCodeType,a=i.codecs;n&&(o=n.logCodeType,a=n.codecs),r&&(r.codec_type=o),this.menuCodeType=a,this.config&&(this.config.codecType=o)}},{key:"cacheSpeed",value:function(){try{var e=y.Z.historyAvspeed;e>0&&e!==1/0&&h.Xb.setItem(u.OU,e)}catch(e){}window.removeEventListener("beforeunload",this.cacheSpeed)}},{key:"unloadVideo",value:function(){var e=this.player;try{e.video&&e.video.src&&(e.video.removeAttribute("src"),e.video.load())}catch(e){}}},{key:"destroy",value:function(){var e;clearInterval(this._bufferCheckTimer),this.cacheSpeed(),this.destroyKernal(),this._unbindPlayerProxyAttr(),this.player.playNext=T,this.player.removeHooks("replay"),null===(e=this.player.preloader)||void 0===e||e.removePlayingId(this.player.playerId),this.off("seeking",this._onSeeking),this.off("waiting",this._onWaiting),this.off("playing",this._onPlaying),this.off("source_error",this._onSourceError),this.off("error",this._onSourceError),this.off(i.LOAD_START,this._onLoadStart),this.off(i.LOADED_DATA,this._onLoadData),this.off(i.AUTOPLAY_STARTED,this._onPlayStarted),this.off("AbortError",this._onPlayAbort),this._originResetState&&(this.player.resetState=this._originResetState)}},{key:"_unbindPlayerProxyAttr",value:function(){var e=I(this),t=this.player;Object.keys(e).forEach(function(e){delete t[e]})}},{key:"_bindEvents",value:function(){this.on("playing",this._onPlaying),this.on("seeking",this._onSeeking),this.on("waiting",this._onWaiting),this.on("source_error",this._onSourceError),this.on("error",this._onSourceError),this.on(i.LOAD_START,this._onLoadStart),this.on(i.LOADED_DATA,this._onLoadData),this.on(i.AUTOPLAY_STARTED,this._onPlayStarted),this.on("AbortError",this._onPlayAbort)}},{key:"getPreloadInfos",value:function(){return null}},{key:"getPreloadStat",value:function(){return{}}},{key:"_onBufferReachThreshold",value:function(){var e=this.player;if(e.video){for(var t=e.video.buffered,r=0,n=0,i=0;i<t.length&&(r=t.start(i),n=t.end(i),!(r<=e.video.currentTime)||!(e.video.currentTime<=n));i++);n-e.video.currentTime>=this._bufferThreshold&&!this._hasTriggerBufferThreshold&&(this._hasTriggerBufferThreshold=!0,e.emit("BUFFER_THRESHOLD",n-e.video.currentTime))}}},{key:"_startBufferCheck",value:function(){var e=this,t=this.player;this._bufferCheckTimer=setInterval(function(){if(!!t.video){var r=[];try{for(var n=0,i=t.video.buffered.length;n<i;n++)r.push([t.video.buffered.start(n),t.video.buffered.end(n)]);r.toString()!==e.lastBuffer&&(e.lastBuffer=r.toString(),e._onBufferReachThreshold())}catch(e){}}},200)}},{key:"_setStartTime",value:function(e,t,r,n){var i=this,o=this.player,a=this.playerConfig,s=this.config;if(t>0||n){var u=!1,c=function(){!u&&(u=!0,o.currentTime=t,a.startTime=0,r&&t>0&&o.emit("setStartTime"),"mp4"===s.defaultFormat&&i.setCodeInfo(p.d0.AVC))};l.Z.once(o,"canplay",c,e),l.Z.once(o,"playing",c,e)}}},{key:"preloadManager",get:function(){return this.player.preloader}},{key:"domain",get:function(){return this._cdnHost?this._cdnHost:null}},{key:"playerType",get:function(){return"dash"===this.config.defaultFormat?"dash":"dash_mp4_2"}},{key:"supportMenus",get:function(){var e="dash"===this.config.defaultFormat;return{speed:e,cdn:e,resolution:e}}},{key:"currentDefitionFromPlayer",get:function(){return this._currentDefinition}},{key:"abrInstance",get:function(){return this._kernal&&this._kernal.abrInstance?this._kernal.abrInstance:null}},{key:"menuCodeType",get:function(){return this._menuCodeType},set:function(e){var t=this.player;this._menuCodeType=e,null==t||t.emit("codecsupdate",e)}},{key:"stat",get:function(){var e=this.player;if(this._kernal&&!e.isSrcVoid){var t=this._kernal.getStat();return t.steps=this.steps.slice(0,Math.max(10,this.steps.length)),this.steps=[],e.video&&e.video.error&&(t.media={readyState:e.video.readyState,error:e.video.error.code,errorMsg:e.video.error.message}),t}return null}},{key:"loadURL",get:function(){return this._loadURL},set:function(e){this._loadURL=e;var t=l.Z.getHostFromUrl(e);this._cdnHost!==t&&(this._cdnHost=t,this.player&&this.player.emit("changeHost",t))}},{key:"onPreChangeDefinition",value:function(e,t){var r=this._kernal instanceof _.Z?t:e;return this._kernal.onPreChangeDefinition(r)}}],[{key:"pluginName",get:function(){return"DASHPlugin"}},{key:"defaultConfig",get:function(){return A.g}},{key:"isEMESupported",value:function(){return(0,c.isEMESupported)()}},{key:"encryptUtils",get:function(){return c}}])}(f.q);E.updateUnionInfo=m.XGSecretKey.updateUnionInfo,E.registerPreloader=f.q.registerPreloader},894538:function(e,t,r){r.r(t),r.d(t,{AV1MimeTypes:function(){return d},checkWebAssemblySupport:function(){return c},getDrmServerUrl:function(){return _},isAV1Supported:function(){return h},isCodecSupported:function(){return f},isEMESupported:function(){return g},isEncryptSupported:function(){return p},isSupported:function(){return v}});var n=r(884504);r(121621),r(577829),r(864614),r(632852),r(227470),r(677546),r(812735),r(623302),r(983431),r(319386),r(657170),r(853127),r(644952),r(759149),r(949136),r(966922),r(33814),r(29536),r(716005),r(548485),r(103343),r(260075),r(791017),r(743286),r(310378),r(124539),r(48498),r(728271),r(814647),r(535689),r(659673);var i=r(280161);function o(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),r=e.indexOf("Trident/");return t>0||r>0}function a(){return window.navigator.userAgent.toLowerCase().indexOf("qqbrowser")>-1}function s(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function u(){return navigator.userAgent.indexOf("Edge")>0}function c(){try{if(("undefined"==typeof WebAssembly?"undefined":(0,n.Ac)(WebAssembly))==="object"&&"function"==typeof WebAssembly.instantiate){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e) instanceof WebAssembly.Instance}}catch(e){}return!1}function l(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported}var d=['video/mp4; codecs="av01.0.01M.08,mp4a.40.5"'];function f(e){if(!l())return!1;for(var t=0;t<e.length;t++){var r=e[t];if(MediaSource.isTypeSupported(r))return!0}return!1}function h(){return f(d)}function g(){var e,t,r,n,a;return!!navigator.requestMediaKeySystemAccess&&(e=s(),t=o(),n=(r=window.navigator.userAgent,!(window.location.search.indexOf("firefox_dash=true")>-1||i.Xb.getItem("firefox_dash"))&&r.toLowerCase().indexOf("firefox")>-1),a=u(),!e&&!t&&!n&&!a)}function v(){return c()&&l()&&!o()}function p(){return c()&&l()&&!o()&&!a()}function _(e){return new Promise(function(t){(!c()||!l()||!navigator.requestMediaKeySystemAccess)&&t(void 0);var r=s(),n=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,i=u();n&&!a()?navigator.requestMediaKeySystemAccess("com.widevine.alpha",[{initDataTypes:["keyids","webm"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01e"'}]}]).then(function(){t("https://".concat(e,"/video/drm/v1/widevine?aid=32&kid="))},function(){t(void 0)}):i?t("https://".concat(e,"/video/drm/v1/playready?aid=32&kid=")):t(void 0)})}},32493:function(e,t,r){r.d(t,{Z:function(){return a},h:function(){return i}});var n=r(811156);function i(){return localStorage&&!!localStorage.getItem("playerlog")}function o(){return new Date().toLocaleString()}var a=function(){function e(t){(0,n.PA)(this,e),this._enable=i(),this._logs=[],this._prefix=t}return(0,n.qH)(e,[{key:"log",value:function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];this._enable&&console.log&&(e=console).log.apply(e,[this._prefix,o()].concat(r)),this._logs.push(r.join(","))}},{key:"logMessage",value:function(){if(this._enable){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];console.log&&(e=console).log.apply(e,[this._prefix,o()].concat(r))}}},{key:"getLogs",value:function(){return this._logs.join("\n")}}]),e}()},659361:function(e,t,r){r.d(t,{D:function(){return _},o:function(){return y}});var n=r(811156),i=r(623176),o=r(661854),a=r(860513),s=r(639569),u=r(728898),c=r(458862),l=r(171138),d=r(32493),f=r(895672),h=r(166960),g=[i.PLAY,i.SEEKING],v=[i.PAUSE,i.ENDED],p="definition_change_hint",_={SR_DEGRADE:"SR_DEGRADE"},y=function(e){(0,n.XW)(r,e);var t=(0,n.WY)(r);function r(){var e;(0,n.PA)(this,r);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),(0,n._x)((0,n.Lc)(e),"_srCore",null),(0,n._x)((0,n.Lc)(e),"_paintCount",0),(0,n._x)((0,n.Lc)(e),"_degradeCount",0),(0,n._x)((0,n.Lc)(e),"_loadDataPromise",(0,c.Qo)()),(0,n._x)((0,n.Lc)(e),"_usedSr",!1),(0,n._x)((0,n.Lc)(e),"_isOnSR",!1),(0,n._x)((0,n.Lc)(e),"_code",l.te.NOT_ACTIVE),(0,n._x)((0,n.Lc)(e),"_rateTimestamp",performance.now()),(0,n._x)((0,n.Lc)(e),"_logger",new d.Z("SRPlugin")),(0,n._x)((0,n.Lc)(e),"_codeDesc",{}),(0,n._x)((0,n.Lc)(e),"_appendFrameStat",null),(0,n._x)((0,n.Lc)(e),"_hasGLErrorCall",!1),(0,n._x)((0,n.Lc)(e),"_isVideoPlaybackQualitySupported",!1),(0,n._x)((0,n.Lc)(e),"_encrypted",!1),(0,n._x)((0,n.Lc)(e),"_hasDefinitionChanged",!1),(0,n._x)((0,n.Lc)(e),"_preVideoWidth",0),(0,n._x)((0,n.Lc)(e),"_preVideoHeihgt",0),(0,n._x)((0,n.Lc)(e),"_onDefinitionChange",function(){e._hasDefinitionChanged=!0}),(0,n._x)((0,n.Lc)(e),"_onTimeUpdate",function(){var t=e.video,r=t.videoWidth,n=t.videoHeight;(e._preVideoWidth!==r||e._preVideoHeihgt!==n)&&(e._preVideoWidth=r,e._preVideoHeihgt=n,e._hasDefinitionChanged&&e._isLimitWidthHeight&&(e._hasDefinitionChanged=!1,e._isLimitWidthHeight=!1,e.core.video?e._startRender():e.active(),e._logger.log("onTimeUpdate render")))}),(0,n._x)((0,n.Lc)(e),"_onEncrypted",function(){e._encrypted=!0,e._isOnSR&&(e._logger.log("onEncrypted degrade"),e._onDegrade(l.te.ENCRYPTED,{msg:"encrypted video"}))}),(0,n._x)((0,n.Lc)(e),"_onSRCodeChanged",function(t){e._code=t,e._logger.log("SRCodeChange",t),l.GK.indexOf(t)>-1&&e._srCore&&e._onDegrade(e._code,{msg:e._srCore.codeMsg,recover:!1})}),(0,n._x)((0,n.Lc)(e),"getPaintCount",function(){return e._paintCount}),(0,n._x)((0,n.Lc)(e),"_onRenderLost",function(){var t;e._appendFrameStat=null===(t=e._appendFrameStragty)||void 0===t?void 0:t.getStat(),e._destroyAppendFrame(),e._isOnSR=!1,e._unBind()}),(0,n._x)((0,n.Lc)(e),"_onRenderCallback",function(t){if(!!e._srCore)if(t.code===l.te.LIMIT_WIDTH_HEIGHT&&(e._isLimitWidthHeight=!0),0!==t.code){var r=l.eO[t.code],i=!1;r&&(t.algoMsg=r.msg,i=r.recover),e._srCore.statMark(h.E.RUNINFO);var o=e._srCore.getRuntimeInfo()+(null==t?void 0:t.errMsg);e._srCore.statEndMark(h.E.RUNINFO),e._onDegrade(l.te.WASM_RENDER_FAIL,(0,n.Zj)((0,n.Zj)({},t),{},{msg:t.code+" WASM_RENDER_FAIL "+o,recover:i}))}else e._isLimitWidthHeight=!1,e._usedSr=!0,e._code=l.te.SUCCESS,e._codeMsg="SUCCESS",e._calFps()}),(0,n._x)((0,n.Lc)(e),"_onRun",function(){e._srCore.readyPromise.then(function(){if(!!e._handleLimitResolution())e._loadDataPromise.then(function(){if(e._isOnSR&&e._srCore.code===l.te.SUCCESS){var t;null===(t=e._srCore)||void 0===t||t.run()}})})}),(0,n._x)((0,n.Lc)(e),"_onStop",function(){e._srCore.readyPromise.then(function(){if(e._isOnSR){var t;null===(t=e._srCore)||void 0===t||t.stop()}})}),(0,n._x)((0,n.Lc)(e),"_onLoadeddata",function(){e._loadDataPromise.resolve()}),e}return(0,n.qH)(r,[{key:"version",get:function(){return"1.0.9"}},{key:"core",get:function(){return this._srCore}},{key:"video",get:function(){var e=this.player;return e.media||e.video}},{key:"afterCreate",value:function(){var e=this,t=this.config,r=this.player;if(t.disabled){this._usedSr=!1,this._code=l.te.SR_DISABLED,this._logger.log("disabled");return}(r.video||r.media).addEventListener("encrypted",this._onEncrypted),r.on("encrypted",this._onEncrypted),r.on(p,this._onDefinitionChange),r.on(i.TIME_UPDATE,this._onTimeUpdate),Object.keys(l.te).forEach(function(t){e._codeDesc[l.te[t]]=t}),this._srCore=(0,u.s8)(t.isSingle,Object.assign({},t,{enableContextmenu:this.playerConfig.enableContextmenu,videoConfig:this.playerConfig.videoConfig||{}})),!t.isSingle&&this.active()}},{key:"_proxyVideoPlayQuality",value:function(){this._isVideoPlaybackQualitySupported=(0,s.rP)()}},{key:"active",value:function(){if(this._encrypted){this._logger.log("ACTIVE ENCRYPTED return"),this._onDegrade(l.te.ENCRYPTED,{msg:"encrypted video"});return}if(this._srCore.code===l.te.WASM_INIT_FAIL||this._srCore.code===l.te.WASM_LOADED_FAILED){this._srCore.code===l.te.WASM_LOADED_FAILED&&(0,u.LQ)(),this._logger.log("ACTIVE FAIL",this._srCore.code),this._code=this._srCore.code,!this._srCore.hasReport&&(this._srCore.hasReport=!0,this._onDegrade(this._code,{msg:this._srCore.codeMsg,recover:!1}));return}if(this._srCore.code===l.te.WEBGL_CONTEXT_LOST||[l.te.WASM_URL_MISS,l.te.HIJACK].includes(this._srCore.code)){this._code=this._srCore.code;return}var e=!!this.config.useDelayedSR&&this.config.isSingle,t=!this._srCore.isContextReady||this._code===l.te.WASM_NOT_READY;if(e&&t){this._code=l.te.WASM_NOT_READY,this._codeMsg="激活时超分未ready,并且设置useDelayedSR为false",this._isOnSR=!1;return}this._code=l.te.NOT_PLAY,this._logger.log("ACTIVE current stat notplay");var r=this.player;if(this._srCore.bindMediaElement(r.media||r.video,{onRenderCallback:this._onRenderCallback,onRenderLostCallback:this._onRenderLost,onSRCodeChanged:this._onSRCodeChanged}),this._isVideoPlaybackQualitySupported){var n=this.video.getVideoPlaybackQuality().totalVideoFrames;this._paintCount=n}this._unBind(),this._bindEvents(),this._startRender()}},{key:"_startRender",value:function(){var e=this;this._destroyAppendFrame();var t=this.config,r=t.threshold,n=t.minRenderCount;this._appendFrameStragty=new f.Z({isVFC:this._srCore.isUseVideoFrame,threshold:r,minRenderCount:n},this.player.media||this.player.video,function(t){e._paintCount=t}),this._isOnSR=!0,this._hasGLErrorCall=!1,this._tryRender()}},{key:"_calFps",value:function(){if(!!this._srCore){this._srCore.statMark(h.E.CALFPS);var e=this.config;if(this._srCore.isUseVideoFrame?this._paintCount+=this.video.playbackRate:this._paintCount++,!this._appendFrameStragty||!this._isVideoPlaybackQualitySupported){this._srCore.statEndMark(h.E.CALFPS);return}var t=this.video.getVideoPlaybackQuality(),r=t.droppedVideoFrames,n=t.totalVideoFrames;this._appendFrameStragty.record(performance.now(),n),this._dropRate=(n-this._appendFrameStragty.missFrames-this._paintCount)/n,this._dropRate<0&&(this._dropRate=Math.max(0,r/n)),this._srCore.recordDropRate(this._dropRate);var i=performance.now();this._dropRate>=e.degradeFrameRate&&n>100?i-this._rateTimestamp>1e3&&(this._rateTimestamp=i,this._degradeCount++,this._degradeCount>e.degradeFrameRateCount&&(this._degradeCount=0,this._onDegrade(l.te.FPS_DEGRADE,{msg:"FPS_DEGRADE",recover:!0,dropRate:this._srCore.getDropRate()}))):this._degradeCount=0,this._srCore.statEndMark(h.E.CALFPS)}}},{key:"_onDegrade",value:function(e,t){var r=t||{};this._logger.log("onDegrade, code: ".concat(e,", ext:").concat(JSON.stringify(t))),this._code=e,this._codeMsg=t.msg,this.emit(_.SR_DEGRADE,(0,n.Zj)((0,n.Zj)({code:e},r),{},{defaultRenderDelta:1e3/this.config.minRenderCount})),this._srCore.unBindMediaElement(),this._isOnSR=!1}},{key:"_bindEvents",value:function(){var e=this;g.forEach(function(t){e.on(t,e._onRun)}),v.forEach(function(t){e.on(t,e._onStop)})}},{key:"_isLimitResolution",value:function(){var e=this.config,t=e.maxWdith,r=e.maxHeight;return!!(this.video.videoWidth>t)||!!(this.video.videoHeight>r)||!1}},{key:"_handleLimitResolution",value:function(){return!this._isLimitResolution()||(this._code=l.te.LIMIT_WIDTH_HEIGHT,this._logger.log("LIMIT_WIDTH_HEIGHT"),!1)}},{key:"_unBind",value:function(){var e=this;this.player&&(g.forEach(function(t){e.off(t,e._onRun)}),v.forEach(function(t){e.off(t,e._onStop)}))}},{key:"_tryRender",value:function(){var e=this;this.video.readyState>=2?this._loadDataPromise.resolve():this.on("loadeddata",this._onLoadeddata),Promise.all([this._loadDataPromise,this._srCore.readyPromise]).then(function(){if(e._logger.log("tryRender width:".concat(e.video.videoWidth,", height:").concat(e.video.videoHeight)),e._isOnSR&&e._srCore.isContextReady&&e._handleLimitResolution()){var t;null===(t=e._srCore)||void 0===t||t.doRender()}}).catch(function(){})}},{key:"_unbindVideoPlayQuality",value:function(){}},{key:"_destroyAppendFrame",value:function(){this._appendFrameStragty&&(this._appendFrameStragty.destroy(),this._appendFrameStragty=null)}},{key:"fps",get:function(){return this._fps}},{key:"isPlaybackUsedSR",value:function(){return this._usedSr}},{key:"getReason",value:function(){return this._code}},{key:"destroy",value:function(){var e,t;this._unbindVideoPlayQuality(),this.off("loadeddata",this._onLoadeddata),this._unBind(),null===(e=this.player)||void 0===e||e.off(i.TIME_UPDATE,this._onTimeUpdate),null===(t=this.player)||void 0===t||t.off(p,this._onDefinitionChange),this._loadDataPromise=null,this._appendFrameStragty&&this._appendFrameStragty.destroy(),this._appendFrameStragty=null,!this.config.isSingle&&this._srCore.destroy(),this._srCore=null}},{key:"getStat",value:function(){var e,t,r,i=this._srCore?this._srCore.getStat():{},a=this._appendFrameStat?this._appendFrameStat:null===(e=this._appendFrameStragty)||void 0===e?void 0:e.getStat(),s=this.player.video||this.player.media;return(0,n.Zj)((0,n.Zj)({width:this.video.videoWidth,height:this.video.videoHeight,playbackRate:this.video.playbackRate,mediaTime:null===(t=this.video)||void 0===t?void 0:t.currentTime,presentedFrames:this._paintCount,isPlaybackUsedSR:this.isPlaybackUsedSR(),usingSR:o.ZP.hasClass(s.parentElement,u.Xv),reason:this._code,reasonDesc:this._codeMsg||(null===(r=this._srCore)||void 0===r?void 0:r.codeMsg)||this._codeDesc[this._code],isLimitResolution:this._isLimitResolution(),isDestroyed:null===this._srCore},i),a)}},{key:"getLog",value:function(){var e=this._srCore.getLog()+"\n"+this._logger.getLogs();return this.emit("log",{type:"oneevent",end_type:"srlog",log:e}),e}},{key:"setRunning",value:function(e){if(!!this._srCore){if(this._srCore.statMark(h.E.SETRUNNING),this.config.disabled){this._srCore.statMark(h.E.SETRUNNING);return}this._isOnSR?(this._srCore.setRunning(e),!e&&(this._isOnSR=!1)):e&&(this._isOnSR=!0,this._srCore.setRunning(e)),this._srCore.statEndMark(h.E.SETRUNNING)}}}],[{key:"defaultConfig",get:function(){return(0,l.Rl)({})}},{key:"pluginName",get:function(){return"srplugin"}},{key:"isSupported",value:function(){return(0,s.Gb)()}},{key:"preload",value:function(e){(0,u.s8)(e.isSingle,e)}}]),r}(a.ZP)},458862:function(e,t,r){function n(){var e,t,r=new Promise(function(r,n){e=r,t=n});return r.resolve=function(){return e.apply(void 0,arguments)},r.reject=function(){return t.apply(void 0,arguments)},r}function i(e,t){var r;return function(){var n=arguments,i=this;clearTimeout(r),r=setTimeout(function(){e.apply(i,n)},t)}}function o(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=0,i=0;return function(){for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];var u=performance.now();if(r&&r.apply(this),u-n<t){clearTimeout(i),i=setTimeout(function(){n=u,e.apply(void 0,a)},200);return}clearTimeout(i),n=u,e.apply(void 0,a)}}r.d(t,{Ds:function(){return i},P2:function(){return o},QC:function(){return function e(t){var r=!0,n=Object.prototype.toString,i=Function.prototype.toString;if(Array.isArray(t))r=t.reduce(function(t,r){return t&&e(r)},r);else{var o=RegExp("^".concat(String(n).replace(/[.*+?^${}()|[\]\/\\]/g,"\\$&").replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),"$"));r="function"==typeof t&&o.test(i.call(t))}return r}},Qo:function(){return n}})},204828:function(e,t,r){r.d(t,{P:function(){return i}});var n=r(989798);r(864614),r(210434);function i(e,t,r){var i=r.isOpen,o=r.enable266,a=r.filterKey,s=r.filterList,u=r.scoreMultiple,c=r.type;if(!i)return e;var l=null;return("filter"===c?l=function(e,t,r,n){var i=null;if(r.forEach(function(r){r.source===t[e]&&(i=r)}),!i)return null;for(var o=null,a=function(t){if(i.target.forEach(function(r){n[t][e]===r&&(o=n[t])}),o)return 1},s=0;s<n.length&&!a(s);s++);return o}(a,e,s,t):"multiple"===c&&(l=function(e,t,r){if(!e)return null;for(var n=-1,i=0;i<r.length;i++)if(t.definition===r[i].definition){n=i;break}if(n>-1&&n<r.length-1){var o=n+e>r.length-1?r.length-1:n+e;return r[o]}return null}(u,e,t)),l&&(!l.isH266||o))?(0,n.Zj)((0,n.Zj)({},l),{},{type:"overscore",fromType:e.type,orgDefinition:e.definition}):e}},406406:function(e,t,r){r.d(t,{KR:function(){return u},Rr:function(){return s},dJ:function(){return a}});var n,i,o,a=((n=a||{})[n.DURATION=0]="DURATION",n[n.SIZE=1]="SIZE",n);var s=((i=s||{})[i.INDEXDB=0]="INDEXDB",i[i.MEMORY=1]="MEMORY",i);var u=((o=u||{}).PRELOAD_NEXT="PRELOAD_NEXT",o.PRELOAD_START="PRELOAD_START",o.PRELOAD_CANCEL="PRELOAD_CANCEL",o)},246020:function(e,t,r){r.d(t,{Z:function(){return m}});var n=r(673295);r(766282),r(864614),r(632852),r(514312),r(379493),r(121621),r(616414),r(612222);var i=r(368240),o=r(51891),a=r(493820),s=r(409684),u=r(630050),c={},l="readonly",d="readwrite";function f(e){var t=c[e.name],r={};r.promise=new Promise(function(e,t){r.resolve=e,r.reject=t}),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then(function(){return r.promise}):t.dbReady=r.promise}function h(e,t){return new Promise(function(r,n){if(c[e.name]=c[e.name]||y(),e.db){if(!t)return r(e.db);f(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=null===o.Z||void 0===o.Z?void 0:o.Z.open.apply(o.Z,i);t&&(a.onupgradeneeded=function(t){var r=a.result;try{r.createObjectStore(e.storeName)}catch(e){if("ConstraintError"===e.name);else throw e}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){r(a.result),!function(e){var t=c[e.name].deferredOperations.pop();if(t)t.resolve(),t.promise}(e)}})}function g(e){return h(e,!1)}function v(e){return h(e,!0)}function p(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version,e.version=e.db.version),i||r){if(r){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function _(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return Promise.resolve().then(function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),h(e,!0)}).then(function(){return(function(e){f(e);for(var t=c[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,h(e,!1).then(function(t){if(e.db=t,p(e))return h(e,!0);return t}).then(function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n}).catch(function(t){throw!function(e,t){var r=c[e.name].deferredOperations.pop();if(r)r.reject(t),r.promise}(e,t),t})})(e).then(function(){_(e,t,r,n-1)})}).catch(r);r(i)}}function y(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}let m=function(){function e(){(0,n.PA)(this,e)}return(0,n.qH)(e,[{key:"ready",value:function(){return this._ready}},{key:"_initStorage",value:function(e){var t=this;t._defaultConfig=e;var r={db:null,name:"",version:""};if(e)for(var n in e)r[n]=e[n];var i=c[r.name];!i&&(i=y(),c[r.name]=i),i.forages.push(t),!t._initReady&&(t._initReady=t.ready,t._ready=t._fullyReady);var o=[];function a(){return Promise.resolve()}for(var s=0;s<i.forages.length;s++){var u=i.forages[s];u!==t&&o.push(u._initReady().catch(a))}var l=i.forages.slice(0);return t._ready=Promise.all(o).then(function(){return r.db=i.db,h(r,!1)}).then(function(e){if(r.db=e,p(r,t._defaultConfig.version))return h(r,!0);return e}).then(function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<l.length;n++){var o=l[n];o!==t&&(o._dbInfo.db=r.db,o._dbInfo.version=r.version)}}),t._ready}},{key:"probeSupport",get:function(){return(0,i.Z)()}},{key:"getItem",value:function(e,t){var r=this;e=(0,u.Z)(e);var n=new Promise(function(t,n){r.ready().then(function(){_(r._dbInfo,l,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),t(e)},a.onerror=function(){n(a.error)}}catch(e){n(e)}})}).catch(n)});return(0,a.Z)(n,t),n}},{key:"setItem",value:function(e,t,r){var n=this;e=(0,u.Z)(e);var i=new Promise(function(r,i){n.ready().then(function(){return n._dbInfo,t}).then(function(t){_(n._dbInfo,d,function(o,a){if(o)return i(o);try{var s=a.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var u=s.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),r(t)},a.onabort=a.onerror=function(){var e=u.error?u.error:u.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)});return(0,a.Z)(i,r),i}},{key:"removeItem",value:function(e,t){var r=this;e=(0,u.Z)(e);var n=new Promise(function(t,n){r.ready().then(function(){_(r._dbInfo,d,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){n(a.error)},o.onabort=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}})}).catch(n)});return(0,a.Z)(n,t),n}},{key:"clear",value:function(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){_(t._dbInfo,d,function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return(0,a.Z)(r,e),r}},{key:"length",value:function(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){_(t._dbInfo,l,function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){r(o.error)}}catch(e){r(e)}})}).catch(r)});return(0,a.Z)(r,e),r}},{key:"all",value:function(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){_(t._dbInfo,l,function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).openCursor(),a=[];o.onsuccess=function(){var t=o.result;if(!t){e(a);return}a.push({key:t.key,value:t.value}),t.continue()},o.onerror=function(){r(o.error)}}catch(e){r(e)}})}).catch(r)});return(0,a.Z)(r,e),r}},{key:"_fullyReady",value:function(e){var t=this,r=t._initReady().then(function(){var e=c[t._dbInfo.name];if(null!=e&&e.dbReady)return e.dbReady});return(0,s.Z)(r,e,e),r}},{key:"getItemSync",value:function(){throw Error("NotSupported")}}]),e}()},677521:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(6214);r(864614),r(632852);var i=function(){function e(){(0,n.PA)(this,e);var t,r,i=new Promise(function(e,n){t=e,r=n});return i.resolve=t,i.reject=r,i}return(0,n.qH)(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}()},394494:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(6214);r(514312),r(227470),r(766282),r(614521);var i=function(){function e(){(0,n.PA)(this,e)}return(0,n.qH)(e,null,[{key:"parse",value:function(t){var r=e.parseXmlString(t);return null!==r?e.parseDOMChildren(r):null}},{key:"parseXmlString",value:function(e){if(void 0===e)return null;var t,r=new window.DOMParser;try{(t=r.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}return t}},{key:"parseDOMChildren",value:function(t,r){if(t.nodeType===Node.DOCUMENT_NODE){for(var n={},i=t.childNodes,o=0;o<i.length;o++){var a=i[o];a.nodeType===Node.ELEMENT_NODE&&(n=e.parseDOMChildren(a))}return n}if(t.nodeType===Node.ELEMENT_NODE){var s={};s.__cnt=0;for(var u=[],c=t.childNodes,l=0;l<c.length;l++){var d=c[l],f=e.getNodeLocalName(d);if(d.nodeType!==Node.COMMENT_NODE){var h="".concat(r,".").concat(f);if(s.__cnt++,null==s[f]){var g=e.parseDOMChildren(d,h);if("#text"!==f||/[^\s]/.test(g)){var v={};v[f]=g,u.push(v)}s[f]=g,e.toArrayAccessForm(s,f)}else{null!=s[f]&&!(s[f]instanceof Array)&&(s[f]=[s[f]],e.toArrayAccessForm(s,f,h));var p=e.parseDOMChildren(d,h);if("#text"!==f||/[^\s]/.test(p)){var _={};_[f]=p,u.push(_)}s[f][s[f].length]=p}}}for(var y=0;y<t.attributes.length;y++){var m=t.attributes[y];s.__cnt++;var C=m.value;s[m.name]=C}var b=t.prefix;return null!=b&&""!==b&&(s.__cnt++,s.__prefix=b),null!=s["#text"]&&(s.__text=s["#text"],s.__text instanceof Array&&(s.__text=s.__text.join("\n")),delete s["#text"],delete s["#text_asArray"]),null!=s["#cdata-section"]&&(s.__cdata=s["#cdata-section"],delete s["#cdata-section"],delete s["#cdata-section_asArray"]),1===s.__cnt&&null!=s.__text?s=s.__text:1===s.__cnt&&null!=s.__cdata&&(s=s.__cdata),delete s.__cnt,s}if(t.nodeType===Node.TEXT_NODE||t.nodeType===Node.CDATA_SECTION_NODE)return t.nodeValue}},{key:"getNodeLocalName",value:function(e){var t=e.localName;return null==t&&(t=e.baseName),(null==t||""===t)&&(t=e.nodeName),t}},{key:"toArrayAccessForm",value:function(e,t){!(e[t]instanceof Array)&&(e[t]=[e[t]])}}]),e}()},874918:function(e,t,r){r.d(t,{Z:function(){return n}});var n=(0,r(68950).p)("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIGRlY29kZXIgPSBudWxsOwoKICB2YXIgZnJhbWVRdWV1ZSA9IFtdOwoKICB2YXIgcmVjZWl2ZUZyYW1lVGltZXIgPSAwOwoKICB2YXIgaGFzUmVjZWl2ZUZyYW1lID0gZmFsc2U7CgogIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CiAgICBzd2l0Y2ggKGUuZGF0YS5tc2cpIHsKICAgICAgY2FzZSAnY29uZmlndXJhdGlvbic6CiAgICAgICAgZGVjb2RlciA9IG5ldyBzZWxmLlZpZGVvRGVjb2Rlcih7CiAgICAgICAgICBvdXRwdXQ6IGZ1bmN0aW9uIChmcmFtZSkgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZGVjb2RlZCEnLCBkZWNvZGVyLmRlY29kZVF1ZXVlU2l6ZSwgZnJhbWVRdWV1ZS5sZW5ndGgpCgogICAgICAgICAgICBoYXNSZWNlaXZlRnJhbWUgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKHJlY2VpdmVGcmFtZVRpbWVyKSB7CiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHJlY2VpdmVGcmFtZVRpbWVyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgZiA9IGZyYW1lUXVldWUuc2hpZnQoKTsKICAgICAgICAgICAgaWYgKCFmKSB7CiAgICAgICAgICAgICAgZnJhbWUuY2xvc2UoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIHR5cGU6ICdERUNPREVEJywKICAgICAgICAgICAgICAgIHdpZHRoOiBmcmFtZS5kaXNwbGF5V2lkdGgsCiAgICAgICAgICAgICAgICBoZWlnaHQ6IGZyYW1lLmRpc3BsYXlIZWlnaHQsCiAgICAgICAgICAgICAgICBpbmZvOiBmLAogICAgICAgICAgICAgICAgYnVmZmVyOiBmcmFtZQogICAgICAgICAgICAgIH0sIFtmcmFtZV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGVjb2Rlci5kZWNvZGVRdWV1ZVNpemUgPT09IGZyYW1lUXVldWUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICB0eXBlOiAnQkFUQ0hfRklOSVNIX0ZMQUcnCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1tXZWJjb2RlY1dvcmtlcl06JywgZSk7CiAgICAgICAgICAgIGlmIChlLm1lc3NhZ2UgPT09ICdDb2RlYyByZWNsYWltZWQgZHVlIHRvIGluYWN0aXZpdHkuJykgcmV0dXJuCiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgIHR5cGU6ICdGQUlMRUQnLAogICAgICAgICAgICAgIG1lc3NhZ2U6IGUgJiYgZS5tZXNzYWdlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHNlbGYuVmlkZW9EZWNvZGVyLmlzQ29uZmlnU3VwcG9ydGVkKGUuZGF0YS5kYXRhKQogICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHN0YXR1cykgewogICAgICAgICAgICBpZiAoc3RhdHVzLnN1cHBvcnRlZCkgewogICAgICAgICAgICAgIGRlY29kZXIuY29uZmlndXJlKGUuZGF0YS5kYXRhKTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1dlYmNvZGVjV29ya2VyXTonLCAnaXNDb25maWdTdXBwb3J0ZWQnLCBzdGF0dXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgdHlwZTogJ0RFQ09ERVJfUkVBRFknIH0pOwoKICAgICAgICAgICAgLy8g5o6i5rWL6ZW/5pe26Ze05peg6Kej56CB5bin6L6T5Ye6LOmZjee6p+WIsHdhc20KICAgICAgICAgICAgcmVjZWl2ZUZyYW1lVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICBpZiAoaGFzUmVjZWl2ZUZyYW1lKSByZXR1cm4KICAgICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgdHlwZTogJ0ZBSUxFRCcsIG1lc3NhZ2U6ICdubyBmcmFtZSBvdXRwdXQnIH0pOwogICAgICAgICAgICB9LCAyMDAwKTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgdHlwZTogJ0ZBSUxFRCcsCiAgICAgICAgICAgICAgbWVzc2FnZTogZSAmJiBlLm1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICBicmVhawogICAgICBjYXNlICdkZWNvZGUnOgogICAgICAgIHZhciBkID0gZS5kYXRhLmRhdGE7CgogICAgICAgIHZhciBzYW1wbGVJbmZvID0gZS5kYXRhLmluZm87CgogICAgICAgIGZyYW1lUXVldWUucHVzaChzYW1wbGVJbmZvKTsKCiAgICAgICAgdmFyIGZyYW1lU2l6ZSA9IGQuYnl0ZUxlbmd0aCAtIDQ7CgogICAgICAgIHZhciBkdiA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoNCkpOwoKICAgICAgICBkdi5zZXRVaW50MzIoMCwgZnJhbWVTaXplLCBmYWxzZSk7CgogICAgICAgIGQuc2V0KG5ldyBVaW50OEFycmF5KGR2LmJ1ZmZlciksIDApOwoKICAgICAgICBpZiAoc2FtcGxlSW5mby5rZXlmcmFtZSkgewogICAgICAgICAgZGVjb2Rlci5mbHVzaCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNodW5rID0gbmV3IHNlbGYuRW5jb2RlZFZpZGVvQ2h1bmsoewogICAgICAgICAgdHlwZTogc2FtcGxlSW5mby5rZXlmcmFtZSA/ICdrZXknIDogJ2RlbHRhJywKICAgICAgICAgIHRpbWVzdGFtcDogc2FtcGxlSW5mby5wdHMsCiAgICAgICAgICBkYXRhOiBkCiAgICAgICAgfSk7CiAgICAgICAgZGVjb2Rlci5kZWNvZGUoY2h1bmspOwogICAgICAgIGJyZWFrCiAgICAgIGNhc2UgJ2Rlc3Ryb3knOgogICAgICAgIGlmIChkZWNvZGVyKSB7CiAgICAgICAgICBkZWNvZGVyLmZsdXNoKCk7CiAgICAgICAgICBkZWNvZGVyLmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIGNsZWFyVGltZW91dChyZWNlaXZlRnJhbWVUaW1lcik7CiAgICAgICAgYnJlYWsKICAgICAgY2FzZSAnY2hlY2tEZWNvZGUnOgogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ0NIRUNLX1RPX0RFQ09ERScsCiAgICAgICAgICBkYXRhOiBNYXRoLmFicyhkZWNvZGVyLmRlY29kZVF1ZXVlU2l6ZSAtIGZyYW1lUXVldWUubGVuZ3RoKSA9PT0gMAogICAgICAgIH0pOwogICAgICAgIGJyZWFrCiAgICB9CiAgfSk7Cgp9KCkpOwoK",null,!1)},602837:function(e,t,r){r.d(t,{Z:function(){return y}}),r("530129");var n=r("247425"),i=r("938156"),o=r("440669"),a=r("356670"),s=r("269277"),u=r("917970"),c=r("197201");r("514312"),r("842903");var l=r("495728"),d=r("303075"),f=r("992117"),h=r("917971"),g=r("720202"),v=r("364508"),p=function(){function e(t){(0,n.Z)(this,e),this.TAG="DecodeEstimate",this._lowDecodeThreshold=(0,v.tT)().lowDecodeThreshold/5,this._lowDecodeFpsDelta=(0,v.tT)().lowDecodeFpsDelta,this._needEstimate=!0,this._parent=t,this._lastDecodeDot=0,this._lastDecodeCost=0,this._lastFrameDts=0,this._dtsDeltas=[],this._decodeCosts=[],this._lowDecodeQueue=[],this._fps=0,this._decodeFps=0,this._gopLength=0,this._webcodec=!1}return(0,i.Z)(e,[{key:"fps",get:function(){return this._fps}},{key:"decodeFps",get:function(){return this._decodeFps}},{key:"decodeCost",get:function(){return this._lastDecodeCost}},{key:"gopLength",get:function(){return this._gopLength}},{key:"webcodec",set:function(e){this._webcodec=e}},{key:"updateGopCount",value:function(){this._gopLength++}},{key:"needEstimateFps",value:function(){this._needEstimate=!0}},{key:"addDecodeInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dts:0};this._estimateDecodeFps(e),this._estimateFps(e)}},{key:"resetDecodeDot",value:function(e){this._lastDecodeDot=e||0}},{key:"reset",value:function(){this._decodeCosts=[],this._lowDecodeQueue=[]}},{key:"_estimateFps",value:function(e){if(!this._needEstimate)return;if(!this._lastFrameDts){this._lastFrameDts=e.dts;return}var t=e.dts-this._lastFrameDts;if(this._lastFrameDts=e.dts,!(Math.abs(t)>200)){this._dtsDeltas.push(t);var r=this._dtsDeltas.length;!(r<5)&&(this._fps=Math.ceil(1e3/this._avg(this._dtsDeltas,r)),l.kg.log(this.TAG,"estimate fps:",this._fps),this._needEstimate=!1)}}},{key:"_estimateDecodeFps",value:function(e){if(!this._lastDecodeDot){this._lastDecodeDot=performance.now();return}var t=performance.now(),r=t-this._lastDecodeDot;this._lastDecodeDot=t,e.cost=r,this._lastDecodeCost=r,this._decodeCosts.push(r);var n=this._decodeCosts.length;if(!(n<5)){var i=this._avg(this._decodeCosts,n);this._decodeFps=Math.floor(1e3/i),this._decodeCosts=[],this._lowDecodeDetect()}}},{key:"_avg",value:function(e,t){return Math.floor(e.reduce(function(e,t){return e+=t},0)/t)||1}},{key:"_lowDecodeDetect",value:function(){if(!this._decodeFps){this._parent.emit(g.ZP.VIDEO.DECODE_LOW_FPS,0);return}this._decodeFps<this._fps*this._parent.playbackRate+(this.webcodec?0:this._lowDecodeFpsDelta)?this._lowDecodeQueue.push(this._decodeFps):this._lowDecodeQueue.pop(),this._lowDecodeQueue.length>this._lowDecodeThreshold&&(this._lowDecodeQueue=[],l.kg.log(this.TAG,"解码效率过低,应该降级"),this._parent.emit(g.ZP.VIDEO.DECODE_LOW_FPS,this._decodeFps))}},{key:"destroy",value:function(){this._parent=null}}]),e}(),_=r("359834"),y=function(e){(0,s.Z)(v,e);var t,r,d=(t=v,r=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,c.Z)(t);return e=r?Reflect.construct(n,arguments,(0,c.Z)(this).constructor):n.apply(this,arguments),(0,u.Z)(this,e)});function v(e,t){var r;return(0,n.Z)(this,v),(r=d.call(this,e,t))._timeRange=new f.Z((0,o.Z)(r)),r._decodeEstimate=new p((0,o.Z)(r)),r._frameQueue=new h.Z((0,o.Z)(r)),r._lastTimeupdate=0,r._renderCost=0,r._canAutoPlay=!0,r._videoDecode=!1,r._inSeeking=!1,r._frameRender=null,r._configuration=null,r._canvasLayoutDone=!1,r._render=r._render.bind((0,o.Z)(r)),r._renderWorker=new _.Z(r._render,e,(0,o.Z)(r)),r._canvas=r._renderWorker.canvas,r._bindEvents(),r}return(0,i.Z)(v,[{key:"canAutoPlay",get:function(){return this._canAutoPlay}},{key:"canvas",get:function(){return this._canvas}},{key:"timescale",get:function(){return 1e3}},{key:"fps",get:function(){return this._decodeEstimate.fps||this._meta&&this._meta.fpsNum/this._meta.fpsDen||24}},{key:"decodeFps",get:function(){return this._decodeEstimate.decodeFps}},{key:"decodeCost",get:function(){return this._decodeEstimate.decodeCost}},{key:"renderCost",get:function(){return this._renderCost}},{key:"totalSize",get:function(){return this._timeRange.totalSize}},{key:"bitrate",get:function(){return this._timeRange.bitrate},set:function(e){this._timeRange.bitrate=e}},{key:"gopLength",get:function(){return this._decodeEstimate.gopLength}},{key:"is540p",get:function(){return this._canvas.height<720}},{key:"buffered",get:function(){return this._timeRange.buffered}},{key:"inSeeking",get:function(){return this._inSeeking}},{key:"interval",get:function(){return Math.floor(1e3/this.fps/this.playbackRate)}},{key:"playbackRate",get:function(){return this._playbackRate||1}},{key:"baseDts",get:function(){return this._timeRange.baseDts}},{key:"currentTime",get:function(){return this._timeRange.getCurrentTime(this.preciseVideoDts)}},{key:"timelinePosition",get:function(){return this._parent.timelinePosition}},{key:"lastTimelinePosition",get:function(){return this._lastTimelinePosition||0},set:function(e){this._lastTimelinePosition=e}},{key:"audioSyncDts",get:function(){return this._audioDts||this.baseDts},set:function(e){this._audioDts=e}},{key:"preciseVideoDts",get:function(){return this.audioSyncDts+Math.floor((this.timelinePosition-this.lastTimelinePosition)*1e3)}},{key:"readyState",get:function(){var e=this._frameQueue.length||(this.currentTime?1:0);return e?e>=8?4:e>=4?3:e>=2?2:1:0}},{key:"isHevc",get:function(){return!("hev1.1.6.L93.B0"!==(this._meta||{}).codec)}},{key:"videoDecode",get:function(){return this._videoDecode}},{key:"decoderMode",get:function(){var e;return null===(e=this._decodeController)||void 0===e?void 0:e.decoderMode}},{key:"configuration",get:function(){var e,t;return this._configuration?this._configuration:(this._configuration=this._meta.configuration||(0,l.Mv)(null===(e=this._meta)||void 0===e?void 0:e.sps[0],null===(t=this._meta)||void 0===t?void 0:t.pps[0]),this._configuration)},set:function(e){this._configuration=e.configuration||(0,l.Mv)(e.sps[0],e.pps[0])}},{key:"setSeekingStatus",value:function(e){this._inSeeking=e}},{key:"getDtsOfTime",value:function(e){return this._timeRange.getDtsOfTime(e)}},{key:"updateReady",value:function(){this._whenReady()}},{key:"forceRender",value:function(){this._render(!0)}},{key:"getSeekStartPosition",value:function(e,t){return this._timeRange.getSeekStartPosition(e,t)}},{key:"getSeekStartPositionBehind",value:function(e,t){return this._timeRange.getSeekStartPositionBehind(e,t)}},{key:"canSeek",value:function(){throw Error("need override by children")}},{key:"emitResizeEvent",value:function(){this===null||void 0===this||this._emitTimelineEvents(g.ZP.TIMELINE.PLAY_EVENT,g.ZP.VIDEO_EVENTS.RESIZE)}},{key:"_assembleErr",value:function(e,t){var r=Error(e);return r.code=3,r.subCode=t,r}},{key:"_emitError",value:function(e,t){this._emitTimelineEvents(g.ZP.TIMELINE.PLAY_EVENT,g.ZP.VIDEO_EVENTS.ERROR,this._assembleErr(e,t))}},{key:"_emitTimelineEvents",value:function(e,t,r){var n;null===(n=this._parent)||void 0===n||n.emit(e,t,r)}},{key:"_bindEvents",value:function(){var e=this;(0,a.Z)((0,c.Z)(v.prototype),"_bindEvents",this).call(this);var t=function(t){var r=t.width,n=t.height,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=e._canvas,s=a.width,u=a.height,c=n*s/u,d=r*u/s,f=r-c,h=n-d,g=f*i+"px",v=h*o+"px";e._canvas.style.left=g,e._canvas.style.top=v,l.kg.warn(e.TAG,"cvsWidth=".concat(s,", cvsHeight=").concat(u,", scaleCvsWidth=").concat(c,", scaleCvsHeight=").concat(d)),l.kg.warn(e.TAG,"cover position: deltaX=".concat(f,", deltaY=").concat(h,", width=").concat(r,", height=").concat(n,", pX=").concat(g,", pY=").concat(v))};this._parent.on(g.ZP.VIDEO.UPDATE_VIDEO_FILLTYPE,function(r,n){var i=n.width,o=n.height,a=e._canvas,s=a.width,u=a.height,c=!i||i/o>s/u;if(l.kg.warn(e.TAG,"UPDATE_VIDEO_FILLTYPE isGapX =",c,"type =",r,s,u,i,o),e._canvas.style.maxWidth="initial",e._canvas.style.maxHeight="initial","cover"===r){if(c){e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.height="auto",e._canvas.style.width="100%",t({width:i,height:o},0,.5);return}e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.width="auto",e._canvas.style.height="100%",t({width:i,height:o},.5,0);return}if("fill"===r){e._canvas.style.width="100%",e._canvas.style.height="100%";return}e._canvas.style.top=0,e._canvas.style.bottom=0,e._canvas.style.left=0,e._canvas.style.right=0,e._canvas.style.maxWidth="100%",e._canvas.style.maxHeight="100%",e._canvas.style.width="initial",e._canvas.style.height="initial",s<i&&u<o&&(s/i>u/o?e._canvas.style.width="100%":e._canvas.style.height="100%")}),this._parent.on(g.ZP.VIDEO.UPDATE_VIDEO_COVER_POSITION,t),this._parent.on(g.ZP.TIMELINE.SYNC_DTS,function(t){var r,n=e._frameQueue.nextFrame(),i=n&&n.info&&n.info.dts;if(e.lastTimelinePosition=e.timelinePosition,e.noAudio){var o=e._timeRange.nextFrame();t=t||i||o&&o.dts||0}if(e.audioSyncDts=t,i&&i-t>500&&e._emitTimelineEvents(g.ZP.TIMELINE.PLAY_EVENT,g.ZP.VIDEO_EVENTS.LARGE_AV_GAP,{aDts:t,vDts:i,frameLength:e._frameQueue.length,currentTime:e._parent.currentTime,duration:e._parent.duration}),l.kg.log(e.TAG,"audio current buffer play finish, next buffer dts=",t,"currentTime:",e._parent.currentTime,"preciseVideoDts:",e.preciseVideoDts,"next video frame dts:",i,"frame length:",e._frameQueue.length),!e._isLive&&!(null!==(r=e._parent)&&void 0!==r&&r.seeking)){var a=e._timeRange.nextFrame();if(a){var s=(a.dts-a.baseDts)/1e3;e._parent.currentTime-s>1&&(l.kg.warn(e.TAG,"丢帧!"),e.ajustSeekTime(e._parent.currentTime))}}}),this._parent.on(g.ZP.TIMELINE.UPDATE_GL_OPTIONS,function(t){e._config.glCtxOptions=t}),this._parent.on(g.ZP.TIMELINE.UPDATE_SEGMENT_END,this._updateSegmentEnd.bind(this)),this.on(g.ZP.VIDEO.AUTO_RUN,this._startRender.bind(this)),this._parent.on(g.ZP.TIMELINE.SET_PLAYBACKRATE,function(t){e._playbackRate=t,e._startRender()})}},{key:"ajustSeekTime",value:function(){throw Error("need override by children")}},{key:"_resetDts",value:function(e,t){"audio"!==t&&this._timeRange.resetDts(e)}},{key:"_setMetadata",value:function(e,t){if("audio"!==e){l.kg.warn(this.TAG,"video set metadata"),this._meta=t;var r=t&&t.frameRate&&t.frameRate.fps;r?l.kg.log(this.TAG,"detect fps:",r):l.kg.warn(this.TAG,"no detect fps,start estimate"),this._initDecoder()}}},{key:"_initDecoder",value:function(){throw Error("need override by children")}},{key:"_whenDecoderReady",value:function(){throw Error("need override by children")}},{key:"_appendChunk",value:function(){throw Error("need override by children")}},{key:"_startDecode",value:function(){throw Error("need override by children")}},{key:"_receiveFrame",value:function(e,t){if(!!this._parent&&!!this._timeRange){var r=e.info||{};if(this._decodeEstimate.addDecodeInfo(r),this._checkCanvasLayout(e),!this._isLive&&((r.output||r.keyframe)&&(this.setSeekingStatus(!1),l.kg.warn(this.TAG,"set seeking status=",!1)),this.inSeeking)){l.kg.log(this.TAG,"drop frame"),(0,h.s)(e);return}this._isLive?this._frameQueue.append(e):this._frameQueue.appendVodFrame(e),t&&t(),!this._ready&&this.readyState>=1&&this._whenReady()}}},{key:"_checkCanvasLayout",value:function(e){!this._canvasLayoutDone&&e.width===this._canvas.width&&(e.width/e.height).toFixed(2)===(this._canvas.width/this._canvas.height).toFixed(2)&&(this===null||void 0===this||this._emitTimelineEvents(g.ZP.TIMELINE.PLAY_EVENT,g.ZP.VIDEO_EVENTS.CANVAS_LAYOUT),this._canvasLayoutDone=!0)}},{key:"_startRender",value:function(){l.kg.log(this.TAG,"start render"),this._renderWorker.startLoop(this.interval)}},{key:"_render",value:function(){throw Error("need override by children")}},{key:"_updateSegmentEnd",value:function(){throw Error("need override by children")}},{key:"_whenReady",value:function(){this._ready=!0,this.emit(g.ZP.VIDEO.VIDEO_READY),this.noAudio&&this._emitTimelineEvents(g.ZP.TIMELINE.PLAY_EVENT,g.ZP.VIDEO_EVENTS.PLAYING)}},{key:"_doPlay",value:function(){this._renderWorker.startLoop()}},{key:"_doPause",value:function(){this._renderWorker.stopLoop()}},{key:"_doSeek",value:function(){this._ready=!1,this._frameQueue.destroy()}},{key:"_doChaseFrame",value:function(){throw Error("need override by children")}},{key:"destroy",value:function(e){var t,r,n,i,o,a;null===(t=this._renderWorker)||void 0===t||t.destroy(e),null===(r=this._timeRange)||void 0===r||r.destroy(),null===(n=this._frameQueue)||void 0===n||n.destroy(),null===(i=this._frameRender)||void 0===i||null===(o=i.destroy)||void 0===o||o.call(i),null===(a=this._decodeEstimate)||void 0===a||a.destroy(),this._renderWorker=null,this._canvas=null,this._timeRange=null,this._frameQueue=null,this._frameRender=null,this._decodeEstimate=null,this._parent=null,this.removeAllListeners()}}]),v}(d.Z)},252542:function(e,t,r){r.d(t,{Z:function(){return a}}),r(121621),r(864614),r(812735),r(623302),r(983431),r(319386),r(657170),r(853127),r(644952),r(759149),r(949136),r(966922),r(33814),r(29536),r(716005),r(548485),r(260075),r(791017),r(743286),r(310378),r(124539),r(48498),r(728271),r(814647),r(535689),r(659673),r(561999);var n=[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,624,592,944,912,1008,976,816,784,880,848],i=[-32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,-23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,-15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,-11900,-11388,-10876,-10364,-9852,-9340,-8828,-8316,-7932,-7676,-7420,-7164,-6908,-6652,-6396,-6140,-5884,-5628,-5372,-5116,-4860,-4604,-4348,-4092,-3900,-3772,-3644,-3516,-3388,-3260,-3132,-3004,-2876,-2748,-2620,-2492,-2364,-2236,-2108,-1980,-1884,-1820,-1756,-1692,-1628,-1564,-1500,-1436,-1372,-1308,-1244,-1180,-1116,-1052,-988,-924,-876,-844,-812,-780,-748,-716,-684,-652,-620,-588,-556,-524,-492,-460,-428,-396,-372,-356,-340,-324,-308,-292,-276,-260,-244,-228,-212,-196,-180,-164,-148,-132,-120,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,32124,31100,30076,29052,28028,27004,25980,24956,23932,22908,21884,20860,19836,18812,17788,16764,15996,15484,14972,14460,13948,13436,12924,12412,11900,11388,10876,10364,9852,9340,8828,8316,7932,7676,7420,7164,6908,6652,6396,6140,5884,5628,5372,5116,4860,4604,4348,4092,3900,3772,3644,3516,3388,3260,3132,3004,2876,2748,2620,2492,2364,2236,2108,1980,1884,1820,1756,1692,1628,1564,1500,1436,1372,1308,1244,1180,1116,1052,988,924,876,844,812,780,748,716,684,652,620,588,556,524,492,460,428,396,372,356,340,324,308,292,276,260,244,228,212,196,180,164,148,132,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,0],o=new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]),a={decodeG711:function(e,t){if("g7110a"===t)return function(e){for(var t=new Uint8Array(2*e.length),r=0,i=0;r<e.length;){var o=n[e[r]];if(void 0===o)throw Error("can not decode g711 alaw data!");t[i]=255&o,t[i+1]=o>>8,r+=1,i+=2}return t}(e);if("g7110m"===t)return function(e){for(var t=new Uint8Array(2*e.length),r=0,n=0;r<e.length;){var o=i[e[r]];if(void 0===o)throw Error("can not decode g711 ulaw data!");t[n]=255&o,t[n+1]=o>>8,r+=1,n+=2}return t}(e);throw Error("no supported format=".concat(t," for g711"))},createAudioBufferFromPcm:function(e,t,r,n,i){for(var o=(c=t.byteLength,c/r/i),a=e.createBuffer(r,o,n),s=new DataView(t),u=0;u<r;u++){for(var c,l,d=a.getChannelData(u),f=void 0,h=0;h<o;h++){;f=s.getUint16(2*r*h+2*u,!0),d[h]=(l=f)>=32768?-(65536-l)/32768:l/32767}}return{audioBuffer:a,duration:o/n}},packageAACToAdts:function(e,t){var r,n,i,o,a,s,u,c,l,d=new Uint8Array(t.data.byteLength+7);var f=(r=e,n=t.data,i=r.sampleRateIndex,o=r.channelCount,a=r.config,s=i,i=(u=(7&a[0])<<1|a[1]>>>7)!==s?u:s,(c=new Uint8Array(7))[0]=255,c[1]=240,c[1]=1|c[1],c[2]=64,c[2]=c[2]|60&i<<2,c[2]=c[2]|1&o>>2,c[3]=192&o<<6,l=n.byteLength+7,c[3]=c[3]|3&l>>11,c[4]=255&l>>3,c[5]=224&l<<5,c[5]=31|c[5],c[6]=252,c);return d.set(f),d.set(t.data,7),d},concatAdts:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,n=0,i=e.length;n<i;n++){if(!t||n%t!=0)r+=e[n].byteLength}for(var o=new Uint8Array(r),a=0,s=0,u=e.length;s<u;s++){if(!t||s%t!=0)o.set(e[s],a),a+=e[s].byteLength}return o},checkRefillFrame:function(e){var t=e[0].dts,r=e.filter(function(e){return e.dts===t}).length;if(!(r<=1))for(var n=0;n<r;n++)e[n].data=o}}},579252:function(e,t,r){r.d(t,{d1:function(){return g}}),r("530129");var n=r("377998"),i=r("668117"),o=r("938156"),a=r("247425"),s=r("737299"),u=r.n(s);r("121621"),r("864614"),r("616414"),r("612222"),r("510766"),r("312602"),r("210434"),r("947478"),r("632852"),r("227470");var c=r("215150"),l=function(){function e(){(0,a.Z)(this,e)}return(0,o.Z)(e,null,[{key:"start",value:function(e){return!e||!e.length||1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&0>e.start(0)?0:e.start(0)}},{key:"end",value:function(e){return!e||!e.length||1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1)}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(e){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var r=[],n=0,i=e.length;n<i;n++){var o=r.length;if(o&&t){var a=r[o-1],s=a[1];if(e.start(n)-s<=t){var u=e.end(n);u>s&&(a[1]=u)}else r.push([e.start(n),e.end(n)])}else r.push([e.start(n),e.end(n)])}return r}},{key:"length",value:function(e){return e&&e.length?e.reduce(function(e,t){return e+(t[1]-t[0])},0):0}},{key:"info",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,o=0,a=0,s=0,u=0,c=0,l=0,d=e.buffers(t,n),f=0,h=d.length;f<h;f++){var g=d[f];if(r+n>=g[0]&&r<g[1])i=g[0],o=g[1],a=f;else if(r+n<g[0]){s=g[0],u=g[1];break}else r+n>g[1]&&(c=g[0],l=g[1])}return{start:i,end:o,index:a,buffers:d,nextStart:s,nextEnd:u,prevStart:c,prevEnd:l,currentTime:r,behind:r-i,remaining:o?o-r:0,length:e.length&&e.length(d)}}}]),e}(),d=r("439271"),f=r("599723"),h=function(){try{return f.j?window.MediaSource:null}catch(e){}}(),g=function(){var e,t,r;function s(e){var t=this;(0,a.Z)(this,s),(0,i.Z)(this,"media",null),(0,i.Z)(this,"mediaSource",null),(0,i.Z)(this,"_openPromise",(0,c.Q)()),(0,i.Z)(this,"_queue",Object.create(null)),(0,i.Z)(this,"_sourceBuffer",Object.create(null)),(0,i.Z)(this,"_onSBUpdateEnd",function(e){var r=t._queue[e];if(r){var n=r.shift();n&&(n.promise.resolve(),t._startQueue(e))}}),(0,i.Z)(this,"_onSBUpdateError",function(e,r){var n=t._queue[e];if(n){var i=n[0];i&&i.promise.reject(new d.Fc(d.wb.MEDIA,d.wb.SUB_TYPES.MSE_APPEND_BUFFER,r))}}),e&&this.bindMedia(e)}return(0,o.Z)(s,[{key:"isOpened",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)==="open"}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"updateDuration",value:function(e){var t=this;return this._enqueueBlockingOp(function(){t.mediaSource&&(t.mediaSource.duration=e)})}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource;t.addEventListener("sourceopen",function r(){t.removeEventListener("sourceopen",r),e._openPromise.resolve()}),this._openPromise=(0,c.Q)()}return this._openPromise}},{key:"bindMedia",value:(e=(0,n.Z)(u().mark(function e(t){var r,n,i=this;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.mediaSource||this.media)){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(!(!t||!h)){e.next=5;break}throw Error("Param media or MediaSource does not exist");case 5:return this.media=t,r=this.mediaSource=new h,t.src=URL.createObjectURL(r),n=function e(){r.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),i._openPromise.resolve()},r.addEventListener("sourceopen",n),e.abrupt("return",this._openPromise);case 11:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"unbindMedia",value:(t=(0,n.Z)(u().mark(function e(){var t,r=this;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._openPromise.used&&this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach(function(e){var t=r._queue[e];t&&t.forEach(function(e){return e.promise.resolve})}),"open"===t.readyState)try{t.endOfStream()}catch(e){}Object.keys(this._sourceBuffer).forEach(function(e){try{t.removeSourceBuffer(r._sourceBuffer[e])}catch(e){}})}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(e){}this.media=null}this.mediaSource=null,this._openPromise=(0,c.Q)(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"createSource",value:function(e,t){var r;if(!this._sourceBuffer[e]&&this.mediaSource){try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(e){throw new d.Fc(d.wb.MEDIA,d.wb.SUB_TYPES.MSE_ADD_SB,e)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this._sourceBuffer[e];return this.mediaSource&&r&&r.mimeType!==t&&"function"==typeof r.changeType?this._enqueueOp(function(){r.changeType(t)}):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t){var r=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,function(){var n;r.mediaSource&&(null===(n=r._sourceBuffer[e])||void 0===n||n.appendBuffer(t))}):Promise.resolve()}},{key:"remove",value:function(e,t,r){var n=this;if(1!==Object.keys(this._sourceBuffer).length)return this._enqueueOp(e,function(){if(n.mediaSource){var i=n._sourceBuffer[e];if(t>=r||!i){n._onSBUpdateEnd(e);return}i.remove(t,r)}})}},{key:"clearBuffer",value:function(e,t){var r,n=this;return Object.keys(this._sourceBuffer).forEach(function(i){r=n._enqueueOp(i,function(){n.mediaSource&&n._sourceBuffer[i].remove(e,t)})}),r}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach(function(r){e=t._enqueueOp(r,function(){if(t.mediaSource){var e=t._sourceBuffer[r];e.remove(0,l.end(l.get(e)))}})}),e}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp(function(){var r=t.mediaSource;r&&"open"===r.readyState&&(e?r.endOfStream(e):r.endOfStream())}):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;!(e<0)&&!(t<e)&&null!=r&&r.setLiveSeekableRange&&"open"===r.readyState&&r.setLiveSeekableRange(e,t)}},{key:"buffered",value:function(e){return l.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return l.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return l.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t){if(!this.mediaSource)return Promise.resolve();var r=this._queue[e]=this._queue[e]||[],n={exec:t,promise:(0,c.Q)()};return r.push(n),1===r.length&&this._startQueue(e),n.promise}},{key:"_enqueueBlockingOp",value:(r=(0,n.Z)(u().mark(function e(t){var r,n,i=this;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((r=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return n=[],r.forEach(function(e){var t=i._queue[e],r=(0,c.Q)();n.push(r),t.push({exec:function(){return r.resolve()},promise:r}),1===t.length&&i._startQueue(e)}),e.abrupt("return",Promise.all(n).then(function(){try{return t()}finally{r.forEach(function(e){var t=i._queue[e],r=i._sourceBuffer[e];null==t||t.shift(),(!r||!r.updating)&&i._startQueue(e)})}}));case 8:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var r=t[0];if(r)try{r.exec()}catch(n){r.promise.reject(new d.Fc(d.wb.MEDIA,d.wb.SUB_TYPES.MSE_OTHER,n)),t.shift(),this._startQueue(e)}}}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!h)return!1;try{return h.isTypeSupported(e)}catch(e){return!1}}}]),s}();(0,i.Z)(g,"VIDEO","video"),(0,i.Z)(g,"AUDIO","audio")},544977:function(e,t,r){r.d(t,{mf:function(){return f}});var n=r(15810),i=r(106989),o=r(171569),a=r(50827),s=r(912913),u=r(663786),c=r(496549),l=r(197392),d=r(159322),f=function(e){(0,n.XW)(d,e);var t,r=(0,n.WY)(d);function d(e){var t;return(0,n.PA)(this,d),t=r.call(this,e),(0,n._x)((0,n.Lc)(t),"type",o.t.FETCH),(0,n._x)((0,n.Lc)(t),"_queue",[]),(0,n._x)((0,n.Lc)(t),"_alive",[]),(0,n._x)((0,n.Lc)(t),"_currentTask",null),(0,n._x)((0,n.Lc)(t),"_finnalUrl",""),(0,n._x)((0,n.Lc)(t),"_config",void 0),t._config=(0,a.i)(e),(t._config.loaderType===o.t.XHR||!i.j.isSupported())&&(t.type=o.t.XHR),t.log=e.logger,t}return(0,n.qH)(d,[{key:"isFetch",value:function(){return this.type===o.t.FETCH}},{key:"load",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?r=e:r.url=e||r.url||this._config.url,(r=Object.assign({},this._config,r)).params&&(r.params=Object.assign({},r.params)),r.headers&&(0,u.PO)(r.headers)&&(r.headers=Object.assign({},r.headers)),r.body&&(0,u.PO)(r.body)&&(r.body=Object.assign({},r.body)),r.transformRequest&&(r=r.transformRequest(r)||r),r.logger=this.log;var n=new s.i(this.type,r);return n.loader.on(l.K.REAL_TIME_SPEED,function(e){t.emit(l.K.REAL_TIME_SPEED,e)}),this._queue.push(n),1===this._queue.length&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),n.promise}},{key:"cancel",value:(t=(0,n.x)((0,n.l5)().mark(function e(){var t;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map(function(e){return e.cancel()}).concat(this._alive.map(function(e){return e.cancel()})),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,(0,c._v)();case 8:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var t=this._currentTask.exec().catch(function(e){});t&&"function"==typeof t.finally&&t.finally(function(){var t,r;null!==(t=e._currentTask)&&void 0!==t&&t.alive&&(null===(r=e._alive)||void 0===r?void 0:r.length)>0&&(e._alive=e._alive.filter(function(t){return t&&t!==e._currentTask})),e._processTask()})}}}],[{key:"isFetchSupport",value:function(){return i.j.isSupported()}}]),d}(r.n(d)())},927425:function(e,t,r){r.d(t,{d1:function(){return f}});var n=r(932393),i=r(365753),o=r(398692),a=r(897948),s=r(41866),u=r(250944);function c(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];try{if(!o.j)return null;if(e&&"undefined"!=typeof ManagedMediaSource)return ManagedMediaSource;return window.MediaSource}catch(e){}}function l(e){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(e))}var d={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},f=function(){var e,t,r;function o(e,t){var r=this;(0,n.PA)(this,o),(0,n._x)(this,"media",null),(0,n._x)(this,"mediaSource",null),(0,n._x)(this,"_openPromise",(0,u.Qo)()),(0,n._x)(this,"_queue",Object.create(null)),(0,n._x)(this,"_sourceBuffer",Object.create(null)),(0,n._x)(this,"_mseFullFlag",{}),(0,n._x)(this,"_st",0),(0,n._x)(this,"_opst",0),(0,n._x)(this,"_logger",null),(0,n._x)(this,"_config",null),(0,n._x)(this,"_url",null),(0,n._x)(this,"_onStartStreaming",function(){r._logger.debug("startstreaming")}),(0,n._x)(this,"_onEndStreaming",function(){r._logger.debug("endstreaming")}),(0,n._x)(this,"_onSBUpdateEnd",function(e){var t=r._queue[e];if(t){var n=t[0];if((null==n?void 0:n.opName)!==d.UPDATE_DURATION&&t.shift(),n){var i,o,a=void 0;try{a=null===(o=r._sourceBuffer[e])||void 0===o?void 0:o.buffered}catch(e){}var s=(0,u.je)()-r._opst;r._logger.debug("UpdateEnd(".concat(e,"/").concat(n.opName,")"),u.Kp.stringify(function(e){var t=[];if(e instanceof TimeRanges)for(var r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}(a)),s,n.context),n.promise.resolve({name:n.opName,context:n.context,costtime:s});var c=null===(i=n.context)||void 0===i?void 0:i.callback;c&&"function"==typeof c&&c(n.context),r._startQueue(e)}}}),(0,n._x)(this,"_onSBUpdateError",function(e,t){var n=r._queue[e];if(n){var i=n[0];i&&(r._logger.error("UpdateError",e,i.opName,i.context),i.promise.reject(new a.Fc(a.wb.MEDIA,a.wb.SUB_TYPES.MSE_APPEND_BUFFER,t)))}}),this._config=Object.assign(o.getDefaultConfig(),t),e&&this.bindMedia(e),this._logger=new s.Y("MSE"),this._config.openLog&&s.Y.enable()}return(0,n.qH)(o,[{key:"isOpened",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)==="open"}},{key:"hasOpTasks",get:function(){var e=this,t=!1;return Object.keys(this._queue).forEach(function(r){var n=e._queue[r];Array.isArray(n)&&(t||(t=n.length>0))}),t}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"streaming",get:function(){return!l(this.mediaSource)||this.mediaSource.streaming}},{key:"isFull",value:function(e){return e?this._mseFullFlag[e]:this._mseFullFlag[o.VIDEO]}},{key:"updateDuration",value:function(e){var t=this,r=this.mediaSource&&this.mediaSource.duration>e;if(this.mediaSource&&this.mediaSource.duration>e){var n=0;if(Object.keys(this._sourceBuffer).forEach(function(e){try{n=Math.max(t.bufferEnd(e)||0,n)}catch(e){}}),e<n)return Promise.resolve()}return this._enqueueBlockingOp(function(){if(t.isEnded){t._logger.debug("setDuration but ended");return}t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("setDuration",e))},d.UPDATE_DURATION,{isReduceDuration:r})}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource;t.addEventListener("sourceopen",function r(){var n=(0,u.je)()-e._st;e._logger.debug("sourceopen",n),t.removeEventListener("sourceopen",r),e._openPromise.resolve({costtime:n})}),this._openPromise=(0,u.Qo)()}return this._openPromise}},{key:"bindMedia",value:(e=(0,n.x)((0,n.l5)().mark(function e(t){var r,i,o,a,s=this;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.mediaSource||this.media)){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(r=c(this._config.preferMMS),!(!t||!r)){e.next=6;break}throw Error("Param media or MediaSource does not exist");case 6:return this.media=t,o=l(i=this.mediaSource=new r),this._st=(0,u.je)(),a=function e(){var r=(0,u.je)()-s._st;s._logger.debug("sourceopen"),i.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),s._openPromise.resolve({costtime:r})},i.addEventListener("sourceopen",a),o&&(i.addEventListener("startstreaming",this._onStartStreaming),i.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(i),t.src=this._url,t.disableRemotePlayback=o,e.abrupt("return",this._openPromise);case 17:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"unbindMedia",value:(t=(0,n.x)((0,n.l5)().mark(function e(){var t,r,i,o=this;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._openPromise.used&&this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach(function(e){var t=o._queue[e];t&&t.forEach(function(e){var t,r;return null===(t=e.promise)||void 0===t?void 0:null===(r=t.resolve)||void 0===r?void 0:r.call(t)})}),r=!!this.media&&this.media.readyState>=1,i="open"===t.readyState,r&&i)try{t.endOfStream()}catch(e){}Object.keys(this._sourceBuffer).forEach(function(e){try{t.removeSourceBuffer(o._sourceBuffer[e])}catch(e){}}),l(t)&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch(e){}this.media=null}this.mediaSource=null,this._openPromise=(0,u.Qo)(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"createSource",value:function(e,t){var r;if(!this._sourceBuffer[e]&&this.mediaSource){try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(e){throw new a.Fc(a.wb.MEDIA,a.wb.SUB_TYPES.MSE_ADD_SB,e)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this,n=this._sourceBuffer[e];return this.mediaSource&&n&&n.mimeType!==t?"function"!=typeof n.changeType?Promise.reject(new a.Fc(a.wb.MEDIA,a.wb.SUB_TYPES.MSE_CHANGE_TYPE,Error("changeType is not a function"))):this._enqueueOp(e,function(){try{n.changeType(t)}catch(e){throw new a.Fc(a.wb.MEDIA,a.wb.SUB_TYPES.MSE_CHANGE_TYPE,e)}n.mimeType=t,r._onSBUpdateEnd(e)},"changeType",{mimeType:t}):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,r){var n=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,function(){var i;n.mediaSource&&!n.media.error&&(n._logger.debug("MSE APPEND START",r),n._opst=(0,u.je)(),null===(i=n._sourceBuffer[e])||void 0===i||i.appendBuffer(t))},d.APPEND,r):Promise.resolve()}},{key:"remove",value:function(e,t,r,n){var i=this,o=!1;return this._mseFullFlag[e]&&(o=!0),this._enqueueOp(e,function(){if(i.mediaSource&&!i.media.error){var o=i._sourceBuffer[e];if(t>=r||!o){i._onSBUpdateEnd(e);return}i._opst=(0,u.je)(),i._logger.debug("MSE REMOVE START",e,t,r,n),o.remove(t,r)}},d.REMOVE,n,o)}},{key:"clearBuffer",value:function(e,t){var r,n=this;return Object.keys(this._sourceBuffer).forEach(function(i){r=n.remove(i,e,t)}),r||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach(function(r){var n=t._sourceBuffer[r];e=t.remove(r,0,i.l.end(i.l.get(n)))}),e}},{key:"clearOpQueues",value:function(e,t){this._logger.debug("MSE clearOpQueue START");var r,n=this._queue[e];if(t&&n){this._queue[e]=[];return}if(n&&n[e]&&!(n.length<5)){var i=[];n.forEach(function(e){e.context&&e.context.isinit&&i.push(e)}),this._queue[e]=n.slice(0,2),i.length>0&&(r=this._queue[e]).push.apply(r,i)}}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp(function(){var r=t.mediaSource;r&&"open"===r.readyState&&(t._logger.debug("MSE endOfStream START"),e?r.endOfStream(e):r.endOfStream())},"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;!(e<0)&&!(t<e)&&null!=r&&r.setLiveSeekableRange&&"open"===r.readyState&&r.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return i.l.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return i.l.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return i.l.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,r,n,i){var o=this;if(!this.mediaSource)return Promise.resolve();var a=this._queue[e]=this._queue[e]||[],s={exec:t,promise:(0,u.Qo)(),opName:r,context:n};return i?(a.splice(0,0,s),this._mseFullFlag[e]=!1,this._startQueue(e)):a.push(s),this.isOpened||this.isEnded?1===a.length&&this._startQueue(e):this._openPromise.then(function(){1===a.length&&o._startQueue(e)}),s.promise}},{key:"_enqueueBlockingOp",value:(r=(0,n.x)((0,n.l5)().mark(function e(t,r,i){var o,a,s=this;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((o=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return a=[],o.forEach(function(e){var t=s._queue[e],n=(0,u.Qo)();a.push(n),t.push({exec:function(){n.resolve()},promise:n,opName:r,context:i}),1===t.length&&s._startQueue(e)}),e.abrupt("return",Promise.all(a).then(function(){try{return t()}finally{o.forEach(function(e){var t=s._queue[e],r=s._sourceBuffer[e];null==t||t.shift(),(!r||!r.updating)&&s._startQueue(e)})}}));case 8:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var r=t[0];if(r&&!this._mseFullFlag[e])try{r.exec()}catch(i){i&&i.message&&i.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,r.context&&"object"===(0,n.Ac)(r.context)&&(r.context.isFull=!0),this._logger.error("[MSE error],  context,",r.context," ,name,",r.opName,",err,SourceBuffer is full"),r.promise.reject(new a.Fc(a.wb.MEDIA,a.wb.SUB_TYPES.MSE_FULL,i))):(this._logger.error(i),r.promise.reject(i.constructor===a.Fc?i:new a.Fc(a.wb.MEDIA,a.wb.SUB_TYPES.MSE_OTHER,i)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,r){var n=this;return this._enqueueOp(e,function(){t<0&&(t+=.001),n._sourceBuffer[e].timestampOffset=t,n._onSBUpdateEnd(e)},"setTimeoffset",r)}},{key:"abort",value:function(e,t){var r=this;return this.isOpened?this._enqueueOp(e,function(){r._sourceBuffer[e].abort(),r._onSBUpdateEnd(e)},"abort",t):Promise.resolve()}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',t=c();if(!t)return!1;try{return t.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}}},{key:"isMMSOnly",value:function(){return"undefined"!=typeof ManagedMediaSource&&"undefined"==typeof MediaSource}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),o}();(0,n._x)(f,"VIDEO","video"),(0,n._x)(f,"AUDIO","audio")},786019:function(e,t,r){r.d(t,{C:function(){return o}});var n=r(932393),i=r(43024),o=function(e){(0,n.XW)(r,e);var t=(0,n.WY)(r);function r(e,o,a,s){var u;return(0,n.PA)(this,r),u=t.call(this,s),(0,n._x)((0,n.Lc)(u),"retryCount",0),(0,n._x)((0,n.Lc)(u),"isTimeout",!1),(0,n._x)((0,n.Lc)(u),"loaderType",i.t.FETCH),(0,n._x)((0,n.Lc)(u),"startTime",0),(0,n._x)((0,n.Lc)(u),"endTime",0),(0,n._x)((0,n.Lc)(u),"options",{}),u.url=e,u.request=o,u.response=a,u}return(0,n.qH)(r)}((0,n.wm)(Error))},54544:function(e,t,r){r.d(t,{mf:function(){return f}});var n=r(932393),i=r(757367),o=r(43024),a=r(51762),s=r(374131),u=r(896269),c=r(721035),l=r(611451),d=r(159322),f=function(e){(0,n.XW)(d,e);var t,r=(0,n.WY)(d);function d(e){var t;return(0,n.PA)(this,d),t=r.call(this,e),(0,n._x)((0,n.Lc)(t),"type",o.t.FETCH),(0,n._x)((0,n.Lc)(t),"_queue",[]),(0,n._x)((0,n.Lc)(t),"_alive",[]),(0,n._x)((0,n.Lc)(t),"_currentTask",null),(0,n._x)((0,n.Lc)(t),"_finnalUrl",""),(0,n._x)((0,n.Lc)(t),"_config",void 0),t._config=(0,a.i)(e),(t._config.loaderType===o.t.XHR||!i.j.isSupported())&&(t.type=o.t.XHR),t.log=e.logger,t}return(0,n.qH)(d,[{key:"isFetch",value:function(){return this.type===o.t.FETCH}},{key:"load",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?r=e:r.url=e||r.url||this._config.url,(r=Object.assign({},this._config,r)).params&&(r.params=Object.assign({},r.params)),r.headers&&(0,u.PO)(r.headers)&&(r.headers=Object.assign({},r.headers)),r.body&&(0,u.PO)(r.body)&&(r.body=Object.assign({},r.body)),r.transformRequest&&(r=r.transformRequest(r)||r),r.logger=this.log;var n=new s.i(this.type,r);return n.loader.on(l.K.REAL_TIME_SPEED,function(e){t.emit(l.K.REAL_TIME_SPEED,e)}),this._queue.push(n),1===this._queue.length&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),n.promise}},{key:"cancel",value:(t=(0,n.x)((0,n.l5)().mark(function e(){var t;return(0,n.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map(function(e){return e.cancel()}).concat(this._alive.map(function(e){return e.cancel()})),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,(0,c._v)();case 8:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var t=this._currentTask.exec().catch(function(e){});t&&"function"==typeof t.finally&&t.finally(function(){var t,r;null!==(t=e._currentTask)&&void 0!==t&&t.alive&&(null===(r=e._alive)||void 0===r?void 0:r.length)>0&&(e._alive=e._alive.filter(function(t){return t&&t!==e._currentTask})),e._processTask()})}}}],[{key:"isFetchSupport",value:function(){return i.j.isSupported()}}]),d}(r.n(d)())},43024:function(e,t,r){r.d(t,{U:function(){return i},t:function(){return n}});var n={FETCH:"fetch",XHR:"xhr"},i={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"}},250944:function(e,t,r){function n(){var e,t,r=new Promise(function(r,n){e=r,t=n});return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}function i(){try{return parseInt(performance.now(),10)}catch(e){return new Date().getTime()}}r.d(t,{Kp:function(){return o},Qo:function(){return n},je:function(){return i}});var o={stringify:function(e){try{return JSON.stringify(e)}catch(e){return""}},parse:function(e){try{return JSON.parse(e)}catch(e){return}}}},299025:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(177595),i=function(){function e(t){if((0,n.PA)(this,e),(0,n._x)(this,"_bytesAvailable",void 0),(0,n._x)(this,"_bitsAvailable",0),(0,n._x)(this,"_word",0),!t)throw Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return(0,n.qH)(e,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"bitsPos",value:function(){return 8*this._bytesAvailable-this._bitsAvailable}},{key:"bitsLeft",value:function(){return 8*this._data.length-this.bitsPos()}},{key:"byteAligned",value:function(){return 0===this.bitsPos()||this.bitsPos()%8==0}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{var t=Math.floor((e-=this._bitsAvailable)/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return(this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable)?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if((this._word&2147483648>>>e)!=0)return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}}]),e}()}}]);