/*! For license information please see player-8.e30076b1.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).xss={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function n(e,t,n){if(n||2==arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var r=/[^a-zA-Z0-9\\_:.-]/gim,i=/</g,a=/>/g,o=/&#([a-zA-Z0-9]*);?/gim,s=/&quot;/g,u=/&colon;?/gim,c=/&newline;?/gim,l=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,d=/u\s*r\s*l\s*\(.*/gi,g=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,h=/"/g,f=function(e){return e.replace(i,"&lt;").replace(a,"&gt;")},p={indexOf:function(e,t){var n,r;for(n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return -1},forEach:function(e,t,n){var r,i;for(r=0,i=e.length;r<i;r++)t.call(n,e[r],r,e)},some:function(e,t,n){var r,i;for(r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r,e))return!0;return!1},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},includes:function(e,t){if("string"==typeof e)return -1!==e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1},uniq:function(e){for(var t={},n=[],r=0;r<e.length;r++)t[e[r]]||(n.push(e[r]),t[e[r]]=!0);return n},from:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t},keys:function(e){var t=[];for(var n in e)t.push(n);return t}};function v(e){return null==e}function m(e){var t;return'"'===(t=e)[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]?e.substr(1,e.length-2):e}function _(e){var t,n,r,i,a,o,s,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",l=0;for(e=function(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?t+=String.fromCharCode(r>>6|192)+String.fromCharCode(63&r|128):t+=String.fromCharCode(r>>12|224)+String.fromCharCode(r>>6&63|128)+String.fromCharCode(63&r|128)}return t}(e);l<e.length;)i=(t=e.charCodeAt(l++))>>2,a=(3&t)<<4|(n=e.charCodeAt(l++))>>4,o=(15&n)<<2|(r=e.charCodeAt(l++))>>6,s=63&r,isNaN(n)?o=s=64:isNaN(r)&&(s=64),c=c+u.charAt(i)+u.charAt(a)+u.charAt(o)+u.charAt(s);return c}function I(e){var t,n,r,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");c<e.length;)t=s.indexOf(e.charAt(c++))<<2|(i=s.indexOf(e.charAt(c++)))>>4,n=(15&i)<<4|(a=s.indexOf(e.charAt(c++)))>>2,r=(3&a)<<6|(o=s.indexOf(e.charAt(c++))),u+=String.fromCharCode(t),64!==a&&(u+=String.fromCharCode(n)),64!==o&&(u+=String.fromCharCode(r));return function(e){for(var t="",n=0,r=0,i=0,a=0;n<e.length;)(r=e.charCodeAt(n))<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(t+=String.fromCharCode((31&r)<<6|63&(a=e.charCodeAt(n+1))),n+=2):(a=e.charCodeAt(n+1),t+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&(i=e.charCodeAt(n+2))),n+=3);return t}(u)}function C(e,t,n){var r="",i=0,a=!1,o=!1,s=0,u=e.length,c="",l="";e:for(s=0;s<u;s++){var d=e.charAt(s);if(!1===a){if("<"===d){a=s;continue}}else if(!1===o){if("<"===d){r+=n(e.slice(i,s)),a=s,i=s;continue}if(">"===d||s===u-1){r+=n(e.slice(i,a)),c=function(e){var t,n=p.spaceIndex(e);return t=-1===n?e.slice(1,-1):e.slice(1,n+1),"/"===(t=p.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}(l=e.slice(a,s+1)),r+=t(a,r.length,c,l,"</"===l.slice(0,2)),i=s+1,a=!1;continue}if('"'===d||"'"===d)for(var g=1,h=e.charAt(s-g);""===h.trim()||"="===h;){if("="===h){o=d;continue e}h=e.charAt(s-++g)}}else if(d===o){o=!1;continue}}return i<u&&(r+=n(e.substr(i))),r}function A(e,t){var n=0,i=0,a=[],o=!1,s=e.length;function u(e,n){if(!((e=(e=p.trim(e)).replace(r,"").toLowerCase()).length<1)){var i=t(e,n||"");i&&a.push(i)}}for(var c=0;c<s;c++){var l=e.charAt(c),d=void 0;if(!1!==o||"="!==l){if(!1===o||c!==i){if(/\s|\n|\t/.test(l)){if(e=e.replace(/\s|\n|\t/g," "),!1===o){if(-1===(d=function(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}return -1}(e,c))){u(p.trim(e.slice(n,c))),o=!1,n=c+1;continue}c=d-1;continue}if(-1===(d=function(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}return -1}(e,c-1))){u(o,m(p.trim(e.slice(n,c)))),o=!1,n=c+1;continue}}}else{if(-1===(d=e.indexOf(l,c+1)))break;u(o,p.trim(e.slice(i+1,d))),o=!1,n=(c=d)+1}}else o=e.slice(n,c),n=c+1,i='"'===e.charAt(n)||"'"===e.charAt(n)?n:function(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"'"===n||'"'===n?t:-1}return -1}(e,c+1)}return n<e.length&&(!1===o?u(e.slice(n)):u(o,m(p.trim(e.slice(n))))),p.trim(a.join(" "))}function y(e,t,n){if(n=function(e){return e=function(e){for(var t="",n=0,r=e.length;n<r;n++)t+=32>e.charCodeAt(n)?" ":e.charAt(n);return p.trim(t)}(e=(e=(e=e.replace(s,'"')).replace(o,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})).replace(u,":").replace(c," "))}(n),"href"===t||"src"===t){if("#"===(n=p.trim(n)))return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"tel:"!==n.substr(0,4)&&"data:image/"!==n.substr(0,11)&&"ftp://"!==n.substr(0,6)&&"./"!==n.substr(0,2)&&"../"!==n.substr(0,3)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(l.lastIndex=0,l.test(n))return""}else if("style"===t&&(g.lastIndex=0,g.test(n)||(d.lastIndex=0,d.test(n)&&(l.lastIndex=0,l.test(n)))))return"";return n=function(e){return e=f(e=e.replace(h,"&quot;"))}(n)}var b=function(e){return"string"==typeof e?e.replace(/'/g,'"').replace('=""',"").replace(/\s+/g,"").toLowerCase():""},k=function(){function e(e){var t=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{});t.stripIgnoreTag&&(t.onIgnoreTag,t.onIgnoreTag=function(){return""}),t.whiteList={},t.onTag=function(){},t.onTagAttr=function(){},t.onIgnoreTag=function(){},t.onIgnoreTagAttr=function(){},t.safeAttrValue=y,t.escapeHtml=f,this.options=Object.assign(t,e)}return e.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t,n,r,i,a,o,s=this.options,u=s.whiteList,c=s.onTag,l=s.onIgnoreTag,d=s.onTagAttr,g=s.onIgnoreTagAttr,h=s.safeAttrValue,f=s.escapeHtml;s.stripBlankChar&&(e=(t=(t=e.split("")).filter(function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)})).join("")),s.allowCommentTag||(e=function(e){for(var t="",n=0;n<e.length;){var r=e.indexOf("\x3c!--",n);if(-1===r){t+=e.slice(n);break}t+=e.slice(n,r);var i=e.indexOf("--\x3e",r);if(-1===i)break;n=i+3}return t}(e));var v=!1;s.stripIgnoreTagBody&&(n=s.stripIgnoreTagBody,"function"!=typeof(r=l)&&(r=function(){}),i=!Array.isArray(n),a=[],o=!1,l=(v={onIgnoreTag:function(e,t,s){var u;if(u=e,i||-1!==p.indexOf(n,u)){if(s.isClosing){var c="[/removed]",l=s.position+c.length;return a.push([!1!==o?o:s.position,l]),o=!1,c}return o||(o=s.position),"[removed]"}return r(e,t,s)},remove:function(e){var t="",n=0;return p.forEach(a,function(r){t+=e.slice(n,r[0]),n=r[1]}),t+=e.slice(n)}}).onIgnoreTag);var m=C(e,function(e,t,n,r,i){var a={sourcePosition:e,position:t,isClosing:i,isWhite:Object.prototype.hasOwnProperty.call(u,n)},o=c(n,r,a);if(null!=o)return o;if(a.isWhite){if(a.isClosing)return"</".concat(n,">");var s=function(e){var t=p.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=p.trim(e.slice(t+1,-1)))[e.length-1];return n&&(e=p.trim(e.slice(0,-1))),{html:e,closing:n}}(r),v=u[n],m=A(s.html,function(e,t){var r=-1!==p.indexOf(v,e),i=d(n,e,t,r);return null==i?r?(t=h(n,e,t,null))?"".concat(e,'="').concat(t,'"'):e:null==(i=g(n,e,t,r))?void 0:i:i});return r="<".concat(n),m&&(r+=" ".concat(m)),s.closing&&(r+=" /"),r+=">"}return null==(o=l(n,r,a))?f(r):o},f);return v&&(m=v.remove(m)),m},e}(),S=Function("\nvar _checkXSS = function (it) {\n  return it && it.Math == Math && it;\n};\nreturn _checkXSS(typeof globalThis === 'object' && globalThis) ||\n_checkXSS(typeof window === 'object' && window) ||\n_checkXSS(typeof self === 'object' && self) ||\n_checkXSS(typeof global === 'object' && global) ||\nFunction('return this')();\n")(),E=new(function(){function e(){var e=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var t,n,r="douyin_web";if(!p.includes(r,"bid"))return r;if(e.config&&e.config.bid)return e.config.bid;if(S&&S._xssBid)return S._xssBid;if(S&&S.slardar&&"function"==typeof S.slardar.config){var i=(S.slardar.config()||{}).bid;if(i)return i}if(S&&S.Slardar&&"function"==typeof S.Slardar.config){var a=(S.Slardar.config()||{}).bid;if(a)return a}return(null===(n=null===(t=null==S?void 0:S.Slardar)||void 0===t?void 0:t._baseParams)||void 0===n?void 0:n.bid)||"argus"},this.getConfigRegion=function(){var t;return p.includes("cn","region")?e.config&&e.config.region?e.config.region:((null===(t=null==S?void 0:S.gfdatav1)||void 0===t?void 0:t.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=function(){var t={cn:I("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boe:I("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),ttp:I("aHR0cHM6Ly9tb24udXMudGlrdG9rdi5jb20vbW9uaXRvcl9icm93c2VyL2NvbGxlY3QvYmF0Y2gvc2VjdXJpdHkvP2JpZD0="),va:I("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),maliva:I("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),sg:I("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boei18n:I("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9")}[e.getConfigRegion()];if(t)return t+e.getSlardarBid()}}return e.prototype.setConfig=function(e){this.config=e},e.prototype.upload=function(){var e=this,t=this.gerReportUrl();!this.lock&&t&&0!==this.batchData.length&&(this.lock=!0,setTimeout(function(){var n=e.batchData.slice(0,100);e.batchData=e.batchData.slice(100),S.fetch(t,{method:"post",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).catch(function(e){}),e.lock=!1,e.upload()},this.timeout))},e.prototype.generateKey=function(e){return e.collectKey?[e.collectMode,e.collectKey].join("___"):""},e.prototype.push=function(e){this.batchData.push(e),this.upload()},e.prototype.report=function(e){var t=this.generateKey(e);if(S.fetch&&e.collectKey){var n="object"==typeof window?window.location.href:"SSR";e.documentUrl=n;var r={age:Math.floor(Date.now()),type:"xss",url:n,body:e,"user-agent":""};"enforce"===e.disposition&&"SSR"!==n||(r.url=t),"SSR"===n&&(r.url="SSR___".concat(r.url),r.body.ssr=!0),this.push(r)}},e}()),T=function(e){for(var t=0,n=function(n){Array.isArray(e[n])?0===e[n].length?delete e[n]:(e[n]=p.from(p.uniq(e[n])),t+=e[n].length):0===p.keys(e[n]).length?delete e[n]:p.keys(e[n]).forEach(function(r){e[n][r]=p.from(p.uniq(e[n][r])),t+=e[n][r].length})},r=0,i=p.keys(e);r<i.length;r++)n(i[r]);return{count:t,ret:e}};function R(e,t){return E.setConfig(t),new k(t).process(e)}function w(e){var t,n=(t=/\s|\n|\t/.exec(e))?t.index:-1;if(-1===n)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=e.slice(n+1,-1).trim())[e.length-1];return r&&(e=e.slice(0,-1).trim()),{html:e,closing:r}}var x=function(e){return -1===(e=(e=(e=(e=e.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?e.trim().toLowerCase():e.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,function(e,t,n,r){return String.fromCharCode(t?parseInt(n,16):parseInt(r))}).replace(/(\t|\n|\r)/g,"").toLowerCase()};function D(e,t){if(void 0===e&&(e=""),"string"!=typeof e)return!0;if(e=x(e),p.includes(e,"base64")&&!function(e){if(""===e||""===e.trim())return!0;try{return!p.includes(e,"data:text/html;base64")}catch(e){return!0}}(e))return t&&t("data:text/html;base64"),!1;var n=["expression(","behavior:","view-source:"];if(p.some(n,function(t){return -1!==e.indexOf(t)}))return p.forEach(n,function(n){-1!==e.indexOf(n)&&t&&t(n)}),!1;var r=["data:application","data:javascript","data:text/html","data:texthtml"];if(p.some(r,function(t){return -1!==e.indexOf(t)}))return p.forEach(r,function(n){-1!==e.indexOf(n)&&t&&t(n)}),!1;if(e.indexOf("javascript:")>0)return t&&t("javascript:"),!1;if(/^javascript:/i.test(e)){var i=e.slice(11).replace(/\s/g,"").trim();return!!p.some(["void","void(0)","void0","false","undefined",";"],function(e){return e===i})||(t&&t("javascript:"),!1)}return!0}var P=function(e,t){var n,r,i="<%= isSaveValidUrl =>";if("string"!=typeof e||(r=Number("<%= urlLimit =>"),void 0!==n&&(r=n),"NaN"!==e.toString()&&-1!==r&&e.length>=r)||D(e,t))return e;try{if(!0===(i=JSON.parse(i))||"true"===i){var a=new URL(e);return a.origin+a.pathname}}catch(e){}return"#"};function N(e,t,r){if(void 0===e&&(e=""),void 0===t&&(t=[]),"string"!=typeof e)return!0;if(!D(e=x(e)))return!1;var i,a={url:(i=e.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[])[0],scheme:i[1],slash:i[2],host:i[3],port:i[4],path:i[5],query:i[6],hash:i[7]},o=a.scheme,s=a.host;return r?!!r(e):!(!o||!s)&&(!p.includes(["http","https","file"],o)||("object"==typeof window&&window&&(t=n(n([],t,!0),[location.host],!1)),p.some(t,function(e){return!!(e instanceof RegExp&&e.test(s))||e===s})))}var Z={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},L={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var e=T(this.collect),t=e.count,n=e.ret;return this.collect=null,{collectKey:0===t?null:JSON.stringify(n),collectMode:"white"}},onIgnoreTagAttr:function(e,t,r){return e&&p.indexOf(["href","src"],t)>-1?L.domainWhiteList&&Array.isArray(L.domainWhiteList)&&L.domainWhiteList.length>0&&!N(r,n([],L.domainWhiteList,!0))?"":"".concat(t,'="').concat(P(r,function(e){var t;null===(t=L.collect)||void 0===t||t.filterProtocol.push(e)}),'"'):e&&(p.indexOf(["style","class","id"],t)>-1||t.indexOf("data-")>-1)?"".concat(t,'="').concat(r,'"'):(L.collect.whiteList[e]=L.collect.whiteList[e]||[],void L.collect.whiteList[e].push(t))},onIgnoreTag:function(e,t){if("style"===e)return t;C(t,function(e,t,n,r){A(w(r).html.replace("/",""),function(e){L.collect.whiteList[n]=L.collect.whiteList[n]||[],L.collect.whiteList[n].push(e)})},f)},whiteList:Z,mergeWhiteList:function(e){for(var t,n={},r=0,i=p.keys(Z);r<i.length;r++)n[t=i[r]]=p.from(Z[t]);for(var a=0,o=p.keys(e);a<o.length;a++)n[t=o[a]]=t in Z?Z[t].concat(e[t]):p.from(e[t]);return n},setWhiteList:function(e){for(var t=0,n=p.keys(e);t<n.length;t++){var r=n[t];this.whiteList[r]=r in Z?Z[r].concat(e[r]):p.from(e[r])}}};try{var B={},O="merge";p.includes(O,"override")&&(L.whiteList=B.whiteList),p.includes(O,"merge")&&L.setWhiteList(B.whiteList)}catch(e){}var G=function(e,t){for(var n={},r=0,i=p.keys(e);r<i.length;r++){var a=i[r];Array.isArray(e[a])?n[a]=p.from(e[a]):n[a]=G({},e[a])}for(var o=0,s=p.keys(t);o<s.length;o++)(a=s[o])in e?Array.isArray(e[a])?n[a]=e[a].concat(t[a]):n[a]=G(e[a],t[a]):Array.isArray(t[a])?n[a]=p.from(t[a]):n[a]=G({},t[a]);return n},M={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var W={};W.blackAttrRegExps&&(W.blackAttrRegExps=W.blackAttrRegExps.map(function(e){return new RegExp(e.toString().slice(1,e.toString().length-1))}));var V="merge";p.includes(V,"override")&&(M=W),p.includes(V,"merge")&&(M=G(M,W))}catch(e){}var U={mode:"black",whiteList:{},blackConfig:M,collect:null,initCollect:function(){U.collect={blackList:{},blackTags:[],blackAttrs:[],blackAttrRegExps:[],filterAttrs:[],filterList:{},filterProtocol:[]}},removeCollect:function(){var e=T(U.collect),t=e.count,n=e.ret;return U.collect=null,{collectKey:0===t?null:JSON.stringify(n),collectMode:"black"}},onIgnoreTag:function(e,t){var n;if(!p.includes(M.blackTags,e))return C(t,function(e,t,n,r,i){if(-1!==n.indexOf("/"))return f(r);if(i)return"</".concat(n,">");var a=w(r),o=A(a.html,function(e,t){var r,i=0;if(M.blackList[n]&&p.includes(M.blackList[n],e)&&(U.collect.blackList[n]=U.collect.blackList[n]||[],U.collect.blackList[n].push(e),i++),M.blackAttrRegExps.length&&M.blackAttrRegExps.some(function(t){return t.test(e)})&&p.forEach(M.blackAttrRegExps,function(t){t.test(e)&&(U.collect.blackAttrRegExps.push("".concat(t.toString(),"->").concat(e)),i++)}),M.blackAttrs.length&&p.includes(M.blackAttrs,e)&&(M.blackAttrs.push(e),i++),!i){if(M.filterList&&M.filterList[n]&&p.includes(M.filterList[n],e)){var a=P(t,function(e){var t;null===(t=U.collect)||void 0===t||t.filterProtocol.push(e)});return a!==t&&(U.collect.filterList[n]=U.collect.filterList[n]||[],U.collect.filterList[n].push(e)),t?"".concat(e,"='").concat(a,"'"):e}return M.filterAttrs&&p.includes(M.filterAttrs,e)?((a=P(t,function(e){var t;null===(t=U.collect)||void 0===t||t.filterProtocol.push(e)}))!==t&&(null===(r=U.collect)||void 0===r||r.filterAttrs.push(e)),t?"".concat(e,"='").concat(a,"'"):e):t?"".concat(e,"='").concat(t,"'"):e}});return r="<".concat(n),o&&(r+=" ".concat(o)),a.closing&&(r+=" /"),r+=">"},f);null===(n=U.collect)||void 0===n||n.blackTags.push(e)}},Y=function(e){var t=e.reportOnly,n=void 0===t||t,r=e.block;return n&&"all"===n?"report":("string"==typeof n&&("true"===n&&(n=!0),"false"===n&&(n=!1)),r?"enforce":n?"report":"enforce")},K=function(e){return function(n,r,i){if(!n||"string"!=typeof n)return n;var a=r;e===R&&(a=L).initCollect();var o=e(n,a);if(b(o)===b(n))return n;if(!i)return o;var s=i.logType,u=Y(i),c=a.removeCollect();return E.report(t(t({type:s,disposition:u},c),{sourceText:_(n),filterText:_(o)})),"enforce"===u?o:n}},H=K(function(e,t){return void 0===t&&(t={}),t&&t.whiteList||(t.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}),new k(t).process(e)}),X=K(R),F=function(e,t,n){var r=[],i=P(e,function(e){r.push(e)});if(i===e)return e;r=p.from(p.uniq(r));var a=t||n||{};if(!a)return i;var o=a.logType,s=Y(n);return E.report({type:o,disposition:s,collectKey:r.join("___"),collectData:JSON.stringify(r),collectMode:"black",sourceText:_(e),filterText:_(i)}),"enforce"===s?i:e},j=S._xssProject||{},J=S.xssNamespace||{},z="3.0.26",Q={FilterXSS:k,version:z,webpackPluginVersion:"<%= webpackPluginVersion =>",reportOnly:"<%= reportOnly =>",filterXSS:H,_filterXSS:X,filterUrl:F,Config:L,BlackConfig:U,project:j,setProjectName:function(e){j[e]=this,S._xssProjectName=e}};J.douyin_web=Q,S.xssNamespace=J,S.Math&&!S.Math.xssNamespace&&(S.Math.xssNamespace=J),j[z]=Q,S.globalThis=S,S.getFilterXss=function(){return void 0!==this._xssProjectName?this._xssProject[this._xssProjectName]:Q},S.xss=Q,S.isSafeUrl=N,S.isSafeDomain=N,S.isSafeProtocol=D,S._xssProject=j,S._xssProjectName&&(j[S._xssProjectName]=Q);var q=Q.setProjectName.bind(Q);e.BlackConfig=U,e.Config=L,e.FilterXSS=k,e._filterXSS=X,e.filterUrl=F,e.filterXSS=H,e.isSafeDomain=N,e.isSafeProtocol=D,e.isSafeUrl=N,e.project=j,e.setProjectName=q,e.setXssNamespace=function(e){var t=e.appId,n=e.bid,r=e.region;J[t]=Q;L.bid=n,L.region=r,L.enabled=!0},e.xssNamespace=J,Object.defineProperty(e,"__esModule",{value:!0})});"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["9794"],{677043:function(e,t,n){n.d(t,{f:function(){return u}});var r=n(167846),i=n(280161),a=n(159322),o=n(906399),s=n(150799),u=function(e){function t(e){var n;return(0,r.PA)(this,t),(n=(0,r.$w)(this,t)).onVisibleChange=function(){var e=n.masterTimer||n.workerTimer;n.stop(),e&&n.start()},n.options=e,document.addEventListener("visibilitychange",n.onVisibleChange),n}return(0,r.XW)(t,e),(0,r.qH)(t,[{key:"start",value:function(){var e=this,t=this.options,n=t.timerInWorker,r=t.frequency,a=function(){try{(e.masterTimer||e.workerTimer)&&e.emit(o.sW)}catch(e){}};this.stop(),n&&"undefined"!=typeof Worker&&document.hidden?this.workerTimer=(0,i.Ic)(a,1e3*r,!0):(this.masterTimer=new s.B(a),this.masterTimer.tickEvery(r))}},{key:"stop",value:function(){this.workerTimer&&((0,i.vI)(this.workerTimer),this.workerTimer=void 0),this.masterTimer&&(this.masterTimer.stop(),this.masterTimer=void 0)}},{key:"destroy",value:function(){this.removeAllListeners(),document.removeEventListener("visibilitychange",this.onVisibleChange),this.stop()}}])}(a.EventEmitter)},264543:function(e,t,n){n.d(t,{O1:function(){return o},iR:function(){return s},oO:function(){return u},zO:function(){return c}});var r=n(167846),i=n(398762),a=n(383414),o={416:i.WE[i.wb.NETWROK_RANGE_NOT_SATISFIABLE],403:i.WE[i.wb.NETWORK_FORBIDDEN],404:i.WE[i.wb.NETWORK_NOTFOUND],timeout:i.WE[i.wb.NETWORK_TIMEOUT],networkError:i.WE[i.wb.NETWORK],lenNotMatch:2130,mse:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.MSE_OTHER],mseOpen:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.MSE_ADD_SB],mseAppend:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.MSE_APPEND_BUFFER],mse_hijack:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.MSE_HIJACK],eme_hijack:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.EME_HIJACK],metaError:i.WE[i.wb.DEMUX][i.wb.SUB_TYPES.MP4],muxError:i.WE[i.wb.REMUX][i.wb.SUB_TYPES.FMP4],other:i.WE[i.wb.OTHER],waitTimeout:i.WE[i.wb.RUNTIME][i.wb.SUB_TYPES.BUFFERBREAK_ERROR],waitTimeoutWithHidden:i.WE[i.wb.RUNTIME][i.wb.SUB_TYPES.WAITING_TIMEOUT_ERROR],drm:i.WE[i.wb.DRM][i.wb.SUB_TYPES.LICENSE]},s=i.wb,u=(0,r.qH)(function e(t,n,i){(0,r.PA)(this,e);var s,u=0,c=0;null!=i&&i.range&&i.range.length>1&&(u=i.range[0],c=i.range[1]);var l=o[s=n]||s;return{headers:(null==i?void 0:i.headers)||null,errorCode:l,errorType:t,errorMessage:(null==i?void 0:i.httpText)||(null==i?void 0:i.message),url:null==i?void 0:i.url,httpCode:n,version:a.i,rangeStart:u,rangeEnd:c,ext:i,mediaError:{code:l,message:(null==i?void 0:i.httpText)||(null==i?void 0:i.message)}}}),c=(0,r.qH)(function e(t,n,i){return(0,r.PA)(this,e),{version:a.i,errorCode:n,errorType:t,errorMessage:i.msg,ext:i,mediaError:{code:n,message:i.msg}}})},383414:function(e,t,n){n.d(t,{i:function(){return r}});let r="3.0.25-alpha.4"},930770:function(e,t,n){n.d(t,{E0:function(){return h},G9:function(){return g},Gb:function(){return l},Hs:function(){return c},KI:function(){return s},pU:function(){return d},qK:function(){return u},u8:function(){return o},yx:function(){return a}});var r=n(167846);function i(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/");return t>0||n>0}n(34580),n(41873),n(121621),n(577829),n(947478),n(864614),n(227470),n(999921),n(812735),n(623302),n(983431),n(319386),n(657170),n(853127),n(644952),n(759149),n(949136),n(966922),n(33814),n(29536),n(716005),n(548485),n(103343),n(260075),n(791017),n(743286),n(310378),n(124539),n(48498),n(728271),n(814647),n(535689),n(659673);function a(){return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)}function o(){var e=window.chrome,t=window.navigator,n=t.vendor,r=void 0!==window.opr,i=t.userAgent.indexOf("Edge")>-1;return t.userAgent.match("CriOS")||null!=e&&"Google Inc."===n&&!1===r&&!1===i}function s(){var e,t,n,r,o,s,u,c;return!!navigator.requestMediaKeySystemAccess&&(e=a(),t=i(),s=(n=navigator.mimeTypes,r=navigator.userAgent,o=!1,n&&r.indexOf("Chrome")>1&&(o=Object.keys(n).some(function(e){return!!(n[e].type&&n[e].type.indexOf("360")>-1||n[e].type&&n[e].type.indexOf("application/vnd.chromium.remoting-viewer")>-1||n[e].description&&n[e].description.indexOf("360")>-1)||!1})),o),u=navigator.userAgent.indexOf("Firefox")>0,c=navigator.userAgent.indexOf("Edge")>0,!e&&!t&&!s&&!u&&!c)}function u(){try{if(("undefined"==typeof WebAssembly?"undefined":(0,r.Ac)(WebAssembly))==="object"&&"function"==typeof WebAssembly.instantiate){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e) instanceof WebAssembly.Instance}}catch(e){}return!1}function c(){if("undefined"==typeof self)return!1;var e=function(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}(),t=!!e&&"function"==typeof e.isTypeSupported;return t&&void 0===self.MediaSource&&(self.MediaSource=e),t}function l(){return c()&&u()&&!i()}function d(){return u()&&!i()}function g(){return"undefined"!=typeof MediaSource&&!!MediaSource.isTypeSupported&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))}function h(){return"undefined"!=typeof MediaSource&&!!MediaSource.isTypeSupported&&MediaSource.isTypeSupported("video/mp4;codecs=bvc2.1.6.L93.B0")}},328943:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(167846);n(864614),n(632852);var i=(0,r.qH)(function e(){(0,r.PA)(this,e);var t,n,i=new Promise(function(e,r){t=e,n=r});return i.resolve=function(e){t(e),i.state="fulfilled"},i.reject=function(e){n(e),i.state="rejected",i.isBreak="DESTROYED"===e},i.state="pending",i},[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}])},479461:function(e,t,n){n.d(t,{Ck:function(){return m},Ef:function(){return P},Im:function(){return L},Kc:function(){return b},Lc:function(){return s},OU:function(){return o},U2:function(){return A},VC:function(){return i},WV:function(){return x},WX:function(){return h},X4:function(){return T},Y2:function(){return l},Y9:function(){return y},Z6:function(){return a},_6:function(){return f},_R:function(){return D},a1:function(){return Z},c9:function(){return S},h4:function(){return g},i4:function(){return v},iS:function(){return w},kI:function(){return d},mD:function(){return _},ne:function(){return c},of:function(){return N},sp:function(){return R},uD:function(){return E},vG:function(){return r},vL:function(){return p},vp:function(){return u},wL:function(){return I},wW:function(){return k},x3:function(){return C}});var r=1e3,i=50,a=1,o="danger_d_speed",s=5e9,u=300,c={"x-cache":"x_cache","x-response-sinfo":"server_ip"},l={"360p":.45,"480p":.75,"720p":1.6,"1080p":5,"2k":7.5,"4k":12.5},d="player_start",g="wasm_start",h="wasm_ready",f="init_finished",p="core_start",v="start_play",m="error_handler",_="error_catching",I="error_no_mp4opts",C="error_catch_finished",A="next_start",y="next_finished",b={NO_START:0,GOING:1,APPEND:2},k="media_exception",S="mp4_source_exception",E="task_request_expired",T="task_request_error",R={MAIN:"0",BACK:"1"},w={INIT:"init",ERR:"error"},x="currentDashType",D={CDN:"cdn",PCDN:"pcdn"},P=2,N="buffer_control",Z={WAITING:"waiting",PLAYING:"playing"},L={BUFFER_CONTROLS:"buffer_control"}},469140:function(e,t,n){n.d(t,{Z:function(){return k}});var r,i,a=n(884504);n(514312),n(561999),n(11258),n(904644),n(379493),n(969642),n(12965),n(724356),n(947478),n(864614),n(238658),n(210434);var o=n(626735),s=n(374078),u=n(661854),c=n(623176),l=n(768891),d=n(897948),g=n(927425),h=n(569898),f=n(676400),p=n(479461),v=n(894538),m=n(203199),_=n(831442),I=n(431413),C=n(340412),A=n(74312),y=n(918334),b=p.iS;var k=(0,a.qH)(function e(t){var n,r=this;(0,a.PA)(this,e),(0,a._x)(this,"start",(n=(0,a.x)((0,a.l5)().mark(function e(t){var n,i,o,s,u,c,d;return(0,a.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r._beforeLoadStartCostTime=0,r._tm=m.Z.nowTime(),r._sTime=m.Z.nowTime(),!r._checkHasDestroy("start")){e.next=5;break}return e.abrupt("return");case 5:if(r._hasStart&&(r.__dash__&&(r.__dash__.destroy(),r.__dash__=null),r._initProfile(),r._initialize(),r._hasStart=!1),r.setNodeTime("newplayer_start"),n=Date.now(),i=r.__dash__,s=(o=r._pluginInst).player,u=o.config,s.dashState=p.kI,s.emit("dashStateChange",p.kI),!t&&(t=s.config.url="anytext"),c=new l.Z(t,r._pluginInst,i),i){e.next=17;break}return r._info({msg:"__dash__ is null, dashOpts",startMs:n,name:"start __dash__"}),e.abrupt("return");case 17:return i.initDash(c),i.dashVideoEncrypted||i.dashAudioEncrypted||r._pluginInst.softVideo?(h.ZP.log("加密视频"),d=!1===u.useEME,u.useEME=(0,v.isEMESupported)(),(d||r._pluginInst.softVideo)&&(u.useEME=!1),u.intertrustServerURL&&(u.useEME=!0),!u.useEME&&(i.crypto=new f.Z),c.useEME=u.useEME,r._info({msg:"encrypt video ready useEME ".concat(c.useEME)})):(h.ZP.log("非加密视频"),r._info({msg:" no encrypt video ready"})),s.dashState=p.h4,s.emit("dashStateChange",p.h4),e.next=23,r._onWasmReady({url:t});case 23:r._info({msg:"info player start execute",startMs:n,name:"start",profile:!0}),r._hasStart=!0;case 25:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})),(0,a._x)(this,"_onLoadStart",function(){var e=r._pluginInst.config,t=m.Z.nowTime()-r._tm;r._beforeLoadStartCostTime=t>100?100:t,r.changeState("loadstart","beforeLoadStartCostTime ".concat(r._beforeLoadStartCostTime)),e.mseOpenTimeout>0&&(h.ZP.log("mOPenTime",e.mseOpenTimeout,performance.now()),r._mseOpenTimeoutId=setTimeout(function(){var e,t;h.ZP.log("Timeout",performance.now()),r._errorHandler(new I.Z(d.wb.MEDIA,I.Z.MSE_OPEN_TIMEOUT,{message:"mse open timeout"})),r._clearMseOpenTimeout(),null===(e=r.__dash__)||void 0===e||e.destroy(),null===(t=r.__dash__)||void 0===t||null===(t=t.dash)||void 0===t||t.destroy()},e.mseOpenTimeout))}),(0,a._x)(this,"_onLoadData",(0,a.x)((0,a.l5)().mark(function e(){var t,n,i;return(0,a.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.changeState("loaddata"),null==(i=r.__dash__)||null===(t=i.dash)||void 0===t||t.checkPCDN(),null==i||null===(n=i.dash)||void 0===n||n.cachePreloadData(),h.ZP.log("未起播计时 clearCheckCanplayTimer"),i.clearCheckCanplayTimer(),!(null!=i&&i.abrInstance)){e.next=10;break}return e.next=9,i.abrInstance.init(i.dash.mpd.mediaList);case 9:i.abrInstance.execute();case 10:case"end":return e.stop()}},e)}))),(0,a._x)(this,"_errorHandler",function(e){if(r._checkHasDestroy("errorHandler"))return;var t,n,i=r._pluginInst,s=i.player,u=i.config;if(u.codecType===A.$V[A.d0.HEVC].logCodeType&&(null===(t=s.video.error)||void 0===t||null===(t=t.message)||void 0===t?void 0:t.indexOf("video decoder initialization failed"))>=0&&(h.ZP.log("ErrorHandler DECODER_FAILED"),s.emit("DECODER_FAILED",{codecType:u.codecType,vid:u.vid,message:e.message})),e instanceof I.Z)e=new o.ZP(s,e);else if(s.video.error)e=new o.ZP(s,{errorType:d.wb.MEDIA,errorCode:5100+s.video.error.code});else{var c=e;if("string"!=typeof e)try{c=JSON.stringify(e)}catch(e){c="other"}e=new o.ZP(s,{errorType:d.wb.OTHER,errorCode:0,errorMessage:c})}if(null===(n=r._pluginInst)||void 0===n||n.setStartTimelines(y.l1.PLAYER_ERROR,{message:"mse-".concat(e.message,"-").concat(e.errorCode)}),r._errors.push({time:new Date().getTime(),err:e}),h.ZP.log(e),s.emit("xglog_cache"),!!e&&s.dashState!==p.Ck){s.dashState=p.Ck,e.vid=u.vid,e.url=s.src;var l=r.__dash__,g=l&&l.isCurrentAutoDefi;if(e.errd&&"object"===(0,a.Ac)(e.errd)&&l&&l.dash&&(e.errd.url=l.dash.url,e.url=l.dash.url),e.url&&e.url.indexOf("blob:")>-1&&u.dashOpts&&u.dashOpts.dynamic_video&&(e.url=u.dashOpts.dynamic_video.main_url),e&&(e.errorCode===r._getCode(d.wb.MEDIA,d.wb.SUB_TYPES.MSE_HIJACK)||e.errorCode===r._getCode(d.wb.MEDIA,d.wb.SUB_TYPES.EME_HIJACK))){s.emit("error",e);return}if(s.emit("DATA_REPORT",e),e&&e.errorCode===r._getCode(d.wb.DRM,d.wb.SUB_TYPES.LICENSE)){r._pluginInst.destroyKernal(),s.emit("error",e);return}if(e&&(e.errorCode===r._getCode(d.wb.MEDIA,d.wb.SUB_TYPES.MSE_ADD_SB)||e.errorCode===r._getCode(d.wb.DEMUX,d.wb.SUB_TYPES.SIDX))){r._handleDegradeToMp4(e);return}if(e.segmentExpired||e.msg===p.uD){l&&l.abrInstance&&"function"==typeof l.abrInstance._stop&&(l.abrInstance._stop(),h.ZP.abr("error stop","expired",e.segmentExpired,e.ex)),r._pluginInst.emitExpireEvent(e);return}if(!e.curReqVideoSegInfo&&l&&(e.curReqVideoSegInfo=JSON.parse(JSON.stringify(l.curReqVideoSegInfo||{}))),!e.headers&&(e.headers=e.curReqVideoSegInfo.headers||{}),u.useBackUrl&&!r._pluginInst._hasUsedBackUrl&&u.dashOpts&&u.dashOpts.dynamic_video&&l){h.ZP.log("backup replay");var f=l.changeMainBackUrl(b.ERR,r._pluginInst._hasUsedBackUrl);l.updateDashType(),g?f.autoBitrateOpts&&(f.autoBitrateOpts.isPlayAutoDefi=!0):(r.currentDefitionFromPlayer&&(f.defaultDefinition=r.currentDefitionFromPlayer.definition),f.autoBitrateOpts&&(f.autoBitrateOpts.isPlayAutoDefi=!1)),r._pluginInst._hasUsedBackUrl=!0,r._pluginInst.next(s.currentTime,"REPLAY",f,!0,"dash"),s.emit("playCatch","dash",e),h.ZP.log("playCatch dash",JSON.stringify(e)),r._emitDegradeEvent(e,"dash");return}l&&l.updateDashType(!0),r._handleDegradeToMp4(e)}}),this._pluginInst=t,this._errors=[],this._initProfile(),this._proxyPlayer(),this._initialize(),this._bindEvents()},[{key:"changeState",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!this._pTime&&(this._pTime=m.Z.nowTime());var r=m.Z.nowTime()-this._pTime,i=m.Z.nowTime()-this._sTime;h.ZP.log(null===(t=this._pluginInst)||void 0===t||null===(t=t.config)||void 0===t?void 0:t.vid,">>>changeState[".concat(e,"]"),r,i,JSON.stringify(n));var a={state:e,t1:r,t2:i,data:n};!this.states[e]&&(this.states[e]=a),this.allPhases.push(a),this._pTime=m.Z.nowTime()}},{key:"_initProfile",value:function(){this.states={},this.preloadMap={},this.allPhases=[]}},{key:"setNodeTime",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.changeState(e,t),n&&this.setPreloadData(e,t),"initmse_sbopendone"===e&&(h.ZP.log("clear Timeout sbopendone",performance.now()),this._clearMseOpenTimeout())}},{key:"setPreloadData",value:function(e,t){this.preloadMap[e]=t}},{key:"_proxyPlayer",value:function(){var e=this._pluginInst.player;this._originSwitchURL=e.switchURL,this._originErrorHandler=e.errorHandler,e.switchURL=this._switchURL.bind(this),e._startInit=this.start,e.dash=!0,e.errorHandler=this._errorHandler}},{key:"_info",value:function(e){this._pluginInst&&this._pluginInst.info(e)}},{key:"_onWasmReady",value:(r=(0,a.x)((0,a.l5)().mark(function e(t){var n,r,i,o,c,l,d,g,f,v,_,I,C=this;return(0,a.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._checkHasDestroy("_onWasmReady")){e.next=2;break}return e.abrupt("return");case 2:return n=t.url,i=(r=this._pluginInst).player,o=r.config,l=(c=this.__dash__).dash,i.dashState=p.WX,i.emit("dashStateChange",p.WX),h.ZP.log("监听到wasm_ready"),this._info({msg:"wasm_ready"}),m.Z.on(l,"error",this._errorHandler,"destroy"),c.bindComEvent(),e.prev=12,e.next=15,l.init(n);case 15:if(d=e.sent){e.next=19;break}return this._info({msg:"isDestroy ".concat(!i,", isMseNull ").concat(!d)}),e.abrupt("return");case 19:h.ZP.time("initReady cost",new Date().getTime()-c.startTimestamp),i.dashState=p._6,i.emit("dashStateChange",p._6),h.ZP.log("dash init完成"),l.mpd.mediaList.video.length>0&&(!o.defaultDefinition&&(o.defaultDefinition=o.dashOpts.dynamic_video.dynamic_video_list[0].definition,c.lastDefiIdx=0),!c.isOpenAutoDefi&&(c.isCurrentAutoDefi=!1,c.abrInstance.isCurrentInAbr=!1),g=o.defaultDefinition.toString(),this._initDefinitionList(g),(!(f=c.definitions.some(function(e){return e.selected}))||void 0===c.lastDefiIdx)&&(!f&&(c.definitions[0].selected=!0,v=c.definitions[0].definition,this._pluginInst.setCurrentDefitionInfos(v,c.definition2item[v])),i.emit("initialUrl",l.mpd.mediaList.video[0].baseURL),c.curBitrate=o.dashOpts.dynamic_video.dynamic_video_list[0].bitrate,c.lastDefiIdx=0),this._afterInitDefinitionList()),this._pluginInst.originStartInit.call(i,d.url),h.ZP.time("start call cost",new Date().getTime()-c.startTimestamp),i.dashState=p.vL,i.emit("dashStateChange",p.vL),c.startCheckCanplayTimer(),c.isDashCanUse=!0,c.mse=d,c.emitMenuResolutionChange(),"safari"===s.Z.browser&&(u.ZP.addClass(i.root,"canplay"),_=function(){u.ZP.removeClass(i.root,"xgplayer-is-enter")},m.Z.once(i,"waiting",_)),I=function(){if(!C._checkHasDestroy("onStartPlay"))i.emit("dash_start_play"),C._info({msg:"dash_start_play"}),i.dashState=p.i4,C._info({msg:"START_PLAY ready"}),i.emit("dashStateChange",p.i4),i.emit("playInterfaceInfo",o.dashOpts||{}),!c.isCurrentAutoDefi&&h.ZP.time("onStartPlay cost not abr",new Date().getTime()-c.startTimestamp),c.startProgressTimer(),h.ZP.time("onStartPlay cost",new Date().getTime()-c.startTimestamp),c.setCurrentDefinition()},m.Z.once(l,"start_play",I),this._info({msg:"START_PLAY dashready"}),i.emit("dashready"),e.next=42;break;case 39:e.prev=39,e.t0=e.catch(12),i.errorHandler(e.t0);case 42:case"end":return e.stop()}},e,this,[[12,39]])})),function(e){return r.apply(this,arguments)})},{key:"_initDefinitionList",value:function(e){var t=this;e=e.toString();var n=this._pluginInst,r=n.player,i=n.config,o=this.__dash__,s=o.dash,u=i.dashOpts.dynamic_video.dynamic_video_list;o.definitions=[];for(var c=0;c<u.length;c++){var l=u[c];o.bandwidth2item[l.bitrate]=l,o.definition2item[l.definition]=l}s.mpd.mediaList.video.sort(function(e,t){return t.height-e.height}),s.mpd.mediaList.video.forEach(function(n,u){var c=o.bandwidth2item[n.bandwidth];if(!!c){var l=c.definition.toString(),d=!!(l===e&&(!o.isOpenAutoDefi||!o.isPlayAutoDefi));o.definitions.push((0,a.Zj)((0,a.Zj)({name:i.definitionText&&i.definitionText[l]||l,selected:d,fps:c.fps},c),{},{url:Array.isArray(n.url)?n.url:n.id,definition:String(c.definition)})),n.frameRate=n.frameRate||c.fps||25;var g=c.bitrate;o.updateAbrCacheData(u,o.isPlayAutoDefi,c),l===e&&(h.ZP.log("dashDefinition",l),r.emit("initialUrl",s.mpd.mediaList.video[u].baseURL),o.curBitrate=g,o.lastDefiIdx=u),d&&t._pluginInst.setCurrentDefitionInfos(c.definition,c)}})}},{key:"_afterInitDefinitionList",value:function(){var e=this._pluginInst,t=e.player,n=e.config,r=this.__dash__;t.emit("resourceReady",r.definitions,n.dashOpts.dynamic_video.dynamic_video_list),r.abrInstance.updateBitrate(r.curBitrate);var i=r.definitions.filter(function(e){return e.selected})[0];r.setPlayerCurDefinition(i)}},{key:"_filterBy",value:function(e,t,n){var r=[],i=[];t.forEach(function(t){r.push(t),t[e]&&i.push(t[e])}),Array.isArray(n)&&n.forEach(function(t){t.isExtra=!0,t[e]&&!i.includes(t[e])&&r.push(t)});var a=[],o=r.filter(function(e){return"video"===e.mediaType});o.sort(function(e,t){return e.bitrate<t.bitrate?-1:1});var s=r.filter(function(e){return"audio"===e.mediaType});return s.sort(function(e,t){return e.bitrate<t.bitrate?-1:1}),a=(a=a.concat(o)).concat(s)}},{key:"_processFeedData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._pluginInst,n=t.player,r=t.config,i=n.config;if(r.playInfoType===C.zB.FEED&&i.definition){var a,o=r.dashOpts.Data,s=i.definition.list,u=i.definition.extraList||[],c=e?s:(null==o?void 0:o.vid)===r.vid&&(null==o?void 0:o.playInfoList)||s;c=c.filter(function(e){return!e.isExtra}),r.defaultDefinition=i.defaultDefinition||i.definition.defaultDefinition,i.definition.list=c.filter(function(e){return e.vtype.toUpperCase()===y.l0.DASH&&"video"===e.mediaType});var l=c.concat(u)||[];null!==(a=c[0])&&void 0!==a&&a.file_id&&(l=this._filterBy("file_id",c,u)),r.dashOpts.Data={vid:i.vid,duration:i.duration,playInfoList:JSON.parse(JSON.stringify(l))};var d=l.filter(function(e){return e.vtype.toUpperCase()===y.l0.MP4});if(d.length>0||i.downgradeUrl){var g=d.length>0?d:[{url:i.downgradeUrl,definition:"1",vtype:"MP4",size:0,codecType:"h264"}];r.mp4Opts={mp4List:g}}else r.mp4Opts=null}}},{key:"_processData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._pluginInst,n=t.player,r=t.config,i=n.config;this._processFeedData(e),r.dashOpts.Data&&(r.playInfoType===C.zB.TOP||r.playInfoType===C.zB.FEED)&&this._playInfoInit(),r.dashOpts.dynamic_video&&(r.dashOpts.dynamic_video.dynamic_video_list=r.dashOpts.dynamic_video.dynamic_video_list||[],r.dashOpts.dynamic_video.dynamic_audio_list=r.dashOpts.dynamic_video.dynamic_audio_list||[],[r.dashOpts.dynamic_video.dynamic_video_list,r.dashOpts.dynamic_video.dynamic_audio_list].forEach(function(e){e.forEach(function(e){if(e.bitrate=parseInt(e.real_bitrate||e.bitrate),i&&"function"==typeof i.preProcessUrl){var t=i.preProcessUrlOptions||{};e.main_url=i.preProcessUrl(e.main_url,t).url,e.backup_url_1=i.preProcessUrl(e.backup_url_1,t).url;var n=Object.assign({},t,{isFallback:!0});e.fallback_url=i.preProcessUrl(e.fallback_url,n).url}})}))}},{key:"_initialize",value:function(){var e=this._pluginInst,t=e.player,n=e.config;if(h.ZP.log(null==n?void 0:n.vid,"执行dashKernal"),this._processData(),!n.dashOpts){this._info({msg:"dashOpts is null",startMs:Date.now(),name:"_initialize",add:!0});return}var r=p.iS,i=new _.Z({pluginInst:this._pluginInst});this.__dash__=i;var a=g.d1.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"');a?i.changeMainBackUrl(r.INIT,this._hasUsedBackUrl):(this._info({msg:"isCodecSupported ".concat(a),add:!0}),null==t||t.errorHandler(new I.Z(d.wb.MEDIA,d.wb.SUB_TYPES.MEDIA_ERR_CODEC_NOT_SUPPORTED,{message:"init"})))}},{key:"_bindEvents",value:function(){var e=this._pluginInst.player;e.on(c.LOAD_START,this._onLoadStart),e.on(c.LOADED_DATA,this._onLoadData)}},{key:"_clearMseOpenTimeout",value:function(){this._mseOpenTimeoutId&&(clearTimeout(this._mseOpenTimeoutId),this._mseOpenTimeoutId=null)}},{key:"beforeLoadStartCostTime",get:function(){return this._beforeLoadStartCostTime}},{key:"_switchURL",value:(i=(0,a.x)((0,a.l5)().mark(function e(t){var n,r,i=arguments;return(0,a.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(i.length>1)||void 0===i[1]||i[1],r=this.__dash__,e.next=4,r.switchURL(t,n);case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"onPreChangeDefinition",value:function(e){if(!Array.isArray(e)||!this.__dash__||!this.__dash__.dash||this.__dash__.dash._hasDestroyed)return[];var t,n,r,i,a,o=this._pluginInst,s=o.player,u=o.config,c=s.config,l=null===(t=this.__dash__)||void 0===t||null===(t=t.dash)||void 0===t?void 0:t.mpd;if(l&&(i=null===(a=this.__dash__)||void 0===a||null===(a=a.dash)||void 0===a||null===(a=a.mpd)||void 0===a?void 0:a.getCurrDefition()),c.definition.list=e,this._processData(!0),null===(n=this.__dash__)||void 0===n||null===(n=n.dash)||void 0===n||null===(n=n.mpd)||void 0===n||n.init(!1,i),l){var d=l.mediaList.video,g=d.selectedIdx;this.__dash__.curVideoInitSegmentIdx=g,this.__dash__.curVideoFileId=d[g].fileId}var h=u.defaultDefinition.toString();return this._initDefinitionList((null===(r=s.curDefinition)||void 0===r?void 0:r.definition)||h),this._afterInitDefinitionList(),this.__dash__.definitions}},{key:"_playInfoInit",value:function(){var e=this._pluginInst,t=e.config,n=e.playerConfig,r=t.dashOpts.Data;t.vid=r.VideoID||r.Vid||r.vid,n.vid=t.vid,t.playInfoType===C.zB.TOP?(0,C.NK)(t):t.playInfoType===C.zB.FEED&&(0,C.LY)(t)}},{key:"_getCode",value:function(e,t){return d.WE[e][t]}},{key:"_emitDegradeEvent",value:function(e,t){if(this._pluginInst){var n=this._pluginInst.player,r=e.errorCode,i=e.errorMessage,o=(0,a.Zj)((0,a.Zj)({},e),{},{vtype:t,errc:r,err_msg:i||(null==e?void 0:e.message)});n.pause(),n.emit("degrade",o),h.ZP.log("degrade event emit",JSON.stringify(o))}}},{key:"_handleDegradeToMp4",value:function(e){var t=this;if(!this._checkHasDestroy("_handleDegradeToMp4")){var n=this._pluginInst,r=n.player,i=n.config;if(i.mp4Opts&&!this._hasDegradeMp4){h.ZP.log("_handleDegradeToMp4"),this._hasDegradeMp4=!0,r.dashState=p.mD;var o=i.startTime||r.currentTime||0;setTimeout(function(){var n;if(!t._checkHasDestroy("degrademp4"))t._pluginInst._setStartTime("destroy",o,!0,!1),r.emit("playertypechange"),r.dashState=p.x3,r.emit("playCatch","dash_mp4_2",(0,a.Zj)((0,a.Zj)({},e),{},{url:(null==r||null===(n=r.config)||void 0===n?void 0:n.downgradeUrl)||""})),h.ZP.log("playCatch dash_mp4_2",JSON.stringify(e)),t._emitDegradeEvent(e,"dash_mp4_2"),i.defaultFormat="mp4",t._pluginInst.changeKernal(!0,!1,"dash_mp4_2"),r.once("canplay",function(){if(r.config.autoplay){var e=r.video.play();e&&e.catch(function(){})}})},0)}else!i.mp4Opts&&(r.dashState=p.wL,r.emit("dashDestroy"),r.emit("error",e),h.ZP.log("_handleDegradeToMp4 throw error"))}}},{key:"abrInstance",get:function(){return this.__dash__.abrInstance}},{key:"destroy",value:function(){var e=this._pluginInst.player;this.__dash__&&(this.__dash__.destroy(),this.__dash__=null),e.off(c.LOAD_START,this._onLoadStart),e.off(c.LOADED_DATA,this._onLoadData),e.errorHandler=this._originErrorHandler,e._startInit=this._pluginInst._originStartInit,e.switchURL=this._originSwitchURL,this._pluginInst=null,this._hasStart=!1,h.ZP.log("dashKernal destroy"),this._clearMseOpenTimeout()}},{key:"_checkHasDestroy",value:function(e){return!this._pluginInst&&(this._info({msg:"dashKernal destroy ".concat(e),add:!0}),h.ZP.log("checkHasDestroy",e),!0)}},{key:"executeReady",value:function(){if(!this._checkHasDestroy("executeReady")){var e=this._pluginInst.player;m.Z.once(e,"dash_start_play",function(){e.dashState=p.Y9,e.emit("nextEnded")})}}},{key:"getStat",value:function(){if(!this._checkHasDestroy("getStat")){var e={};e.dvps=!!this._pluginInst.pvStartup,e.daps=!!this._pluginInst.paStartup,e.preLoadData=this.getPreloadStat();var t={},n={};if(this.__dash__&&this.__dash__.dash&&this.__dash__.dash.mse){var r=this.__dash__.dash.mse;if(r._sourceBuffer){for(var i=Object.keys(r._sourceBuffer),a=0;a<i.length;a++){var o=i[a],s=(r._queue[o]||[]).map(function(e){return{opName:e.opName,context:e.context}});n[o]={updating:r._sourceBuffer[o].updating,queue:s.slice(0,Math.max(5,s.length)),queueEmpty:!r._queue[o]}}}}e.mseStat=n,this.__dash__&&this.__dash__.dash&&this.__dash__.dash.mpd&&(t.video=this.__dash__.dash.mpd._getBuffered("video"),t.audio=this.__dash__.dash.mpd._getBuffered("audio")),e.bfs=t;var u=this._pluginInst.player;e.currentTime=u.currentTime;var c=u.video.error;return e.dVideoError=c?{code:c.code,message:c.message}:null,e.errors=this._errors,e.performance=this.states,e.stage=this._getKeyCost(),e}}},{key:"_getKeyCost",value:function(){var e=this,t=function(t,n){var r=e.states[n],i=e.states[t],a=(null==r?void 0:r.t2)-(null==i?void 0:i.t2);return Number.isFinite(a)?a:-1};return{mseopen_to_msedone:t("initmse_sbopen","initmse_sbopendone"),videometastart_to_metadone:t("initvideo_metastart","initvideo_metadone"),audiometastart_to_metadone:t("initaudio_metastart","initaudio_metadone"),videosegstart_to_segdone:t("initvideo_segstart","initvideo_segdone"),audiosegstart_to_segdone:t("initaudio_segstart","initaudio_segdone"),mseopen_to_loadeddata:t("initmse_sbopen","loaddata"),videoappend_to_loadeddata:t("initvideoSegmentAppend","loaddata"),audioappend_to_loadeddata:t("initaudioSegmentAppend","loaddata")}}},{key:"getPreloadStat",value:function(){for(var e={length:0,byteLength:0,load:[],duration:0,audioDuration:0},t=Object.keys(this.preloadMap),n=0;n<t.length;n++){var r=this.preloadMap[t[n]]||{};if(r&&r.fromCache&&r.byteLength){if(e.length+=r.byteLength,e.byteLength+=r.byteLength,e.load.push(r),!r.isInitSegment&&!r.duration)try{var i,a=this.__dash__.dash.mpd.mediaList[r.mediaType],o=null===(i=a[a.selectedIdx].mediaSegments)||void 0===i?void 0:i[0].endRaw;r.duration=o}catch(e){r.duration=5}var s=r.duration;"video"===r.mediaType?e.duration+=s||0:e.audioDuration+=s||0}}return e.loadLength=e.load.length,e}},{key:"pcdnReq",get:function(){var e,t=null===(e=this.__dash__)||void 0===e?void 0:e.dash;return null==t?void 0:t.pcdnReqCnt()}},{key:"pcdnVVStat",value:function(){var e,t=null===(e=this.__dash__)||void 0===e?void 0:e.dash;return null==t?void 0:t.pcdnVVStat()}},{key:"encryptedType",get:function(){return this.__dash__.encryptedType}},{key:"replay",value:function(){var e=this.__dash__;e&&e.abrInstance&&e.abrInstance.isCurrentInAbr&&e.abrInstance.start()}},{key:"bandwidth",get:function(){var e,t=this.__dash__;return t&&t.dash&&t.dash.loadInfo?null===(e=t.dash)||void 0===e?void 0:e.loadInfo:{cdn:{size:0},pcdn:{size:0}}}}])},907376:function(e,t,n){n.d(t,{Lj:function(){return p},ZP:function(){return _}});var r,i,a,o,s,u,c=n(884504);n(561999),n(11258),n(379493),n(724356),n(864614),n(227470),n(347885);var l=n(868685),d=n(203199),g=n(569898),h=["app_id","trackerUrl","sid","task_type"],f={CLOSE:"close",OPEN:"open",FORBIDDEN:"forbidden"},p={PCDN:1,CDN:0},v={PLAY:1},m={enterMinBuffer:10,minDuration:25,openPreloadPCDN:!1,outMaxBuffer:5,openPCDN:!1,trackerUrl:"https://vc-gate.ndcpp.com/sdk/get_peer",withReferer:1};var _=(0,c.qH)(function e(t,n,r,i,a,o){(0,c.PA)(this,e),this._pcdnNodes=null,this._cachedPcdn={},this._PCDNState=f.CLOSE,this._retryInfo={},this._bitrate2file={},this._isOpenPCDN=!1,this._duration=0,this._vid="",this._tag="",this._isUseCDN=!1,this._lastPCDNUrl="",this.pcdn_download_request_cnt=0,this.pcdn_download_failed_cnt=0,this._PCDNSwitchCnt=0,this.pcdn_tracker_failed_cnt=0,this.pcdn_tracker_request_cnt=0,this._pcdnVVStat={try_req_node:0,req_node_succ:0,has_ret_node:0,conn_req_num:0,conn_fail_num:0,conn_jump_num:0,pSCCancelCnt:0},this._lastBitrateMap={},this._pcdnConfig=Object.assign({},m,t),this._isOpenPCDN=n,this.updateConfig({vid:i,duration:r}),this._player=a,this._tag=o},[{key:"getPCDNReqId",value:function(e){var t=e.uri||this._vid;return this._getPCDNReqIdBitrate(t,e.bitrate)}},{key:"_getPCDNReqIdBitrate",value:function(e,t){return e.slice(-20)+t}},{key:"_createFileInfo",value:function(e){var t,n=e.file_id||e.fileId,r=e.main_url||e.baseURL;if(t=r,!/^http(s)?:\/\/.+/.test(t))r=document.location.protocol+r;return{vid:this._vid,cdn_url:r,file_type:"dash",sfid:n,bitrate:e.bitrate,duration:Math.floor(this._duration||0),size:e.size}}},{key:"checkPCDN",value:(r=(0,c.x)((0,c.l5)().mark(function e(t){var n,r,i,a,o,s,u,d,f,p,m,_,I;return(0,c.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._vid){e.next=3;break}return e.abrupt("return");case 3:if(!((null===(n=this._pcdnConfig)||void 0===n?void 0:n.openPCDN)&&this._isOpenPCDN&&this._duration>=this._pcdnConfig.minDuration&&t)){e.next=24;break}if(r=t.bitrate,!(i=this._cachedPcdn[r])){e.next=12;break}if(a=i.pcdnNodeList,o=i.pcdnTraceInfo,!(a&&a.length>0&&o)){e.next=12;break}return this._pcdnTraceInfo=o,e.abrupt("return");case 12:return u=(s=this._pcdnConfig).app_id,d=s.trackerUrl,f=s.sid,p=s.task_type,m=(0,c.Kd)(s,h),_=t.file_id||t.fileId,I=this._createFileInfo(t),this._bitrate2file[t.bitrate]=_,this._pcdn?(g.ZP.log(this._tag,"resetTrackeArgs"),this._pcdn.resetTrackeArgs()):this._pcdn=new l.e((0,c.Zj)({productConfig:{app_id:u,sid:f,task_type:p||v.PLAY},trackerUrl:d},m),this._player,I.bitrate,I.duration),e.prev=17,e.next=20,this.getPCDNNode(t.bitrate,t);case 20:e.next=24;break;case 22:e.prev=22,e.t0=e.catch(17);case 24:case"end":return e.stop()}},e,this,[[17,22]])})),function(e){return r.apply(this,arguments)})},{key:"setSetRetryInfo",value:function(e){var t=d.Z.getHostFromUrl(e);this._retryInfo[t]=!0}},{key:"_updateNodeList",value:function(e,t){var n=this;if(e&&e.nodes){var r,i={pcdnNodeList:e.nodes.filter(function(e){if(!Object.prototype.hasOwnProperty.call(n._retryInfo,d.Z.getHostFromUrl(null==e?void 0:e.url)))return e}),pcdnTraceInfo:{uri:e.vid,fid:e.fid,trace_id:e.trace_id}},a=this._bitrate2file[t];null!==(r=e.fid)&&void 0!==r&&r.includes(a)?(this._cachedPcdn[t]=i,this._pcdnTraceInfo=i.pcdnTraceInfo,g.ZP.log(this._tag,"_updateNodeList",JSON.stringify(this._cachedPcdn))):8*function(e){return Math.floor(e/8)}(t)===e.bitrate&&(this._cachedPcdn[t]=i,g.ZP.log(this._tag,"_updateNodeList not file not match cachedFileid",a,"pcdnRet"))}}},{key:"isUpdateNode",value:function(e){var t=this._getNodeListByBitrate(e);return!t||!t.length}},{key:"selectedPCDN",value:function(e,t){var n,r;if(!!(null===(n=this._pcdnConfig)||void 0===n?void 0:n.openPCDN)){if(this._PCDNState===f.FORBIDDEN||e){this._isUseCDN=!0;return}if(this.isUsePCDN(t)){this._isUseCDN=!1;var i=this._getNodeListByBitrate(t);i&&(r=i[0].url,this._lastPCDNUrl!==r&&(this._lastPCDNUrl=r,this._pcdnVVStat.conn_req_num+=1),this.pcdn_download_request_cnt++)}else!this._isUseCDN&&(this._PCDNSwitchCnt++,this._pcdnVVStat.conn_jump_num+=1,this._PCDNSwitchCnt>=this._pcdnConfig.switchPCDNMaxCnt&&this.updatePCDNState(f.FORBIDDEN,function(){})),this._isUseCDN=!0;return r}}},{key:"isUsePCDN",value:function(e){var t=this._getNodeListByBitrate(e);return this._PCDNState===f.OPEN&&t&&t.length>0}},{key:"_getNodeListByBitrate",value:function(e){var t=this._cachedPcdn[e];return t?t.pcdnNodeList:null}},{key:"getPCDNInOUtBuffer",value:function(){var e,t,n,r=null===(e=this._pcdnConfig)||void 0===e?void 0:e.openPCDN,i=this._pcdnConfig,a=null===(t=this._pcdn)||void 0===t?void 0:t.getPCDNInBuffer(),o=null===(n=this._pcdn)||void 0===n?void 0:n.getPCDNOutBuffer(),s=a||(null==i?void 0:i.enterMinBuffer)||(null==i?void 0:i.minBuffer)||-1,u=o||(null==i?void 0:i.outMaxBuffer)||-1;return{PCDNInBuffer:r?s:-1,PCDNOutBuffer:r?u:-1}}},{key:"isOpenPCDN",value:function(e,t,n,r){if(!!(null===(i=this._pcdnConfig)||void 0===i?void 0:i.openPCDN)){var i,a=this.getPCDNInOUtBuffer(),o=a.PCDNInBuffer,s=a.PCDNOutBuffer;e>=o?this._doOpenPCDN(t,r):e<s&&this.updatePCDNState(f.CLOSE,n)}}},{key:"_emptyCancel",value:function(){}},{key:"_doOpenPCDN",value:(i=(0,c.x)((0,c.l5)().mark(function e(t,n){var r;return(0,c.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updatePCDNState(f.OPEN,this._emptyCancel),null===(r=this._pcdn)||void 0===r||r.updatePCDNBitrate(t),!this.isUpdateNode(t)){e.next=5;break}return e.next=5,this.getPCDNNode(t,n);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"openPCDNForce",value:(a=(0,c.x)((0,c.l5)().mark(function e(t,n){var r;return(0,c.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=this._pcdnConfig)||void 0===r?void 0:r.openPCDN){e.next=3;break}return e.abrupt("return");case 3:return this._PCDNState=f.OPEN,e.next=6,this.checkPCDN(n);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"updatePCDNState",value:(o=(0,c.x)((0,c.l5)().mark(function e(t,n){return(0,c.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==f.FORBIDDEN){e.next=5;break}this._PCDNState=t,g.ZP.log(this._tag,"updatePCDNState",f.FORBIDDEN),e.next=16;break;case 5:if(!(this._PCDNState!==f.FORBIDDEN&&this._PCDNState!==t)){e.next=16;break}if(!(!this._isUseCDN&&t===f.CLOSE&&this._PCDNState!==f.CLOSE)){e.next=14;break}return this._PCDNState=t,g.ZP.log(this._tag,"updatePCDNState",f.CLOSE),e.next=11,n();case 11:this._pcdnVVStat.pSCCancelCnt++,e.next=16;break;case 14:this._PCDNState=t,g.ZP.log(this._tag,"updatePCDNState",t);case 16:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"getPCDNNode",value:(s=(0,c.x)((0,c.l5)().mark(function e(t,n){var r,i,a,o,s,u,l,d,h;return(0,c.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._pcdn){e.next=2;break}return e.abrupt("return",null);case 2:if(e.prev=2,i=n.mediaType,a=this._lastfetchNodeTime[i]||0,o=this._lastBitrateMap[i],!((s=Date.now())-a<this._pcdn.options.NULLNodeTimeStep&&o===t)){e.next=9;break}return e.abrupt("return");case 9:return this._lastfetchNodeTime[i]=s,this._lastBitrateMap[i]=t,u=this._getPCDNReqIdBitrate(this._vid,t),l=this._createFileInfo(n),e.next=15,this._pcdn.fetchPCDNNode(null,l,u);case 15:if(d=e.sent,h=this._getPCDNReqIdBitrate(this._vid,t),!(null!=d&&d.req_id&&h!==d.req_id)){e.next=20;break}return g.ZP.log("getPCDNNode is not match curDefinition reqId",u,", pcdnRet.req_id",d.req_id),e.abrupt("return");case 20:d&&this._updateNodeList(d,t),this._pcdnVVStat.try_req_node+=1,this._pcdnVVStat.req_node_succ+=1,this._pcdnVVStat.has_ret_node+=(null==d||null===(r=d.nodes)||void 0===r?void 0:r.length)>0?1:0,e.next=30;break;case 26:e.prev=26,e.t0=e.catch(2),this._pcdnVVStat.try_req_node+=1;case 30:case"end":return e.stop()}},e,this,[[2,26]])})),function(e,t){return s.apply(this,arguments)})},{key:"removePCDNNode",value:(u=(0,c.x)((0,c.l5)().mark(function e(t,n){return(0,c.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._pcdn){e.next=2;break}return e.abrupt("return",null);case 2:return g.ZP.log(this._tag,"removePCDNNode",t,n),this.pcdn_download_failed_cnt++,this._pcdnVVStat.conn_fail_num++,this._cachedPcdn[t]=null,e.next=8,this._pcdn.removePCDNNode(this._vid,t,n);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"pcdnReqCnt",get:function(){var e=l.e.pcdnReqCnt;return{pcdn_download_request_cnt:this.pcdn_download_request_cnt,pcdn_download_failed_cnt:this.pcdn_download_failed_cnt,pcdn_tracker_request_cnt:e.pcdn_tracker_request_cnt,pcdn_tracker_failed_cnt:e.pcdn_tracker_failed_cnt}}},{key:"pcdnVVStat",get:function(){var e;return Object.assign({},this._pcdnVVStat,{is_try_open:1,trace_id:null===(e=this._pcdnTraceInfo)||void 0===e?void 0:e.trace_id})}},{key:"updateConfig",value:function(e){var t=e.vid,n=e.duration;this._vid=t,this._duration=n,this._lastfetchNodeTime={audio:0,video:0},this._lastBitrateMap={audio:0,video:0}}}])},639569:function(e,t,n){n.d(t,{Gb:function(){return a},HR:function(){return u},lE:function(){return c},rP:function(){return o}});var r=n(811156),i=["webgl2"];function a(){return function(){try{if(("undefined"==typeof WebAssembly?"undefined":(0,r.Ac)(WebAssembly))==="object"&&"function"==typeof WebAssembly.instantiate){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e) instanceof WebAssembly.Instance}}catch(e){}return!1}()&&u()}function o(){return!!HTMLVideoElement.prototype.getVideoPlaybackQuality}var s="xgplayer-webgl-hard-supported";function u(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=sessionStorage&&sessionStorage.getItem(s);if(!e&&null!==t)return 1===parseInt(t);var n=!1,r=null;try{r=document.createElement("canvas");for(var a=0;a<i.length;a++){var o=r.getContext(i[a],{failIfMajorPerformanceCaveat:!0});if(o){o=null,r=null,n=!0;break}}}catch(e){n=!1}finally{r=null}return sessionStorage&&sessionStorage.setItem(s,n?1:0),n}function c(){return"requestVideoFrameCallback"in HTMLVideoElement.prototype||!1}},559435:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(989798);n(904644),n(947478),n(864614);let i=(0,r.qH)(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.PA)(this,e),this.config={size:30,severeBlockDuration:1500,slightBlockDuration:100,highBitrateRatio:1.5,lowBitrateRatio:.8,highLadderSelectedCnt:1,lowLadderSelectedCnt:1,blockSumMaxTime:6e5},Object.keys(n).map(function(e){t.config[e]=n[e]}),this.timerId=null,this.setTimer()},[{key:"setConfig",value:function(e){var t=this;Object.keys(e).map(function(n){t.config[n]=e[n]})}},{key:"resetCurrent",value:function(){this._info.currentBlockDur=0}},{key:"setTimer",value:function(){var e=this;this._blockQueue=[],this._tBQueue=[],this._sBQueue=[],this._hCount=0,this._lCount=0,this._info={blockDurationSum:0,currentBlockDur:0,targetBitrateAvg:0,selectedBitrateAvg:0,higherSelectedCnt:0,lowerSelectedCnt:0},this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.timerId=setTimeout(function(){e.setTimer()},this.config.blockSumMaxTime)}},{key:"targetBitRate",set:function(e){if(!!e&&"number"==typeof e){this._tBQueue.push(parseInt(e,10)),this._tBQueue.length>this.config.size&&this._tBQueue.shift(0,1);var t=0;this._tBQueue.map(function(e){t+=e}),this._info.targetBitrateAvg=t/this._tBQueue.length}}},{key:"selectBitRate",set:function(e){if(!!e&&"number"==typeof e){this._sBQueue.push(e),this._sBQueue.length>this.config.size&&this._sBQueue.shift(0,1);var t=0;this._sBQueue.map(function(e){t+=e}),this._info.selectedBitrateAvg=t/this._sBQueue.length}}},{key:"blockDuration",set:function(e){this._blockQueue.push(e),this._blockQueue.length>this.config.size&&this._blockQueue.shift(0,1);var t=0;this._blockQueue.map(function(e){t+=e}),this._info.blockDurationSum=t}},{key:"currentBlockDur",set:function(e){this._info.currentBlockDur+=e}},{key:"updateBitRateInfo",value:function(e,t){if(!!e&&!!t)e>t?this._info.higherSelectedCnt++:e<t&&this._info.lowerSelectedCnt++}},{key:"checkDefinition",value:function(){var e=this.config,t=this._info;return t.blockDurationSum>e.severeBlockDuration&&(t.selectedBitrateAvg>t.targetBitrateAvg*e.highBitrateRatio&&t.higherSelectedCnt>=e.highLadderSelectedCnt||t.currentBlockDur>e.severeBlockDuration)?1:t.blockDurationSum<e.slightBlockDuration&&t.selectedBitrateAvg<t.targetBitrateAvg*e.lowBitrateRatio&&t.lowerSelectedCnt>=e.lowLadderSelectedCnt?2:0}}])},409684:function(e,t,n){n.d(t,{Z:function(){return r}});function r(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}},51891:function(e,t,n){n.d(t,{Z:function(){return r}});let r=function(){try{if("undefined"!=typeof indexedDB)return indexedDB}catch(e){}}()},362043:function(e,t,n){n.d(t,{d:function(){return s}});var r=n(673295);n(864614),n(632852),n(130458);var i=n(159322),a=n.n(i),o=n(975048),s=function(e){(0,r.XW)(u,e);var t,n,i,a,s=(0,r.WY)(u);function u(e,t){var n;return(0,r.PA)(this,u),(n=s.call(this))._data=null,n.preloadManager=e,n._config=t,n.promisePolyfill(),n}return(0,r.qH)(u,[{key:"taskInProgress",get:function(){return!1}},{key:"stepwise",get:function(){return this.preloadManager.stepwise}},{key:"getRequestOption",value:function(e){var t=this._config,n=t.getRequestOptionsCallback,r=t.reqOptions,i={};return e?i=e.reqOptions?e.reqOptions:"function"==typeof n?n(e):r||{}:i}},{key:"getUserSelectDefinition",value:function(){return this.preloadManager.getUserSelectDefinition()}},{key:"selectBitrate",value:function(e,t,n){return this.preloadManager.selectBitrate(e,t,n)}},{key:"promisePolyfill",value:function(){!Promise.prototype.finally&&(Promise.prototype.finally=({finally:function(e){var t=function(t){return Promise.resolve(e()).then(t)};return this.then(function(e){return t(function(){return e})},function(e){return t(function(){return Promise.reject(e)})})}}).finally)}},{key:"getData",value:function(){return this._data}},{key:"setData",value:function(e){this._data=e}},{key:"start",value:(t=(0,r.x)((0,r.l5)().mark(function e(t,n){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("start need implement, return Promise");case 1:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)})},{key:"cancel",value:(n=(0,r.x)((0,r.l5)().mark(function e(){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("cancel need implement, cancel current preload request");case 1:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})},{key:"getPreLoadData",value:(i=(0,r.x)((0,r.l5)().mark(function e(t){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("getPreLoadData not implement");case 1:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})},{key:"getPreLoadDataSync",value:function(e){return null}},{key:"hasItemSameVid",value:function(e){return!0}},{key:"destroy",value:(a=(0,r.x)((0,r.l5)().mark(function e(){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)})},{key:"parseKey",value:function(e){return o.s.parseKey(e[0])}}],[{key:"generateUniqueKey",value:function(e){throw Error("generateUniqueCacheKey  need implement, return string")}},{key:"vtype",get:function(){throw Error("need vtype")}},{key:"isUniqueCache",value:function(e){return!0}}]),u}(a())},743107:function(e,t,n){function r(e,t,n){if(!e)return!1;var r=a(e.buffered,e.currentTime),i=t.startPreloadControl,o=t.startPreloadMinBuffer,s=t.startPreloadMinPosTime,u=t.minBufferLength;if(i){var c=Math.max(r[1]-e.currentTime,0);if(c>o){if(e.currentTime>s||e.currentTime>e.duration/2)return null==n||n("log","[checkIfStartPreload] hit buffer",c,"startPreloadMinBuffer",o),!0}else if(e.currentTime+o+1>e.duration&&e.currentTime+c>e.duration-1)return null==n||n("log","[checkIfStartPreload] hit end"),!0}else{var l=e.duration>u+5?u:e.duration/2,d=Math.min(e.currentTime+u,e.duration),g=r[1]-d;if(e.currentTime>l&&g>-1)return null==n||n("log","[checkIfStartPreload] hit minPos",l,"minCacheTime",d),!0}return!1}function i(e,t,n){var r=t.endPreloadControl,i=t.endPreloadMinBuffer,o=t.startPreloadMinBuffer;if(!e)return!1;if(r){if(e.currentTime+o>=e.duration)return!1;var s=Math.max(a(e.buffered,e.currentTime)[1]-e.currentTime,0);if(s<=i)return null==n||n("log","[checkIfCancelPreload] hit buffer:",s,"endPreloadMinBuffer:",i,"video:","".concat(e.currentTime,"/").concat(e.duration)),!0}return!1}function a(e,t){var n=[0,0];if(e)for(var r=0,i=e.length;r<i&&(n[0]=e.start(r),n[1]=e.end(r),!(n[0]<=t)||!(t<=n[1]));r++);return n[0]-t<=0&&t-n[1]<=0?n:[0,0]}function o(e,t,n){for(var r=0;r<e.length;r++)if(n===e[r][t])return r;return -1}n.d(t,{PK:function(){return o},fQ:function(){return i},lh:function(){return a},xF:function(){return r}}),n(514312)},344584:function(e,t,n){n.d(t,{_R:function(){return o},kW:function(){return a},l0:function(){return i}});var r,i=((r=i||{}).MP4="MP4",r.MP4_MSE_SOFT="MP4_MSE_SOFT",r.MP4_MSE="MP4_MSE",r.MP4_0="MP4_0",r.MP4_1="MP4_1",r.MP4_2="MP4_2",r.DASH="DASH",r.HLS="HLS",r),a="real_time_speed",o={CDN:"cdn",PCDN:"pcdn"}},280161:function(e,t,n){n.d(t,{v8:function(){return d.Z},vI:function(){return l.vI},Ds:function(){return i.Z},Xb:function(){return u.Z},E8:function(){return a.Z},zh:function(){return s},XK:function(){return c.Z},Ic:function(){return l.Ic}});var r=n("645957"),i=n("581686"),a=n("242909"),o=n("6214");let s=function(){function e(){(0,o.PA)(this,e),this.timeID=null,this.func=null}return(0,o.qH)(e,[{key:"repeat",value:function(e,t){this.timeID=1,this.repeatInterval(e,t)}},{key:"repeatInterval",value:function(e,t){var n=this;if(!this.timeID)return;if(null===this.func&&(this.func=e),this.func===e)this.timeID&&clearTimeout(this.timeID),this.timeID=null,this.timeID=setTimeout(function(){e(),n.repeatInterval(e,t)},t)}},{key:"clear",value:function(){clearTimeout(this.timeID),this.timeID=null}}]),e}();var u=n("626142"),c=n("677521"),l=n("453253"),d=n("394494");(0,r.l)()},635035:function(e,t,n){n.d(t,{Z:function(){return _}}),n(530129);var r=n(247425),i=n(938156),a=n(440669),o=n(269277),s=n(917970),u=n(197201);n(864614),n(632852),n(514312);var c=n(159322),l=n.n(c),d=n(495728),g=n(779228),h=n(992205),f=n(154440),p=n(720202),v=n(740200),m=n(364508),_=function(e){(0,o.Z)(l,e);var t,n,c=(t=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,u.Z)(t);return e=n?Reflect.construct(r,arguments,(0,u.Z)(this).constructor):r.apply(this,arguments),(0,s.Z)(this,e)});function l(e,t){var n;return(0,r.Z)(this,l),(n=c.call(this)).TAG="TimeLine",n._parent=t,n._seeking=!1,n.audioRender=h.Z.isSupported()?new h.Z(e,(0,a.Z)(n)):new g.Z(e,(0,a.Z)(n)),n.videoRender=new f.Z(e,(0,a.Z)(n)),n._readyStatus={audio:!1,video:!1},n._paused=!0,n._switchToMultiWorker=!1,n._lowdecodeEmited=!1,n._startPlayed=!1,n._emitReady=!1,n._singleTrack=-1,n._bindEvent(),n._decodeVideo=e.video,n._seekDirection=1,n}return(0,i.Z)(l,[{key:"analyse",get:function(){return this._parent.analyse}},{key:"ready",get:function(){return this._readyStatus.video&&this._readyStatus.audio}},{key:"played",get:function(){var e=this;return{length:this.currentTime?1:0,start:function(){return 0},end:function(){return e.currentTime}}}},{key:"noAudio",get:function(){return 1===this._singleTrack||2===this._singleTrack}},{key:"isLive",get:function(){return this._parent.live}},{key:"seeking",get:function(){return this._seeking}},{key:"decodeFps",get:function(){return this.videoRender.decodeFps}},{key:"decodeCost",get:function(){return this.videoRender.decodeCost}},{key:"renderCost",get:function(){return this.videoRender.renderCost}},{key:"wasmInitCost",get:function(){return this.videoRender.wasmInitCost}},{key:"fps",get:function(){return this.videoRender.fps}},{key:"totalSize",get:function(){return this.videoRender.totalSize}},{key:"bitrate",get:function(){return this.videoRender.bitrate}},{key:"gopLength",get:function(){return this.videoRender.gopLength}},{key:"currentTime",get:function(){if(this.noAudio)return this.paused?this.videoRender.nextFrameTime:this.videoRender.currentTime;return this.audioRender.currentTime}},{key:"timelinePosition",get:function(){return this.noAudio?performance.now()/1e3:this.audioRender.currentTime}},{key:"canvas",get:function(){return this.videoRender.canvas}},{key:"readyState",get:function(){return this.audioRender.readyState}},{key:"buffered",get:function(){var e=this;return this.noAudio?this.videoRender.buffered:this.audioRender.isMse||this.isLive?this.audioRender.buffered:{length:this.audioRender.buffered.length,start:function(t){return Math.max(e.audioRender.buffered.start(t),e.videoRender.buffered.start(t))},end:function(t){return Math.min(e.audioRender.buffered.end(t),e.videoRender.buffered.end(t))}}}},{key:"duration",get:function(){return this.noAudio?this.videoRender.duration:this.isLive?this.audioRender.duration:Math.min(this.audioRender.duration,this.videoRender.duration)}},{key:"paused",get:function(){return this._paused},set:function(e){this._paused=e}},{key:"lowlatency",get:function(){return this._parent.lowlatency}},{key:"decoderMode",get:function(){return this.videoRender.decoderMode}},{key:"currentAudioCanAutoplay",get:function(){return this.audioRender.audioCanAutoplay}},{key:"_checkInBuffer",value:function(){for(var e=this.buffered,t=0,n=e.length;t<n;t++)if(e.start(t)<=this.currentTime+.1&&e.end(t)>=this.currentTime)return!0;return!1}},{key:"_resetReadyStatus",value:function(){this._readyStatus.audio=!1,this._readyStatus.video=!1}},{key:"_bindEvent",value:function(){var e=this;this.on(p.ZP.DECODE_EVENTS.REMUX,function(t){e.videoRender.setRemux(t)}),this.on(p.ZP.DECODE_EVENTS.CHASE_VIDEO_FRAME_END,function(t){e.emit(p.ZP.DECODE_EVENTS.CHASE_AUDIO_FRAME,t)}),this.audioRender.on(p.ZP.AUDIO.AUDIO_READY,function(t){d.kg.log(e.TAG,"audio ready! seeking=",e._seeking,"seeked:",!!t,"paused:",e._paused),e._seeking&&setTimeout(function(){try{var t=1===e._seekDirection?e.videoRender.getSeekStartPositionBehind(e.currentTime,1/0):e.videoRender.getSeekStartPosition(e.currentTime,1/0);if(e.audioRender.isMse&&t){if((0,m.tT)().preciseSeekLimit>e.duration&&e.currentTime>.1){e.audioRender.seekNoSideEffect({position:e.currentTime+.1}),e.videoRender.ajustSeekTime(e.currentTime,!0);return}e.audioRender.seekNoSideEffect({position:t.position+.1}),e.videoRender.ajustSeekTime(t.position);return}e.videoRender.ajustSeekTime(e.currentTime)}catch(e){}},10),e._readyStatus.video&&e._startRender(e._seeking&&t),e._readyStatus.audio=!0,!e._startPlayed&&e.analyse.addAudioReady()}),this.audioRender.on(p.ZP.AUDIO.AUDIO_NOT_ALLOWED_AUTOPLAY,function(){e._emitReady&&e.pause()}),this.audioRender.on(p.ZP.AUDIO.AUDIO_WAITING,function(){!e.noAudio&&e.currentTime&&(d.kg.warn(e.TAG,"lack data, audio waiting,currentTime:",e.currentTime),e.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.WAITING),e.emit(p.ZP.TIMELINE.DO_PAUSE),e._readyStatus.audio=!1)}),this.videoRender.on(p.ZP.VIDEO.VIDEO_WAITING,function(){d.kg.warn(e.TAG,"lack data, video waiting"),e.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.WAITING),e.emit(p.ZP.TIMELINE.DO_PAUSE),e._readyStatus.video=!1}),this.videoRender.on(p.ZP.VIDEO.VIDEO_READY,function(){d.kg.log(e.TAG,"video ready!"),!e._startPlayed&&e.analyse.addVideoReady(),e._readyStatus.audio&&e._startRender(e._seeking),e._readyStatus.video=!0}),this.videoRender.on(p.ZP.VIDEO.DECODE_LOW_FPS,function(t){!(e.currentTime<.1)&&(e.analyse.increaseLowDecodeCount(t),!e._lowdecodeEmited&&((0,v.u$)(),e._lowdecodeEmited=!0),e.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.LOW_DECODE))}),this.on(p.ZP.TIMELINE.SINGLE_TRACK,function(t){e._singleTrack=t,(1===t||2===t)&&(e._readyStatus.audio=!0),3===t&&(e._readyStatus.video=!0),e.emit(p.ZP.TIMELINE.SYNC_DTS,0)}),this.on(p.ZP.TIMELINE.DESTROY,function(){e.removeAllListeners(),e.videoRender=null,e.audioRender=null}),this.on(p.ZP.TIMELINE.DO_PLAY,function(){e.emit(p.ZP.TIMELINE.START_RENDER),e._paused=!1,e.noAudio&&e.emit(p.ZP.TIMELINE.SYNC_DTS,0)})}},{key:"_startRender",value:function(e){if(!this._parent.error&&this.videoRender){if(this.noAudio&&this.emit(p.ZP.TIMELINE.SYNC_DTS,0),this.videoRender.forceRender(),!this.isLive&&this._paused&&this.seeking&&this._checkInBuffer()){d.kg.log(this.TAG,"set seeking = false"),this._seeking=!1,this.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.SEEKED),d.kg.groupEnd();return}!this._startPlayed&&(this.analyse.addFirstframe(),this.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.LOADEDDATA),this.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.FIRST_FRAME),this._startPlayed=!0),d.kg.log(this.TAG,"emit canplay"),this.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.CANPLAY),this._parent.autoplay&&(d.kg.warn(this.TAG,"startRender: time=",this.currentTime,"paused:",this.paused,"seeking:",this.seeking),this.emit(p.ZP.TIMELINE.START_RENDER)),this.emit(p.ZP.TIMELINE.READY),this._emitReady=!0,this._seeking&&e&&(d.kg.log(this.TAG,"set seeking = false"),this._seeking=!1,this.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.SEEKED),d.kg.groupEnd())}}},{key:"_checkHlsTracks",value:function(e){if(!(null==e?void 0:e.samples[0])){if(!this.buffered.length){var t=Error("lack video sample");t.code=3,this.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.ERROR,t)}return!1}return!0}},{key:"appendBuffer",value:function(e,t){this.emit(p.ZP.TIMELINE.APPEND_CHUNKS,e,t),this.noAudio&&this._seeking&&this.videoRender.ajustSeekTime(this.currentTime)}},{key:"play",value:function(){var e=this;return new Promise(function(t,n){var r=e.currentAudioCanAutoplay;e.noAudio?r=!0:e.audioRender&&e.audioRender.resume().then(function(){if(d.kg.log(e.TAG,"audio render resumed, pause status: ".concat(e._paused,", audioCanAutoplay:").concat(e.currentAudioCanAutoplay)),e._paused||!e.currentAudioCanAutoplay){r=!1,e.emit(p.ZP.TIMELINE.DO_PAUSE);return}r=!0}).catch(function(){}),setTimeout(function(){if(d.kg.log(e.TAG,"play() timer done, resumed=".concat(r,", paused=").concat(e.paused)),!r){if(!e.paused){d.kg.log(e.TAG,"audioCtx can't autoplay"),e.pause(),n({name:"NotAllowedError"});return}e.pause(),t();return}e._paused=!1,t()},e.audioRender.isMse?10:60)})}},{key:"pause",value:function(){var e,t;(!this._paused||null===(e=this.audioRender)||void 0===e||null===(t=e.media)||void 0===t||!t.paused)&&(this.ready||this._seeking)&&(this.emit(p.ZP.TIMELINE.DO_PAUSE),this._paused=!0,this.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.PAUSE))}},{key:"seek",value:function(e){var t=this;if(this._seeking&&d.kg.groupEnd(),this.isLive){if(this.currentTime<.1||!this.currentAudioCanAutoplay||this.paused)return;var n=this.videoRender.getSeekStartPosition(e,this._parent.preloadTime+1);if(n){if(n.position<this.currentTime)return;var r=this.audioRender.canSeek(n.position),i=this.videoRender.canSeek(n);if(!r||!i){d.kg.log(this.TAG,"seek, !!!!!!!!!can not seek, audioCanSeek:",r,"videoCanSeek:",i);return}d.kg.warn(this.TAG,"seek, chase frame to time: ",n.position,"currentTime:",this.currentTime,"duration:",this.duration),this.videoRender.videoDecode?(this.audioRender.doPause(),n.position=n.position-1.5,this.emit(p.ZP.DECODE_EVENTS.CHASE_VIDEO_FRAME,n)):this.emit(p.ZP.TIMELINE.CHASE_FRAME,n)}return}e>=this.duration&&(e=this.duration-1),e<0&&(e=0),d.kg.group(this.TAG,"start seek to:".concat(e,", set seeking status=true")),this._seeking=!0,this.videoRender.setSeekingStatus(!0),this.noAudio?(this.emit(p.ZP.TIMELINE.SYNC_DTS,this.videoRender.getDtsOfTime(e)),this.videoRender.ajustSeekTime(e)):this._resetReadyStatus(),this._seekDirection=this.currentTime<e?1:2,this.emit(p.ZP.TIMELINE.DO_SEEK,e),new Promise(function(e){t.emit(p.ZP.TIMELINE.PLAY_EVENT,p.ZP.VIDEO_EVENTS.SEEKING),e()})}}]),l}(l())},198729:function(e,t,n){n.d(t,{Z:function(){return r}});var r=(0,n(68950).p)("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyogZXNsaW50LWRpc2FibGUgbm8tZXZhbCAqLwogIC8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmICovCiAgLy8g55uu5YmN5LuF5pSv5oyBeXV2NDIwCgogIGZ1bmN0aW9uIHNoaW1JbXBvcnRTY3JpcHRzIChzcmMpIHsKICAgIHJldHVybiBmZXRjaChzcmMpCiAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICByZXR1cm4gcmVzLnRleHQoKQogICAgICB9KQogICAgICAudGhlbihmdW5jdGlvbiAodGV4dCkgewogICAgICAgIGV2YWwodGV4dCk7CiAgICAgICAgc2VsZi5Nb2R1bGUgPSBNb2R1bGU7CiAgICAgICAgc2VsZi5hZGRPblBvc3RSdW4gPSBhZGRPblBvc3RSdW47CiAgICAgIH0pCiAgfQoKICB2YXIgTUFYX1NUUkVBTV9CVUZGRVJfTEVOR1RIID0gMTAyNCAqIDEwMjQgKiAzOwogIHZhciBpbml0VHMgPSAwOwoKICB2YXIgRGVjb2RlciA9IGZ1bmN0aW9uIChzZWxmKSB7CiAgICB0aGlzLmluaXRlZCA9IGZhbHNlOwogICAgdGhpcy5pbmZvSWQgPSAwOwogICAgdGhpcy5zZWxmID0gc2VsZjsKICAgIHRoaXMubWV0YSA9IHRoaXMuc2VsZi5tZXRhOwogICAgdGhpcy50cyA9IDA7CiAgICB0aGlzLmluZm9saXN0ID0gW107CiAgICBzZWxmLnBhcl9icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQgPSB0aGlzLmJyb2Fkd2F5T25Ccm9hZHdheUluaXRlZC5iaW5kKHRoaXMpOwogICAgc2VsZi5wYXJfYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkID0gdGhpcy5icm9hZHdheU9uUGljdHVyZURlY29kZWQuYmluZCh0aGlzKTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS50b1U4QXJyYXkgPSBmdW5jdGlvbiAocHRyLCBsZW5ndGgpIHsKICAgIHJldHVybiBNb2R1bGUuSEVBUFU4LnN1YmFycmF5KHB0ciwgcHRyICsgbGVuZ3RoKQogIH07CgogIERlY29kZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICBNb2R1bGUuX2Jyb2Fkd2F5SW5pdCgwLCAxKTsKICAgIHRoaXMub2Zmc2V0ID0gTW9kdWxlLl9icm9hZHdheUNyZWF0ZVN0cmVhbShNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEgpOwogIH07CgogIERlY29kZXIucHJvdG90eXBlLmJyb2Fkd2F5T25QaWN0dXJlRGVjb2RlZCA9IGZ1bmN0aW9uICgKICAgIG9mZnNldCwKICAgIHdpZHRoLAogICAgaGVpZ2h0LAogICAgaW5mb2lkLAogICAgc2xpY2VUeXBlCiAgKSB7CiAgICB2YXIgaW5mbyA9IHRoaXMuaW5mb2xpc3Quc2hpZnQoKTsKICAgIHZhciB5Um93Y291bnQgPSBoZWlnaHQ7CiAgICB2YXIgdXZSb3djb3VudCA9IGhlaWdodCAvIDI7CiAgICB2YXIgeUxpbmVzaXplID0gd2lkdGg7CiAgICB2YXIgdXZMaW5lc2l6ZSA9IHdpZHRoIC8gMjsKICAgIGlmICh0aGlzLm1ldGEgJiYgKHRoaXMubWV0YS5jaHJvbWFGb3JtYXQgPT09IDQ0NCB8fCB0aGlzLm1ldGEuY2hyb21hRm9ybWF0ID09PSA0MjIpKSB7CiAgICAgIHV2Um93Y291bnQgPSBoZWlnaHQ7CiAgICB9CiAgICBpZiAoaW5mbyAmJiBpbmZvLnByZWNpc2VTZWVrKSB7CiAgICAgIGlmICghaW5mby5vdXRwdXQpIHJldHVybgogICAgfQoKICAgIHZhciBkYXRhID0gdGhpcy50b1U4QXJyYXkob2Zmc2V0LCB5TGluZXNpemUgKiB5Um93Y291bnQgKyAyICogKHV2TGluZXNpemUgKiB1dlJvd2NvdW50KSk7CiAgICAvLyB0aGlzLmluZm9saXN0W2luZm9pZF0gPSBudWxsOwogICAgdmFyIGRhdGV0ZW1wID0gbmV3IFVpbnQ4QXJyYXkoZGF0YS5sZW5ndGgpOwogICAgZGF0ZXRlbXAuc2V0KGRhdGEpOwogICAgdmFyIGJ1ZmZlciA9IGRhdGV0ZW1wLmJ1ZmZlcjsKCiAgICB0aGlzLnNlbGYucG9zdE1lc3NhZ2UoCiAgICAgIHsKICAgICAgICBtc2c6ICdERUNPREVEJywKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgeUxpbmVzaXplLAogICAgICAgIHV2TGluZXNpemUsCiAgICAgICAgaW5mbywKICAgICAgICBidWZmZXIKICAgICAgfSwKICAgICAgW2J1ZmZlcl0KICAgICk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuaW5pdGVkKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdGhpcy5pbml0ZWQgPSB0cnVlOwogICAgdmFyIGNvc3QgPSAwOwogICAgaWYgKGluaXRUcykgewogICAgICBjb3N0ID0gcGVyZm9ybWFuY2Uubm93KCkgLSBpbml0VHM7CiAgICB9CiAgICB0aGlzLnNlbGYucG9zdE1lc3NhZ2UoeyBtc2c6ICdERUNPREVSX1JFQURZJywgY29zdCB9KTsKICB9OwoKICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAoZGF0YSwgaW5mbykgewogICAgbGV0IHRpbWUgPSBwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSk7CiAgICBsZXQgaW5mb2lkID0gdGltZSAtIE1hdGguZmxvb3IodGltZSAvIDEwZTgpICogMTBlODsKICAgIHRoaXMuaW5mb2xpc3QucHVzaChpbmZvKTsKICAgIGlmIChpbmZvICYmIGluZm8ua2V5ZnJhbWUpIHsKICAgICAgdGhpcy5pbmZvbGlzdCA9IFtpbmZvXTsKICAgICAgTW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKGluZm9pZCk7CiAgICB9CiAgICBNb2R1bGUuSEVBUFU4LnNldChkYXRhLCB0aGlzLm9mZnNldCk7CiAgICBNb2R1bGUuX2Jyb2Fkd2F5UGxheVN0cmVhbShkYXRhLmxlbmd0aCwgdGhpcy5pbmZvSWQpOwogIH07CgogIERlY29kZXIucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24gKCkgewogICAgTW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKCk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgIE1vZHVsZS5fYnJvYWR3YXlFeGl0KCk7CiAgfTsKCiAgRGVjb2Rlci5wcm90b3R5cGUudXBkYXRlTWV0YSA9IGZ1bmN0aW9uIChtZXRhKSB7CiAgICB0aGlzLm1ldGEgPSBtZXRhOwogIH07CgogIHZhciBkZWNvZGVyOwoKICBmdW5jdGlvbiBvblBvc3RSdW4gKCkgewogICAgZGVjb2RlciA9IG5ldyBEZWNvZGVyKHRoaXMpOwogICAgZGVjb2Rlci5pbml0KCk7CiAgfQoKICB2YXIgV0FTTV9DRE5fUEFUSF9QUkVGSVggPSAnJzsKCiAgZnVuY3Rpb24gaW5pdCAodXJsKSB7CiAgICBXQVNNX0NETl9QQVRIX1BSRUZJWCA9IHVybC5zcGxpdCgnLycpLnNsaWNlKDAsIC0xKS5qb2luKCcvJyk7CiAgICBpbml0VHMgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgIHZhciBpc0RlZ3JhZGUgPSAvYXNtLy50ZXN0KHVybCk7CiAgICBpZiAoIWRlY29kZXIpIHsKICAgICAgdmFyIHRhc2s7CgogICAgICBpZiAoIXNlbGYuaW1wb3J0U2NyaXB0cykgewogICAgICAgIHRhc2sgPSBzaGltSW1wb3J0U2NyaXB0cyh1cmwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRhc2sgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICBpZiAoIXNlbGYuY29uc29sZSkgewogICAgICAgICAgICBzZWxmLmNvbnNvbGUgPSB7CiAgICAgICAgICAgICAgbG9nOiBmdW5jdGlvbiAoKSB7fSwKICAgICAgICAgICAgICB3YXJuOiBmdW5jdGlvbiAoKSB7fSwKICAgICAgICAgICAgICBpbmZvOiBmdW5jdGlvbiAoKSB7fSwKICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkge30KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNlbGYuaW1wb3J0U2NyaXB0cyh1cmwpOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGFzawogICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChpc0RlZ3JhZGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ2F1dG8gaW5zdGFuY2UgRGVjb2RlciEnKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIG9uUG9zdFJ1bi5jYWxsKHNlbGYpOwogICAgICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2VsZi5tKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmCiAgICAgICAgICAgICAgLm0oewogICAgICAgICAgICAgICAgaW5zdGFudGlhdGVXYXNtOiBmdW5jdGlvbiAoaW5mbywgcmVjZWl2ZUluc3RhbmNlKSB7CiAgICAgICAgICAgICAgICAgIGZldGNoKGAke1dBU01fQ0ROX1BBVEhfUFJFRklYfS9kZWNvZGVyLndhc20uanNgKQogICAgICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiByZXMuYXJyYXlCdWZmZXIoKSkKICAgICAgICAgICAgICAgICAgICAudGhlbihidWZmZXIgPT4gewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKGJ1ZmZlciwgaW5mbykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlSW5zdGFuY2UocmVzdWx0Lmluc3RhbmNlKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKE1vZCkgewogICAgICAgICAgICAgICAgc2VsZi5Nb2R1bGUgPSBNb2Q7CiAgICAgICAgICAgICAgICBvblBvc3RSdW4uY2FsbChzZWxmKTsKICAgICAgICAgICAgICB9KQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgIGFkZE9uUG9zdFJ1bihvblBvc3RSdW4uYmluZChzZWxmKSk7CgogICAgICAgICAgICBNb2R1bGUub25SdW50aW1lSW5pdGlhbGl6ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgTW9kdWxlLm9uQWJvcnQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHJlamVjdChlICYmIGUubWVzc2FnZSA/IGUgOiBuZXcgRXJyb3IoJ3dhc20gaW5pdCBlcnJvcicpKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ3dhc20gbG9hZCB0aW1lb3V0JykpOwogICAgICAgICAgICB9LCA2MDAwKTsKICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBtc2c6ICdJTklUX0ZBSUxFRCcsCiAgICAgICAgICAgIGxvZzogZS5tZXNzYWdlCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KICB9CgogIHNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsKICAgIHZhciBkYXRhID0gZS5kYXRhOwogICAgaWYgKCFkYXRhLm1zZykgewogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBtc2c6ICdFUlJPUjppbnZhbGlkIG1lc3NhZ2UnCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGRhdGEubXNnICE9PSAnaW5pdCcgJiYgZGF0YS5tc2cgIT09ICdwcmVsb2FkJyAmJiAhZGVjb2RlcikgcmV0dXJuCiAgICAgIHN3aXRjaCAoZGF0YS5tc2cpIHsKICAgICAgICBjYXNlICdwcmVsb2FkJzoKICAgICAgICAgIGluaXQoZGF0YS51cmwpOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdpbml0JzoKICAgICAgICAgIHNlbGYubWV0YSA9IGRhdGEubWV0YTsKICAgICAgICAgIGluaXQoZGF0YS51cmwpOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICd1cGRhdGVtZXRhJzoKICAgICAgICAgIHNlbGYubWV0YSA9IGRhdGEubWV0YTsKICAgICAgICAgIGRlY29kZXIudXBkYXRlTWV0YShkYXRhLm1ldGEpOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdpbml0RGVjb2Rlcic6CiAgICAgICAgICBkZWNvZGVyLmRlY29kZShkYXRhLmRhdGEpOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdkZWNvZGUnOgogICAgICAgICAgZGVjb2Rlci5kZWNvZGUoZGF0YS5kYXRhLCBkYXRhLmluZm8pOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdmbHVzaCc6CiAgICAgICAgICBkZWNvZGVyLmZsdXNoKCk7CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ2ZpbmlzaF9mbGFnJzoKICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBtc2c6ICdCQVRDSF9GSU5JU0hfRkxBRycKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdkZXN0b3J5JzoKICAgICAgICAgIGRlY29kZXIuZGVzdHJveSgpOwogICAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQogIH07Cgp9KCkpOwoK",null,!1)},17982:function(e,t,n){n.d(t,{Z:function(){return p}}),n(530129);var r=n(247425),i=n(938156),a=n(440669),o=n(269277),s=n(917970),u=n(197201),c=n(668117);n(514312);var l=n(43864),d=n(874918),g=n(495728),h=n(364508),f=(0,h.tT)().maxDecodeOnceWebcodec,p=function(e){(0,o.Z)(p,e);var t,n,l=(t=p,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,u.Z)(t);return e=n?Reflect.construct(r,arguments,(0,u.Z)(this).constructor):r.apply(this,arguments),(0,s.Z)(this,e)});function p(){var e;(0,r.Z)(this,p);for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=l.call.apply(l,[this].concat(n)),(0,c.Z)((0,a.Z)(e),"TAG","WebCodecController"),(0,c.Z)((0,a.Z)(e),"_decoderMode",5),(0,c.Z)((0,a.Z)(e),"_maxDecodeOnce",f),(0,c.Z)((0,a.Z)(e),"_continueDecodeThreshold",f/2),(0,c.Z)((0,a.Z)(e),"_avccpushed",!1),e}return(0,i.Z)(p,[{key:"webcodec",get:function(){return!0}},{key:"needToDecode",get:function(){return this._inDecoding?(this._checkToDecode(),0):this._continueDecodeThreshold}},{key:"_initWorker",value:function(){var e=this;g.kg.log(this.TAG,"start init webcodec worker");var t=new d.Z;t.onMessage=function(t){var n,r;switch(t.data.type){case"DECODER_READY":g.kg.log(e.TAG,"webcodec worker ready "),e._decoderReady=!0,e._workerMessageCallback({type:"DECODER_READY"});break;case"DECODED":if(e._inDecoding=!0,(null===(n=t.data)||void 0===n?void 0:null===(r=n.info)||void 0===r?void 0:r.id)!==e._id)return;e._workerMessageCallback({type:"RECEIVE_FRAME",data:t.data});break;case"BATCH_FINISH_FLAG":if(e._inDecoding=!1,!e._workerMessageCallback)return;e._workerMessageCallback({type:"BATCH_FINISH"});break;case"CHECK_TO_DECODE":e._inDecoding=t.data.data;break;case"FAILED":e._whenError(t.data.message)}},t.onError=function(t){var n,r,i=null===(n=e._parent)||void 0===n?void 0:null===(r=n._parent)||void 0===r?void 0:r._parent;i&&i.removeChild(i.querySelector("canvas")),e._whenError(t.message)},t.addEventListener("message",t.onMessage),t.addEventListener("error",t.onError),this._decoderWorker=t,this._initDecoderWithConfiguration(t,this._parent.configuration)}},{key:"_whenError",value:function(e){p.canUse=!1,this._workerErrorCallback(e)}},{key:"_initDecoderWithConfiguration",value:function(e,t){e.postMessage({msg:"configuration",data:{codec:this._parent._meta.codec,codedHeight:this._parent._meta.height,codedWidth:this._parent._meta.width,description:t}}),this._avccpushed=!0}},{key:"_checkToDecode",value:function(){this._decoderWorker.postMessage({msg:"checkDecode"})}},{key:"destroy",value:function(){var e=this._decoderWorker;e.removeEventListener("message",e.onMessage),e.removeEventListener("error",e.onError),e.postMessage({msg:"destroy"}),e.terminate(),this._decoderWorker=null}}],[{key:"isSupported",value:function(){return(0,h.tT)().h264WithWebcodec&&!!window.VideoDecoder&&!1!==p.canUse}}]),p}(l.Z)},917971:function(e,t,n){n.d(t,{Z:function(){return o},s:function(){return a}});var r=n(247425),i=n(938156);function a(e){var t;(null===(t=e.buffer)||void 0===t?void 0:t.close)&&e.buffer.close()}n(379493),n(561999),n(210434);var o=function(){function e(t){(0,r.Z)(this,e),this.TAG="FrameQueue",this._parent=t,this._lastGopId=0,this._frames=[]}return(0,i.Z)(e,[{key:"currentTimeDts",get:function(){return this._parent.preciseVideoDts}},{key:"length",get:function(){return this._frames.length}},{key:"frames",get:function(){return this._frames}},{key:"append",value:function(e){if(!e.info){a(e);return}this._frames.push(e)}},{key:"appendVodFrame",value:function(e){this._frames.push(e)}},{key:"nextFrame",value:function(){var e=this._frames.length;return 1===this._parent.noAudio&&e>3&&(this._frames=this._frames.slice(e-2)),this._frames[0]}},{key:"shift",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._frames.shift();return this.deletePassed(e),t}},{key:"deletePassed",value:function(e){this._frames=this._frames.filter(function(t){return!!t.info&&!!(t.info.dts>e)||(a(t),!1)})}},{key:"empty",value:function(){this._frames.forEach(function(e){return a(e)}),this._frames=[]}},{key:"destroy",value:function(){this.empty(),this._lastGopId=0}}]),e}()},359834:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(429250),i=n(247425),a=n(938156),o=n(668117);n(121621),n(864614),n(616414),n(612222),n(510766);var s=n(495728),u=n(364508),c=[],l=function(){function e(t,n,a){var s=this;(0,i.Z)(this,e),(0,o.Z)(this,"TAG","RenderWorker"),(0,o.Z)(this,"timerWorkerCache",c),(0,o.Z)(this,"_errorOccur",!1),(0,o.Z)(this,"_doTask",function(e){var t,n;if("NEXT_TICK"===e.data.type){null===(t=s._task)||void 0===t||t.call(s);return}if("RENDER_ERR"===e.data.type){s._emitError(e.data.msg);return}"RESIZE_EVENT"===e.data.type&&(null===(n=s._parent)||void 0===n||n.emitResizeEvent())}),(0,o.Z)(this,"_onError",function(e){s._emitError(e.message)}),(0,o.Z)(this,"_emitError",function(e){s._errorOccur=!0,s._worker&&(s._worker._cvs=null,s._worker._offscreen=null),s._cvs&&(s._cvs._worker=null),s._parent._emitError(e,3)}),this._task=t,this._parent=a;var u=this._initCanvasWorkerPair(n),l=(0,r.Z)(u,2),d=l[0],g=l[1];g&&(this._worker=g,this._cvs=d,this._bindEvent())}return(0,a.Z)(e,[{key:"canvas",get:function(){return this._cvs}},{key:"_initCanvasWorkerPair",value:function(e){var t,n=this,r=e.canvas||(null===(t=c.pop())||void 0===t?void 0:t._cvs)||document.createElement("canvas");if(r.style.margin="auto",r.style.position="absolute",r.style.pointerEvents="none",r._worker)return s.kg.log(this.TAG,"init canvas && worker, use cached,",r.width,r.height),[r,r._worker];try{var i=new Blob(["\n  class FrameRender {\n    constructor (configs) {\n      this.TAG = 'FrameRender'\n      this.configs = Object.assign({}, configs)\n      this.canvas = this.configs.canvas\n      this.meta = Object.assign({}, this.configs.meta)\n      this._initMeta()\n      this._initContextGL()\n      if (this.contextGL) {\n        this._initProgram()\n        this._initBuffers()\n        this._initTextures()\n      }\n    }\n\n    _initMeta () {\n      this.chroma = this.meta.chromaFormat\n      this.height = this.meta.height\n      this.width = this.meta.width\n      if (this.canvas.width !== this.meta.width || this.canvas.height !== this.meta.height) {\n        this.canvas.width = this.meta.width\n        this.canvas.height = this.meta.height\n        self.postMessage({\n          type: 'RESIZE_EVENT'\n        })\n      }\n      this.clear()\n    }\n\n    _initContextGL () {\n      if (this.configs.type === '2d') {\n        this.ctx = this.canvas.getContext('2d')\n        return\n      }\n      var canvas = this.canvas\n      let gl = null\n\n      var validContextNames = ['webgl', 'experimental-webgl', 'moz-webgl', 'webkit-3d']\n      let nameIndex = 0\n\n      while (!gl && nameIndex < validContextNames.length) {\n        var contextName = validContextNames[nameIndex]\n\n        try {\n          gl = canvas.getContext(contextName, this.configs.glCtxOptions)\n          break\n        } catch (e) {\n          gl = null\n        }\n\n        if (!gl || typeof gl.getParameter !== 'function') {\n          gl = null\n        }\n\n        ++nameIndex\n      }\n\n      if(!gl) {\n        throw new Error('init webgl context error')\n      }\n\n      this.contextGL = gl\n    }\n\n    _initProgram () {\n      var gl = this.contextGL\n\n      // vertex shader is the same for all types\n      var vertexShaderScript\n      var fragmentShaderScript\n      vertexShaderScript = [\n        'attribute vec4 vertexPos;',\n        'attribute vec4 texturePos;',\n        'attribute vec4 uTexturePos;',\n        'attribute vec4 vTexturePos;',\n        'varying vec2 textureCoord;',\n        'varying vec2 uTextureCoord;',\n        'varying vec2 vTextureCoord;',\n\n        'void main()',\n        '{',\n        '  gl_Position = vertexPos;',\n        '  textureCoord = texturePos.xy;',\n        '  uTextureCoord = uTexturePos.xy;',\n        '  vTextureCoord = vTexturePos.xy;',\n        '}'\n      ].join('')\n\n      fragmentShaderScript = [\n        'precision highp float;',\n        'varying highp vec2 textureCoord;',\n        'varying highp vec2 uTextureCoord;',\n        'varying highp vec2 vTextureCoord;',\n        'uniform sampler2D ySampler;',\n        'uniform sampler2D uSampler;',\n        'uniform sampler2D vSampler;',\n        'uniform mat4 YUV2RGB;',\n\n        'void main(void) {',\n        '  highp float y = texture2D(ySampler,  textureCoord).r;',\n        '  highp float u = texture2D(uSampler,  uTextureCoord).r;',\n        '  highp float v = texture2D(vSampler,  vTextureCoord).r;',\n        '  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;',\n        '}'\n      ].join('')\n\n      var YUV2RGB = [1.16438, 0.0, 1.59603, -0.87079, 1.16438, -0.39176, -0.81297, 0.52959, 1.16438, 2.01723, 0.0, -1.08139, 0, 0, 0, 1]\n      var vertexShader = gl.createShader(gl.VERTEX_SHADER)\n      gl.shaderSource(vertexShader, vertexShaderScript)\n      gl.compileShader(vertexShader)\n      if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n        console.log('Vertex shader failed to compile: ' + gl.getShaderInfoLog(vertexShader))\n      }\n\n      var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER)\n      gl.shaderSource(fragmentShader, fragmentShaderScript)\n      gl.compileShader(fragmentShader)\n      if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n        console.log('Fragment shader failed to compile: ' + gl.getShaderInfoLog(fragmentShader))\n      }\n\n      var program = gl.createProgram()\n      gl.attachShader(program, vertexShader)\n      gl.attachShader(program, fragmentShader)\n      gl.linkProgram(program)\n      if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n        console.log('Program failed to compile: ' + gl.getProgramInfoLog(program))\n      }\n\n      gl.useProgram(program)\n\n      var YUV2RGBRef = gl.getUniformLocation(program, 'YUV2RGB')\n      gl.uniformMatrix4fv(YUV2RGBRef, false, YUV2RGB)\n\n      this.shaderProgram = program\n    }\n\n    _initBuffers () {\n      var gl = this.contextGL\n      const program = this.shaderProgram\n\n      var vertexPosBuffer = gl.createBuffer()\n      gl.bindBuffer(gl.ARRAY_BUFFER, vertexPosBuffer)\n      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1, 1, -1, 1, 1, -1, -1, -1]), gl.STATIC_DRAW)\n\n      var vertexPosRef = gl.getAttribLocation(program, 'vertexPos')\n      gl.enableVertexAttribArray(vertexPosRef)\n      gl.vertexAttribPointer(vertexPosRef, 2, gl.FLOAT, false, 0, 0)\n\n      var texturePosBuffer = gl.createBuffer()\n      gl.bindBuffer(gl.ARRAY_BUFFER, texturePosBuffer)\n      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1, 0, 0, 0, 1, 1, 0, 1]), gl.STATIC_DRAW)\n\n      var texturePosRef = gl.getAttribLocation(program, 'texturePos')\n      gl.enableVertexAttribArray(texturePosRef)\n      gl.vertexAttribPointer(texturePosRef, 2, gl.FLOAT, false, 0, 0)\n\n      this.texturePosBuffer = texturePosBuffer\n\n      var uTexturePosBuffer = gl.createBuffer()\n      gl.bindBuffer(gl.ARRAY_BUFFER, uTexturePosBuffer)\n      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1, 0, 0, 0, 1, 1, 0, 1]), gl.STATIC_DRAW)\n\n      var uTexturePosRef = gl.getAttribLocation(program, 'uTexturePos')\n      gl.enableVertexAttribArray(uTexturePosRef)\n      gl.vertexAttribPointer(uTexturePosRef, 2, gl.FLOAT, false, 0, 0)\n\n      this.uTexturePosBuffer = uTexturePosBuffer\n\n      var vTexturePosBuffer = gl.createBuffer()\n      gl.bindBuffer(gl.ARRAY_BUFFER, vTexturePosBuffer)\n      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1, 0, 0, 0, 1, 1, 0, 1]), gl.STATIC_DRAW)\n\n      var vTexturePosRef = gl.getAttribLocation(program, 'vTexturePos')\n      gl.enableVertexAttribArray(vTexturePosRef)\n      gl.vertexAttribPointer(vTexturePosRef, 2, gl.FLOAT, false, 0, 0)\n\n      this.vTexturePosBuffer = vTexturePosBuffer\n    }\n\n    _initTextures () {\n      var gl = this.contextGL\n      var program = this.shaderProgram\n      var yTextureRef = this._initTexture()\n      var ySamplerRef = gl.getUniformLocation(program, 'ySampler')\n      gl.uniform1i(ySamplerRef, 0)\n      this.yTextureRef = yTextureRef\n\n      var uTextureRef = this._initTexture()\n      var uSamplerRef = gl.getUniformLocation(program, 'uSampler')\n      gl.uniform1i(uSamplerRef, 1)\n      this.uTextureRef = uTextureRef\n\n      var vTextureRef = this._initTexture()\n      var vSamplerRef = gl.getUniformLocation(program, 'vSampler')\n      gl.uniform1i(vSamplerRef, 2)\n      this.vTextureRef = vTextureRef\n\n      // fix WebGL: INVALID_OPERATION: texImage2D: ArrayBufferView not big enough for request\n      //  texture bound to texture unit 1 is not renderable. It might be non-power-of-2 or have incompatible texture filtering (maybe)\n      gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1)\n    }\n\n    _initTexture () {\n      var gl = this.contextGL\n\n      var textureRef = gl.createTexture()\n      gl.bindTexture(gl.TEXTURE_2D, textureRef)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n      gl.bindTexture(gl.TEXTURE_2D, null)\n\n      return textureRef\n    }\n\n    _drawPictureGL (data, width, height, yLinesize, uvLinesize) {\n      var ylen = yLinesize * height\n      let uvlen = (uvLinesize * height) / 2\n      if (this.chroma === 444 || this.chroma === 422) {\n        uvlen *= 2\n      }\n      data = new Uint8Array(data)\n      var renderData = {\n        yData: data.subarray(0, ylen),\n        uData: data.subarray(ylen, ylen + uvlen),\n        vData: data.subarray(ylen + uvlen, ylen + uvlen + uvlen)\n      }\n      this._drawPictureGL420(renderData, width, height, yLinesize, uvLinesize)\n    }\n\n    _drawPictureGL420 (data, width, height, yLinesize, uvLinesize) {\n      var gl = this.contextGL\n      var texturePosBuffer = this.texturePosBuffer\n      var uTexturePosBuffer = this.uTexturePosBuffer\n      var vTexturePosBuffer = this.vTexturePosBuffer\n\n      var yTextureRef = this.yTextureRef\n      var uTextureRef = this.uTextureRef\n      var vTextureRef = this.vTextureRef\n\n      var yData = data.yData\n      var uData = data.uData\n      var vData = data.vData\n\n      var yDataPerRow = yLinesize\n      var yRowCnt = height\n\n      var uDataPerRow = uvLinesize\n      let uRowCnt = height / 2\n\n      if (this.chroma === 422 || this.chroma === 444) {\n        uRowCnt = height\n      }\n\n      var vDataPerRow = uvLinesize\n      var vRowCnt = uRowCnt\n\n      var ratiow = this.canvas.width / this.width\n      var ratioh = this.canvas.height / this.height\n      let left = 0\n      let top = 0\n      let w = this.canvas.width\n      let h = this.canvas.height\n      if (ratiow < ratioh) {\n        h = (this.height * this.canvas.width) / this.width\n        top = parseInt((this.canvas.height - (this.height * this.canvas.width) / this.width) / 2)\n      } else {\n        w = (this.width * this.canvas.height) / this.height\n        left = parseInt((this.canvas.width - (this.width * this.canvas.height) / this.height) / 2)\n      }\n      gl.viewport(left, top, w, h)\n\n      const texturePosValues = new Float32Array([1, 0, 0, 0, 1, 1, 0, 1])\n      gl.bindBuffer(gl.ARRAY_BUFFER, texturePosBuffer)\n      gl.bufferData(gl.ARRAY_BUFFER, texturePosValues, gl.DYNAMIC_DRAW)\n\n      const uTexturePosValues = new Float32Array([1, 0, 0, 0, 1, 1, 0, 1])\n      gl.bindBuffer(gl.ARRAY_BUFFER, uTexturePosBuffer)\n      gl.bufferData(gl.ARRAY_BUFFER, uTexturePosValues, gl.DYNAMIC_DRAW)\n\n      const vTexturePosValues = new Float32Array([1, 0, 0, 0, 1, 1, 0, 1])\n      gl.bindBuffer(gl.ARRAY_BUFFER, vTexturePosBuffer)\n      gl.bufferData(gl.ARRAY_BUFFER, vTexturePosValues, gl.DYNAMIC_DRAW)\n\n      gl.activeTexture(gl.TEXTURE0)\n      gl.bindTexture(gl.TEXTURE_2D, yTextureRef)\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.LUMINANCE, yDataPerRow, yRowCnt, 0, gl.LUMINANCE, gl.UNSIGNED_BYTE, yData)\n\n      gl.activeTexture(gl.TEXTURE1)\n      gl.bindTexture(gl.TEXTURE_2D, uTextureRef)\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.LUMINANCE, uDataPerRow, uRowCnt, 0, gl.LUMINANCE, gl.UNSIGNED_BYTE, uData)\n\n      gl.activeTexture(gl.TEXTURE2)\n      gl.bindTexture(gl.TEXTURE_2D, vTextureRef)\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.LUMINANCE, vDataPerRow, vRowCnt, 0, gl.LUMINANCE, gl.UNSIGNED_BYTE, vData)\n\n      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4)\n    }\n\n    _drawPicture2d (data) {\n      if (!data) {\n        return\n      }\n      if (this.canvas) {\n        if (!this.ctx) {\n          this.ctx = this.canvas.getContext('2d')\n        }\n        var width = data.displayWidth || data.width\n        var height = data.displayHeight || data.height\n        if (this.canvas.height !== height || this.canvas.width !== width) {\n          this.canvas.height = height\n          this.canvas.width = width\n        }\n        try {\n          this.ctx.drawImage(data.dom || data, 0, 0, width, height)\n        } catch (error) {\n          // console.error(this.TAG, '_drawPicture2d', data, data.dom, error, error.message)\n        }\n      }\n    }\n\n    _resize (width, height) {\n      if (this.canvas.width !== width || this.canvas.height !== height) {\n        this.width = width\n        this.height = height\n        this.canvas.width = width\n        this.canvas.height = height\n        self.postMessage({\n          type: 'RESIZE_EVENT'\n        })\n      }\n    }\n\n    render (data, width, height, yLinesize, uvLinesize) {\n      this._resize(width, height)\n      var gl = this.contextGL\n      if (gl) {\n        this._drawPictureGL(data, width, height, yLinesize, uvLinesize)\n      } else {\n        this._drawPicture2d(data)\n      }\n    }\n\n    updateMeta (meta) {\n      this.meta = Object.assign({}, meta)\n      this._initMeta()\n    }\n\n    clear () {\n      if (this.contextGL) {\n        this.contextGL.clear(this.contextGL.DEPTH_BUFFER_BIT | this.contextGL.COLOR_BUFFER_BIT)\n      }\n    }\n  }\n\n  var timer\n  var frameRender\n\n  function initTimer (interval) {\n    stopTimer()\n    clearInterval(timer)\n    timer = setInterval(function () {\n      self.postMessage({ type: 'NEXT_TICK' })\n    }, interval)\n  }\n\n  function stopTimer () {\n    clearInterval(timer)\n  }\n\n  function initWebgl (canvas, meta, type) {\n    try {\n      frameRender = new FrameRender({\n        canvas,\n        meta,\n        type\n      })\n    } catch (e) {\n      self.postMessage({\n        type: 'RENDER_ERR',\n        msg: e && e.message\n      })\n    }\n  }\n\n  self.onmessage = function (e) {\n    var { type, interval } = e.data\n    switch (type) {\n      case 'START':\n        initTimer(interval)\n        break\n      case 'DESTROY':\n        stopTimer()\n        break\n      case 'OFFSCREEN_CANVAS':\n        if (!frameRender) {\n          initWebgl(e.data.canvas, e.data.meta, e.data.ctxType)\n        }\n        break\n      case 'UPDATE_META':\n        frameRender && frameRender.updateMeta(e.data.meta)\n        break\n      case 'RENDER':\n        try {\n          frameRender && frameRender.render(e.data.data, e.data.width, e.data.height, e.data.yLinesize, e.data.uvLinesize)\n        } catch (e) {\n          self.postMessage({\n            type: 'RENDER_ERR',\n            msg: e && e.message\n          })\n        }\n        break\n      case 'CLEAR':\n        frameRender && frameRender.clear()\n        break\n      default:\n    }\n  }\n"],{type:"application/javascript"}),a=new Worker(URL.createObjectURL(i));if((0,u.tT)().offscreenCanvas){var o=r.transferControlToOffscreen();a._offscreen=o,a._cvs=r,r._worker=a}return s.kg.log(this.TAG,"init canvas && worker, new created"),[r,a]}catch(e){setTimeout(function(){n._emitError(e.message)})}return[]}},{key:"_bindEvent",value:function(){this._worker.addEventListener("message",this._doTask),this._worker.addEventListener("error",this._onError)}},{key:"startLoop",value:function(e){var t;(e=parseInt(e))<10?e=10:e>60?e=60:e-=8,null===(t=this._worker)||void 0===t||t.postMessage({type:"START",interval:e})}},{key:"stopLoop",value:function(){this._worker.postMessage({type:"DESTROY"})}},{key:"initRenderContext",value:function(e){var t,n,r,i=e.meta,a=e.type;if(null!==(t=this._worker)&&void 0!==t&&t._offscreen&&(this._worker._offscreen.width=i.width,this._worker._offscreen.height=i.height),null!==(n=this._worker)&&void 0!==n&&null!==(r=n._offscreen)&&void 0!==r&&r.cloned){this._worker.postMessage({type:"UPDATE_META",meta:i});return}this._worker.postMessage({type:"OFFSCREEN_CANVAS",canvas:this._worker._offscreen,meta:i,ctxType:a},[this._worker._offscreen]),this._worker._offscreen.cloned=1}},{key:"render",value:function(e,t,n,r,i){this._worker.postMessage({type:"RENDER",data:e,width:t,height:n,yLinesize:r,uvLinesize:i},[e])}},{key:"destroy",value:function(e){this._worker&&(this._worker.postMessage({type:"DESTROY"}),this._worker.removeEventListener("message",this._doTask),this._worker.removeEventListener("error",this._onError),e&&!this._errorOccur&&(c.push(this._worker),this._worker.postMessage({type:"CLEAR"}),s.kg.log(this.TAG,"cache render worker")),this._worker=null,this._task=null)}}]),e}()},742983:function(e,t,n){n.d(t,{b:function(){return v}});var r=n("981500"),i=n("101132"),a=n("417680"),o=n("429571"),s=n("933330"),u=n("410486"),c=n("393046"),l=n("554946"),d=function(){function e(){(0,r.PA)(this,e),(0,r._x)(this,"_data",Object.create(null))}return(0,r.qH)(e,[{key:"set",value:function(e,t){this._data[e]=t}},{key:"get",value:function(e){return this._data[e]}},{key:"clear",value:function(){this._data=Object.create(null)}}]),e}(),g=n("146598"),h=n("159322"),f=n.n(h),p=["vid","cache"],v=function(e){(0,r.XW)(k,e);var t,n,h,f,v,m,_,I,C,A,y,b=(0,r.WY)(k);function k(e){(0,r.PA)(this,k),t=b.call(this),(0,r._x)((0,r.Lc)(t),"vid",""),(0,r._x)((0,r.Lc)(t),"url",""),(0,r._x)((0,r.Lc)(t),"meta",{}),(0,r._x)((0,r.Lc)(t),"downloadInfo",[]),(0,r._x)((0,r.Lc)(t),"videoSegments",[]),(0,r._x)((0,r.Lc)(t),"audioSegments",[]),(0,r._x)((0,r.Lc)(t),"cache",null),(0,r._x)((0,r.Lc)(t),"_currentSegmentIndex",-1),(0,r._x)((0,r.Lc)(t),"_currentLoadingSegmentIndex",-1),(0,r._x)((0,r.Lc)(t),"buffer",void 0),(0,r._x)((0,r.Lc)(t),"bufferDataLen",0),(0,r._x)((0,r.Lc)(t),"_error",void 0),(0,r._x)((0,r.Lc)(t),"_transformError",function(e){return e}),t._config=(0,c.i)(e);var t,n=t._config,s=n.vid,u=n.cache,l=(0,r.Kd)(n,p);return t.cache=u||new d,t.vid=s||l.url,t.url=l.url,l.transformError=t._transformError,t.logger=new i.Y("MP4Loader_"+t.vid),e.openLog&&i.Y.enable(),l.logger=t.logger,t._loader=new a.mf(l),t._loader.on(o.K.REAL_TIME_SPEED,function(e){t.emit(o.K.REAL_TIME_SPEED,e)}),t}return(0,r.qH)(k,[{key:"isMetaLoaded",get:function(){return this.videoSegments.length||this.audioSegments.length}},{key:"setCurrentSegment",value:function(e){(0,g.hj)(e)&&(this._currentSegmentIndex=e)}},{key:"isLastSegment",value:function(e){if((0,g.hj)(e)){var t,n;return e>=((null===(t=this.videoSegments[this.videoSegments.length-1])||void 0===t?void 0:t.index)||(null===(n=this.audioSegments[this.audioSegments.length-1])||void 0===n?void 0:n.index)||0)}return!1}},{key:"isSegmentLoading",value:function(e){return e===this._currentLoadingSegmentIndex}},{key:"changeUrl",value:(t=(0,r.x)((0,r.l5)().mark(function e(t){var n,i,a,o=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:t,i=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,e.next=5,this.reset(a);case 5:t&&(this.url=t),n&&(this.vid=n),i&&(this._config.moovEnd=i);case 8:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getOrLoadMeta",value:(n=(0,r.x)((0,r.l5)().mark(function e(t){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(t);case 3:return e.abrupt("return",this.meta);case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"newBufferArray",value:function(e,t){var n;if(this.buffer){if(t||(null===(n=this.buffer)||void 0===n?void 0:n.byteLength)<e){var r,i=this.buffer.subarray(0,this.bufferDataLen),a=(0,s.xf)(((null===(r=this.buffer)||void 0===r?void 0:r.byteLength)||0)+e);a.set(i,0),delete this.buffer,this.buffer=a}}else this.buffer=(0,s.xf)(e),this.bufferDataLen=0}},{key:"loadMetaProcess",value:(h=(0,r.x)((0,r.l5)().mark(function e(t,n,i){var a,o=this,c,d,h,f,p,v=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d=(c=(0,r.ZQ)(n,2))[0],h=c[1],f=v.length>3&&void 0!==v[3]?v[3]:{},this._error=!1,this.logger.debug("[loadMetaProcess start], range,",[d,h]),null!==(a=this._config)&&void 0!==a&&a.memoryOpt&&(!this.buffer||null!=f&&f.isExp))try{this.newBufferArray(h-d+1,null==f?void 0:f.isExp)}catch(e){i(null,!0,{},new l.c(null==e?void 0:e.message),{})}return p=function(){var e=(0,r.x)((0,r.l5)().mark(function e(n,a,c,p){var v,m,_,I,C,A,y,b,k,S,E;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o.meta&&null!=c&&c.range&&c.range.length>0&&c.range[1]>=h&&(a=!0,o.logger.debug("[loadMetaProcess],data done,setstate true,[",d,h,"]")),a&&null!=c&&c.range&&c.range.length>0&&c.range[1]<h&&(a=!1,o.logger.debug("[loadMetaProcess],data not done,setstate false,[",d,h,"]")),o.logger.debug("[loadMetaProcess],task,[",d,h,"], range,",c.range,",dataLen,",n?n.byteLength:void 0,", state,",a,",err,",o._error),!o._error&&n&&n.byteLength>0&&i(n,a,c,null,p),!(o.meta.moov||o._error)){e.next=6;break}return e.abrupt("return");case 6:if(!(n&&n.byteLength>0)){e.next=52;break}e.prev=7,null!==(m=o._config)&&void 0!==m&&m.memoryOpt?(o.buffer.set(n,o.bufferDataLen),o.bufferDataLen+=(null==n?void 0:n.byteLength)||0,v=o.buffer.subarray(0,o.bufferDataLen)):(o.buffer=(0,s.gJ)(o.buffer,n),v=o.buffer),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(7),i(null,a,c,new l.c(null===e.t0||void 0===e.t0?void 0:e.t0.message),p),e.abrupt("return");case 15:if(_=u.I.findBox(v,["moov"])[0]){e.next=30;break}if(I=u.I.findBox(v,["mdat"])[0],!a){e.next=30;break}if(I){e.next=25;break}return o._error=!0,i(null,a,c,new l.c("cannot find moov or mdat box"),p),e.abrupt("return");case 25:return C=I.start+I.size,e.next=28,o.loadData([C,""],t,f);case 28:(A=e.sent)&&(_=u.I.findBox(A.data,["moov"])[0]);case 30:if(!(_&&a&&_.size>_.data.length)){e.next=34;break}return o.logger.debug("[loadMetaProcess],moov not all, range,",c.range[1],",dataLen,",o.bufferDataLen,", state,",a),e.next=34,o.loadMetaProcess(t,[c.range[1],_.start+_.size-1],i,{isExp:!0});case 34:if(!(_&&_.size<=_.data.length&&!o.meta.moov)){e.next=52;break}if(b=u.I.moov(_)){e.next=40;break}return o._error=!0,i(null,a,c,new l.c("cannot parse moov box"),p),e.abrupt("return");case 40:if(k=(0,g._H)(b,o._config),(0,g.d0)(k)){e.next=45;break}return o._error=!0,i(null,a,c,new l.c("cannot parse segments"),p),e.abrupt("return");case 45:o.meta=(0,g.$Z)(b),S=k.videoSegments,E=k.audioSegments,o.videoSegments=S,o.audioSegments=E,null!==(y=o._config)&&void 0!==y&&y.memoryOpt&&(delete o.buffer,o.bufferDataLen=0),o.logger.debug("[loadMetaProcess] moov ok"),i(void 0,a,{meta:{meta:o.meta,videoSegments:S,audioSegments:E}},null,p);case 52:case"end":return e.stop()}},e,null,[[7,11]])}));return function(t,n,r,i){return e.apply(this,arguments)}}(),e.next=8,this.loadData([d,h||this._config.moovEnd],t,(0,r.Zj)({onProgress:p},f));case 8:case"end":return e.stop()}},e,this)})),function(e,t,n){return h.apply(this,arguments)})},{key:"loadMeta",value:(f=(0,r.x)((0,r.l5)().mark(function e(t,n){var i,a,o,c,d,h,f,p,v,m,_=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=_.length>2&&void 0!==_[2]?_[2]:{},a=[],this.logger.debug("[loadMeta start]"),e.next=5,this.loadData([0,n||this._config.moovEnd],t,i);case 5:if(o=e.sent){e.next=8;break}return e.abrupt("return");case 8:if(a.push(o),c=u.I.findBox(o.data,["moov"])[0]){e.next=24;break}if(d=u.I.findBox(o.data,["mdat"])[0]){e.next=14;break}throw new l.c("cannot find moov or mdat box",o.data);case 14:return h=d.start+d.size,e.next=17,this.loadData([h],t,i);case 17:if(o=e.sent){e.next=20;break}return e.abrupt("return");case 20:if(a.push(o),c=u.I.findBox(o.data,["moov"],h)[0]){e.next=24;break}throw new l.c("cannot find moov box",o.data);case 24:if(!(c.size>c.data.length)){e.next=32;break}return e.next=27,this.loadData([o.data.length,c.start+c.size-1],t,i);case 27:if(o=e.sent){e.next=30;break}return e.abrupt("return");case 30:a.push(o),c.data=(0,s.gJ)(c.data,o.data);case 32:if(f=u.I.moov(c)){e.next=35;break}throw new l.c("cannot parse moov box",c.data);case 35:if(p=(0,g._H)(f,this._config),(0,g.d0)(p)){e.next=38;break}throw new l.c("cannot parse segments",c.data);case 38:return this.meta=(0,g.$Z)(f),v=p.videoSegments,m=p.audioSegments,this.videoSegments=v,this.audioSegments=m,delete this.buffer,this.bufferDataLen=0,this.logger.debug("[load moov end!!!!!]"),e.abrupt("return",{meta:this.meta,videoSegments:v,audioSegments:m,responses:a});case 46:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"loadCacheMeta",value:function(e,t){var n=e.moov,r=(0,g._H)(n,this._config),i=r.videoSegments,a=r.audioSegments;this.videoSegments=i,this.audioSegments=a,this._currentSegmentIndex=t,this.meta=e}},{key:"getSegmentByTime",value:function(e){var t,n;return this.videoSegments.length?(t=this.videoSegments.find(function(t){return t.startTime<=e&&t.endTime>e}))&&(n=this.audioSegments[t.index]):n=this.audioSegments.find(function(t){return t.startTime<=e&&t.endTime>e}),{video:t,audio:n}}},{key:"loadSegmentByTime",value:(v=(0,r.x)((0,r.l5)().mark(function e(t,n){var i,a,o,s,u,c=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(c.length>2)||void 0===c[2]||c[2],a=c.length>3&&void 0!==c[3]?c[3]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta(n);case 5:return s=(o=this.getSegmentByTime(t)).video,u=o.audio,e.abrupt("return",this._loadSegment(s,u,n,i,a));case 7:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"loadNextSegment",value:(m=(0,r.x)((0,r.l5)().mark(function e(t){var n,i,a,o,s=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(s.length>1)||void 0===s[1]||s[1],i=s.length>2&&void 0!==s[2]?s[2]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta();case 5:return a=this.videoSegments[this._currentSegmentIndex+1],o=this.audioSegments[this._currentSegmentIndex+1],e.abrupt("return",this._loadSegment(a,o,t,n,i));case 8:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"preload",value:(_=(0,r.x)((0,r.l5)().mark(function e(t){var n,i,a,o,s,u,c,l=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(!0);case 3:if(!(!t||t<0)){e.next=5;break}return e.abrupt("return");case 5:if(i=(n=this.getSegmentByTime(t)).video,a=n.audio,o=Math.max((null==i?void 0:i.index)||0,(null==a?void 0:a.index)||0)){e.next=9;break}return e.abrupt("return");case 9:return s=this.videoSegments.slice(0,o),u=this.audioSegments.slice(0,o),c=function(){var e=(0,r.x)((0,r.l5)().mark(function e(t){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>o)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,l._loadSegment(s[t],u[t],!0,!1);case 4:return e.next=6,c(t+1);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),e.next=14,c(0);case 14:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"cancel",value:function(){return this._loader.cancel()}},{key:"reset",value:(I=(0,r.x)((0,r.l5)().mark(function e(){var t,n=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.length>0&&void 0!==n[0]&&n[0]){e.next=5;break}return this.logger.debug("[MP4loader reset func call loader.cancel]"),e.next=5,this._loader.cancel();case 5:this.vid=this.url="",this.meta={},this.downloadInfo=[],this.videoSegments=[],this.audioSegments=[],this._currentSegmentIndex=-1,this._currentLoadingSegmentIndex=-1,null!==(t=this._config)&&void 0!==t&&t.memoryOpt&&(delete this.buffer,this.bufferDataLen=0);case 13:case"end":return e.stop()}},e,this)})),function(){return I.apply(this,arguments)})},{key:"destroy",value:(C=(0,r.x)((0,r.l5)().mark(function e(){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reset();case 2:this.cache.clear();case 3:case"end":return e.stop()}},e,this)})),function(){return C.apply(this,arguments)})},{key:"_loadSegment",value:(A=(0,r.x)((0,r.l5)().mark(function e(t,n,i,a,o){var s,u;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!t&&!n)){e.next=2;break}return e.abrupt("return");case 2:return s=(null==t?void 0:t.index)||(null==n?void 0:n.index)||0,this._currentLoadingSegmentIndex=s,e.prev=4,e.next=7,this.loadData([Math.min((null==t?void 0:t.range[0])||1/0,(null==n?void 0:n.range[0])||1/0),Math.max((null==t?void 0:t.range[1])||0,(null==n?void 0:n.range[1])||0)],i,o);case 7:u=e.sent;case 8:return e.prev=8,this._currentLoadingSegmentIndex=-1,e.finish(8);case 11:if(u){e.next=13;break}return e.abrupt("return");case 13:return a&&(this._currentSegmentIndex=s),u.video=t,u.audio=n,e.abrupt("return",u);case 17:case"end":return e.stop()}},e,this,[[4,,8,11]])})),function(e,t,n,r,i){return A.apply(this,arguments)})},{key:"loadData",value:(y=(0,r.x)((0,r.l5)().mark(function e(t,n){var i,a,o,s,u,c=arguments;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>2&&void 0!==c[2]?c[2]:{},a=this._getCacheKey(t),e.next=4,this.cache.get(a);case 4:if(o=e.sent){e.next=12;break}return u=null!=i&&i.url?i.url:this.url,e.next=9,this._loader.load(u,(0,r.Zj)({range:t,vid:this.vid},i));case 9:s=e.sent,e.next=13;break;case 12:s={data:o,state:!0,options:{fromCache:!0,range:t,vid:this.vid}};case 13:if(s){e.next=15;break}return e.abrupt("return");case 15:return!o&&(s.data&&this.downloadInfo.push({startTime:s.startTime,endTime:s.endTime,size:s.data.byteLength,range:t}),this.downloadInfo&&this.downloadInfo.length>this._config.maxDownloadInfoSize&&(this.downloadInfo=this.downloadInfo.slice(-this._config.maxDownloadInfoSize))),e.abrupt("return",s);case 18:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"_getCacheKey",value:function(e){return(this.vid||this.url)+":"+e}}]),k}(f())},788539:function(e,t,n){n.d(t,{j:function(){return r}});var r="undefined"!=typeof window},292263:function(e,t,n){n.d(t,{G7:function(){return o},Gu:function(){return i},pl:function(){return u},rO:function(){return s}});var r=n(509399);function i(e){if(!!e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function a(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function o(e,t){if(e){if(!t)return e;var n,i=Object.keys(t).map(function(e){if(null!=(n=t[e]))return Array.isArray(n)?e+="[]":n=[n],n.map(function(t){return(0,r.J_)(t)?t=t.toISOString():(0,r.Kn)(t)&&(t=JSON.stringify(t)),"".concat(a(e),"=").concat(a(t))}).join("&")}).filter(Boolean).join("&");if(i){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}}function s(e,t,n,r,i,a,o,s,u,c,l){return i=null!=i?parseFloat(i):null,Number.isNaN(r=parseInt(r||"0",10))&&(r=0),{data:e,done:t,options:{range:u,vid:c,index:s,contentLength:r,age:i,startTime:a,firstByteTime:o,endTime:Date.now(),priOptions:l},response:n}}function u(e,t){return Math.round(8e3*e/t/1024)}},473886:function(e,t,n){n.d(t,{U:function(){return i},t:function(){return r}});var r={FETCH:"fetch",XHR:"xhr"},i={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"}},393293:function(e,t,n){n.d(t,{C:function(){return a}});var r=n(15810),i=n(171569),a=function(e){(0,r.XW)(n,e);var t=(0,r.WY)(n);function n(e,a,o,s){var u;return(0,r.PA)(this,n),u=t.call(this,s),(0,r._x)((0,r.Lc)(u),"retryCount",0),(0,r._x)((0,r.Lc)(u),"isTimeout",!1),(0,r._x)((0,r.Lc)(u),"loaderType",i.t.FETCH),(0,r._x)((0,r.Lc)(u),"startTime",0),(0,r._x)((0,r.Lc)(u),"endTime",0),(0,r._x)((0,r.Lc)(u),"options",{}),u.url=e,u.request=a,u.response=o,u}return(0,r.qH)(n)}((0,r.wm)(Error))},496549:function(e,t,n){n.d(t,{_v:function(){return r}});function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(t){return setTimeout(t,e)})}},398692:function(e,t,n){n.d(t,{j:function(){return r}});var r="undefined"!=typeof window}}]);